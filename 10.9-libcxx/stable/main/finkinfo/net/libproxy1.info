Package: libproxy1
Version: 0.4.18
# later versions need meson to build
Revision: 3
Source: https://github.com/libproxy/libproxy/releases/download/%v/libproxy-%v.tar.xz
Source-Checksum: SHA256(69b5856e9ea42c38ac77e6b8c92ffc86a71d341fef74e77bef85f9cc6c47a4b1)
BuildDepends: <<
	cmake,
	fink (>= 0.32),
	fink-buildenv-modules,
	fink-package-precedence,
	pkgconfig (>= 0.23)
<<
Depends: %n-shlibs (= %v-%r)
Conflicts: libproxy0
Replaces: libproxy0
BuildDependsOnly: true
GCC: 4.0
PatchFile: %n.patch
PatchFile-MD5: 894b1be417dcd7fa2a148b80cf0f858f
PatchScript: <<
	%{default_script}
	perl -pi -e 's/_POSIX_C_SOURCE/_DARWIN_C_SOURCE/' libproxy/CMakeLists.txt
<<
CompileScript: <<
#!/bin/sh -ev
	. %p/sbin/fink-buildenv-cmake.sh
	cmake \
		$FINK_CMAKE_ARGS  \
		-DCMAKE_C_FLAGS:STRING=-MD \
		-DCMAKE_CXX_FLAGS:STRING="-MD -std=c++11" \
		-DWITH_DUKTAPE:BOOL=OFF \
		-DWITH_PERL:BOOL=OFF \
		-DWITH_PYTHON2:BOOL=OFF \
		-DWITH_PYTHON3:BOOL=OFF
	make
	fink-package-precedence --depfile-ext='\.d' --prohibit-bdep=%n .
<<
InstallScript: <<
	make install DESTDIR=%d
<<
InfoTest: TestScript: make test || exit 2
SplitOff: <<
	Package: %N-shlibs
	Files: <<
		lib/libproxy.1.0.0.dylib
		lib/libproxy.1.dylib
	<<
	Shlibs: <<
		%p/lib/libproxy.1.dylib 1.0.0 %n (>= 0.4.0-1)
	<<
	DocFiles:AUTHORS COPYING ChangeLog NEWS README
<<
SplitOff2: <<
	Package: libproxy-bin
	Depends: %N-shlibs (>= %v-%r)
	Files: bin
	DocFiles: AUTHORS COPYING ChangeLog NEWS README
	Description: Command-line proxy detector
<<
DocFiles: AUTHORS COPYING ChangeLog NEWS README
DescPackaging: <<
	Hacking CMakeLists.txt seems to be only way to disable building
	certain plugins.

	We're apple, but we still want public lib-detection files.
<<
DescDetail: <<
	This is the core library only, and the plugins to support
	proxy-configuration via envvar and file. Other plugins will be
	packaged separately. Note: plugins are tied to specific %%v of
	library, not its ABI or other libversion field. Updating
	library package will require updating external plugin
	packages.
<<
Description: Generic access to network proxy settings
Homepage: https://libproxy.github.io/libproxy
License: LGPL
Maintainer: Daniel Macks <dmacks@netspace.org>
