Package: libxar-apple1-shlibs
Version: 494.81.1
Revision: 1
Source: https://github.com/apple-oss-distributions/xar/archive/refs/tags/xar-%v.tar.gz
Source-Checksum: SHA256(5c1f3d4252c08909f6407964f2776e6d35a67f8dfbaa6b2594ce2a4f6d730a76)
SourceDirectory: xar-xar-%v
BuildDepends: <<
	bzip2-dev,
	fink-package-precedence,
	libxml2 (>= 2.9.1-1),
	openssl300-dev
<<
Depends: <<
	bzip2-shlibs,
	libxml2-shlibs (>= 2.9.1-1),
	openssl300-shlibs
<<
PatchFile: %n.patch
PatchFile-MD5: 505e04b130799b9b25b5fb66d9c25fbf
SetCPPFLAGS: -DXARSIG_BUILDING_WITH_XAR -MD -DNO_COMMONCRYPTO
SetLIBS: -lcrypto
ConfigureParams: --disable-static --libdir=%p/lib/xar-apple
CompileScript: <<
#!/bin/sh -ev
	pushd xar
	%{default_script}
	fink-package-precedence --depfile-ext='\.d' --prohibit-bdep=libxar-apple1-dev .
<<
InfoTest: <<
	TestScript: <<
	#!/bin/sh -ex
		pushd xar/test
		PATH=%b/xar/src:$PATH
		PYTHON=/usr/bin/python
		[ -x $PYTHON ] || PYTHON=/usr/bin/python3
		for t in *.py; do
			$PYTHON $t || exit 2
		done
	<<
<<
InstallScript: <<
#!/bin/sh -ev
	pushd xar
	make install DESTDIR=%d
<<
DocFiles: xar/LICENSE xar/TODO
Shlibs: %p/lib/xar-apple/libxar.1.dylib 1.0.0 %n (>= 494.81.1-1)
SplitOff: <<
	Package: xar
	Depends: <<
		%N (>= %v-%r),
		bzip2-shlibs,
		libxml2-shlibs (>= 2.9.1-1),
		openssl300-shlibs
	<<
	Files: <<
		bin
		share/man
	<<
	DocFiles: xar/LICENSE xar/TODO
<<
SplitOff2: <<
	Package: libxar-apple1-dev
	Depends: %N (= %v-%r)
	Conflicts: <<
		libxar1-dev,
		libxar-apple1-dev
	<<
	Replaces: <<
		xar (<< 1.4-3),
		libxar1-dev,
		libxar-apple1-dev
	<<
	BuildDependsOnly: true
	Files: <<
		include
		lib/xar-apple/libxar.{dylib,la}
	<<
	DocFiles: xar/LICENSE xar/TODO
<<
License: BSD
Description: The eXtensible ARchiver
DescDetail: <<
xar is an archiver meant to handle the archival tasks of the 21st 
century.  It handles Extended Attributes, ACLs, Resource Forks, can
extract archives to match up the usernames/groupnames of files it
has archived (as opposed to just matching up uids/gids), and can
make you coffee.
<<
DescPort: <<
	Hack to build the non-Apple variant for compatibility to older
	OSX releases (as of 494.81.1, claims to omit features on
	platforms prior to 12.0)
<<
DescPackaging: <<
	Source provenance:
		http://xar.googlecode.com
		https://github.com/mackyle/xar
		https://github.com/tpoechtrager/xar
		https://github.com/jimafisk/xar
	At some point, apple forked it, leading to:
		https://github.com/apple-oss-distributions/xar
		https://github.com/val-verde/apple-xar

	We hack in a preprocessor token to allow forcing internal
	support of crypto via openssl, even if platform-detection
	would prefer CommonCrypto. That allows building recent
	versions even on older OSX platforms.

	We base our package on Apple's, with val-verde's patch for
	newer openssl:
	      https://github.com/val-verde/apple-xar/commit/36ff6763444e591803ce8dc14466b092c731e614

	The build creates two shared libs--one with install_name in %p
	the other in %b. It also creates two runtime binaries--one
	linked against each shared lib. Doesn't use libtool, so this
	game allows test-run everything during building.

	Manually run the tests, but don't abort for the known fails.
<<
Maintainer: None <fink-devel@lists.sourceforge.net>
Homepage: https://github.com/apple-oss-distributions/xar
