Info2: <<
Package: duplicity
Version: 3.0.7
Revision: 1
Description: Encrypted backup using rsync algorithm
License: GPL
Homepage: http://duplicity.nongnu.org/
Maintainer: Scott Hannahs <shannahs@users.sourceforge.net>

# Dependencies.
BuildDepends: <<
	fink (>= 0.24.12-1),
	librsync2,
	sphinx-py310
<<

# boto3-py, ncftp, lft2, par2, pexepect, fastners-py, lxml-py310 needed for backends
Depends: <<
	python310,
	librsync2-shlibs (>= 2.0),
	librsync-bin (>= 2.0),
	gnupg2,
	intltool40,
	ncftp,
	lftp,
	par2,
	setuptools-tng-py310,
	boto3-py310,
	fasteners-py310,
	lxml-py310,
	paramiko-py310,
	pexpect-py310,
	requests-oauthlib-py310
<<

# Unpack Phase.
Source: https://gitlab.com/%n/%n/-/archive/rel.%v/%n-rel.%v.tar.gz
Source-Checksum: SHA256(39a7dab3e335f33510759b2f26f56a82e6c8c74a73119b3950b738c902ed7f46)
PatchFile: %n.patch
PatchFile-Checksum: SHA256(7ee4a5653a15282fbd301441b3472e07f2271187cd1d3f1188ea5e3841bf40b7)

# Patch Phase.
PatchScript: <<
	patch -p1 < %{PatchFile}
	grep -rl '^\#!.*python' 2> /dev/null | xargs -n1 perl -pi -e 's|/usr/bin/python3$|%p/bin/python3.10|g'
	grep -rl '^\#!.*python' 2> /dev/null | xargs -n1 perl -pi -e 's|/usr/bin/env python3$|/usr/bin/env %p/bin/python3.10|g'
	grep -rl 'python3[^\.]' 2> /dev/null | xargs -n1 perl -pi -e 's|\(\["python3"\]\)|\(\["python3.10"\]\)|g'
<<

# Compile Phase.
CompileScript: %p/bin/python3.10 setup.py build  --librsync-dir=%p

InfoTest: <<
    TestDepends: <<
	pytest-py310,
	pytest-cov-py310,
	pytest-runner-py310,
	coverage-py310,
	black-py310 (>=24.8.0),
	pycodestyle-py310,
	pylint-py310
    <<
    TestScript: <<
    	#!/bin/sh -ev
	ulimit -n 8192
	echo $PATH
	trap "gpg-connect-agent KILLAGENT /bye ; exit" 0 1 2 3 15
	mkdir "$HOME/.gnupg"
	gpg-connect-agent /bye
	%p/bin/pytest-3.10 -p no:xdist -p no:hypothesis -p no:randomly
    <<
<<

# Install Phase.
DocFiles: CHANGELOG.md AUTHORS.md COPYING README-LOG.md README-REPO.md README-TESTING.md README.md
InstallScript: <<
	%p/bin/python3.10 setup.py install --prefix=%p --root=%d  --librsync-dir=%p
	mkdir -p %i/bin
	cp %b/debian/duplicity.sh %i/bin/duplicity
	chmod a+x %i/bin/duplicity
<<

# Documentation.
DescDetail: <<
Duplicity backsup directories by producing encrypted
tar-format volumes and uploading them to a remote
or local file server. Because duplicity uses
librsync, the incremental archives are space
efficient and only record the parts of files that
have changed since the last backup. Because
duplicity uses GnuPG to encrypt and/or sign these
archives, they will be safe from spying and/or
modification by the server.

The duplicity package also includes the rdiffdir
utility. Rdiffdir is an extension of librsync's
rdiff to directories---it can be used to produce
signatures and deltas of directories as well as
regular files. These signatures and deltas are in
GNU tar format.
<<

DescPackaging:  <<
Documentation not built and installed since
exists on the web.
The testing phase needs more than the default 256
maximum files, it is set to 8192 in the test script.
Testing Phase (on MacOS 15.3.1) has
3 failed, 461 passed, 17 skipped, 1 xpassed (700.03s)
1 failed test due to not installing rdiff
1 failed test due to not installing black-py
XPASS error is in GPGWriteFile
supports
  ssh parmiko
  ssh pexpect
  rsync
  ncftp
  onedrive
  Amazon web services (multi-processing and Glacier)
  Google Cloud Storage

Other backends
Backend Requirements:
 * scp/sftp paramiko -- python-paramiko
 * scp/sftp pexpect -- openssh, pexpect
 * lftp -- lftp version 3.7.15 or later
 * ncftp -- ncftp
 * OneDrive -- python-requests & python-requests-oauthlib
(not Installed)
 * Azure -- python Azure SDK (not implemented)
 * Boto 2.7.0 or later for Glacier S3 access

Previously maintained by Murali Vadivelu
<<
#Info2
<<
