Info3: <<
  Package: clamav8-shlibs
  Version: 0.100.3
  Revision: 1

  Description: Shared libraries for ClamAV
  DescDetail: <<
    Clam AntiVirus is a GPL anti-virus toolkit for UNIX, designed
    especially for e-mail scanning on mail gateways. It provides
    a number of utilities including a flexible and scalable multi-
    threaded daemon, a command line scanner and advanced tool for
    automatic database updates. The core of the package is an
    anti-virus engine available in a form of shared library.
  <<

  DescPackaging: <<
    clamscan requires a user named 'clamav' to run in
    superuser mode regardless of how it was built. (Important when
    running the post-build tests because fink runs as root).

    During the test the virus database isn't actually installed yet so
    the one in the build directory is specified.

    The database directory %i/var/db/clamav must be owned by the 'clamav'
    user. This requires a change of the owner during the build.
    Therefore, we cannot build as 'nobody'.

    Original package maintainer was Carsten Klapp
    <carstenklapp@users.sourceforge.net>.
  <<
  DescPort: <<
    Install virus databases into %p/var/db/clamav instead of default
    %p/share/clamav; %p/share is for static data.
  <<

  Maintainer: Remi Mommsen <remigius.mommsen@cern.ch>
  Homepage: http://www.clamav.net/
  License: GPL/OpenSSL
  Source: http://www.clamav.net/downloads/production/clamav-%v.tar.gz
  Source-MD5: 6ba3c2476bc71f746733c16d1a0c1926

  BuildDepends: <<
    fink (>= 0.24.12),
    fink-package-precedence,
    bzip2-dev,
    libiconv-dev,
    libncurses5,
    libpcre2,
    libtool2 (>= 2.4.2-4),
    libxml2 (>= 2.9.1-1),
    openssl110-dev,
    pkgconfig
  <<
  Depends: <<
    bzip2-shlibs,
    libncurses5-shlibs,
    libpcre2-shlibs,
    libtool2-shlibs (>= 2.4.2-4),
    libxml2-shlibs (>= 2.9.1-1),
    openssl110-shlibs
  <<

  PatchScript: <<
    %{default_script}
    /usr/bin/sed -i'.bak' -e 's/LC_AGE=1/LC_AGE=0/g' -e 's/-print-multi-os-directory//g' configure*
    /usr/bin/sed -i'.bak' -e 's/${wl}-flat_namespace ${wl}-undefined ${wl}suppress/${wl}-twolevel_namespace/g' libclamav/libmspack-0.5alpha/configure*
  <<

  SetCFLAGS: -O3
  CompileScript: <<
    #!/bin/sh -ev
    ./configure --prefix=%p --with-dbdir=%p/var/db/clamav \
                --enable-dependency-tracking --disable-clamav \
                --with-openssl=%p --with-pcre=%p --with-xml=%p \
                --with-zlib=$(xcrun --sdk macosx --show-sdk-path)/usr
    make
    fink-package-precedence --prohibit-bdep=clamav8-dev,clamav9-dev .
  <<
  InstallScript: <<
    #!/bin/sh -ev
    /usr/bin/make install DESTDIR=%d

    /bin/rm -r %i/bin %i/etc %i/sbin %i/share
  <<

  Shlibs: <<
    %p/lib/libclamav.8.dylib          9.0.0 %n (>= 0.95-1)
    %p/lib/libclamunrar.8.dylib       9.0.0 %n (>= 0.95-1)
    %p/lib/libclammspack.0.dylib      2.0.0 %n (>= 0.100-1)
  <<

  SplitOff: <<
    Package: clamav8-dev
    Description: Developer files for ClamAV
    Replaces: clamav8-dev,clamav9-dev
    Conflicts: clamav8-dev,clamav9-dev
    Depends: <<
      clamav8-shlibs (=%v-%r)
    <<
    Provides: clamav-dev
    BuildDependsOnly: true
    Files: <<
      include
      lib/pkgconfig
      lib/*.la
      lib/libclamav.dylib
      lib/libclammspack.a
      lib/libclammspack.dylib
      lib/libclamunrar.dylib
      lib/libclamunrar_iface*so
    <<
  <<
<<
