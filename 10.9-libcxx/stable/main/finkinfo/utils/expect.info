Package: expect
# dylib install_name is tied to package micro version number
Version: 5.45.4
Revision: 1
Maintainer: None <fink-devel@lists.sourceforge.net>
BuildDepends: <<
	autoconf2.6,
	fink (>= 0.32),
	tcltk-dev (>= 8.6.1-1),
	x11-dev
<<
Depends: <<
	tcl-%n (>= %v-%r),
	tcl-libdirs,
	tcltk (>= 8.6.1-1),
	tcltk-shlibs (>= 8.6.1-1)
<<
Conflicts: %N-dev
Replaces: %N-dev
Source: mirror:sourceforge:%n/Expect/%v/%n%v.tar.gz
Source-Checksum: SHA256(49a7da83b0bdd9f46d04a04deec19c7767bb9a323e40c4781f89caf760b92c34)
Source2: mirror:debian:pool/main/e/%n/%n_%v-4.debian.tar.xz
Source2-Checksum: SHA256(3f8b9600ccf3d0d9afaa029ab3831327512311dc945879f11757041190f8b3ab)
PatchFile: %n.patch
PatchFile-MD5: 2f98c4647c1eb433b4fb47f7d1cfbbb1
# Uses autoconf but not automake, so there's no simple way to trigger
# autotools to handle this one:
UpdateConfigGuessInDirs: tclconfig
ConfigureParams: <<
	--with-tcl=%p/lib \
	--with-tk=%p/lib \
	--with-tkinclude=%p/include \
	--with-tclinclude=%p/include/tcltk-private/tcl8.6/generic \
	--libdir=%p/lib/tcl-libdirs/8.6
<<
PatchScript: <<
	#!/bin/sh -ev
	for p in `cat ../debian/patches/series`; do
		[[ $p == "05-makefile-soname.patch" ]] && continue;
		[[ $p == "06-pkgindex.patch" ]] && continue;
		echo "applying Debian's $p"
		patch -p1 < ../debian/patches/$p
	done
	sed -e 's,@SONAME@,%p/lib/tcl-libdirs/8.6/%n%v/libexpect%v.dylib,' < %{PatchFile} | patch -p1
<<
InfoTest: TestScript: make test || exit 2
SetLDFLAGS: -ltcl8.6
CompileScript: <<
	#!/bin/sh -ev
	autoreconf -fi
	./configure %c
	make
<<
InstallScript: <<
	#!/bin/sh -ev
	make install DESTDIR=%d

	mkdir -p %i/lib/tcl-libdirs
	ln -s tcl-libdirs/%n%v/libexpect%v.dylib %i/lib/libexpect.dylib
<<
# Doesn't seem to have any reverse-depends outside of this .info, but
# it does have a header (and simple-name symlink for linking by
# others, per Debian packaging). Will leave it quasi-public but not
# strictly "Shlibs policy" for now (again, per Debian).
SplitOff: <<
	Package: tcl-%N
	Depends: <<
		tcltk (>= 8.6.1-1),
		tcltk-shlibs (>= 8.6.1-1)
	<<
	Conflicts: %N-dev
	Replaces: %N-dev
	Files: <<
		lib/tcl-libdirs
	<<
	Shlibs: %p/lib/tcl-libdirs/8.6/%N%v/libexpect%v.dylib 5.45.4 %n (>= 5.45.4-1)
	DocFiles: README
<<
SplitOff2: <<
	Package: tcl-%N-dev
	Depends: tcl-%N (= %v-%r)
	BuildDependsOnly: true
	# converge to Debian's layout
	Conflicts: %N-dev
	Replaces: %N-dev
	Files: <<
		include
		lib/libexpect.dylib
		share/man/man3
	<<
	DocFiles: README
<<
DocFiles: FAQ HISTORY NEWS README
Description: Tool for automatic interactive applications
DescDetail: <<
Expect is a tool for automating interactive applications such as
telnet, ftp, passwd, fsck, rlogin, tip, etc. Expect really makes this
stuff trivial. Expect is also useful for testing these same
applications. 
<<
DescPackaging: <<
	Import debian's patch-set (see Source2)
<<
License: Public Domain
Homepage: https://core.tcl-lang.org/expect/index
