# -*- coding: ascii; tab-width: 4 -*-
Package: fossil
Epoch: 1
Version: 2.27
Revision: 1
Description: Distributed version control system
DescDetail: <<
	A self-contained, open source, distributed version control system like
	git or mercurial with integrated bug tracking, wiki and blog mechanisms.
	Fossil also contains a web-based ui and an autosync mode to keep remote
	repositories in sync.
<<
DescUsage: <<
	Please see "fossil help" and the homepage for usage information.
<<
License: BSD
Homepage: https://www.fossil-scm.org
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>

#Source: https://www.fossil-scm.org/home/tarball/release/%v.tar.gz
#Source: https://fossil-scm.org/home/tarball/99675884a93c09125dbfbef0ca47959626c81545c132e247e67a08bd12ac7256/fossil-src-%v.tar.gz
# Upstream has a hash in the URL and lately requires click-through and
# one-time tokens, so we use Debian for a usable direct link.
Source: mirror:debian:pool/main/f/%n/%n_%v.orig.tar.xz
SourceRename: %n-src-%v.tar.xz
Source-Checksum: SHA256(3635b17f735d523ee2ae32383b79a17f099947459ab04fb98431252560054890)

PatchScript: <<
	# use our iconv with _libiconv
	perl -pi -e 's|iconv iconv|lib$&|g' auto.def
<<

Depends: <<
	libbind6,
	libiconv,
	openssl300-shlibs,
	sqlite3-shlibs (>= 3.43-1)
<<
BuildDepends: <<
	fink (>= 0.32),
	fink-package-precedence,
	libbind6-dev,
	libiconv-dev,
	openssl300-dev,
	sqlite3-dev (>= 3.43-1),
	tcltk
<<

# NB: bug in zlib path handling of --with-zlib
# https://fossil-scm.org/forum/forumpost/9c64b51d44
SetCPPFLAGS: -MD
ConfigureParams: <<
	--with-openssl=%p \
	--with-sqlite=%p \
	--disable-fusefs \
	--json
<<
CompileScript: <<
	CCACHE=none ./configure %c; make TCLSH=%p/bin/tclsh
	fink-package-precedence --depfile-ext='\.d' .
<<

InfoTest: <<
	# tests need a blank password entered
	TestScript: printf "\n" | make test TCLSH=%p/bin/tclsh || exit 2
<<

InstallScript: <<
	mkdir -p %i/bin
	install -m 0755 fossil %i/bin
<<

DocFiles: COPYRIGHT-BSD2.txt
