Package: libao2-shlibs
Version: 0.8.8
Revision: 4
Maintainer: None <fink-devel@lists.sourceforge.net>

Depends: macosx
BuildDepends: <<
	autoconf2.6,
	automake1.15,
	fink-package-precedence,
	libtool2
<<

Source: http://downloads.xiph.org/releases/ao/libao-%v.tar.gz
Source-Checksum: SHA256(e52e05af6b10f42d2ee9845df1a581bf2b352060eabf7946aee0a600c3878954)
PatchFile: %n.patch
PatchFile-MD5: 0784783c15d96f35a5da377d6da4a544
PatchScript: <<
	%{default_script}
	# safety
	perl -pi -e 's/(LIBAO_LA_LDFLAGS)=""/\1="-no-undefined"/' configure.ac

	perl -p -i -e "s/-framework\s*/-Wl,-framework,/g" src/plugins/macosx/Makefile.am

	echo "AC_CONFIG_MACRO_DIRS([m4])" >> configure.ac
	echo "ACLOCAL_AMFLAGS = -I m4" >> Makefile.am
	mkdir m4
<<

SetCPPFLAGS: -DAO_SYSTEM_CONFIG='"%p/etc/libao.conf"'
ConfigureParams: <<
	--enable-dependency-tracking \
	--disable-arts \
	--disable-esd \
	--disable-pulse
<<
CompileScript: <<
	# Upstream is >7 years old, missing lots of modern details
	autoreconf -fi
	%{default_script}
	fink-package-precedence --prohibit-bdep=libao2 .
<< 
InstallScript: <<
	make install DESTDIR=%d

	# Install a default config file
	mkdir -p %i/etc
	echo "default_driver=macosx" >> %i/etc/libao.conf
<<
Shlibs: %p/lib/libao.2.dylib 4.0.0 %n (>= 0.8.3-1)
DocFiles: README COPYING AUTHORS
SplitOff: <<
	Package: libao2
	Depends: %N (= %v-%r)
	Conflicts: <<
		libao2,
		libao4
	<<
	Replaces: <<
		libao2,
		libao4
	<<
	BuildDependsOnly: True
	Files: <<
		etc
		include
		lib/ao/plugins-2/*.la
		lib/libao.{dylib,la}
		lib/pkgconfig
		share/aclocal
		share/doc/libao
		share/man
	<<
	ConfFiles: %p/etc/libao.conf
	DocFiles: README COPYING AUTHORS
<<

Description: Audio output library
DescDetail: <<
libao is a way to easily add cross-platform audio output to your program. 
Output devices are implemented as dynamic plugins. The Fink package
only builds the macosx plugin.
<<
DescPort: <<
- Patch to fix multi-channel output
- Patch to fix plugin linkage and dlopening
- Patch to remove _dlsym_auto_underscore, which could cause link issues
  for external code using libao2.
<<
DescPackaging: <<
	Originally packaged by Ben Hines
<<
Homepage: https://www.xiph.org/ao/
License: GPL
