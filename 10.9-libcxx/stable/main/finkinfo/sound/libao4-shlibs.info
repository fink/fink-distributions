Package: libao4-shlibs
Version: 1.2.2+20180113
Revision: 1
Maintainer: None <fink-devel@lists.sourceforge.net>

Depends: macosx
BuildDepends: <<
	autoconf2.6,
	automake1.15,
	fink-package-precedence,
	libtool2
<<

#Source: http://downloads.xiph.org/releases/ao/libao-%v.tar.gz
Source: mirror:debian:pool/main/liba/libao/libao_%v.orig.tar.gz
Source-Checksum: SHA256(cc9e68134e74f62a1feb6d07e4a0fb565351d80205d1e5d48d540b6abc4cf07d)
SourceDirectory: libao-%v
PatchFile: %n.patch
PatchFile-MD5: 94f0cf5586d2b63c566177356a4b5171
PatchScript: <<
	%{default_script}
	# safety
	perl -pi -e 's/(LIBAO_LA_LDFLAGS)=""/\1="-no-undefined"/' configure.ac

	perl -p -i -e "s/-framework\s*/-Wl,-framework,/g" src/plugins/macosx/Makefile.am

	echo "AC_CONFIG_MACRO_DIRS([m4])" >> configure.ac
	echo "ACLOCAL_AMFLAGS = -I m4" >> Makefile.am
	mkdir m4
<<

SetCPPFLAGS: -DAO_SYSTEM_CONFIG='"%p/etc/libao.conf"'
ConfigureParams: <<
	--enable-dependency-tracking \
	--disable-arts \
	--disable-esd \
	--disable-pulse \
	ac_cv_header_libroar_config_h=no
<<
CompileScript: <<
	# Upstream is >7 years old, missing lots of modern details
	autoreconf -fi
	%{default_script}
	fink-package-precedence --prohibit-bdep=libao4 .
<< 
InstallScript: <<
	make install DESTDIR=%d

	# Install a default config file
	mkdir -p %i/etc
	echo "default_driver=macosx" >> %i/etc/libao.conf
<<
Shlibs: %p/lib/libao.4.dylib 6.0.0 %n (>= 1.0.0-1)
DocFiles: README COPYING AUTHORS
SplitOff: <<
	Package: libao4
	Depends: %N (= %v-%r)
	Conflicts: <<
		libao2,
		libao4
	<<
	Replaces: <<
		libao2,
		libao4
	<<
	BuildDependsOnly: True
	Files: <<
		etc
		include
		lib/ao/plugins-4/*.la
		lib/ckport
		lib/libao.{dylib,la}
		lib/pkgconfig
		share/aclocal
		share/doc/libao
		share/man
	<<
	ConfFiles: %p/etc/libao.conf
	DocFiles: README COPYING AUTHORS
<<

Description: Audio output library
DescDetail: <<
libao is a way to easily add cross-platform audio output to your program. 
Output devices are implemented as dynamic plugins. The Fink package
only builds the macosx plugin.
<<
DescPackaging: <<
	Debian has progressed beyond seemingly-frozen upstream.
<<
Homepage: https://www.xiph.org/ao/
License: GPL
