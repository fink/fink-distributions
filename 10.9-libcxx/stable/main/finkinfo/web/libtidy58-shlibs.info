Package: libtidy58-shlibs
Version: 5.8.0
Revision: 1
Epoch: 2
Description: Shared library for HTML Tidy
License: BSD
Maintainer: Daniel Johnson <daniel@daniel-johnson.org>

Source: https://github.com/htacg/tidy-html5/archive/%v.tar.gz
Source-Checksum: SHA256(59c86d5b2e452f63c5cdb29c866a12a4c55b1741d7025cf2f3ce0cde99b0660e)
SourceRename: tidy-html5-%v.tar.gz
# Includes a CVE fix
Source2: mirror:debian:pool/main/t/tidy-html5/tidy-html5_%v-2.1.debian.tar.xz
Source2-Checksum: SHA256(136e72fdf209b562ed9da6394b6d00ef3881afa8e582c1db2600c608222c07b9)

BuildDepends: cmake (>= 3.10), fink (>= 0.32), libxslt-bin

PatchScript: <<
#!/bin/sh -ev
	for f in `cat ../debian/patches/series`; do
		patch -p1 < ../debian/patches/$f
	done
<<

# Even with doxygen installed, build fails when building docs.
CompileScript: <<
	cmake \
		-DCMAKE_INSTALL_PREFIX=%p \
		-DCMAKE_INSTALL_NAME_DIR=%p/lib \
		-DBUILD_TAB2SPACE=ON \
		-DTIDY_CONSOLE_SHARED=YES \
		-DTIDY_CONFIG_FILE=%p/etc/tidy.conf \
		.
	make
<<

# Tests have moved to a separate repo. :(
#InfoTest: <<
#	TestScript: <<
#		perl -pi -e 's|build/cmake/tidy|tidy|' test/testone.sh test/testaccessone.sh test/testall.sh test/html5/testhtml5.sh
#		cd test && ./testall.sh || exit 2
#		cd test && ./testaccess.sh || exit 2
#		cd test && sh ./testxml.sh || exit 2
#	<<
#<<

InstallScript: <<
	make install DESTDIR=%d
	install -m 755 tab2space %i/bin
	rm %i/lib/libtidy.a
<<

Shlibs: %p/lib/libtidy.58.dylib 58.0.0 %n (>= 2:5.8.0-1)
DocFiles: README/*

Homepage: http://www.html-tidy.org
DescDetail: <<
  HTML Tidy reads HTML, XHTML and XML files and writes cleaned up
  markup.  For HTML variants, it detects and corrects many common coding
  errors and strives to produce visually equivalent markup that is both
  W3C compliant and works on most browsers.  A common use of Tidy is to
  convert plain HTML to XHTML.  For generic XML files, Tidy is limited
  to correcting basic well-formedness errors and pretty printing.
<<

Splitoff: <<
	Package: tidy
	Description: Utility to clean up HTML/XHTML/XML
	Depends: %N (>= %e:%v-%r)
	Files: bin share/man
	DocFiles: README/*
<<

Splitoff2: <<
	Package: libtidy58
	Description: Development files for HTML Tidy
	BuildDependsOnly: true
	Replaces: <<
		tidy-dev (<= 1:051026-4),
		libtidy-dev,
		libtidy-0.99.0-dev,
		libtidy5,
		libtidy58
	<<
	Conflicts: <<
		libtidy-dev,
		libtidy-0.99.0-dev,
		libtidy5,
		libtidy58
	<<
	Depends: %N (= %e:%v-%r)
	Files: <<
		include
		lib/libtidy.dylib
		lib/pkgconfig
	<<
	DocFiles: README/*
<<
