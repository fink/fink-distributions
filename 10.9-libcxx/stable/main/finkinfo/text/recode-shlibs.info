Package: recode-shlibs
# php5 is last package-suite using this old libversion
Version: 3.7.1
Revision: 4
Description: Convert files between various charsets
License: GPL3/LGPL
Maintainer: None <fink-devel@lists.sourceforge.net>
Source: https://github.com/rrthomas/recode/releases/download/v%v/recode-%v.tar.gz
Source-Checksum: SHA256(da1195fce1d1c2887bc32108b4ef4ae09b7bcbe90e87f4f20390c20ca4832508)
Depends: <<
	libgettext8-shlibs,
	libiconv
<<
BuildDepends: <<
	fink-package-precedence,
	libgettext8-dev,
	libiconv-dev,
	python27
<<
Replaces: recode (<= 3.6-5)
# Includes renaming of matching of gettext catalog that's used by the
# library to have a lib-versioned name to avoid collisions.
PatchFile: %n.patch
PatchFile-MD5: 4e2c731ccabefc87266ffa425adca526
ConfigureParams: <<
	--disable-static \
	--enable-dependency-tracking
<<
CompileScript: <<
	#!/bin/sh -ev
	export PYTHON=%p/bin/python2.7
	%{default_script}
	fink-package-precedence --prohibit-bdep recode-dev .
<<
InfoTest: <<
	TestDepends: <<
		cython-py27,
		python27
	<<
	TestScript: <<
		make check PYTHON=%p/bin/python2.7 || exit 2
		fink-package-precedence --prohibit-bdep recode-dev .
	<<
<<
InstallScript: <<
	make install DESTDIR=%d AM_UPDATE_INFO_DIR=no
<<
Shlibs: %p/lib/librecode.0.dylib 1.0.0 %n (>= 3.6-6)
SplitOff: <<
	Package: recode
	Depends: <<
		%N (>= %v-%r),
		libgettext8-shlibs,
		libiconv
	<<
	Replaces: recode3-shlibs (<< 3.7.12-3)
	Files: <<
		bin
		share/info
		share/man
	<<
	DocFiles: README COPYING COPYING-LIB AUTHORS NEWS THANKS
	InfoDocs: recode.info
	PostInstScript: <<
		if [ -L %p/etc/alternatives/charset.alias ]; then
			update-alternatives --remove charset.alias %p/lib/charset.alias.recode
		fi
	<<
<<
SplitOff2: <<
	Package: recode-dev
	BuildDependsOnly: True
	Depends: recode-shlibs (= %v-%r)
	Conflicts: <<
		recode-dev,
		recode3-dev
	<<
	Replaces: <<
		recode (<= 3.6-5),
		recode-dev,
		recode3-dev
	<<
	Files: <<
		include
		lib/librecode.dylib
		lib/librecode.la
	<<
	DocFiles: README COPYING COPYING-LIB AUTHORS NEWS THANKS
<<
DocFiles: README COPYING COPYING-LIB AUTHORS NEWS THANKS
#
DescPort: <<
* Prevent collisions with php functions.
https://sources.debian.org/patches/recode/3.6-23/04-src-hash-h-php4-collision.patch/
<<
DescPackaging: <<
	Link directly against build-dir library file. Relying on -l
	and builddir -L is fragile against -L ordering in general. And
	the python module linking and test-running are not handled by
	libtool, so we get the install_name as %p not %b also. Build a
	static lib for testing purposes and link against it directly.
<<
Homepage: https://github.com/rrthomas/recode
