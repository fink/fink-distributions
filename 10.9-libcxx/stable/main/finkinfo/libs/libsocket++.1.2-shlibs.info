Package: libsocket++.1.2-shlibs
# [CMakeLists.txt:SOCKET_VERSION].gdcm.[GDCM VERSION]
Version: 1.12.12.gdcm.3.2.1
Revision: 1
Source: https://github.com/malaterre/GDCM/archive/refs/tags/v3.2.1.tar.gz
Source-Checksum: SHA256(63d4fbbb487d450bc8004542892a45349bdc9f4400f7010c07170c127ef0f9e3)
SourceRename: GDCM-3.2.1.tar.gz
SourceDirectory: GDCM-3.2.1/Utilities/socketxx
BuildDepends: <<
	cmake,
	fink (>= 0.32),
	fink-buildenv-modules,
	fink-package-precedence
<<
# Hack for stand-alone build to match Debian packaging
# (reverts to libsocket++ upstream, not gdcm's changes)
PatchFile: %n.patch
PatchFile-MD5: ffcf66810278968497f020426ebe108d
CompileScript: <<
#!/bin/sh -ev
	. %p/sbin/fink-buildenv-cmake.sh
	mkdir finkbuild
	pushd finkbuild
		# GDCM_MAX_VALIDATED_CMAKE_VERSION from top-level
		# CMakeLists.txt that we don't use.
		cmake \
			$FINK_CMAKE_ARGS \
			-DBUILD_SHARED_LIBS=ON \
			-DCMAKE_CXX_FLAGS=-MD \
			-DGDCM_MAX_VALIDATED_CMAKE_VERSION=3.13.4 \
			..
		make
	popd
	fink-package-precedence --depfile-ext='\.d' --prohibit-bdep=libsocket++.1.2-dev .
<<
InstallScript: <<
#!/bin/sh -ev
	pushd finkbuild
		make install DESTDIR=%d
		# omitted from CMakeLists.txt
		install -m644 socket++/config.h %i/include/socket++
	popd
<<
DocFiles: AUTHORS COPYING
Shlibs: %p/lib/libsocket++.1.2.dylib 1.2.0 %n (>= 1.12.12+gdcm3.2.1-1)
SplitOff: <<
	Package: libsocket++.1.2-dev
	Depends: %N (= %v-%r)
	Replaces: gdcm24-dev, gdcm26-dev
	BuildDependsOnly: true
	Files: <<
		include
		lib/libsocket++.dylib
	<<
	DocFiles: AUTHORS COPYING
<<
DescPackaging: <<
	Upstream (git) and Debian's packaging of it do not compile on
	Darwin. But gdcm has patched it so it does. We use their fork.

	This was originally a splitoff package of the gdcm package,
	but there was package-naming chaos and dependency-deadlock
	messes. Therefore, we pull it out as its own build, external
	to gdcm.

	Headers in subdir per Deabn socket++ package layout.
<<
Description: Socket classes to match iostream classes
Homepage: https://github.com/malaterre/socketxx-1
License: BSD
Maintainer: Daniel Macks <dmacks@netspace.org>
