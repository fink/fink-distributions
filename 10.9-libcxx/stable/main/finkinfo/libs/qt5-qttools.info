Info4: <<
Package: qt5-%type_pkg[qt]-qttools
Version: 5.7.1
Revision: 6
Description: Cross-Platform framework (%type_pkg[qt])
Type: qt (mac)
License: LGPL
Maintainer: None <fink-devel@lists.sourceforge.net>
### First version 5.3.1 by Hanspeter Niederstrasser
### Free to upgrade and modify parameters, but please discuss
### first on the fink-devel list

Depends: <<
	qt5-%type_pkg[qt]-qtclucene-shlibs (= %v-%r),
	qt5-%type_pkg[qt]-qtdesigner-shlibs (= %v-%r),
	qt5-%type_pkg[qt]-qtdesignercomponents-shlibs (= %v-%r),
	qt5-%type_pkg[qt]-qthelp-shlibs (= %v-%r)
<<
BuildDepends: <<
	qt5-%type_pkg[qt]-qtbase-dev-tools (>= %v-1),
	qt5-%type_pkg[qt]-qtbase (>= %v-2),
	qt5-%type_pkg[qt]-qtdeclarative (>= %v-1),
	qt5-%type_pkg[qt]-qtlocation (>= %v-1),
	#qt5-%type_pkg[qt]-qtmultimedia (>= %v-1),
	#qt5-%type_pkg[qt]-qtsensors (>= %v-1),
	#qt5-%type_pkg[qt]-qtwebkit (>= %v-1),
	fink (>= 0.34.4-1),
	fink-buildenv-modules,
	fink-package-precedence,
	pkgconfig,
	xcode.app
<<
BuildConflicts: uuid, libevent1.4, libevent2, libev4
BuildDependsOnly: true
Source: http://download.qt.io/archive/qt/5.7/%v/submodules/qttools-opensource-src-%v.tar.xz
Source-Checksum: SHA256(64197022686c3d8b11a8639f102e2caf03cc325a30e7a32ba66881648ac2dfac)
PatchFile: qt5-qttools.patch
PatchFile-MD5: f19bf00a50499cb67b4b64b9bb810c5b
PatchScript: <<
	sed -e 's|@FINK_PREFIX@|%p|g' -e 's|@QT_VERSION@|%v|g' < %{PatchFile} | patch -p1
<<
NoSetCPPFLAGS: true
NoSetCFLAGS: true
NoSetCXXFLAGS: true

GCC: 4.0
CompileScript: <<
	#!/bin/sh -ev
	. %p/sbin/fink-buildenv-helper.sh
	export QT_FINK_PREFIX=%p/lib/qt5-%type_pkg[qt]
	export PATH=${QT_FINK_PREFIX}/bin:$PATH
	export PKG_CONFIG_PATH=%p/lib/glib-2.0/pkgconfig-strict:$PKG_CONFIG_PATH
	if [ "%type_raw[qt]" == "mac" ]; then
		qmake_flags="QMAKE_CXXFLAGS+=\"-F%b/lib\""
	fi
	qmake $qmake_flags
	make
	fink-package-precedence --depfile-ext='\.d' --prohibit-bdep=%N .
<<

InstallScript: <<
	#!/bin/sh -ev
	export QT_FINK_PREFIX=%p/lib/qt5-%type_pkg[qt]

	make install INSTALL_ROOT=%d

	### Make sure we have all the right packages (by probing .pc files)
	pushd %d/${QT_FINK_PREFIX}/lib/pkgconfig
		### keep <space> at end of the 'want' list of .pc files
		want="Qt5CLucene.pc Qt5Designer.pc Qt5DesignerComponents.pc Qt5Help.pc Qt5UiTools.pc "
		have=`/bin/ls -1 | tr '\n' ' '`
	popd
	if [ "$want" != "$have" ]; then
		echo "Unexpected build results (mismatched list of .pc)"
		echo "  want: '$want'"
		echo "  have: '$have'"
		exit 1
	fi

	### Clean up .la, .prl files
	### remove build-dir location and fix '-framework ' -> '-Wl,-framework,'
	find %d/${QT_FINK_PREFIX}/lib -name \*.prl -o -name \*.la | xargs \
		perl -pi -e 's|%b/lib|%p/lib|g; s|-framework |-Wl,-framework,|g; s|QMAKE_PRL_BUILD_DIR \= (.*)$|QMAKE_PRL_BUILD_DIR = |g'

	### Clean up .pc files
	### fix '-framework ' -> '-Wl,-framework,'
	find %d/${QT_FINK_PREFIX}/lib -name \*.pc | xargs \
		perl -pi -e 's|-framework |-Wl,-framework,|g'
	
	### Fix includedir to point into framework dir instead of non-existent include/QtFOO
	### https://bugreports.qt.io/browse/QTBUG-35256
	for QTLIB in CLucene Designer DesignerComponents Help; do
		perl -pi -e "s|/Qt$QTLIB|/Qt$QTLIB.framework/Headers|g" %d/${QT_FINK_PREFIX}/lib/pkgconfig/Qt5$QTLIB.pc
		perl -pi -e 's|I\$\{includedir\}/Qt|F\$\{libdir\} -I\$\{libdir\}/Qt|g' %d/${QT_FINK_PREFIX}/lib/pkgconfig/Qt5$QTLIB.pc
	done
	
	### clean up Libs.private
	perl -ni -e 'print unless /Libs.private:/' %d/${QT_FINK_PREFIX}/lib/pkgconfig/*.pc
	
	### Mac only
	if [ "%type_raw[qt]" == "mac" ]; then
	### Link .app bundles to %p/Applications/Qt5 (can't move because they hardcode some paths)
		mkdir -p %i/Applications/Qt5
		for qt_app in Assistant Designer Linguist pixeltool qdbusviewer; do
			ln -s ${QT_FINK_PREFIX}/bin/${qt_app}.app %i/Applications/Qt5/${qt_app}.app
		done
	fi
<<
#AppBundles: 
DocFiles: LGPL_EXCEPTION.txt LICENSE.FDL LICENSE.GPLv3 LICENSE.LGPLv21 LICENSE.LGPLv3

SplitOff: <<
	Package: qt5-%type_pkg[qt]-qtclucene-shlibs
	Description: Qt5 Lucene library (%type_pkg[qt])
	Depends: qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2)
	Files: <<
		( %type_pkg[qt] = mac ) lib/qt5-%type_pkg[qt]/lib/QtCLucene.framework/Versions/5/QtCLucene
		( %type_pkg[qt] = x11 ) lib/qt5-%type_pkg[qt]/lib/libQt5CLucene.5*.dylib
	<<
	Shlibs: <<
		( %type_pkg[qt] = mac ) %p/lib/qt5-%type_pkg[qt]/lib/QtCLucene.framework/Versions/5/QtCLucene       5.7.0 %n (>= 5.7.0-1)
		( %type_pkg[qt] = x11 ) %p/lib/qt5-%type_pkg[qt]/lib/libQt5CLucene.5.dylib       5.7.0 %n (>= 5.7.0-1)
	<<
	DescDetail: The QtClucene module provides support for full text search.
<<
SplitOff2: <<
	Package: qt5-%type_pkg[qt]-qtdesigner-shlibs
	Description: Qt5 designer library (%type_pkg[qt])
	Depends: <<
		qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtgui-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtwidgets-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtxml-shlibs (>= %v-2)
	<<
	Files: <<
		( %type_pkg[qt] = mac ) lib/qt5-%type_pkg[qt]/lib/QtDesigner.framework/Versions/5/QtDesigner
		( %type_pkg[qt] = x11 ) lib/qt5-%type_pkg[qt]/lib/libQt5Designer.5*.dylib
	<<
	Shlibs: <<
		( %type_pkg[qt] = mac ) %p/lib/qt5-%type_pkg[qt]/lib/QtDesigner.framework/Versions/5/QtDesigner       5.7.0 %n (>= 5.7.0-1)
		( %type_pkg[qt] = x11 ) %p/lib/qt5-%type_pkg[qt]/lib/libQt5Designer.5.dylib       5.7.0 %n (>= 5.7.0-1)
	<<
	DescDetail: <<
The QtDesigner module provides classes that allow you to
create your own custom widget plugins for Qt Designer, and
classes that enable you to access Qt Designer's components.
	<<
<<
SplitOff3: <<
	Package: qt5-%type_pkg[qt]-qtdesignercomponents-shlibs
	Description: Qt5 designer component library (%type_pkg[qt])
	Depends: <<
		qt5-%type_pkg[qt]-qtdesigner-shlibs (>= %v-%r),
		qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtgui-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtwidgets-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtxml-shlibs (>= %v-2)
	<<
	Files: <<
		( %type_pkg[qt] = mac ) lib/qt5-%type_pkg[qt]/lib/QtDesignerComponents.framework/Versions/5/QtDesignerComponents
		( %type_pkg[qt] = x11 ) lib/qt5-%type_pkg[qt]/lib/libQt5DesignerComponents.5*.dylib
	<<
	Shlibs: <<
		( %type_pkg[qt] = mac ) %p/lib/qt5-%type_pkg[qt]/lib/QtDesignerComponents.framework/Versions/5/QtDesignerComponents       5.7.0 %n (>= 5.7.0-1)
		( %type_pkg[qt] = x11 ) %p/lib/qt5-%type_pkg[qt]/lib/libQt5DesignerComponents.5.dylib       5.7.0 %n (>= 5.7.0-1)
	<<
	DescDetail: <<
The QtDesigner module provides classes that allow you to
create your own custom widget plugins for Qt Designer, and
classes that enable you to access Qt Designer's components.
	<<
<<
SplitOff4: <<
	Package: qt5-%type_pkg[qt]-qthelp-shlibs
	Description: Qt5 help library (%type_pkg[qt])
	Depends: <<
		qt5-%type_pkg[qt]-qtclucene-shlibs (>= %v-%r),
		qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtgui-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtnetwork-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtsql-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtwidgets-shlibs (>= %v-2)
	<<
	Files: <<
		( %type_pkg[qt] = mac ) lib/qt5-%type_pkg[qt]/lib/QtHelp.framework/Versions/5/QtHelp
		( %type_pkg[qt] = x11 ) lib/qt5-%type_pkg[qt]/lib/libQt5Help.5*.dylib
	<<
	Shlibs: <<
		( %type_pkg[qt] = mac ) %p/lib/qt5-%type_pkg[qt]/lib/QtHelp.framework/Versions/5/QtHelp       5.7.0 %n (>= 5.7.0-1)
		( %type_pkg[qt] = x11 ) %p/lib/qt5-%type_pkg[qt]/lib/libQt5Help.5.dylib       5.7.0 %n (>= 5.7.0-1)
	<<
	DescDetail: <<
The QtHelp module provides classes for integrating online
documentation in applications.
	<<
<<
SplitOff5: <<
	Package: qt5-%type_pkg[qt]-assistant
	Description: Qt5 documentation tool (%type_pkg[qt])
	Depends: <<
		qt5-%type_pkg[qt]-qthelp-shlibs (>= %v-%r),
		qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtgui-shlibs (>= %v-1),
		#qt5-%type_pkg[qt]-qtmultimedia-shlibs (>= %v-1),
		#qt5-%type_pkg[qt]-qtmultimediawidgets-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtnetwork-shlibs (>= %v-2),
		#qt5-%type_pkg[qt]-qtopengl-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtprintsupport-shlibs (>= %v-2),
		#qt5-%type_pkg[qt]-qtqml-shlibs (>= %v-1),
		#qt5-%type_pkg[qt]-qtquick-shlibs (>= %v-1),
		#qt5-%type_pkg[qt]-qtsensors-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtsql-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtsql-sqlite-plugins (>= %v-2),
		#qt5-%type_pkg[qt]-qtwebkit-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtwidgets-shlibs (>= %v-2)
	<<
	Files: <<
		( %type_pkg[qt] = mac ) Applications/Qt5/Assistant*
		lib/qt5-%type_pkg[qt]/bin/Assistant*
	<<
	DescDetail: Qt Assistant is a tool for presenting on-line documentation.
<<
SplitOff6: <<
	Package: qt5-%type_pkg[qt]-designer
	Description: Qt5 GUI design tool (%type_pkg[qt])
	Depends: <<
		qt5-%type_pkg[qt]-qtdesigner-shlibs (>= %v-%r),
		qt5-%type_pkg[qt]-qtdesignercomponents-shlibs (>= %v-%r),
		qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtgui-shlibs (>= %v-2),
		#qt5-%type_pkg[qt]-qtmultimedia-shlibs (>= %v-1),
		#qt5-%type_pkg[qt]-qtmultimediawidgets-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtnetwork-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtprintsupport-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtqml-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtquick-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtquickwidgets-shlibs (>= %v-1),
		#qt5-%type_pkg[qt]-qtsensors-shlibs (>= %v-1),
		#qt5-%type_pkg[qt]-qtwebkit-shlibs (>= %v-1),
		qt5-%type_pkg[qt]-qtwidgets-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtxml-shlibs (>= %v-2)
	<<
	Conflicts: <<
		# Plugins from an earlier %v cause Designer.app to not run
		qt5-%type_pkg[qt]-qtquick1-designer-plugins (<< %v-1),
		qt5-%type_pkg[qt]-webengine-designer-plugins (<< %v-1)
	<<
	Files: <<
		( %type_pkg[qt] = mac ) Applications/Qt5/Designer*
		lib/qt5-%type_pkg[qt]/bin/Designer*
		lib/qt5-%type_pkg[qt]/plugins/designer
	<<
	DescDetail: <<
Qt Designer is Qt's tool for designing and building graphical user
interfaces (GUIs) from Qt components.  You can compose and customize
your widgets or dialogs in a what-you-see-is-what-you-get (WYSIWYG)
manner, and test them using different styles and resolutions.

Widgets and forms created with Qt Designer integrated seamlessly with
programmed code, using Qt's signals and slots mechanism, that lets you
easily assign behavior to graphical elements.  All properties set in Qt
Designer can be changed dynamically within the code.  Furthermore,
features like widget promotion and custom plugins allow you to use
your own components with Qt Designer.
	<<
<<
SplitOff7: <<
	Package: qt5-%type_pkg[qt]-linguist
	Description: Qt5 translation tool (%type_pkg[qt])
	Depends: <<
		qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtgui-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtprintsupport-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtwidgets-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtxml-shlibs (>= %v-2)
	<<
	Files: <<
		( %type_pkg[qt] = mac ) Applications/Qt5/Linguist*
		lib/qt5-%type_pkg[qt]/bin/l*
		lib/qt5-%type_pkg[qt]/bin/Linguist*
		lib/qt5-%type_pkg[qt]/share/qt5/phrasebooks
	<<
	DescDetail: <<
Qt provides excellent support for translating applications
into local languages.  You can use Qt linguist to translate
your application.
	<<
<<
SplitOff8: <<
	Package: qt5-%type_pkg[qt]-qttools-dev-tools
	Description: Qt5 QtTools development tools (%type_pkg[qt])
	Depends: <<
		qt5-%type_pkg[qt]-qtcore-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtdbus-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtgui-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qthelp-shlibs (>= %v-%r),
		qt5-%type_pkg[qt]-qtnetwork-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtwidgets-shlibs (>= %v-2),
		qt5-%type_pkg[qt]-qtxml-shlibs (>= %v-2)
	<<
	Files: <<
		( %type_pkg[qt] = mac ) Applications/Qt5/pixeltool.app
		( %type_pkg[qt] = mac ) Applications/Qt5/qdbusviewer.app
		lib/qt5-%type_pkg[qt]/bin
	<<
	DescDetail: <<
	<<
<<
Homepage: http://qt-project.org
DescDetail: <<
Qt is a cross-platform application and UI framework with APIs for
C++ programming and Qt Quick for rapid UI creation.

* Intuitive class libraries
* Easy to use and learn
* Produce highly readable, easily maintainable and reusable code
* High runtime performance and small footprint
<<
DescUsage: <<
To compile against this Qt5, you need to make sure that 
"%p/lib/qt5-%type_pkg[qt]/bin" is first in your PATH and that qmake is 
present. Qmake is provided by "qt5-%type_pkg[qt]-qtbase-dev-tools".

If you need to manually find the headers and libraries, you
need your compiler flags to contain: 

	-F%p/lib/qt5-%type_pkg[qt]/lib

	or this:

	-I%p/lib/qt5-%type_pkg[qt]/include

...and your linker flags to contain:

	-F%p/lib/qt5-%type_pkg[qt]/lib

	or

	-L%p/lib/qt5-%type_pkg[qt]/lib

In this case, it's still a good idea to set your PATH to contain
"%p/lib/qt5-%type_pkg[qt]/bin" as well.
<<
DescPackaging: <<
We follow Ubuntu's lead in using the separate tarballs and separate most
of the packages the same way they do.

Need little extra help to find the private header 'private/qqmljsengine_p.h'.
Give it the full path to the header as a workaround for now.

Add QStandardPaths::AppDataLocation to the qtpaths lookup executable.
<<
<<
# End Info4
