# -*- coding: ascii; tab-width: 4; x-counterpart: tox-py.patch -*-
Info4: <<

Package: tox-py%type_pkg[python]
Version: 3.0.0
Revision: 1
Maintainer: Kurt Schwehr <goatbar@users.sourceforge.net>
License: BSD
Type: python (2.7 3.5 3.6 3.7)
Homepage: http://pypi.python.org/pypi/tox/
Source: https://pypi.io/packages/source/t/tox/tox-%v.tar.gz
Source-MD5: 5dfc0bc3865a7a06186d7e0766015a80
PatchFile: %{ni}.patch
PatchFile-MD5: a3372c83f50d93b2f00a2de60697d419

Depends: python%type_pkg[python]-shlibs, pytest-py%type_pkg[python], virtualenv-py%type_pkg[python], pluggy-py%type_pkg[python]
BuildDepends: python%type_pkg[python], setuptools-scm-py%type_pkg[python], setuptools-tng-py%type_pkg[python]

Description: Testing in virtualenvs

DescDetail: <<
Tox is a generic virtualenv management and test command line tool for:

- checking the package installs correctly with different Python
  versions and interpreters
- running tests in each of the environments, configuring your test
  tool of choice
- acting as a frontend to Continuous Integration servers, greatly
  reducing boilerplate and merging CI and shell-based testing.

tox aims to automate and standardize testing in Python. It is part of a larger
vision of easing the packaging, testing and release process of Python software.
<<

DocFiles: README.rst CHANGELOG.rst HOWTORELEASE.rst CONTRIBUTING.rst CONTRIBUTORS PKG-INFO doc

# Tests should not be run against the installed version and are not included in the package after installation,
# but at least make sure they are running the correct script variants.
PatchScript: <<
    sed 's|PY_PKG|%type_pkg[python]|g;s|PY_RAW|%type_raw[python]|g;' %{PatchFile} | patch -p1
    perl -pi -e 's|(basepython = python)(3.6)|${1}%type_raw[python]|g;' tox.ini
    perl -pi -e 's|(python)(.-[cm])|%p/bin/${1}%type_raw[python]${2}|g;' tox.ini
    perl -pi -e 's|(python)(3.6)(.-[cm])|%p/bin/${1}%type_raw[python]${3}|g;' tox.ini
    perl -pi -e 's|(sphinx-build)(.-[d])|%p/bin/${1}%type_raw[python]${2}|g;' tox.ini
<<

CompileScript: <<
    %p/bin/python%type_raw[python] setup.py build
<<

InfoTest: <<
    TestDepends: pytest-mock-py%type_pkg[python]
    # 2 tests on the tox/tox-quickstart scripts are failing if package is not already installed
    # and are marked `skipif()` for the build environment; for testing installed package, we could
    # run without DEB_SKIP_TOX_TESTS set - but can Info auto-detect this?
    TestScript: <<
        #!/bin/bash -ev
        # Might try to create scripts locally; but would have to hack them to bypass the pkg_resources check for requirement!
        #mkdir -p build/bin
        #python%type_raw[python] setup.py install_scripts -d build/bin
        #grep -v __requires__ build/bin/tox > build/bin/tox-py%type_pkg[python]
        #grep -v __requires__ build/bin/tox-quickstart > build/bin/tox-quickstart-py%type_pkg[python]
        #chmod 755 build/bin/*-py%type_pkg[python]
        DEB_SKIP_TOX_TESTS=1 PYTHONPATH=%b/build/lib %p/bin/pytest-%type_raw[python] tests || exit 2
    <<
    TestSuiteSize: medium
<<

InstallScript: <<
    #!/bin/bash -ev
    find build/lib -name '*.pyc' -exec rm {} \;
    python%type_raw[python] setup.py install --root=%d
    mv %i/bin/tox %i/bin/tox-py%type_pkg[python]
    mv %i/bin/tox-quickstart %i/bin/tox-quickstart-py%type_pkg[python]
<<

PostInstScript: <<
    update-alternatives --verbose --install %p/bin/tox tox-py %p/bin/tox-py%type_pkg[python] %type_pkg[python] --slave %p/bin/tox-quickstart tox-quickstart %p/bin/tox-quickstart-py%type_pkg[python]
<<

PreRmScript: <<
    if [ $1 != "upgrade" ]; then
        update-alternatives --verbose --remove tox-py %p/bin/tox-py%type_pkg[python]
    fi
<<

# Info4
<<
