diff -ruN qtbase-everywhere-src-5.15.1-orig/mkspecs/common/gcc-base-mac.conf qtbase-everywhere-src-5.15.1/mkspecs/common/gcc-base-mac.conf
--- qtbase-everywhere-src-5.15.1-orig/mkspecs/common/gcc-base-mac.conf	2020-09-02 12:15:07.000000000 +0200
+++ qtbase-everywhere-src-5.15.1/mkspecs/common/gcc-base-mac.conf	2020-10-08 14:33:03.000000000 +0200
@@ -15,7 +15,7 @@
 QMAKE_COMPILER_DEFINES += __APPLE__ __GNUC__=4 __APPLE_CC__
 
 QMAKE_LFLAGS_SHLIB         += -single_module -dynamiclib
-QMAKE_LFLAGS_PLUGIN        += $$QMAKE_LFLAGS_SHLIB
+QMAKE_LFLAGS_PLUGIN        += -bundle
 QMAKE_LFLAGS_INCREMENTAL   += -undefined suppress -flat_namespace
 QMAKE_LFLAGS_SONAME        += -install_name$${LITERAL_WHITESPACE}
 QMAKE_LFLAGS_HEADERPAD     += -headerpad_max_install_names
diff -ruN qtbase-opensource-src-5.5.1-orig/mkspecs/common/mac.conf qtbase-opensource-src-5.5.1/mkspecs/common/mac.conf
--- qtbase-opensource-src-5.5.1-orig/mkspecs/common/mac.conf	2015-10-12 23:35:32.000000000 -0500
+++ qtbase-opensource-src-5.5.1/mkspecs/common/mac.conf	2015-12-13 17:02:56.000000000 -0600
@@ -14,6 +14,7 @@
 
 QMAKE_RESOURCE          = /Developer/Tools/Rez
 QMAKE_EXTENSION_SHLIB   = dylib
+QMAKE_EXTENSION_PLUGIN  = so
 QMAKE_LIBDIR            =
 
 # sdk.prf will prefix the proper SDK sysroot
diff -ruN qtbase-everywhere-src-5.15.1-orig/mkspecs/common/macx.conf qtbase-everywhere-src-5.15.1/mkspecs/common/macx.conf
--- qtbase-everywhere-src-5.15.1-orig/mkspecs/common/macx.conf	2020-09-02 12:15:07.000000000 +0200
+++ qtbase-everywhere-src-5.15.1/mkspecs/common/macx.conf	2020-10-08 15:16:10.000000000 +0200
@@ -5,7 +5,7 @@
 QMAKE_PLATFORM         += macos osx macx
 QMAKE_MAC_SDK           = macosx
 
-QMAKE_MACOSX_DEPLOYMENT_TARGET = 10.13
+QMAKE_MACOSX_DEPLOYMENT_TARGET = @MACOSX_DEPLOYMENT_TARGET@
 QMAKE_APPLE_DEVICE_ARCHS = x86_64
 
 # Should be 10.15, but as long as the CI builds with
diff -ruN qtbase-everywhere-src-5.15.1-orig/src/corelib/configure.json qtbase-everywhere-src-5.15.1/src/corelib/configure.json
--- qtbase-everywhere-src-5.15.1-orig/src/corelib/configure.json	2020-09-02 12:15:07.000000000 +0200
+++ qtbase-everywhere-src-5.15.1/src/corelib/configure.json	2020-10-08 16:42:16.000000000 +0200
@@ -72,7 +72,7 @@
             "test": {
                 "main": [
                     "iconv_t x = iconv_open(\"\", \"\");",
-                    "const char *inp;",
+                    "char *inp;",
                     "char *outp;",
                     "size_t inbytes, outbytes;",
                     "iconv(x, &inp, &inbytes, &outp, &outbytes);",
@@ -675,7 +675,7 @@
             "label": "GNU iconv",
             "enable": "input.iconv == 'gnu'",
             "disable": "input.iconv == 'posix' || input.iconv == 'sun' || input.iconv == 'no'",
-            "condition": "!config.win32 && !config.qnx && !config.android && !config.darwin && !features.posix-libiconv && !features.sun-libiconv && libs.gnu_iconv",
+            "condition": "!config.win32 && !config.qnx && !config.android && !features.posix-libiconv && !features.sun-libiconv && libs.gnu_iconv",
             "output": [ "privateFeature" ]
         },
         "icu": {
diff -ruN qtbase-everywhere-src-5.15.1-orig/src/platformsupport/fontdatabases/mac/coretext.pri qtbase-everywhere-src-5.15.1/src/platformsupport/fontdatabases/mac/coretext.pri
--- qtbase-everywhere-src-5.15.1-orig/src/platformsupport/fontdatabases/mac/coretext.pri	2016-03-03 05:35:22.000000000 -0600
+++ qtbase-everywhere-src-5.15.1/src/platformsupport/fontdatabases/mac/coretext.pri	2016-03-17 21:55:50.000000000 -0500
@@ -1,6 +1,12 @@
 HEADERS += $$PWD/qcoretextfontdatabase_p.h $$PWD/qfontengine_coretext_p.h
 OBJECTIVE_SOURCES += $$PWD/qfontengine_coretext.mm $$PWD/qcoretextfontdatabase.mm
 
+contains(QT_CONFIG, system-freetype) {
+    HEADERS += $$QT_SOURCE_TREE/src/gui/text/qfontengine_ft_p.h
+    SOURCES += $$QT_SOURCE_TREE/src/gui/text/qfontengine_ft.cpp
+    CONFIG += opentype
+}
+
 LIBS_PRIVATE += \
     -framework CoreFoundation \
     -framework CoreGraphics \
diff -ruN qtbase-everywhere-src-5.15.1-orig/src/plugins/platforms/cocoa/cocoa.pro qtbase-everywhere-src-5.15.1/src/plugins/platforms/cocoa/cocoa.pro
--- qtbase-everywhere-src-5.15.1-orig/src/plugins/platforms/cocoa/cocoa.pro	2016-03-03 05:35:22.000000000 -0600
+++ qtbase-everywhere-src-5.15.1/src/plugins/platforms/cocoa/cocoa.pro	2016-03-17 21:55:06.000000000 -0500
@@ -92,6 +92,10 @@
 
 LIBS += -framework AppKit -framework CoreServices -framework Carbon -framework IOKit -framework QuartzCore -framework CoreVideo -framework Metal -framework IOSurface -lcups
 
+contains(QT_CONFIG, system-freetype) {
+    LIBS += -lfreetype
+}
+
 DEFINES += QT_NO_FOREACH
 
 QT += \
diff -ruN qtbase-everywhere-src-5.15.1-orig/mkspecs/features/qt_module.prf qtbase-everywhere-src-5.15.1/mkspecs/features/qt_module.prf
--- qtbase-everywhere-src-5.15.1-orig/mkspecs/features/qt_module.prf	2020-10-08 15:12:08.000000000 +0200
+++ qtbase-everywhere-src-5.15.1/mkspecs/features/qt_module.prf	2020-09-02 12:15:07.000000000 +0200
@@ -269,7 +269,7 @@
 load(qt_targets)
 
 # this builds on top of qt_common
-unix|mingw {
+!internal_module:if(unix|mingw):!if(darwin:debug_and_release:CONFIG(debug, debug|release)) {
     CONFIG += create_pc
     QMAKE_PKGCONFIG_DESTDIR = pkgconfig
     host_build: \
