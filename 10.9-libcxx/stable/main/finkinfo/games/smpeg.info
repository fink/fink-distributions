Package: smpeg
Version: 0.4.4
Revision: 1028
Maintainer: None <fink-devel@lists.sourceforge.net>
Depends: %N-shlibs (= %v-%r)
BuildDependsOnly: true
BuildDepends: <<
	autoconf2.6,
	automake1.15,
	fink (>= 0.30.0),
	fink-package-precedence,
	libtool2,
	sdl (>= 1.2.9-1001)
<<
Source: ftp://ftp.uni-erlangen.de/pub/mirrors/gentoo/distfiles/%n-%v.tar.gz
Source-Checksum: SHA256(1efa7984d0aada0c2954cd0aaef357e9d7871dadd3368dbe742ab5f260523e57)
# acinclude.m4 includes bit-rotted versions of material available in
# public .m4 of installed support packages, so just nuke that .m4 so
# autoconf uses those more-modern files. Except AC_TYPE_SOCKLEN_T,
# which does not seem to be available elsewhere, so we preserve it in
# a new .m4.
PatchFile: %n.patch
PatchFile-MD5: 699d53243fc40dee710f509011b31825
# Like https://github.com/icculus/smpeg/commit/ad448cd0675650e412b27b084fdde749c58d77f8
PatchFile2: %n-SDL_endian.patch
PatchFile2-MD5: db0a764ac46804cd9ac609f44abcf634
PatchScript: <<
	%{default_script}
	perl -pi -e 's/(AC_DEFUN\()([^[]+)(,)/\1\[\2]\3/' configure.in m4/acinclude-AC_TYPE_SOCKLEN_T.m4 smpeg.m4
	mv configure.in configure.ac
	rm acinclude.m4
	touch NEWS AUTHORS ChangeLog
	# upstream fix:
	# https://github.com/icculus/smpeg/commit/3769f4db50bdd784a930464fe2332ca9da2113f9
	# (and the preceding commits)
	perl -pi -e 's/0-1/0u-1/g' audio/huffmantable.cpp
	touch endian.h
<<
ConfigureParams: <<
	--disable-opengl-player \
	--disable-gtk-player \
	--disable-sdltest \
	--disable-static
<<
CompileScript: <<
	autoreconf -fi
	%{default_script}
	fink-package-precedence --prohibit-bdep=%n .
<<
InstallScript: make install DESTDIR=%d
GCC: 4.0
SplitOff: <<
  Package: %N-shlibs
  Depends: sdl-shlibs (>= 1.2.9-1001)
  Replaces: %N (<= 0.4.4-4)
  Files: lib/libsmpeg-*.dylib
  Shlibs: %p/lib/libsmpeg-0.4.0.dylib 2.0.0 %n (>= 0.4.4-25)
  Docfiles: CHANGES COPYING README
<<
SplitOff2: <<
  Package: %N-bin
  Depends: %N-shlibs (= %v-%r)
  Replaces: %N (<= 0.4.4-4)
  Files: bin/plaympeg
  Docfiles: CHANGES COPYING README
<<
DocFiles: CHANGES COPYING README README.SDL_mixer TODO
Description: SDL MPEG Player Library
Homepage: https://icculus.org/smpeg/
License: LGPL
