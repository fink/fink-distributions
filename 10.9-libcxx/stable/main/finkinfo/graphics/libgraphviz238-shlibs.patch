diff -ruN graphviz-12.2.1-orig/configure graphviz-12.2.1/configure
--- graphviz-12.2.1-orig/configure	2024-12-06 17:56:04
+++ graphviz-12.2.1/configure	2025-10-21 21:26:29
@@ -8866,13 +8866,15 @@
       # if running on 10.5 or later, the deployment target defaults
       # to the OS version, if on x86, and 10.4, the deployment
       # target defaults to 10.4. Don't you love it?
-      case ${MACOSX_DEPLOYMENT_TARGET-10.0},$host in
-	10.0,*86*-darwin8*|10.0,*-darwin[91]*)
-	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
-	10.[012][,.]*)
-	  _lt_dar_allow_undefined='$wl-flat_namespace $wl-undefined ${wl}suppress' ;;
-	10.*)
-	  _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup' ;;
+      case $MACOSX_DEPLOYMENT_TARGET,$host in
+        10.[012],*|,*powerpc*-darwin[5-8]*)
+          _lt_dar_allow_undefined='$wl-flat_namespace $wl-undefined ${wl}suppress' ;;
+        *)
+          _lt_dar_allow_undefined='$wl-undefined ${wl}dynamic_lookup'
+          if test yes = "$lt_cv_support_no_fixup_chains"; then
+            as_fn_append _lt_dar_allow_undefined ' $wl-no_fixup_chains'
+          fi
+        ;;
       esac
     ;;
   esac
@@ -11902,7 +11904,7 @@
   esac
   sys_lib_search_path_spec=`$ECHO "$lt_search_path_spec" | $lt_NL2SP`
 else
-  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
+  sys_lib_search_path_spec="/lib /usr/lib @FINKPREFIX@/lib"
 fi
 library_names_spec=
 libname_spec='lib$name'
@@ -12186,8 +12188,8 @@
   shlibpath_var=DYLD_LIBRARY_PATH
   shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
 
-  sys_lib_search_path_spec="$sys_lib_search_path_spec /usr/local/lib"
-  sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
+  sys_lib_search_path_spec="$sys_lib_search_path_spec @FINKPREFIX@/lib"
+  sys_lib_dlsearch_path_spec='@FINKPREFIX@/lib /lib /usr/lib'
   ;;
 
 dgux*)
@@ -12350,7 +12352,7 @@
   esac
   shlibpath_var=LD_LIBRARY${shlibsuff}_PATH
   shlibpath_overrides_runpath=no
-  sys_lib_search_path_spec="/usr/lib$libsuff /lib$libsuff /usr/local/lib$libsuff"
+  sys_lib_search_path_spec="/usr/lib$libsuff /lib$libsuff @FINKPREFIX@/lib$libsuff"
   sys_lib_dlsearch_path_spec="/usr/lib$libsuff /lib$libsuff"
   hardcode_into_libs=yes
   ;;
@@ -12528,7 +12530,7 @@
   library_names_spec='${libname}_dll.$libext'
   dynamic_linker='OS/2 ld.exe'
   shlibpath_var=BEGINLIBPATH
-  sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
+  sys_lib_search_path_spec="/lib /usr/lib @FINKPREFIX@/lib"
   sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
   postinstall_cmds='base_file=`basename \$file`~
     dlpath=`$SHELL 2>&1 -c '\''. $dir/'\''\$base_file'\''i; $ECHO \$dlname'\''`~
@@ -17094,7 +17096,7 @@
   shlibpath_var=DYLD_LIBRARY_PATH
   shrext_cmds='`test .$module = .yes && echo .so || echo .dylib`'
 
-  sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
+  sys_lib_dlsearch_path_spec='@FINKPREFIX@/lib /lib /usr/lib'
   ;;
 
 dgux*)
@@ -20473,7 +20475,7 @@
 # Standard set of common directories for X headers.
 # Check X11 before X11Rn because it is often a symlink to the current release.
 ac_x_header_dirs='
-/usr/X11/include
+/opt/X11/include
 /usr/X11R7/include
 /usr/X11R6/include
 /usr/X11R5/include
@@ -20502,7 +20504,7 @@
 /usr/XFree86/include/X11
 
 /usr/include
-/usr/local/include
+@FINKPREFIX@/include
 /usr/unsupported/include
 /usr/athena/include
 /usr/local/x11r5/include
@@ -23278,7 +23280,7 @@
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb sitehdrdir`"
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb rubyhdrdir`"
             RUBY_LIBS="-L`$RUBY $srcdir/config/config_ruby.rb libdir` `$RUBY -rrbconfig -e \"puts RbConfig::CONFIG['LIBRUBYARG_SHARED']\"`"
-            RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb vendorarchdir`"
+            RUBY_INSTALL_DIR="@FINKPREFIX@/lib/@PKGVERSION@/graphviz/ruby"
 	    if test "$RUBY_INSTALL_DIR" = ""; then
 	  	  RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb sitearchdir`"
 	    fi
@@ -23347,7 +23349,7 @@
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb sitehdrdir`"
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb rubyhdrdir`"
             RUBY_LIBS="-L`$RUBY $srcdir/config/config_ruby.rb libdir` `$RUBY -rrbconfig -e \"puts RbConfig::CONFIG['LIBRUBYARG_SHARED']\"`"
-            RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb vendorarchdir`"
+            RUBY_INSTALL_DIR="@FINKPREFIX@/lib/@PKGVERSION@/graphviz/ruby"
 	    if test "$RUBY_INSTALL_DIR" = ""; then
 	  	  RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb sitearchdir`"
 	    fi
@@ -23413,7 +23415,7 @@
           if test "$RUBY" = ""; then
             use_ruby="No (ruby not available)"
           else
-            RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb vendorarchdir`"
+            RUBY_INSTALL_DIR="@FINKPREFIX@/lib/@PKGVERSION@/graphviz/ruby"
 	  fi
 
 fi
@@ -23527,7 +23529,7 @@
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb sitehdrdir`"
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb rubyhdrdir`"
             RUBY_LIBS="-L`$RUBY $srcdir/config/config_ruby.rb libdir` `$RUBY -rrbconfig -e \"puts RbConfig::CONFIG['LIBRUBYARG_SHARED']\"`"
-            RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb vendorarchdir`"
+            RUBY_INSTALL_DIR="@FINKPREFIX@/lib/@PKGVERSION@/graphviz/ruby"
 	    if test "$RUBY_INSTALL_DIR" = ""; then
 	  	  RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb sitearchdir`"
 	    fi
@@ -23596,7 +23598,7 @@
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb sitehdrdir`"
             RUBY_CFLAGS="$RUBY_CFLAGS -I`$RUBY $srcdir/config/config_ruby.rb rubyhdrdir`"
             RUBY_LIBS="-L`$RUBY $srcdir/config/config_ruby.rb libdir` `$RUBY -rrbconfig -e \"puts RbConfig::CONFIG['LIBRUBYARG_SHARED']\"`"
-            RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb vendorarchdir`"
+            RUBY_INSTALL_DIR="@FINKPREFIX@/lib/@PKGVERSION@/graphviz/ruby"
 	    if test "$RUBY_INSTALL_DIR" = ""; then
 	  	  RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb sitearchdir`"
 	    fi
@@ -23662,7 +23664,7 @@
           if test "$RUBY" = ""; then
             use_ruby="No (ruby not available)"
           else
-            RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb vendorarchdir`"
+            RUBY_INSTALL_DIR="@FINKPREFIX@/lib/@PKGVERSION@/graphviz/ruby"
 	  fi
 
 fi
@@ -23713,7 +23715,7 @@
         if test "$RUBY" = ""; then
           use_ruby="No (ruby not available)"
         else
-          RUBY_INSTALL_DIR="`$RUBY $srcdir/config/config_ruby.rb vendorarchdir`"
+          RUBY_INSTALL_DIR="@FINKPREFIX@/lib/@PKGVERSION@/graphviz/ruby"
 	fi
 
 fi
@@ -27106,8 +27108,8 @@
 if test -f "/usr/include/tclInt.h"; then
 TCLINT_INCLUDES=""
 else
-if test -f "/usr/local/include/tclInt.h"; then
-TCLINT_INCLUDES="-I/usr/local/include"
+if test -f "@FINKPREFIX@/include/tclInt.h"; then
+TCLINT_INCLUDES="-I@FINKPREFIX@/include"
 fi
 fi
 fi
diff -ruN graphviz-12.2.1-orig/lib/dotgen/compound.c graphviz-12.2.1/lib/dotgen/compound.c
--- graphviz-12.2.1-orig/lib/dotgen/compound.c	2024-12-06 17:55:56
+++ graphviz-12.2.1/lib/dotgen/compound.c	2025-10-21 21:28:52
@@ -169,6 +169,9 @@
 	return tmin;
 
     no_cross = countVertCross(pts, xcoord);
+    if (tmin >= tmax)
+        return -1.0;
+
     if (no_cross == 0)
 	return -1.0;
 
@@ -211,6 +214,9 @@
 	return tmin;
 
     no_cross = countHorzCross(pts, ycoord);
+    if (tmin >= tmax)
+        return -1.0;
+
     if (no_cross == 0)
 	return -1.0;
 
diff -ruN graphviz-12.2.1-orig/lib/gvc/gvcext.h graphviz-12.2.1/lib/gvc/gvcext.h
--- graphviz-12.2.1-orig/lib/gvc/gvcext.h	2024-12-06 17:55:56
+++ graphviz-12.2.1/lib/gvc/gvcext.h	2025-10-21 21:30:09
@@ -14,6 +14,8 @@
 
 #pragma once
 
+#include <ltdl.h>
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -36,10 +38,14 @@
     typedef struct GVG_s GVG_t;
     typedef struct GVC_s GVC_t; ///< graphviz context
 
+#if 0
     typedef struct {
 	const char *name;
 	void* address;
     } lt_symlist_t;
+#else
+	typedef	const lt_dlsymlist	lt_symlist_t;	// libtool2's ltdl.h
+#endif
 
     typedef struct gvplugin_available_s gvplugin_available_t;
 
diff -ruN graphviz-12.2.1-orig/lib/neatogen/adjust.c graphviz-12.2.1/lib/neatogen/adjust.c
--- graphviz-12.2.1-orig/lib/neatogen/adjust.c	2024-12-06 17:55:56
+++ graphviz-12.2.1/lib/neatogen/adjust.c	2025-10-21 21:31:15
@@ -915,7 +915,7 @@
 int 
 removeOverlapWith (graph_t * G, adjust_data* am)
 {
-    int ret;
+    int ret = 0;
 
     if (agnnodes(G) < 2)
 	return 0;
diff -ruN graphviz-12.2.1-orig/plugin/gd/Makefile.in graphviz-12.2.1/plugin/gd/Makefile.in
--- graphviz-12.2.1-orig/plugin/gd/Makefile.in	2024-12-06 17:56:08
+++ graphviz-12.2.1/plugin/gd/Makefile.in	2025-10-21 21:37:22
@@ -90,7 +90,6 @@
 build_triplet = @build@
 host_triplet = @host@
 @WITH_LIBGD_TRUE@@WITH_WIN32_TRUE@am__append_1 = -no-undefined
-@WITH_LIBGD_TRUE@@WITH_WIN32_TRUE@am__append_2 = $(top_builddir)/lib/pathplan/libpathplan.la
 subdir = plugin/gd
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/m4/ax_check_compile_flag.m4 \
@@ -564,7 +563,7 @@
 @WITH_LIBGD_TRUE@	$(top_builddir)/lib/cgraph/libcgraph.la \
 @WITH_LIBGD_TRUE@	$(top_builddir)/lib/cdt/libcdt.la \
 @WITH_LIBGD_TRUE@	$(PANGOCAIRO_LIBS) $(GDLIB_LIBS) $(MATH_LIBS) \
-@WITH_LIBGD_TRUE@	$(am__append_2)
+@WITH_LIBGD_TRUE@	$(top_builddir)/lib/pathplan/libpathplan.la
 all: all-am
 
 .SUFFIXES:
diff -ruN graphviz-12.2.1-orig/plugin/quartz/Makefile.in graphviz-12.2.1/plugin/quartz/Makefile.in
--- graphviz-12.2.1-orig/plugin/quartz/Makefile.in	2024-12-06 17:56:08
+++ graphviz-12.2.1/plugin/quartz/Makefile.in	2025-10-21 21:40:35
@@ -575,7 +575,7 @@
 libgvplugin_quartz_la_LDFLAGS = -version-info $(GVPLUGIN_VERSION_INFO) \
 	-framework CoreFoundation $(am__append_1)
 libgvplugin_quartz_la_SOURCES = $(libgvplugin_quartz_C_la_SOURCES)
-libgvplugin_quartz_la_LIBADD = $(QUARTZ_LIBS)
+libgvplugin_quartz_la_LIBADD = $(top_builddir)/lib/gvc/libgvc.la $(top_builddir)/lib/cgraph/libcgraph.la $(QUARTZ_LIBS)
 AM_LIBTOOLFLAGS = --tag=CC
 all: all-am
 
diff -ruN graphviz-12.2.1-orig/plugin/quartz/gvloadimage_quartz.c graphviz-12.2.1/plugin/quartz/gvloadimage_quartz.c
--- graphviz-12.2.1-orig/plugin/quartz/gvloadimage_quartz.c	2024-12-06 17:55:56
+++ graphviz-12.2.1/plugin/quartz/gvloadimage_quartz.c	2025-10-21 21:41:06
@@ -15,6 +15,10 @@
 #include <stdlib.h>
 #include <string.h>
 
+#include <CoreGraphics/CGDataProvider.h>
+#include <CoreGraphics/CGImage.h>
+#include <CGGLContext.h>
+
 #include <gvc/gvplugin_loadimage.h>
 
 #include "gvplugin_quartz.h"
diff -ruN graphviz-12.2.1-orig/plugin/quartz/gvplugin_quartz.h graphviz-12.2.1/plugin/quartz/gvplugin_quartz.h
--- graphviz-12.2.1-orig/plugin/quartz/gvplugin_quartz.h	2024-12-06 17:55:56
+++ graphviz-12.2.1/plugin/quartz/gvplugin_quartz.h	2025-10-21 21:41:38
@@ -10,7 +10,10 @@
 
 #pragma once
 
-#include <Availability.h>
+#include <CoreGraphics/CoreGraphics.h>
+#include <CoreGraphics/CGDataConsumer.h>
+#include <CoreGraphics/CGFont.h>
+#include <AvailabilityMacros.h>
 
 #if defined(__IPHONE_OS_VERSION_MIN_REQUIRED)
 #include <CoreGraphics/CoreGraphics.h>
diff -ruN graphviz-12.2.1-orig/plugin/quartz/gvrender_quartz.c graphviz-12.2.1/plugin/quartz/gvrender_quartz.c
--- graphviz-12.2.1-orig/plugin/quartz/gvrender_quartz.c	2024-12-06 17:55:56
+++ graphviz-12.2.1/plugin/quartz/gvrender_quartz.c	2025-10-21 21:42:28
@@ -13,6 +13,9 @@
 #include <stdlib.h>
 #include <string.h>
 
+#include <CoreGraphics/CGContext.h>
+#include <CoreGraphics/CGPDFContext.h>
+
 #ifdef __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
 #if __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 20000
 #include <mach/mach_host.h>
@@ -27,6 +30,11 @@
 #include <gvc/gvplugin_device.h>
 #include <gvc/gvplugin_render.h>
 #include <cgraph/cgraph.h>
+
+#ifndef CGFLOAT_DEFINED
+/* nowhere defined, for Carbon Emacs the same work-around */
+typedef float CGFloat;
+#endif
 
 #include "gvplugin_quartz.h"
 
diff -ruN graphviz-12.2.1-orig/tclpkg/Makefile.in graphviz-12.2.1/tclpkg/Makefile.in
--- graphviz-12.2.1-orig/tclpkg/Makefile.in	2024-12-06 17:56:08
+++ graphviz-12.2.1/tclpkg/Makefile.in	2025-10-21 21:43:19
@@ -932,7 +932,7 @@
 @ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@	-mkdir -p $(DESTDIR)$(RUBY_INSTALL_DIR);
 @ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@	if test -w $(DESTDIR)$(RUBY_INSTALL_DIR); then \
 @ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@		(cd $(DESTDIR)$(RUBY_INSTALL_DIR); \
-@ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@			cp -f $(DESTDIR)$(pkgrubydir)/libgv_ruby.so gv.so;) \
+@ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@			ln -fs $(pkgrubydir)/libgv_ruby.so gv.so;) \
 @ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@	else \
 @ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@		echo "Warning: $(RUBY_INSTALL_DIR) is not writable."; \
 @ENABLE_SHARED_TRUE@@WITH_RUBY_TRUE@		echo "Skipping system installation of ruby binding."; \
diff -ruN graphviz-12.2.1-orig/tclpkg/tcldot/Makefile.in graphviz-12.2.1/tclpkg/tcldot/Makefile.in
--- graphviz-12.2.1-orig/tclpkg/tcldot/Makefile.in	2024-12-06 17:56:09
+++ graphviz-12.2.1/tclpkg/tcldot/Makefile.in	2025-10-21 21:44:54
@@ -704,7 +704,7 @@
 	$(top_builddir)/lib/cdt/libcdt_C.la \
 	$(top_builddir)/lib/util/libutil_C.la $(GTS_LIBS) \
 	$(am__append_2) $(am__append_3) $(EXPAT_LIBS) \
-	$(IPSEPCOLA_LIBS) $(MATH_LIBS)
+	$(IPSEPCOLA_LIBS) $(MATH_LIBS) $(am__append_1)
 @WITH_TCL_TRUE@BUILT_SOURCES = pkgIndex.tcl
 SUFFIXES = .3tcl .3tcl.pdf
 EXTRA_DIST = $(man) README README.Tkspline
