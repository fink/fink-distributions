Package: podofo9-shlibs
# each upstream %v in the 0.x series is a new install_name (explicitly
# not guaranteed to be stable interface) and debian concurs with a
# separate soname package for each
#
# LIBIDN2 FTBFS; https://sourceforge.net/p/podofo/mailman/message/36224376
# new upstream 0.9.6 same situation
Version: 0.9.2
Revision: 7
Source: mirror:sourceforge:podofo/podofo-%v.tar.gz
Source-MD5: 41966c57fa4266ac5cef80bfade0c8e7
License: GPL
DescPackaging: <<
	Former maintainer: Martin Costabel <costabel@wanadoo.fr>

 Upstream patches for newer-cmake compatibility. See for example:
 https://sourceforge.net/p/podofo/tickets/24/

 -std=c++11 to fix FTBFS against cppunit1.15.1. But that also requires
 fixing some narrowing-conversion errors, using upstream patches:
 https://sourceforge.net/p/podofo/code/1726
 https://sourceforge.net/p/podofo/code/1727
<<
Depends: fontconfig2-shlibs, libjpeg9-shlibs, libjpeg-bin, libtiff5-shlibs, freetype219-shlibs, libpng16-shlibs, libidn-shlibs
BuildDepends: fontconfig2-dev, libjpeg9, libtiff5, freetype219, libpng16, cmake (>= 2.6.0-1), lua51-dev, libidn, cppunit1.15.1, fink-package-precedence, fink (>= 0.32)
# despite hackery, cmake's flag spaghetti still picks up an existing
# installed version's headers ahead of the source directory being
# built
BuildConflicts: podofo9-dev
PatchFile: %n.patch
PatchFile-MD5: f1ebf5351222b3a15bdcd2ac3480978d
PatchFile2: %n-c++11.patch
PatchFile2-MD5: df38072aee437ffc16557c4516d0668f
PatchScript: <<
#!/bin/sh -ex
 %{default_script}
 perl -pi -e 's|^INCLUDE_DIRECTORIES\($|$&\n\$\{PoDoFo_SOURCE_DIR\}|' CMakeLists.txt
# Virtualize explicit '/sw' in sources
  perl -pi -e 's,/sw,%p,g' cmake/modules/FindLua51.cmake
# add forgotten man pages to the list so they get installed
  perl -pi -e 's|INSTALL.*|$&\n  podofocolor.1\n  podofogc.1|' debian/man/CMakeLists.txt 
# make it work on 10.7: include headers that really exist
perl -pi.bak -e's|CommonCrypto.h>|CommonDigest.h>\n#include <CommonCrypto/CommonCryptor.h>|' src/base/PdfEncrypt.cpp
# make it work with libc++: remove irritating and apparently unnecessary forward declaration
  /usr/bin/sed -i".bak" -e '/class ios_base/d' src/base/PdfLocale.h
<<
CompileScript: <<
#!/bin/sh -ev
 mkdir build
 cd build
 cmake --debug-output -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON \
       -DCMAKE_INSTALL_PREFIX:PATH=%p \
       -DCMAKE_INCLUDE_PATH:PATH=%p/include \
       -DCMAKE_LIBRARY_PATH:PATH=%p/lib \
       -DPODOFO_BUILD_STATIC:BOOL=TRUE \
       -DCMAKE_INSTALL_NAME_DIR:STRING=%p/lib \
       -DCMAKE_BUILD_WITH_INSTALL_RPATH:BOOL=ON \
       -DCMAKE_INSTALL_RPATH:STRING=%p/lib \
       -DCMAKE_EXE_LINKER_FLAGS:STRING="" \
       -DFONTCONFIG_INCLUDE_DIR:PATH=%p/lib/fontconfig2/include \
       -DFONTCONFIG_LIBRARIES:FILEPATH=%p/lib/fontconfig2/lib/libfontconfig.dylib \
       -DLIBCRYPTO_LIBRARY_RELEASE:FILEPATH=/usr/lib/libSystem.B.dylib \
       -DFREETYPE_DIR:PATH=%p/lib/freetype219 \
       -DFREETYPE_INCLUDE_DIR_FT2BUILD:PATH=%p/include/freetype2 \
       -DFREETYPE_INCLUDE_DIR_FTHEADER:PATH=%p/include/freetype2 \
       -DFREETYPE_LIBRARY:FILEPATH=%p/lib/libfreetype.dylib \
       -DCMAKE_CXX_FLAGS="-MD" \
        ..
# evil hack to find installed headers after the headers in the source
# if you know how to do this more elegantly in cmake, please tell me
 perl -pi -e 's|(\-I%p/include )(\S* )|-I.. \2\1|g' `find . -name flags.make`
#
# Hack for finding not-yet-installed dylibs during making.
# Cmake's method via CMAKE_BUILD_WITH_INSTALL_RPATH=OFF is still
# half-baked; doesn't work for the podofo binary executables
 export DYLD_LIBRARY_PATH=`pwd`/bin
#
 make
 cd ..
 fink-package-precedence --depfile-ext='\.d' --prohibit-bdep=podofo9-dev .
<< 
InstallScript: <<
#!/bin/sh -ev
 pushd build
 make install DESTDIR=%d
 popd
<<
DocFiles: AUTHORS COPYING ChangeLog README.html
Shlibs: %p/lib/libpodofo.0.9.1.dylib 0.9.1 %n (>= 0.9.1-1)
Splitoff: <<
  Package: podofo9-dev
  Depends: %N (= %v-%r)
  BuildDependsOnly: True
  Conflicts: podofo-dev
  Replaces: podofo-dev
  DocFiles: AUTHORS COPYING ChangeLog README.html
  Files: <<
    include
    lib/libpodofo.a
    lib/libpodofo.dylib
  <<
<<
Splitoff3: <<
  Package: podofo
  Depends: %N (>= %v-%r), fontconfig2-shlibs, libjpeg9-shlibs, libjpeg-bin, libtiff5-shlibs, freetype219-shlibs, lua51-shlibs, libidn-shlibs
  Files: bin share/man
  DocFiles: AUTHORS COPYING ChangeLog README.html
<<
SplitOff4: <<
	Package: podofo9
	RuntimeDepends: <<
		fink-obsolete-packages,
		podofo (>=%v-%r)
	<<
	InstallScript: <<
		mkdir -p %i/share/doc/installed-packages
		touch %i/share/doc/installed-packages/%n
	<<
<<
Description: Library and tools for PDF files
DescDetail: <<
The PoDoFo library is a free, portable C++ library
which includes classes to parse PDF files and modify
their contents into memory.
The changes can be written back to disk easily.
The parser can also be used to extract information
from a PDF file (for example the parser could be used
in a PDF viewer). Besides parsing PoDoFo includes also
very simple classes to create your own PDF files.
All classes are documented so it is easy to start
writing your own application using PoDoFo.

The PoDoFo tools are simple tools built around the PoDoFo library.
These tools are first of all examples on how to use the PoDoFo
library in your own projects. But secondly they offer also
features for working with PDF files.
<<
Maintainer: Daniel Macks <dmacks@netspace.org>
Homepage: http://podofo.sourceforge.net/
