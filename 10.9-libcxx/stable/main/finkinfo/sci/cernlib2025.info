Info3: <<
Package: cernlib2025
Version: 2025.09.18.4
Revision: 2
Type: gcc (12)
Description: CERNlib library
License: GPL
Maintainer: None <fink-devel@lists.sourceforge.net>

Source: https://cernlib.web.cern.ch/download/2025_source/tar/cernlib-cernlib-%v-free.tar.gz
Source-Checksum: SHA256(ce12d9951d0252d3cf62bfbdf49a459c9d5eafe2fb61ca112e2e6128b111a91e)
SourceDirectory: cernlib-cernlib-%v-free

BuildDepends: <<
	cmake,
	fink (>= 0.30.0),
	gcc%type_pkg[gcc],
	fink-buildenv-modules,
	fink-package-precedence,
	fontconfig2-dev,
	freetype219,
	libxt,
	openblas,
	openmotif4-2level,
	sed,
	xft2-dev,
	x11-dev
<<
Depends: <<
	gcc%type_pkg[gcc]-shlibs,
	fontconfig2-shlibs,
	freetype219-shlibs,
	openblas-shlibs,
	openmotif4-2level-shlibs,
	x11-shlibs
<<
PatchFile: %n.patch
PatchFile-MD5: ad24481c9d5d00174d3ffdca2947cb87
# for properly resolving all symbols when linking shared libraries
PatchFile2: %n-shared.patch
PatchFile2-MD5: 40900f091781e4694a2a00f376e5d0c9
PatchScript: <<
	sed -e 's|@FINK_PREFIX@|%p|g' <  %{PatchFile} | patch -p1
	sed -e 's|@FINK_PREFIX@|%p|g' <  %{PatchFile2} | patch -p1
<<

CompileScript: <<
#!/bin/sh -ev
	. %p/sbin/fink-buildenv-cmake.sh
	mkdir finkbuild
	pushd finkbuild
		cmake $FINK_CMAKE_ARGS \
			-DCERNLIB_BUILD_SHARED:BOOL=OFF \
			-DCERNLIB_USE_INTERNAL_LAPACK:BOOL=OFF \
			-DCERNLIB_USE_INTERNAL_XBAE:BOOL=ON \
			-DCERNLIB_XROOTD:BOOL=OFF \
			-DCMAKE_C_FLAGS="$CFLAGS -MD" \
			-LAH \
			..
		make -w VERBOSE=1 || make -w -j1 VERBOSE=1
	popd
	fink-package-precedence --depfile-ext='\.d' .
<<
InstallScript: <<
	cd finkbuild; make install DESTDIR=%d
	# match to historical patchy5 filename to avoid collision with patchy4 and U-A
	mv %i/bin/fcasplit %i/bin/fcasplit5
	# avoid collision with openblas' header
	mv %i/include/lapack.h %i/include/lapack-cernlib.h
	rm %i/include/cfortran/lapack.h
	ln -s ../lapack.h %i/include/cfortran/lapack-cernlib.h
<<
SplitOff: <<
	Description: Paw++: Motif enhanced paw
	Package: %N-paw++
	Depends: <<
		%N (>= %v-%r),
		freetype219-shlibs,
		gcc%type_pkg[gcc]-shlibs,
		libxt-shlibs,
		openblas-shlibs,
		openmotif4-2level-shlibs,
		x11
	<<
	Files: <<
		bin/paw++
		bin/kxterm
		share/man/man1/paw++*
		share/man/man1/kxterm*
	<<
<<
SplitOff3: <<
	Description: GEANT 3.2.1
	Package: %N-geant321
	Depends: %N-dev (>= %v-%r)
	Files: <<
		bin/gxint
		lib/libgeant*.a
		share/cernlib/2025.02/xsneut95.dat
		share/doc/cernlib/geant321.README
		share/man/man1/gxint*
	<<
<<
SplitOff5: <<
	Description: CERNLIB patchy utilities
	Package: patchy5-gfortran
	Provides: patchy, patchy5
	Depends: <<
		%N-dev (>= %v-%r),
		gcc%type_pkg[gcc]-shlibs
	<<
	# patchy4 C/R: bin/y*
	#Conflicts: <<
	#	patchy4, patchy4-gfortran
	#<<
	#Replaces: <<
	#	patchy4, patchy4-gfortran
	#<<
	Files: <<
		bin/fcasplit5
		bin/ny*
		bin/yexpand
		share/man/man1/ny*
		share/man/man1/yexpand*
	<<
	PostInstScript: <<
		update-alternatives --install %p/bin/fcasplit fcasplit %p/bin/fcasplit5 2025
	<<
	PreRmScript: <<
		if [ $1 != "upgrade" ]; then
			update-alternatives --remove fcasplit %p/bin/fcasplit5
		fi
	<<
<<

SplitOff10: <<
	Description: Cernlib dev libraries and headers
	Package: %N-dev
	Depends: %N (= %v-%r)
	Files: <<
		include
		lib/lib*.a
		share/aclocal
		share/cernlib/cmake
	<<
<<
RuntimeVars: <<
	CERN:       %p
	CERN_LEVEL: '.'
	CERN_ROOT:  %p
<<

DocFiles: README.md
Homepage: https://cernlib.web.cern.ch/cernlib/
DescDetail: <<
The CERN Program Library is a large collection of general purpose
libraries  and  modules  maintained and offered in both source and
object code form on the CERN central computers. The two most popular
applications based on CERNLIB are  PAW and  GEANT 3.21. Most of these
programs were developed at CERN and are therefore oriented towards the
needs of a physics research laboratory that is general mathematics, data
analysis, detectors simulation, data-handling etc... applicable to a
wide range of problems.
<<

DescPort: <<
cernlib > 2006 is not supported by CERN. The community version is
maintained on a best effort basis.
* Most of the shared libraries are missing dependent libraries to fully resolve all symbols.
* ETIME is not an external function.
  https://stackoverflow.com/questions/36041719/fortran-undefined-reference-to-lnblnk-getpid-dtime-etime
<<
<<
