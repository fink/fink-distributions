diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/CMakeLists.txt	2025-12-20 19:21:51
@@ -367,8 +367,8 @@
 set(CMAKE_STATIC_LINKER_FLAGS  "")
 
 if (APPLE)
- set (CMAKE_EXE_LINKER_FLAGS  "-v -Wl,-ld_classic,-dead_strip")
- set (CMAKE_EXE_LINKER_FLAGS_DEBUG  "-v -Wl,-ld_classic,-dead_strip")
+ set (CMAKE_EXE_LINKER_FLAGS  "-v -Wl,-dead_strip")
+ set (CMAKE_EXE_LINKER_FLAGS_DEBUG  "-v -Wl,-dead_strip")
 endif()
 
 set(CMAKE_EXE_LINKER_FLAGS_${CMAKE_BUILD_TYPE}  "")
@@ -764,7 +764,7 @@
   endif()
 endif()
 if (APPLE)
-  set(X11_LIBRARIES -L/opt/X11/lib -L/opt/homebrew/lib ${X11_LIBRARIES})
+  set(X11_LIBRARIES -L@FINK_PREFIX@/lib -L/opt/X11/lib ${X11_LIBRARIES})
 endif()
 message(STATUS "CERNLIB: X11_Xt_LIB=${X11_Xt_LIB} X11_Xaw_LIB=${X11_Xaw_LIB} X11_LIBRARIES=${X11_LIBRARIES}")
 
@@ -784,7 +784,7 @@
 message(STATUS "CERNLIB: FREETYPE_INCLUDE_DIRS=${FREETYPE_INCLUDE_DIRS} FREETYPE_LIBRARIES=${FREETYPE_LIBRARIES}")
 find_package(Motif REQUIRED)
 if (APPLE)
-  set(X11_INCLUDE_DIR /opt/X11/include /opt/homebrew/include)
+  set(X11_INCLUDE_DIR @FINK_PREFIX@/include /opt/X11/include)
 else()
   set(Xm ${MOTIF_LIBRARIES})
 endif()
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/cmake/Modules/FindXRootD.cmake cernlib-cernlib-2025.09.18.4-free/cmake/Modules/FindXRootD.cmake
--- cernlib-cernlib-2025.09.18.4-free-orig/cmake/Modules/FindXRootD.cmake	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/cmake/Modules/FindXRootD.cmake	2025-12-20 19:21:24
@@ -12,7 +12,7 @@
   HINTS
   /usr/bin
   /usr/local/bin
-  /opt/homebrew/bin
+  @FINK_PREFIX@/bin
 )
 
 if (XROOTD_CONFIG)
@@ -31,9 +31,9 @@
   /usr
   /opt/xrootd/
   /usr/local
-  /opt/homebrew/xrootd
+  @FINK_PREFIX@/xrootd
   PATH_SUFFIXES include/xrootd
-  PATHS /opt/xrootd /usr/local/xrootd /opt/homebrew
+  PATHS /opt/xrootd /usr/local/xrootd @FINK_PREFIX@
 )
 
 if (XROOTD_INCLUDE_DIR)
@@ -50,9 +50,9 @@
   /usr
   /opt/xrootd/
   /usr/local
-  /opt/homebrew
+  @FINK_PREFIX@
   PATH_SUFFIXES lib/xrootd
-  PATHS /opt/xrootd /usr/local/xrootd /opt/homebrew
+  PATHS /opt/xrootd /usr/local/xrootd @FINK_PREFIX@
 )
 
 if (XROOTD_XrdPosix_LIBRARY)
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/geant321/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/geant321/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/geant321/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/geant321/CMakeLists.txt	2025-12-21 07:14:05
@@ -375,7 +375,12 @@
  
   set(geant321_matx55_FSRC dcross.F ddot.F dmm55.F dnorm.F dsmt5t.F rmm55.F rsmt5t.F ssmt5t.F xmm55.F)
   list(TRANSFORM geant321_matx55_FSRC PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/../geant321/matx55/")
+
+#geant321/miface/Imakefile
  
+  set(geant321_miface_FSRC gmicap.F gmiset.F gmorin.F gmplxs.F gmxsec.F)
+  list(TRANSFORM geant321_miface_FSRC PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/../geant321/miface/")
+ 
 #geant321/miguti/Imakefile
  
   set(geant321_miguti_FSRC azirn.F exprnf.F gtiso.F randc.F sflraf.F sigmor.F)
@@ -433,6 +438,7 @@
                              ${geant321_guser_FSRC} 
                              ${geant321_gxint_FSRC} 
                              ${geant321_matx55_FSRC} 
+                             ${geant321_miface_FSRC} 
                              ${geant321_miguti_FSRC} 
                              ${geant321_neutron_FSRC} 
 )
@@ -472,6 +478,7 @@
                              ${geant321_guser_FSRC} 
                              ${geant321_gxint_FSRC} 
                              ${geant321_matx55_FSRC} 
+                             ${geant321_miface_FSRC} 
                              ${geant321_miguti_FSRC} 
                              ${geant321_neutron_FSRC} 
 )
@@ -480,6 +487,7 @@
 target_include_directories(geant321 PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/")
 target_include_directories(geant321 PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/geant321")
 target_include_directories(geant321 PRIVATE ${FREETYPE_INCLUDE_DIRS})
+target_link_libraries(geant321 PRIVATE kernlib packlib graflib higz pawlib paw_motif code_motif)
 install(TARGETS geant321 DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(geant321        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME geant321 SOVERSION 2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libgeant321.so.2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libgeant321.so.2_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/graflib/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/graflib/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/graflib/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/graflib/CMakeLists.txt	2025-12-20 21:30:59
@@ -75,7 +75,7 @@
 target_include_directories(graflib PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/dzdoc")
 target_include_directories(graflib PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/hplot")
 target_include_directories(graflib PRIVATE ${FREETYPE_INCLUDE_DIRS})
-target_link_libraries(graflib PRIVATE ${Xm})
+target_link_libraries(graflib PRIVATE ${Xm} kernlib packlib higz)
 install(TARGETS graflib DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(graflib        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME graflib SOVERSION 1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libgraflib.so.1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libgraflib.so.1_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/graflib/higz/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/graflib/higz/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/graflib/higz/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/graflib/higz/CMakeLists.txt	2025-12-20 21:17:53
@@ -226,6 +226,7 @@
 target_include_directories(higz PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})
 target_include_directories(higz PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/../../packlib/kuip")
 target_include_directories(higz PRIVATE ${FREETYPE_INCLUDE_DIRS})
+target_link_libraries(higz PRIVATE kernlib packlib ${X11_LIBRARIES})
 install(TARGETS higz DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(higz        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME grafX11 SOVERSION 1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libgrafX11.so.1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libgrafX11.so.1_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/lapack/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/lapack/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/lapack/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/lapack/CMakeLists.txt	2025-12-20 20:59:33
@@ -187,7 +187,7 @@
   add_library(lapack SHARED ${lapack_FSRC} )
   target_include_directories(lapack PRIVATE ${PROJECT_SOURCE_DIR}/include)
   target_include_directories(lapack PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})
-  target_link_libraries(lapack PRIVATE blas)
+  target_link_libraries(lapack PRIVATE blas lapack_static)
   install(TARGETS lapack DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
   set_target_properties(lapack  PROPERTIES POSITION_INDEPENDENT_CODE ${CERNLIB_POSITION_INDEPENDENT_CODE} OUTPUT_NAME lapack SOVERSION 1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
   install_symlink(liblapack.so.1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/liblapack.so.1_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/lapack/SRC/dsecnd.f cernlib-cernlib-2025.09.18.4-free/lapack/SRC/dsecnd.f
--- cernlib-cernlib-2025.09.18.4-free-orig/lapack/SRC/dsecnd.f	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/lapack/SRC/dsecnd.f	2025-12-20 21:06:58
@@ -21,7 +21,7 @@
 *     ..
 *     .. External Functions ..
       REAL               ETIME
-      EXTERNAL           ETIME
+*     EXTERNAL           ETIME
 *     ..
 *     .. Executable Statements ..
 *
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/lapack/SRC/second.f cernlib-cernlib-2025.09.18.4-free/lapack/SRC/second.f
--- cernlib-cernlib-2025.09.18.4-free-orig/lapack/SRC/second.f	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/lapack/SRC/second.f	2025-12-20 21:06:53
@@ -21,7 +21,7 @@
 *     ..
 *     .. External Functions ..
       REAL               ETIME
-      EXTERNAL           ETIME
+*     EXTERNAL           ETIME
 *     ..
 *     .. Executable Statements ..
 *
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/mathlib/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/mathlib/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/mathlib/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/mathlib/CMakeLists.txt	2025-12-20 20:48:15
@@ -418,6 +418,7 @@
 target_include_directories(mathlib PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})
 target_include_directories(mathlib PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/gen/")
 target_include_directories(mathlib PRIVATE ${FREETYPE_INCLUDE_DIRS})
+target_link_libraries(mathlib PRIVATE kernlib packlib lapack)
 install(TARGETS mathlib DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(mathlib        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME mathlib SOVERSION 2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libmathlib.so.2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libmathlib.so.2_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/packlib/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/packlib/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/packlib/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/packlib/CMakeLists.txt	2025-12-20 20:21:54
@@ -936,7 +936,7 @@
 target_include_directories(packlib PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/zbook")
 target_include_directories(packlib PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/zebra")
 target_include_directories(packlib PRIVATE ${FREETYPE_INCLUDE_DIRS})
-target_link_libraries(packlib PRIVATE ${libshift} ${libxrdposix} ${crypto})
+target_link_libraries(packlib PRIVATE ${libshift} ${libxrdposix} ${crypto} kernlib)
 install(TARGETS packlib DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(packlib        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME packlib SOVERSION 1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libpacklib.so.1_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libpacklib.so.1_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/paw_motif/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/paw_motif/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/paw_motif/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/paw_motif/CMakeLists.txt	2025-12-21 08:58:57
@@ -103,7 +103,7 @@
 target_include_directories(paw_motif PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})
 target_include_directories(paw_motif PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/")
 target_include_directories(paw_motif PRIVATE ${FREETYPE_INCLUDE_DIRS})
-target_link_libraries(paw_motif PRIVATE ${X11_LIBRARIES})
+target_link_libraries(paw_motif PRIVATE ${X11_Xt_LIB} ${X11_LIBRARIES} kernlib packlib graflib Xm xbae_static higz pawlib code_motif)
 install(TARGETS paw_motif DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(paw_motif        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME pawlib-lesstif SOVERSION 3_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libpawlib-lesstif.so.3_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libpawlib-lesstif.so.3_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/pawlib/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/pawlib/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/pawlib/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/pawlib/CMakeLists.txt	2025-12-20 21:48:16
@@ -443,6 +443,7 @@
 target_include_directories(pawlib PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/paw")
 target_include_directories(pawlib PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}/sigma")
 target_include_directories(pawlib PRIVATE ${FREETYPE_INCLUDE_DIRS})
+target_link_libraries(pawlib PRIVATE kernlib packlib mathlib graflib lapack higz)
 install(TARGETS pawlib DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(pawlib        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME pawlib SOVERSION 2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libpawlib.so.2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libpawlib.so.2_${COMPSUFFIX})
diff -ruN -x finkbuild cernlib-cernlib-2025.09.18.4-free-orig/phtools/CMakeLists.txt cernlib-cernlib-2025.09.18.4-free/phtools/CMakeLists.txt
--- cernlib-cernlib-2025.09.18.4-free-orig/phtools/CMakeLists.txt	2025-09-21 08:17:35
+++ cernlib-cernlib-2025.09.18.4-free/phtools/CMakeLists.txt	2025-12-21 05:53:47
@@ -57,6 +57,7 @@
 target_include_directories(phtools PRIVATE ${PROJECT_SOURCE_DIR}/include)
 target_include_directories(phtools PRIVATE ${CMAKE_CURRENT_SOURCE_DIR})
 target_include_directories(phtools PRIVATE ${FREETYPE_INCLUDE_DIRS})
+target_link_libraries(phtools PRIVATE kernlib mathlib)
 install(TARGETS phtools DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT libs)
 set_target_properties(phtools        PROPERTIES POSITION_INDEPENDENT_CODE ON OUTPUT_NAME phtools SOVERSION 2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR})
 install_symlink(libphtools.so.2_${COMPSUFFIX}.${CERNLIB_VERSION_MAJOR} ${CMAKE_INSTALL_LIBDIR}/libphtools.so.2_${COMPSUFFIX})
