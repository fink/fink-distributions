Info2: <<
Package: cdo%type_pkg[-openmp]
# 2.4.0 needs c++20 -> gcc12
Version: 2.5.3
Revision: 1
Description: Climate Data Operators
HomePage: https://code.mpimet.mpg.de/projects/cdo
License: GPL
Type: gcc (12), -openmp (. -openmp)

Maintainer: None <fink-devel@lists.sourceforge.net>

# Prerequisites
BuildDepends: <<
	(%type_raw[-openmp] = -openmp) gcc%type_pkg[gcc]-compiler,
	eccodes (>= 2.44.0),
	fink-package-precedence,
	fftw3,
	gcc%type_pkg[gcc]-compiler,
	hdf5.200.v1.12,
	libproj19,
	netcdf-c22,
	szip
<<
Depends: <<
	eccodes-shlibs (>= 2.44.0),
	fftw3-shlibs,
	gcc%type_pkg[gcc]-shlibs,
	hdf5.200.v1.12-shlibs,
	libproj19-shlibs,
	netcdf-c22-shlibs,
	szip-shlibs
<<
Conflicts: %{Ni}, %{Ni}-openmp
Replaces: %{Ni}, %{Ni}-openmp

# Unpack Phase:
Source: https://code.mpimet.mpg.de/attachments/download/30045/%{Ni}-%v.tar.gz
Source-Checksum: SHA256(470fee8f4d2b4eddf9ec82d0adccf1f6b4821ddf34b33bfe6b7069b6b6457b40)
PatchFile: %{ni}.patch
PatchFile-MD5: 54f45dc0a69cd2f04a2a409f85eb8a42

# Compile Phase:
SetCC: gcc-fsf-%type_pkg[gcc]
SetCXX: g++-fsf-%type_pkg[gcc]
GCC: 4.0
NoSetLDFLAGS: true
ConfigureParams: <<
	(%type_raw[-openmp] = -openmp) CC=%p/lib/gcc%type_pkg[gcc]/bin/gcc-%type_pkg[gcc] \
	(%type_raw[-openmp] = -openmp) CXX=%p/lib/gcc%type_pkg[gcc]/bin/g++-%type_pkg[gcc] \
	(%type_raw[-openmp] = .) --disable-openmp \
	--with-netcdf=%p \
	--with-hdf5=%p/opt/hdf5.v1.12 \
	--with-szlib=%p \
	--with-eccodes=%p \
	--with-fftw3 \
	--with-proj=%p
<<
CompileScript: <<
	%{default_script}
	fink-package-precedence .
<<

# Test Phase:
# Need -j1, otherwise some tests will fail.
InfoTest: <<
	# tests need python3.anything, so force stable
	TestDepends: <<
		python310
	<<
	TestConfigureParams: PYTHON=%p/bin/python3.10
	TestScript: make -j1 check || exit 2
<<

# Install Phase:
DocFiles: AUTHORS ChangeLog LICENSE NEWS OPERATORS README doc/*.pdf

DescDetail: <<
CDO is a collection of command line Operators
to manipulate and analyse Climate Data files.
Supported file formats are GRIB, netCDF, SERVICE and EXTRA.
There are more than 200 operators available.
The following table gives a short overview about the main categories.
- File information (info, sinfo, diff, ...)
- File operations (copy, cat, merge, split*, ...)
- Selection (selcode, selvar, sellevel, seltimestep, ...)
- Missing values (setctomiss, setmisstoc, setrtomiss)
- Arithmetic (add, sub, mul, div, ...)
- Mathematical functions (sqrt, exp, log, sin, cos, ...)
- Comparision (eq, ne, le, lt, ge, gt, ...)
- Conditions (ifthen, ifnotthen, ifthenc, ifnotthenc)
- Field statistic (fldsum, fldavg, fldstd, fldmin, fldmax, ...)
- Vertical statistic (vertsum, vertavg, vertstd, vertmin, ...)
- Time range statistic (timavg, yearavg, monavg, dayavg, ...)
- Field interpolation (remapbil, remapcon, remapdis, ...)
- Vertical interpolation (ml2pl, ml2hl)
- Time interpolation (inttime, intyear)
Use cdo-openmp to include parallelization.
<<

DescPort: <<
- test needs make -j1, otherwise some tests will fail.
- fix exit code of a test that should fail.
<<
<<
