Package: clamav
Version: 0.73
Revision: 1
Source: mirror:sourceforge:%n/%n-%v.tar.gz
Source-MD5: e96f007e9156b41b5f07707e3b004465
BuildDepends: gmp, bzip2, bzip2-dev
Depends: passwd (>= 20030202-2), gmp-shlibs, bzip2-shlibs
Suggests: unrar
NoSetLDFLAGS: true
SetLIBS: -L%p/lib
ConfigureParams: --mandir=%p/share/man --with-dbdir=%p/var/db/%n --sysconfdir=%p/etc --disable-clamav --enable-shared=no
InstallScript: <<
 #!/bin/sh
 /usr/sbin/chown -R root:admin *
 /usr/bin/make install DESTDIR=%d
 /usr/bin/install -m 644 etc/clamav.conf %i/etc/
 /usr/bin/install -m 644 etc/freshclam.conf %i/etc/
 /usr/sbin/chown -R %n %i/var/db/%n
 /usr/bin/install -d -m 755 %i/share/doc/%n
 /bin/mv docs/* %i/share/doc/%n
 (cd %i/share/doc/%n; /bin/rm -R Makefile Makefile.am Makefile.in man)
 /usr/bin/install -d -m 755 %i/share/doc/%n/test/
 /usr/bin/install -m 644 test/* %i/share/doc/%n/test/
 #Remove CVS directories
 /usr/bin/find %i -name "CVS" -type d -depth -exec rm -rf \{\} \;
 # run tests
 echo; echo "*** TESTING %n:";
 %b/clamscan/clamscan --database=%b/database %b/test/test-failure.rar;  result1="$?"; echo "test result 1: ${result1}";
 echo "Done test 1"; echo;
 %b/clamscan/clamscan --database=%b/database %b/test/test;        result2="$?"; echo "test result 2: ${result2}";
 echo "Done test 2"; echo;
 %b/clamscan/clamscan --database=%b/database %b/test/test.bz2;    result3="$?"; echo "test result 3: ${result3}";
 echo "Done test 3"; echo;
 %b/clamscan/clamscan --database=%b/database %b/test/test-zip-noext; result4="$?"; echo "test result 4: ${result4}";
 echo "Done test 4"; echo;
 %b/clamscan/clamscan --database=%b/database %b/test/test.zip;    result5="$?"; echo "test result 5: ${result5}";
 echo "Done test 5"; echo;
 %b/clamscan/clamscan --database=%b/database %b/test/test.rar;    result6="$?"; echo "test result 6: ${result6}";
 echo "Done test 6"; echo;
 %b/clamscan/clamscan --database=%b/database %b/test/test.msc;    result7="$?"; echo "test result 7: ${result7}";
 echo "Done test 7"; echo;
 if [ $result1 == "0" ] && [ $result2 == "1" ] && [ $result3 == "1" ] && [ $result4 == "1" ] && [ $result5 == "1" ] && [ $result6 == "1" ] && [ $result7 == "1" ]; then
    echo "virus scan tests passed!" ;
    exit 0;
 else
    echo "*** virus scan tests failed! ***" ;
    exit 1;
 fi
<<
SplitOff: <<
  Package: %N-dev
  Depends: %N
  BuildDependsOnly: true
  InstallScript: <<
    /bin/mv %I/include %I/lib %i 
  <<
<<
PreInstScript: <<
 #!/bin/sh
 # Remove old virus databases which are not removed by previous clamav packages
 if [ -f %p/var/db/%n/viruses.db ]; then
   echo "Removing old virus definitions %p/var/db/clamav/viruses.db"
   rm -f %p/var/db/%n/viruses.db
 fi
 if [ -f %p/var/db/%n/viruses.db2 ]; then
   echo "Removing old virus definitions %p/var/db/clamav/viruses.db2"
   rm -f %p/var/db/%n/viruses.db2
 fi
 if [ -d %p/share/%n ]; then
   echo "Removing old virus definitions directory %p/share/%n"
   rm -r %p/share/%n
 fi
<<
PostInstScript: <<
 #!/bin/sh
 dir=%p/var/db/%n
 mainDB=main.cvd
 dailyDB=daily.cvd
 mainMD5SUM=937f22844dd8dc7e75604a7c0939ad73
 dailyMD5SUM=25ff395d7336935c920ccad0874fd845
 origdefs="2"
 if [ -f $dir/$mainDB ] && [ -f $dir/$dailyDB ]; then
   test1=`md5sum $dir/$mainDB`;
   test2=`md5sum $dir/$dailyDB`;
   if [ "$test1" == "$mainMD5SUM  $dir/$mainDB" ] && [ "$test2" == "$dailyMD5SUM  $dir/$dailyDB" ]; then
     origdefs="1";
   fi;
 else
   origdefs="1";
 fi
 if [ "$origdefs" == "1" ]; then
  printf "\n*** You appear to have the default virus definitions included with %n."
  YN=yes;
  printf "\n*** Download the latest virus definitions now? [Yn] "
  read YN
  : ${YN:=yes}
  case $YN in
   [yY]|[yY][eE][sS]) %p/bin/freshclam ;;
  esac
 else
  printf "\nYou have the newest virus definitions."
 fi
 printf "\nTo download the latest virus definitions in future, run 'sudo freshclam'.\n"
 
 if (( `/usr/bin/grep -c "^Example" %p/etc/clamav.conf` )); then 
  printf "\nBefore you can use 'clamscan', you need to edit the\n"
  printf "configuration file %p/etc/clamav.conf.\n"
  printf "(Use for example 'sudo pico %p/etc/clamav.conf').\n"
  printf "In most cases it is enough to remove the line 'Example',\n"
  printf "but check that the default configuration suits your needs.\n"
 fi
<<
ConfFiles: <<
 %p/etc/clamav.conf
 %p/etc/freshclam.conf
<<
DocFiles: AUTHORS BUGS COPYING ChangeLog FAQ NEWS README TODO
Maintainer: Remi Mommsen <remigius.mommsen@cern.ch>
Homepage: http://clamav.sourceforge.net/
License: GPL
Description: Clam Anti-virus scanner
DescDetail: <<
 Clam AntiVirus is an anti-virus scanner written from scratch. It is
 licensed under GNU GPL2 and uses the virus database from
 OpenAntiVirus, which is an another free anti-virus project. In
 contrast to the OpenAntiVirus which is written in Java, Clam
 AntiVirus is written entirely in C and is POSIX compliant.
<<
DescUsage: <<
 `clamscan -h` Outputs help information and exits.

 For virus updates, run `freshclam` as superuser from a shell prompt
 or in a cron script.

 Clamav handles most archive formats except those of unrar 3, for
 which it requires the unrar program.

 Virus signature databases are now installed into %p/var/db/clamav/
 instead of %p/share/clamav/.
<<
DescPackaging: <<
 Built with --disable-clamav to allow clamscan to run without
 superuser permissions.

 However, clamscan still requires a user named 'clamav' to run in
 superuser mode regardless of how it was built. (Important when
 running the post-build tests because fink runs as root).

 During the test the virus database isn't actually installed yet so
 the one in the build directory is specified.

 Original package maintainer was Carsten Klapp
 <carstenklapp@users.sourceforge.net> who provided the most part of
 the info file. However, some modifications where needed when the
 virus database names were changed with upstream version 0.65.
<<
DescPort: <<
 Install virus databases into %p/var/db/clamav instead of default
 %p/share/clamav; %p/share is for static data.

 Shared libraries disabled by '--enable-shared=no' so the program can
 be prebound. No other programs use libclam yet anyway AFAIK.
<<
