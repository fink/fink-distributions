Package: qt4-x11
Version: 4.3.3
Revision: 1
Description: Cross-Platform framework (X11 version)
License: GPL
Maintainer: Benjamin Reed <qt4-x11@fink.racoonfink.com>

Depends: <<
	%N-core-shlibs (= %v-%r),
	%N-gui-shlibs (= %v-%r),
	%N-designer (= %v-%r),
	%N-linguist (= %v-%r),
	%N-doc (= %v-%r),
	pkgconfig (>= 0.21-1),
	macosx (>= 10.4.3-1)
<<
BuildDepends: <<
	cctools (>= 446-0),
	cups-dev,
	dbus-dev (>= 1.0-1),
	expat1,
	fink (>= 0.26.0-1),
	fontconfig2-dev (>= 2.4.1-1),
	freetype219,
	glib2-dev,
	libgettext3-dev,
	libiconv-dev (>= 1.12-3),
	libjpeg,
	libmng2,
	libpng3 (>= 1.2.8-1),
	macosx (>= 10.4.3-1),
	pkgconfig (>= 0.21-1),
	x11-dev
<<
BuildDependsOnly: true
GCC: 4.0

CustomMirror: <<
	Primary: http://ranger.users.finkproject.org/distfiles
	eur-NL: http://ranger.users.finkproject.org/distfiles
	nam-US: http://ranger.befunk.com/fink
	nam-US: http://astrange.ithinksw.net/~astrange/ranger-fink
	nam-CA: http://www.southofheaven.net/befunk
<<
Source: mirror:custom:qt/qt-copy-755604.tar.bz2
Source-MD5: c12ff40d1f7ee9c5b7748a0865ff35aa
PatchFile: %{Ni}.patch
PatchFile-MD5: 98beaa78081e865bda6146f27f869e97
PatchScript: <<
	mkdir .svn
	./apply_patches
	patch -p1 --fuzz=4 < %{PatchFile}
	perl -pi -e 's,const char,char,g' config.tests/unix/gnu-libiconv/gnu-libiconv.cpp
<<

NoSetLDFLAGS: true
CompileScript: <<
#!/bin/sh -ev

	export CPATH=%p/include
	/bin/sh ./configure-for-fink.sh "%p" "%N" -pch -verbose
	make
<<

InstallScript: <<
#!/bin/sh -ev

	#### MAIN INSTALL ####

	unset QMAKESPEC
	export QTDIR=`pwd`
	export PATH="$QTDIR/bin:$PATH"

	make -j1 install INSTALL_ROOT=%d

	install -d -m 755 %i/bin
	for bin in linguist designer qtconfig; do
		ln -sf %p/lib/%N/bin/$bin %i/bin/${bin}4-x11
	done

	# add the WS_X11 stuff
	cat <<END >%i/lib/%N/include/QtCore/qglobal.h.new
#ifndef __USE_WS_X11__
#define __USE_WS_X11__ 1
#endif

END
	cat %i/lib/%N/include/QtCore/qglobal.h >>%i/lib/%N/include/QtCore/qglobal.h.new
	mv %i/lib/%N/include/QtCore/qglobal.h.new %i/lib/%N/include/QtCore/qglobal.h

	#### FIX LA, PRL and PC FILES ####

	perl -pi -e 's,-framework +[A-Za-z]+ ,,g' %i/lib/%N/lib/*.la
	perl -pi -e 's,%b/lib,%p/lib/%N/lib,g; s| -framework | -Wl,-framework,|g' %i/lib/%N/lib/pkgconfig/*.pc %i/lib/%N/lib/*.prl %i/lib/%N/lib/*.la

	#### TUTORIALS AND EXAMPLES ####

	# clean up the makefiles
	perl -pi -e "s,^DEPENDPATH.*,,g;s,^REQUIRES.*,,g" `/usr/bin/find demos examples -name "*.pro"`

	install -d -m 0755 %i/share/doc/%N/examples
	install -d -m 0755 %i/share/doc/%N/demos
	/bin/cp -fRL examples/* %i/share/doc/%N/examples/
	/bin/cp -fRL demos/* %i/share/doc/%N/demos/

	# kde icon for qt designer
	install -d -m 0755 %i/share/applnk/Development
	cat >%i/share/applnk/Development/designer4.desktop <<EOF
[Desktop Entry]
Name=Qt Designer 4
GenericName=Interface Designer
Exec=%p/lib/%N/bin/designer
Icon=designer
InitialPreference=5
MapNotify=true
MimeType=application/x-designer
Terminal=false
Encoding=UTF-8
Type=Application
EOF
	cat >%i/share/applnk/Development/linguist4.desktop <<EOF
[Desktop Entry]
Name=Qt Linguist 4
GenericName=Translation Editor
Exec=%p/lib/%N/bin/linguist
Icon=linguist
InitialPreference=5
MapNotify=true
Terminal=false
Encoding=UTF-8
Type=Application
EOF

	/usr/bin/find %i/share/doc/%N/ -name \*.moc -print0 | xargs -0 rm -rf {} >/dev/null 2>&1 || :
	/usr/bin/find %i/share/doc/%N/ -name \*.obj -print0 | xargs -0 rm -rf {} >/dev/null 2>&1 || :
	/usr/bin/find %i/share/doc/%N/examples -name Makefile\* -print0 | xargs -0 rm -rf >/dev/null 2>&1 || :

	LIBS="Qt3Support QtAssistantClient QtCore QtDBus QtDesigner QtDesignerComponents QtGui QtNetwork QtOpenGL QtScript QtSql QtSvg QtTest QtXml"
	for lib in $LIBS; do
		install_name_tool -id %p/lib/%N/lib/lib$lib.4.dylib %i/lib/%N/lib/lib$lib.%v.dylib
	done
	for lib in $LIBS; do
		for file in `find %i/lib/%N/lib/lib*.dylib %i/lib/%N/plugins/*/*.so %i/lib/%N/bin -type f`; do
			install_name_tool -change lib$lib.%v.dylib %p/lib/%N/lib/lib$lib.4.dylib "$file" || :
			install_name_tool -change lib$lib.4.dylib %p/lib/%N/lib/lib$lib.4.dylib "$file" || :
		done
	done

	perl -pi -e 's/-framework ApplicationServices/-Wl,-framework,ApplicationServices/g' %i/lib/%N/lib/pkgconfig/*.pc

	install -d -m 755 %i/share/doc/installed-packages
	touch %i/share/doc/installed-packages/%N
<<
DocFiles: GPL* LICENSE.* OPENSOURCE-NOTICE.TXT README*
SplitOff: <<
	Package: %N-gui-shlibs
	Depends: <<
		%N-core-shlibs (= %v-%r),
		freetype219-shlibs,
		libmng2-shlibs,
		libpng3-shlibs (>= 1.2.8-1),
		libjpeg-shlibs,
		x11-shlibs
	<<
	Suggests: <<
		%N-designer,
		%N-linguist,
		%N-doc
	<<
	Files: <<
		lib/%N/lib/libQt3Support.4*.dylib
		lib/%N/lib/libQtAssistantClient.4*.dylib
		lib/%N/lib/libQtGui.4*.dylib
		lib/%N/lib/libQtOpenGL.4*.dylib
		lib/%N/lib/libQtSvg.4*.dylib
		lib/%N/plugins/accessible
		lib/%N/plugins/iconengines
		lib/%N/plugins/imageformats
		lib/%N/plugins/inputmethods
	<<
	Shlibs: <<
		%p/lib/%N/lib/libQt3Support.4.dylib        4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtAssistantClient.4.dylib 4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtGui.4.dylib             4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtOpenGL.4.dylib          4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtSvg.4.dylib             4.3.0 %n (>= 4.3.3-1)
	<<
	PostInstScript: (/%p/lib/fontconfig2/bin/fc-cache -f || :) >/tmp/fc-cache.log 2>&1 || :
<<
SplitOff2: <<
	Package: %N-core-shlibs
	Depends: <<
		dbus-shlibs (>= 1.0-1),
		fink (>= 0.26.0-1)
	<<
	Files: <<
		lib/%N/lib/libQtCore.4*.dylib
		lib/%N/lib/libQtDBus.4*.dylib
		lib/%N/lib/libQtNetwork.4*.dylib
		lib/%N/lib/libQtScript.4*.dylib
		lib/%N/lib/libQtSql.4*.dylib
		lib/%N/lib/libQtTest.4*.dylib
		lib/%N/lib/libQtXml.4*.dylib
		lib/%N/plugins/codecs
		lib/%N/plugins/sqldrivers
	<<
	Shlibs: <<
		%p/lib/%N/lib/libQtCore.4.dylib    4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtDBus.4.dylib    4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtNetwork.4.dylib 4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtScript.4.dylib  4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtSql.4.dylib     4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtTest.4.dylib    4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtXml.4.dylib     4.3.0 %n (>= 4.3.3-1)
	<<
<<
SplitOff3: <<
	Package: %N-designer
	Depends: <<
		%N-designer-shlibs (= %v-%r),
		x11
	<<
	Replaces: %N (<< %v-1)
	Files: <<
		bin/designer*
		share/applnk/Development/designer4.desktop
		lib/%N/bin/designer
		lib/%N/translations/designer_*
	<<
<<
SplitOff4: <<
	Package: %N-designer-shlibs
	Depends: <<
		%N-gui-shlibs (= %v-%r),
		x11-shlibs
	<<
	Files: <<
		lib/%N/lib/libQtDesigner.*.dylib
		lib/%N/lib/libQtDesignerComponents.*.dylib
		lib/%N/plugins/designer
	<<
	Shlibs: <<
		%p/lib/%N/lib/libQtDesigner.4.dylib           4.3.0 %n (>= 4.3.3-1)
		%p/lib/%N/lib/libQtDesignerComponents.4.dylib 4.3.0 %n (>= 4.3.3-1)
	<<
<<
SplitOff5: <<
	Package: %N-linguist
	Depends: <<
		%N-gui-shlibs (= %v-%r),
		x11
	<<
	Replaces: %N (<< %v-1)
	Files: <<
		bin/l*
		share/applnk/Development/linguist4.desktop
		lib/%N/bin/l*
		lib/%N/phrasebooks
		lib/%N/translations/linguist_*
	<<
<<
SplitOff6: <<
	Package: %N-doc
	Files: share/doc/%N
<<

Homepage: http://www.trolltech.com/
DescUsage: <<
	To compile against this package, you need to make sure that
	%p/lib/%N/bin is first in your PATH.  $QTDIR is no longer necessary;
	instead, qmake contains the information necessary to find your Qt
	environment, and when you generate a project using qmake it knows
	what to do.

	If you need to manually find this package for whatever reason, you
	need -I%p/lib/%N/include in your compiler flags, and
	-L%p/lib/%N/lib in your linker flags.  In this case, it's still a
	good idea to set your PATH to %p/lib/%N/bin as well.

	To build the demos and examples, it's enough to just run qmake on
	the .pro file in the %p/share/doc/%N directory in the %N-doc
	package:

		mkdir /tmp/build-examples
		cd /tmp/build-examples
		%p/lib/%N/bin/qmake %p/share/doc/%N/examples/examples.pro
		make
<<
DescPackaging: 	This package is dedicated to Boo Fulbright.

