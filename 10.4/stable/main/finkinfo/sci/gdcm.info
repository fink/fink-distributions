Package: gdcm
Version: 2.2.1
Revision: 1
Maintainer: Alexander Hansen <alexkhansen@users.sourceforge.net>
Homepage: http://sourceforge.net/apps/mediawiki/gdcm/index.php?title=Main_Page
Description: Grassroots DICOM library
DescDetail: <<
Whenever medical data, especially medical image data, is generated in a
clinical environment, that data must be stored such that it can be retrieved by
the same hospital either immediately, or after several years to determine the
effectiveness of a course of treatment and to allow comparisons of multiple
images for the same patient.

Digital Imaging and Communications in Medicine (DICOM) is a standard that
governs this capability by specifying handling, storing, printing, and
transmitting information in medical imaging.

Grassroots DICOM (GDCM) is an implementation of the DICOM standard designed to
be open source so that researchers may access clinical data directly. GDCM
includes a file format definition and a network communications protocol, both
of which should be extended to provide a full set of tools for a researcher or
small medical imaging vendor to interface with an existing medical database.
GDCM is an open source implementation of the DICOM standard. It offers some
compatibility with ACR-NEMA 1.0 & 2.0 files (raw files). It is written in C++
and offers wrapping to the following target languages (via the use of swig):
<<
License: BSD

Source: mirror:sourceforge:%n/%n%%202.x/GDCM%%20%v/%n-%v.tar.bz2
Source-MD5: 51a84e2d3d7bc9ba38fd9f77208a56dc

BuildDepends: cmake,expat1, libopenjpeg, swig, system-java-dev, system-openssl-dev
Depends: %N-shlibs (= %v-%r), libopenjpeg-shlibs

CompileScript: <<
#!/bin/sh -ev
mkdir ../gdcmbin
cd ../gdcmbin
cmake 	-DCMAKE_PREFIX_PATH=%p \
		-DCMAKE_INSTALL_PREFIX:PATH=%i \
		-DGDCM_BUILD_SHARED_LIBS:BOOL=ON \
		-DGDCM_USE_SYSTEM_ZLIB:BOOL=ON \
		-DGDCM_USE_SYSTEM_EXPAT:BOOL=ON \
		-DGDCM_USE_SYSTEM_OPENJPEG:BOOL=ON \
		-DGDCM_USE_SYSTEM_OPENSSL:BOOL=ON \
		-DGDCM_USE_SYSTEM_UUID:BOOL=ON \
		-DGDCM_WRAP_JAVA:BOOL=ON \
		-DGDCM_BUILD_APPLICATIONS:BOOL=ON \
		%b
make
<<

InstallScript: << 
#!/bin/sh -ev
cd ../gdcmbin
make install
pushd %i/lib
for lib in 	libgdcmCommon.2.2 \
			libgdcmDICT.2.2 \
			libgdcmDSED.2.2 \
			libgdcmIOD.2.2 \
			libgdcmMEXD.2.2 \
			libgdcmMSFF.2.2 \
			libgdcmcharls.2.2 \
			libgdcmjpeg12.2.2 \
			libgdcmjpeg16.2.2 \
			libgdcmjpeg8.2.2 \
			libsocketxx.1.2 
do 
	#fix install_name
	if [ "$lib" = "libsocketxx.1.2" ] 
		then n=0
		else n=1
	fi 
	install_name_tool -id %p/lib/$lib.dylib $lib.$n.dylib
    for linkedlib in 	libgdcmCommon.2.2 \
						libgdcmDICT.2.2 \
						libgdcmDSED.2.2 \
						libgdcmIOD.2.2 \
						libgdcmMEXD.2.2 \
						libgdcmMSFF.2.2 \
						libgdcmcharls.2.2 \
						libgdcmjpeg12.2.2 \
						libgdcmjpeg16.2.2 \
						libgdcmjpeg8.2.2 \
						libsocketxx.1.2 
		do install_name_tool -change $linkedlib.dylib %p/lib/$linkedlib.dylib $lib.$n.dylib
	done
	# fix executables and jnlib
	for exe in ../bin/* libgdcmjni.jnilib
		do install_name_tool -change $lib.dylib %p/lib/$lib.dylib $exe
	done
done
<<
DescPackaging: <<
	Docs use TeX for generation, so we aren't building them in this package.
	Python bindings don't work yet.
	Examples use Qt for their build, so we'll pull those into their own package 
	at some point.
<<
DescPort: <<
	Lots of use of install_name_tool to fix libs and linkages.
<<
SplitOff: <<
	Package: %N-shlibs
	Files: lib/*.*.dylib
	Depends: expat1-shlibs, libopenjpeg-shlibs
	Shlibs: <<
		%p/lib/libgdcmCommon.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmDICT.2.2.dylib 2.2.0 %n (>=2.2.0-1)
		%p/lib/libgdcmDSED.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmIOD.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmMEXD.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmMSFF.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmcharls.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmjpeg12.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmjpeg16.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libgdcmjpeg8.2.2.dylib 2.2.0 %n (>=2.2.0-1) 
		%p/lib/libsocketxx.1.2.dylib 1.2.0 %n (>=2.2.0-1) 
	<<
<<
SplitOff2: <<
	Package: %N-dev
	BuildDependsOnly: true
	Depends: %N-shlibs (=%v-%r)
	Files: <<
		lib/*.dylib lib/%N-2.2/*.cmake
		include
	<<
<<
SplitOff3: <<
	Package: %N-java
	Depends: system-java, %N-shlibs (=%v-%r)
	Files: lib/gdcm.jar lib/libgdcmjni.jnilib
<<
