Info2: <<
Package: fltk-backend%type_pkg[-ui]-oct%type_pkg[oct]
Type: -ui (-x11 -aqua), oct(3.2.4)
Version: 3.2.4
Revision: 2
Maintainer: Alexander Hansen <alexkhansen@users.sourceforge.net>
Description: Graphics backend for octave-%type_raw[oct]
DescDetail:  <<
We build fltk-backend.oct separately to allow for variants that use Aqua and
X11.  Install fltk-backend-aqua-oct%type_pkg[oct] if you want the Aqua 
interface or fltk-backend-x11-oct%type_pkg[oct] if you want the X11 one.
<<

Source: mirror:gnu:octave/octave-%v.tar.gz
Source-MD5: 90c39fa9e241ad2e978bcee4682a2ba9
SourceDirectory: octave-%v

BuildDepends: <<
	(%type_pkg[-ui] = -x11) fltk-x11, 
	(%type_pkg[-ui] = -x11) x11-dev,
	(%type_pkg[-ui] = -aqua) fltk13-aqua,
	arpack, glpk-dev, hdf5.7, readline5, libncurses5, fftw3 (>= 3.1.1-7), 
    libcurl4, libftgl2, qhull6-dev, qrupdate | qrupdate-atlas, flag-sort,
	pcre, gcc46-compiler, suitesparse-metis, fink (>= 0.30.0), sed,
	graphicsmagick-dev, freetype219, libftgl2
<<
Depends: <<
	(%type_pkg[-ui] = -x11) fltk-x11-shlibs,  
	(%type_pkg[-ui] = -x11) x11,
	(%type_pkg[-ui] = -aqua) fltk13-aqua-shlibs
<<
BuildConflicts: coot-dev, broken-gcc, lammpi-dev, fort77, 4ti2-dev, imagemagick10-dev
GCC: 4.0
Conflicts: fltk-backend-aqua-oct%type_pkg[oct], fltk-backend-x11-oct%type_pkg[oct]
Replaces: fltk-backend-aqua-oct%type_pkg[oct], fltk-backend-x11-oct%type_pkg[oct]
UseMaxBuildJobs: false

PatchFile: octave-glpk.patch
PatchFile-MD5: a4861a0803cfbbbb8892019cd5f217d2
PatchFile2: %{ni}%type_pkg[oct].patch
PatchFile2-MD5: 4897b35503d3ffa49f3f5547669feb29

PatchScript: <<
	#!/bin/sh -ev
	patch -p1 < %{PatchFile}
	sed -e 's/@OCTVERSION@/%v/g' %{PatchFile2} | patch -p1 
	# fix lib name for qhull6
	perl -pi -e 's|(qhull[/.])|lib\1|g ; s|lqhull|lqhull6|' configure
	# wrong include dir for qhull6
	for f in `grep -l -r "qhull_a\.h" src`
		do sed -i.orig -e '/include/s|qhull/|lib&|' $f
	done
	# more patching by fangism
	# silence some warnings
	sed -i.orig -e '/ibasea/s|\*ibasea, ||' \
		-e '/ibasea/s| ibasea =.*||' \
		liboctave/oct-sort.cc
	# should this accompany -D_THREAD_SAFE? in CFLAGS,CXXFLAGS
	sed -i.orig '/#include.*Range\.h/i\
#define	_REENTRANT' liboctave/lo-specfun.cc
	# need size_t from <cstddef>
	sed -i.orig -e '/#define octave_oct_alloc_h/a\
using std::size_t;' liboctave/oct-alloc.h
	# needed by clang++, safe for g++: using-declaration as typedef
	for f in liboctave/DiagArray2.h liboctave/intNDArray.h
	do sed -i.orig -e '/using.*element_type;/s|using|& typename|' $f
	done
	# missing qualifier to dependent-name member-function
	sed -i.orig -e '/truncate_int/s|\(return\) \(truncate_int\)|\1 octave_int_base<T>::\2|' liboctave/oct-inttypes.h
    perl -pi -e 's/scripts doc/scripts/; s/INSTALL.OCTAVE//' Makefile
<<

SetCC: flag-sort -r gcc
SetCXX: flag-sort -r g++
SetLDFLAGS: -Wl,-dead_strip_dylibs
SetLIBS: -lGraphicsMagick -lmetis
ConfigureParams: <<
	F77=%p/bin/gfortran-fsf-4.6 --host=%m-apple-darwin --build=%m-apple-darwin \
	--infodir='${prefix}/share/info' --mandir='${prefix}/share/man' --libexecdir='${prefix}/lib' \
	--enable-shared --enable-dl  --without-mpi --with-hdf5 --with-fftw \
	(%type_pkg[-ui] = -x11 ) --with-x \
	(%type_pkg[-ui] = -x11 ) --x-libraries=/usr/X11/lib \ 
	(%type_pkg[-ui] = -x11 ) --x-includes=/usr/X11/include \ 
	(%type_pkg[-ui] = -x11 ) --without-framework-carbon \
	(%type_pkg[-ui] = -aqua ) --without-x \
	(%type_pkg[-ui] = -aqua ) --with-framework-carbon \
	--disable-static
<<

CompileScript: <<
 #!/bin/sh -ev
 export CFLAGS='-O3 -MD'
 export CXXFLAGS='-O3 -MD'
 export FFLAGS='-O3'
 a='--with-lapack=-Wl,-framework,Accelerate,-dylib_file,/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib:/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libLAPACK.dylib --with-blas=-Wl,-framework,Accelerate,-dylib_file,/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib:/System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib'
 FLIBDIR="%p/lib/gcc4.6/lib"
 ./configure FLIBS="${FLIBDIR}/libgfortran.dylib" %c $a
 #make
 pushd libcruft
 make all
 popd
 pushd liboctave
 make all
 popd
 pushd src
 make all
<<

InstallScript: <<
 mkdir -p %i/lib/octave/%type_raw[oct]/oct/%m-apple-darwin
 cp src/fltk_backend.oct %i/lib/octave/%type_raw[oct]/oct/%m-apple-darwin/
<<
DocFiles: COPYING
Homepage: http://www.octave.org/
License: GPL
DescPackaging:  <<
	Currently we build all of octave and then only install fltk_backend.oct.  
<<
<<
