Package: ccp4-onlylibs-dev
# Use version numbering to sync with the current CCP4 release:
Version: 6.0.99
Revision: 1
GCC: 4.0
Source: http://sage.ucsc.edu/xtal/%n/%n-%v.tgz
#Source: ftp://ftp.ccp4.ac.uk/prerelease/ccp4-onlylibs-dev.tar.gz
# Source-MD5: 67de45f1d718627ab96939f5443937ae
#Source-MD5: e778478de628c75792d2401248c63350
Source-MD5: 04d79e0c72544ec1ba447bb1e91b4b54
#
SourceDirectory: %n
#Source2: http://chemistry.ucsc.edu/~wgscott/xtal/%n/%n-extras-0.1.tgz
#Source2-MD5: ea307964e3786bef0868ea56aaaa0471
#
Depends:  gcc43-shlibs
BuildDepends: gcc43
# BuildDepends: fort77                
BuildDependsOnly: false
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
###############################################################################
#Patch: %n.patch
PatchScript: <<
#!/bin/zsh -efv
umask 0022
# Use my patched configure and ccp4.setup-zsh files
#cp ../ccp4.setup-zsh include/.
# cp ../configure .
# setup scripts for tcsh, zsh and bash users
export TEMPXTAL=$PWD:h
#
perl -pi.bak -e 's|/xtal|\$TEMPXTAL|g' include/ccp4.setup*   
# build prefix (changed in install)
perl -pi.bak -e 's|/prefix|%p|g' include/ccp4.setup*            
# location of tcktk, blt (not needed here, but doesn't hurt).
perl -pi.bak -e 's|/usr/local/bin|%p/bin|g' include/ccp4.setup*   
# same
# make copy for tcsh users (CCP4 convention is no suffix)
cp include/ccp4.setup-dist include/ccp4.setup
#
# Enable everything.
# We need the mmdbold clipper libraries built for COOT:
perl -pi.bak -e 's|enable_mmdbold=no|enable_mmdbold=yes|g' lib/clipper/configure*
perl -pi.bak -e 's|enable_phs=no|enable_phs=yes|g' lib/clipper/configure*
perl -pi.bak -e 's|enable_mmdb=no|enable_mmdb=yes|g' lib/clipper/configure*
perl -pi.bak -e 's|enable_minimol=no|enable_minimol=yes|g' lib/clipper/configure*
perl -pi.bak -e 's|enable_cif=no|enable_cif=yes|g' lib/clipper/configure*
perl -pi.bak -e 's|enable_ccp4=no|enable_ccp4=yes|g' lib/clipper/configure*
# perl -pi.bak -e 's|enable_cctbx=no|enable_cctbx=yes|g' lib/clipper/configure*
perl -pi.bak -e 's|enable_cns=no|enable_cns=yes|g' lib/clipper/configure*
perl -pi.bak -e 's|enable_fortran=no|enable_fortran=yes|g' lib/clipper/configure*

# clean up:
rm -f  include/*.bak lib/clipper/*.bak
   
<<
###############################################################################
CompileScript: <<
#!/bin/zsh -efv
umask 0022
#cp -R ../src/* lib/clipper/src/.
export TEMPXTAL=$PWD:h
source include/ccp4.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
#
 ./configure --disable-cctbx --disable-phaser --disable-pdb_extract --disable-diffractionImg --onlylibs Darwin

#FC="fort77"  ./configure --onlylibs Darwin
#ln -s $CCP4/lib/src $CCP4/lib/clipper/ccp4
#
#  fix some post-configure bugs
#
make          2>../make.log  |tee ../make.log      
make  install 2>../makeinst.log  |tee ../makeinst.log  
#
echo "Ignoring error messages.  They are harmless"
#
command ls -1 lib/*.a
sleep 10
#
# rm $CCP4/lib/clipper/ccp4
# make realclean
<<
###############################################################################
InstallScript: <<
#!/bin/zsh -efv
umask 0022
export TEMPXTAL=$PWD:h
source include/ccp4.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
ORIGDIR=$(dirname $PWD)
#
# Change environment scripts to match final installation install prefix:
 perl -pi.bak -e 's|\$TEMPXTAL|%p/share/xtal|g'         include/ccp4.setup*      
 perl -pi.bak -e 's|CCP4_MASTER/%n|CCP4_MASTER/%n-%v|g' include/ccp4.setup-zsh
 perl -pi.bak -e 's|ccp4-6.0.99|%n-%v|g'                include/ccp4.setup*
 rm -f include/*.bak
 perl -pi.bak -e 's|%b|%p/share/xtal/%n-%v|g' bin/clipper-config 
 rm -f bin/clipper-config.bak                                                          
 perl -pi.bak -e 's|%b|%p/share/xtal/%n-%v|g' lib/*.la
 rm -f lib/*.la.bak
#
    cp include/ssm/ssm_superpose.h include/ssm/ssm_superpose.h-orig
    perl -pi -e 's|ivector   FF1,FF2;||g' include/ssm/ssm_superpose.h
#  
# Now install:
 mkdir -p %i/bin
 mkdir -p %i/share/xtal/%n-%v
 cp bin/* %i/bin/.
 cp -R * %i/share/xtal/%n-%v/.
 ranlib %i/share/xtal/%n-%v/lib/**/*.a
<<
###############################################################################
SplitOff:<<
Package: clipper
Depends: clipper-bin, ccp4-onlylibs-dev
BuildDependsOnly: true
InstallScript: <<
 mkdir -p %i/share/doc/installed-packages
 touch %i/share/doc/installed-packages/%n
<<
Description: Working Clipper static libs and binaries
DescDetail:<<
Placeholder to install working static clipper libraries and binary
executables for packages that require both to be present for linking.

The aim of the project is to produce a set of object-oriented libraries 
for the organisation of crystallographic data and the performance of
crystallographic computation. The libraries are designed as a framework 
for new crystallographic software, which will allow the full power of 
modern programming techniques to be exploited by the developer. This 
will lead to greater functionality from simpler code which will be easier 
to develop and debug. NOTE:  This is a static version of clipper required
to build COOT and various clipper binary executables like CPIRATE with the
g++-4.0 compiler. 
<<
<<
###############################################################################
SplitOff2: <<
Package: clipper-bin
BuildDependsOnly: false
Files: <<   
bin/*
<<
Description: Working Clipper executables including cpirate
DescDetail:<<
The package clipper-bin installs statically-linked versions of the following
binary executable files that are broken in the ccp4-clipper-bin package in 
the 10.4 branch of fink: cecalc cfft chltofom cinvfft clipper-config 
cmakereference cpatterson cphasecombine cphasematch cpirate csfcalc csigmaa 
superpose.  These executables will be installed in %p/bin.
<<
<<
###############################################################################
###############################################################################
Description: CCP4 and CLIPPER static libraries
DescDetail: <<
This package installs CCP4 libraries, only.  If you need all 
of CCP4, install the self-contained CCP4 package instead of, or
in addition to, this. The splitoff package clipper-bin builds
and installs statically-linked clipper executable programs such
as cpirate. CCP4 itself will also install these, but cpirate in
CCP4 suffers from a run-time error.  Installation of clipper-bin
will put working copies in %p/bin, and thus at the head of the path.
The licensing for the CCP4 library loosely conforms to the LGPL,
unlike the more restrictive CCP4 license. The clipper libraries
and programs explicitly adhere to the LGPL.

This version compiles with the Apple Lapack/Blas framework
but uses its own static lib build of fftw to avoid a run-time
error that appears in cpirate and coot fft calculations.

CCP4lib files will be installed under 
%p/share/xtal/ccp4-onlylibs-dev-6.0.2. This is slightly newer
in content relative to the corresponding files in CCP4 6.0.2.

Programs requiring these libraries to build or run need to
source the appropriate
%p/share/xtal/ccp4-onlylibs-dev-6.0.2/include/ccp4.setup
file for the shell, as is done in the coot.info file. Unless
you are building something external to fink, there is no need
to source that file.

The primary use for this package, currently, is for compiling COOT.
The primary use for the clipper-bin split-off package is to provide
stand-alone, functioning versions of cpirate and colleagues.
<<
DocFiles: conditions.txt 
Homepage: http://www.ccp4.ac.uk  
License: LGPL           
Maintainer: W. G. Scott <wgscott@users.sourceforge.net>
