Package: labplot
Version: 1.6.0.pre2
Revision: 3
Distribution: 10.4

Source: mirror:sourceforge:labplot/LabPlot-%v.tar.bz2
Source-MD5: f551e8283719f687480cedea5011d208

Maintainer: Murali Vadivelu <murali1080@users.sourceforge.net>
Homepage: http://labplot.sourceforge.net
License: GPL

Depends: %N-shlibs (= %v-%r)
# changed bdeps to avoid obsolete pkgs kdelibs3 and _-shlibs (kde-libs3-unified not needed,
# being an (indirect) dep (through $N-shlibs and koffice-shlibs). 
# Also versioning liborigin dep, and adding some missing (hdf5, szip, ...)
BuildDepends: <<
arts-dev, audiofile, bzip2-dev, fftw3, freetype219, gettext-tools, ghostscript, gsl, hdf5, imagemagick10-dev,
kdelibs3-unified-dev, koffice-dev (>= 1.6.0-1), lcms, libart2, libgettext3-dev, libiconv-dev, libidn, libjasper.1, libjpeg,
liborigin (>= 20070115-1), libpng3, libtiff, libxml2-bin, ocaml, netcdf, pstoedit, qt3, qwtplot3d ( >= 0.2.6-2), szip, x11-dev
<<

TarFilesRename: src/labplot.desktop

PatchScript: <<
## configure searches a hard-coded list of paths
  perl -pi.bak -e 's,^jpeg_incdirs=",$&%p/include ,' configure
## those Magick++ ldflags could cause eg the lib to link against against the -lqwtplot3d
# of the previous version of labplot (in %p/lib), rather than that of the qwtplot3d pkg.
## USE_QHULL fix added
  perl -pi -e 's, \-\-ldflags,,; s,USE_LIBUNDO,USE_QHULL,' configure
## trailing slashes are bad practice, and throw /bin/ln in disarray. Also, use relative paths.
  perl -pi.bak -e 's,/( |$),\1,g; s,ln \-fs \$\(kde_htmldir\),ln -fs ../..,' doc/*/Makefile.in
## Was in the patch-file. Leaving aside for the moment _ a dylib can also be dlopened if need be.
  perl -pi -e 's, \-module,,' src/Makefile.in
## with the latest KDE, kexidb/parser.h seems to have disappeared. Zap it.
  perl -pi -e 's/.*parser.h.*//' src/FilterKexiDB.cc
## remove the '--silent' flag from libtool
  perl -pi -e 's,(libtool) --silent,\1,' configure
## zap the flat_namespace; add the 'single_module' flag that wouldn't come out for libLabPlotcephs
  perl -pi -e 's,-flat_namespace -undefined suppress,-single_module,' configure
<<

NoSetCPPFLAGS: true
SetCPPFLAGS: -I/usr/X11R6/include -I%p/Library/Frameworks/R.framework/Versions/Current/Resources/include
NoSetLDFLAGS: true
SetLIBRARY_PATH: %p/Library/Frameworks/R.framework/Versions/Current/Resources/lib:%p/lib

ConfigureParams: <<
 ac_cv_prog_TEXVC="no" --mandir=%p/share/man --with-qt-includes=%p/lib/qt3/include --with-qt-libraries=%p/lib/qt3/lib \
 --disable-fftw --enable-fftw3 --with-extra-includes=%p/include/gsl \
 --enable-arts --enable-netcdf --enable-tiff --enable-gsl \
 --enable-ImageMagick --enable-audiofile --enable-jasper --enable-pstoedit \
 --enable-ocaml --enable-system-qwtplot3d --enable-system-liborigin \
 --disable-qsa --disable-cdf --enable-R --enable-texvc --disable-qhull \
 --disable-dependency-tracking
<<
# using disable-qhull to force labplot to use Fink's qhull.

DocFiles: COPYING ChangeLog FEATURES TODO AUTHORS CHANGES NEWS INSTALL README

CompileScript: <<
#!/bin/sh -ev

export CPATH=%p/include
export QWT3D_PATH=%p/lib/qt3/qwtplot3d
export LIBORIGIN_HOME=%p/lib

export CFLAGS="-Os -fPIC -ffast-math"
export CXXFLAGS="$CFLAGS"
if [ %m = "ppc" ]; then
export CFLAGS="$CFLAGS -mtune=970 -maltivec"
export CXXFLAGS="$CXXFLAGS -mtune=970 -maltivec"
fi

./configure %c
make -j1
<<

InstallScript: <<
#!/bin/sh -ev

make install DESTDIR=%d
rm -f %i/bin/labplot %i/bin/LabPlot
cp src/.libs/LabPlot %i/bin/labplot

# libs don't need executable flag
chmod a-x %i/lib/*

mv %i/share/doc/HTML %i/share/doc/kde
mkdir -p %i/share/doc/%n
cp -R examples %i/share/doc/%n

mkdir -p %i/etc/profile.d
cat >> %i/etc/profile.d/%N.sh <<'EOF'
#!/bin/sh
export R_HOME=`R RHOME`
if [ ${SSH_TTY} ]; then
    export LIBGL_ALWAYS_INDIRECT=1
fi
EOF
cat >> %i/etc/profile.d/%N.csh <<'EOF'
#!/bin/csh
setenv R_HOME `R RHOME`
if ( $?SSH_TTY ) then
    setenv LIBGL_ALWAYS_INDIRECT 1
endif
EOF
chown root:admin %i/etc/profile.d/*
chmod 755 %i/etc/profile.d/*
<<

SplitOff: <<
Package: %N-shlibs
Depends: <<
audiofile-bin, fftw3-shlibs, gsl-shlibs, hdf5-shlibs, imagemagick, imagemagick10-shlibs, koffice-shlibs, libjasper1-bin, libjasper.1-shlibs,
liborigin-shlibs, netcdf-shlibs, ocaml, pstoedit-bin, qhull, qwtplot3d-shlibs (>= 0.2.6-2), r-base ( >> 2.7.0 )
<<

Files: lib/*.*.dylib

Shlibs: <<
%p/lib/libLabPlotcephes.1.dylib 7.0.0 %n (>=1.6.0-1)
%p/lib/libLabPlot.1.dylib  7.0.0 %n (>=1.6.0-1)
<<

DocFiles: COPYING ChangeLog FEATURES TODO AUTHORS CHANGES NEWS INSTALL README
<<

DescPackaging: <<
qsa and cdf are not avilable yet, in fink.
Will add qsa support sooner than later!
<<

DescPort: <<
SetCPPFLAGS to allow building against Fink's X11 packages.

NoSetLDFLAGS and NoSetCPPFLAGS, and no '--with-extra..';
using rather LIBRARY_PATH and CPATH, to get more correct
ordering of flags (and since those are always obeyed).

ac_cv_prog_TEXVC="no" in order that texvc be rebuilt even
if one (from a previous version) is already installed
<<

Description: Data analysis and visualisation
DescDetail: <<
LabPlot is a KDE program for two- and three-dimensional
graphical presentation of data sets and functions.
LabPlot allows you to work with multiple plots
which each can have multiple graphs. The graphs can be
produced from data or from functions, including user
defined (up to 9 parameters).

Many thanks goes to Jean-Francois Mertens for cleaning
up the info file, big-time.
<<
