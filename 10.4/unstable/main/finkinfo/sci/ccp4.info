Package: ccp4
Version: 5.99.5
Revision: 1002
Source: ftp://ftp.%n.ac.uk/%n/%v/packed/%n-core.tar.gz
Source2: ftp://ftp.%n.ac.uk/%n/%v/packed/phaser-cctbx.tar.gz
Source-MD5: 1dc37afc2597bceaabd971ba20d86ac3  
Source2-MD5: ac745815cdff2c4c719e9171f029b3ba
SourceDirectory: %n-%v
Source3: http://chemistry.ucsc.edu/~wgscott/xtal/xtalfink/XCCPJiffy-custom.gz
Source3-MD5: 21568dd2475505929573a3fd452c538f
Depends: x11, tcltk, blt, ccp4-shlibs (>= %v-%r)
BuildDepends: g77 (>= 3.4.0-2), f2c, fort77, tcltk-dev
Replaces: mosflm (<= 6.2.3-2), mosflm-small (<= 6.2.3-2), refmac (<= 5.1999-3), ccp4lib, ccp4lib-shlibs, ccp4 (<= 5.0.2-299 )
Conflicts: ccp4lib, ccp4lib-shlibs, ccp4 (<= 5.0.2-299 )
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
#
Patch: %n.patch
PatchScript: <<
#!/bin/zsh -ef
umask 0022
#
# setup script for tcsh, zsh and bash users
export TEMPXTAL=$PWD:h
#
perl -pi.bak -e 's|/xtal|\$TEMPXTAL|g' include/ccp4.setup*   # build prefix (changed in install)
perl -pi.bak -e 's|/prefix|%p|g' include/ccp4.setup*            # location of tcktk, blt
perl -pi.bak -e 's|/usr/local/bin|%p/bin|g' include/ccp4.setup*   # same
#
perl -pi.bak -e 's|SW_PREFIX|%p|g' **/configure            # location of tcktk, blt  
cp include/%n.setup-dist include/%n.setup
rm -f include/%n.setup-bash **/configure.bak include/ccp4.setup*.bak
#
# Set up XCCPJiffy wrapper scripts in $CCP4/etc
# These are small wrapper scripts for xplot84driver and xloggraph generated by the patch
chmod a+x etc/x*
<<
CompileScript: <<
#!/bin/zsh -ef
umask 0022
export TEMPXTAL=$PWD:h
source include/%n.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
export PATH=/System/Library/Frameworks/Python.framework/Versions/Current/bin:$PATH
export PYTHONHOME="/System/Library/Frameworks/Python.framework/Versions/Current"
export PYTHONPATH="/System/Library/Frameworks/Python.framework/Versions/Current/lib/python2.3"
./configure --with-x --with-shared-libs --with-fftw=%p Darwin
#  fix some post-configure bugs
 perl -pi.bak -e 's/EXTRA_LOAD_FLAGS = -lg2c//g' **/*akefile
 perl -pi.bak -e 's/EXTRA_LOAD_FLAGS = -lg2c//g' x-windows/XCCPJIFFY/Imakefile
 perl -pi.bak -e 's|\-lccp4c |\-lccp4c \-lSystemStubs |g' **/*akefile
 perl -pi.bak -e 's|\-lcc_dynamic||g' **/*akefile
 perl -pi.bak -e 's|\-lgfortran||g' x-windows/XCCPJIFFY/*akefile*
#
export PYTHONHOME="/System/Library/Frameworks/Python.framework/Versions/Current"
make -i
export PYTHONHOME="/System/Library/Frameworks/Python.framework/Versions/Current"
make -i install
#
echo "recompile xplot84driver and xccpjiffy2idraw"
# Manually recompile xplot84driver and xccpjiffy2idraw
# Manually link xloggraph with g77 (fails in make)
cd  x-windows/XCCPJIFFY
make xplot84driver 
make xccpjiffy2idraw
cp xplot84driver  $CBIN/xplot84driver.exe
rm -f $CBIN/xplot84driver
cp xccpjiffy2idraw $CBIN/.
#
# make xloggraph >/dev/null 2>&1
g77 -fno-second-underscore -o xloggraph -L/usr/lib msg_box.o ZDr2d.o EditString.o hardcopy_ctrl.o xloggraph.o log_file.o tom_fortran_interface.o bits_and_pieces.o graphics.o -g -Os -I/usr/include/X11R6 -L/usr/X11R6/lib -lXaw -lXmu -lXt -lSM -lICE -lXpm -lXext -lX11 -lm -lgcc -lSystemStubs
#
sleep 10
#
cp xloggraph $CBIN/xloggraph.exe
cd ../..
#
# make realclean
/bin/rm -f **/*.o
<<
InstallScript: <<
#!/bin/zsh -ef
umask 0022
export TEMPXTAL=$PWD:h
source include/%n.setup-zsh
export DYLD_LIBRARY_PATH=$CLIB
ORIGDIR=$(dirname $PWD)
# Change environment scripts to match final installation
perl -pi.bak -e 's|\$TEMPXTAL|%p/share/xtal|g' include/%n.setup*      # install prefix
# perl -pi.bak -e 's|\$TEMPXTAL|%p/share/xtal|g' lib/cctbx/cctbx_build/setpaths* 
#
#
 cp ../XCCPJiffy-custom.gz  XCCPJiffy.gz ; gunzip XCCPJiffy.gz; chmod a+x XCCPJiffy
 perl -pi.bak -e 's|5.0.1|%v|g' XCCPJiffy
 mv -f  XCCPJiffy lib/X11/app-defaults/XCCPJiffy
#  
 perl -pi.bak -e 's|/src/ccp4lib-5.99.5-2/ccp4-5.99.5||g' bin/clipper-config
 rm -f bin/clipper-config.bak
 perl -pi.bak -e 's|lclipper |lclipper-core |g' bin/clipper-config
 rm -f bin/clipper-config.bak                                
 perl -pi.bak -e 's|lib/lib -lrfftw -lfftw |lib/ccp4-%v -lsrfftw -lsfftw |g' bin/clipper-config
 rm -f bin/clipper-config.bak                                
#
# Fix path in libfoo.la files:
#  
 perl -pi.bak -e 's|/src/fink.build/%n-%v-%r/%n-%v/lib|/lib/%n-%v|g' lib/*.la
 rm -f lib/*.la.bak
#
# Now install:
#
 mkdir -p %i/lib
 cp -R lib %i/lib/%n-%v
 mkdir -p %i/bin
 cp -R bin/clipper-config %i/bin/clipper-config
 mkdir -p %i/share/xtal/%n-%v/help
 mkdir -p %i/share/man/man1
# set up man pages in a fink-compliant manner
 cd $PWD/doc
 mv rasmol.doc eightbit_rasmol.doc
 foreach docfilepage ( *.doc )
     cp ${docfilepage}  %i/share/man/man1/${docfilepage:r}.1
     cp ${docfilepage}  %i/share/xtal/%n-%v/help/${docfilepage:r}
end
# back to build directory
 cd ..
#                                
/bin/rm -rf lib 
#/bin/mv  lib lib-save

 cp -R * %i/share/xtal/%n-%v/.
 ln -s   %p/lib/%n-%v      %i/share/xtal/%n-%v/lib
#
# making scripts for %p/etc/profile.d  
 mkdir -p %i/etc/profile.d
#
 echo "source %p/share/xtal/%n-%v/include/%n.setup"                     > %i/etc/profile.d/%n.csh
 echo "setenv CLIB %p/lib/ccp4-%v "                                    >> %i/etc/profile.d/%n.csh
#

echo "if [ -z \$ZSH_NAME ];then                           "                        > %i/etc/profile.d/%n.sh 
echo "    source %p/share/xtal/%n-%v/include/%n.setup-sh "                       >> %i/etc/profile.d/%n.sh    
echo "else                                               "                       >> %i/etc/profile.d/%n.sh
echo "    source %p/share/xtal/%n-%v/include/%n.setup-zsh"                       >> %i/etc/profile.d/%n.sh
echo "fi                                                 "                       >> %i/etc/profile.d/%n.sh
echo "export CLIB=%p/lib/ccp4-%v "                                    >> %i/etc/profile.d/%n.sh
#
 chmod a+x %i/etc/profile.d/%n.*
#
 chmod a+x  %i/share/xtal/%n-%v/ccp4i/etc/osx_ccp4_mail
#
# chmod a+x %i/share/xtal/%n-%v/etc/ccp4help 
#
 ranlib %i/lib/%n-%v/*.a
 ranlib %i/lib/%n-%v/**/*.a
#
<<
PostInstScript: <<
# This chances the paths for the shell and python scripts to those of the 
# final install point rather than the build or debian root directory.
cd %p/lib/%n-%v/cctbx/cctbx_build
/System/Library/Frameworks/Python.framework/Versions/Current/bin/python ../cctbx_sources/libtbx/configure.py mmtbx
more %p/share/xtal/%n-%v/conditions.txt
<<
SplitOff: <<
Package: %N-shlibs
Depends: fftw-shlibs | fftw-mpi-shlibs
Replaces: ccp4lib, ccp4lib-shlibs
  Files: <<
lib/ccp4-5.99.5/libccif.dylib
lib/ccp4-5.99.5/libccp4c.dylib
lib/ccp4-5.99.5/libclipper-ccp4.0.0.0.dylib
lib/ccp4-5.99.5/libclipper-ccp4.0.dylib
lib/ccp4-5.99.5/libclipper-ccp4.dylib
lib/ccp4-5.99.5/libclipper-cif.0.0.0.dylib
lib/ccp4-5.99.5/libclipper-cif.0.dylib
lib/ccp4-5.99.5/libclipper-cif.dylib
lib/ccp4-5.99.5/libclipper-contrib.0.0.0.dylib
lib/ccp4-5.99.5/libclipper-contrib.0.dylib
lib/ccp4-5.99.5/libclipper-contrib.dylib
lib/ccp4-5.99.5/libclipper-core.0.0.0.dylib
lib/ccp4-5.99.5/libclipper-core.0.dylib
lib/ccp4-5.99.5/libclipper-core.dylib
lib/ccp4-5.99.5/libclipper-minimol.0.0.0.dylib
lib/ccp4-5.99.5/libclipper-minimol.0.dylib
lib/ccp4-5.99.5/libclipper-minimol.dylib
lib/ccp4-5.99.5/libclipper-mmdb.0.0.0.dylib
lib/ccp4-5.99.5/libclipper-mmdb.0.dylib
lib/ccp4-5.99.5/libclipper-mmdb.dylib
lib/ccp4-5.99.5/libclipper-phs.0.0.0.dylib
lib/ccp4-5.99.5/libclipper-phs.0.dylib
lib/ccp4-5.99.5/libclipper-phs.dylib
lib/ccp4-5.99.5/libjwc_c.0.1.1.dylib
lib/ccp4-5.99.5/libjwc_c.0.dylib
lib/ccp4-5.99.5/libjwc_c.dylib
lib/ccp4-5.99.5/libssm.0.0.0.dylib
lib/ccp4-5.99.5/libssm.0.dylib
lib/ccp4-5.99.5/libssm.dylib
lib/ccp4-5.99.5/libxdl_view.2.0.0.dylib
lib/ccp4-5.99.5/libxdl_view.2.dylib
lib/ccp4-5.99.5/libxdl_view.dylib
lib/ccp4-5.99.5/libxdl_viewextra.0.0.0.dylib
lib/ccp4-5.99.5/libxdl_viewextra.0.dylib
lib/ccp4-5.99.5/libxdl_viewextra.dylib
<<
#lib/ccp4-5.99.5/libmmdb.dylib
Shlibs: <<
   %p/lib/ccp4-5.99.5/libccif.dylib 0.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libccp4c.dylib 0.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-ccp4.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-ccp4.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-ccp4.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-cif.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-cif.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-cif.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-contrib.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-contrib.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-contrib.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-core.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-core.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-core.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-minimol.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-minimol.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-minimol.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-mmdb.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-mmdb.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-mmdb.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-phs.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-phs.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libclipper-phs.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libjwc_c.0.dylib 2.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libjwc_c.0.1.1.dylib 2.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libjwc_c.dylib 2.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libxdl_view.2.dylib 3.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libxdl_view.2.0.0.dylib 2.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libxdl_view.dylib 2.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libxdl_viewextra.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libxdl_viewextra.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libxdl_viewextra.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libssm.0.0.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libssm.0.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
   %p/lib/ccp4-5.99.5/libssm.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
  << 
  DocFiles: CHANGES COPYING INSTALL INSTALL.html INSTALL.ps README PROBLEMS academic_software_licence.pdf
<<  
#   %p/lib/ccp4-5.99.5/libmmdb.dylib 1.0.0 ccp4lib-shlibs (>= 5.99.5-1002)
#
SplitOff2: <<
Package: %N-dev
Conflicts: clipper-dev
Replaces: clipper-dev
Files:   bin/clipper-config
BuildDependsOnly: True
DocFiles:  CHANGES COPYING INSTALL INSTALL.html INSTALL.ps README PROBLEMS academic_software_licence.pdf
<<
Description:  Macromolecular crystallography package
DescDetail: <<
CCP4 macromolecular crystallography suite of approximately
200 programs and utilities. This version included Clipper
libraries, cctbx and ccif and phaser.

Type "ccp4help" for a summary listing of all ccp4 programs.
Type "ccp4help foo" for a detailed description of program "foo."

Invoke optional ccp4i gui for the first run using: sudo ccp4i
Thereafter, invoke without sudo.

This version compiles with the Apple Lapack/Blas framework
License agreement is part of configure file -- print out form and mail in,
additional comments at http://chemistry.ucsc.edu/~wgscott/xtal/ccp4.html
CCP4 files will be installed under /sw/share/xtal/ccp4-5.99.5
This revision includes all available CCP4 patches as of  December 1, 2005. 
and new bash and zsh command completions specific to ccp4.
<<
DocFiles: README CHANGES COPYING PROBLEMS INSTALL INSTALL.html INSTALL.ps ccp4i_installation.html academic_software_licence.pdf  academic_software_licence.ps.gz  academic_software_licence.rtf
Homepage: http://www.ccp4.ac.uk  
License: Commercial
Maintainer: W. G. Scott <wgscott@users.sourceforge.net>
