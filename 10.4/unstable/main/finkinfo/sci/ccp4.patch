diff -ruN ccp4-6.0.2-orig/ccp4i/etc/configure.def.dist ccp4-6.0.2/ccp4i/etc/configure.def.dist
--- ccp4-6.0.2-orig/ccp4i/etc/configure.def.dist	2006-11-21 12:32:49.000000000 -0800
+++ ccp4-6.0.2/ccp4i/etc/configure.def.dist	2006-11-21 13:07:41.000000000 -0800
@@ -55,8 +55,8 @@
 MESSAGE                   _text				""
 BLT_LIBRARY               _text                     ""
 MENU_LENGTH               _positiveint              25
-HYPERTEXT_VIEWER          _text                     netscape
-START_NETSCAPE	          _text			    netscape
+HYPERTEXT_VIEWER          _text                     open
+START_NETSCAPE	          _text			    open
 O_MAPMAN                  _text                     mapman
 MAPMAN_MAXSIZE		  _positiveint		    4194304
 QUANTA_MBKALL             _text                     mbkall
diff -ruN ccp4-6.0.2-orig/ccp4i/etc/osx_ccp4_mail ccp4-6.0.2/ccp4i/etc/osx_ccp4_mail
--- ccp4-6.0.2-orig/ccp4i/etc/osx_ccp4_mail	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0.2/ccp4i/etc/osx_ccp4_mail	2006-11-21 13:08:18.000000000 -0800
@@ -0,0 +1,164 @@
+#!/usr/bin/perl
+# Drop-in replacement for /usr/bin/mail that uses Mail.app (via an
+# applescript) rather than sendmail to send mail.  Unlike /usr/bin/mail,
+# you can't use it for reading mail.
+#
+# usage: mail [<options>] <recipients>
+#     options:
+#         -v           be verbose
+#         -g           activate Mail.app to approve the message
+#         -F <from>    specify the From: address
+#         -b <bcc>     specify Bcc: recipients in a comma-separated list
+#         -c <cc>      specify Cc: recipients in a comma-separated list
+#         -s <subject> specify the message subject
+#
+# The body of the message is read from standard input.
+#
+# Author: Nathaniel Nystrom <nystrom@cs.cornell.edu>
+# This software is in the public domain.
+#
+# Version 1.0,   21 Aug 2003 -- initial version
+# Version 1.0.1, 22 Aug 2003 -- fixes some quoting problems
+# Version 1.0.2, 23 Aug 2003 -- removed -R <reply-to> option; |reply to|
+#                               is a property of _incoming_ messages
+# Version 1.0.3, 17 Sep 2003 -- fixed escaping of \ in message body;
+#                               escape the subject too
+
+use strict;
+$|++;
+
+my ($verbose, $gui);
+my ($from, @to, @cc, @bcc, $subject, $body);
+my $prog;
+($prog = $0) =~ s|.*/||;
+
+while (@ARGV) {
+    my $arg = shift @ARGV;
+
+    if ($arg eq '-v') {
+        $verbose++;
+    }
+    elsif ($arg eq '-g') {
+        $gui++;
+    }
+    elsif ($arg eq '-F') {
+        $from = shift @ARGV || &usage("missing sender");
+    }
+    elsif ($arg eq '-i' || $arg eq '-l' || $arg eq '-n') {
+        # ignore; for /usr/bin/mail compatibility
+    }
+    elsif ($arg eq '-N' || $arg eq '-f' || $arg eq '-u') {
+        &usage("invalid option $arg; $prog cannot be used for reading mail");
+    }
+    elsif ($arg eq '-s') {
+        $subject = shift @ARGV || &usage("missing subject");
+    }
+    elsif ($arg eq '-c') {
+        my $list = shift @ARGV || &usage("missing Cc list");
+        @cc = split /\s*,\s*/, $list;
+    }
+    elsif ($arg eq '-b') {
+        my $list = shift @ARGV || &usage("missing Bcc list");
+        @bcc = split /\s*,\s*/, $list;
+    }
+    elsif ($arg =~ /^-/) {
+        &usage("invalid option $arg");
+    }
+    else {
+        @to = ($arg, @ARGV);
+        last;
+    }
+}
+
+&usage("missing recipients") unless @to;
+
+unless (defined $subject) {
+    print "Subject: ";
+    $subject = <STDIN> || '';
+    chomp $subject;
+}
+
+$body = '';
+
+while (<STDIN>) {
+    $body .= $_;
+}
+
+$body = &escape($body);
+$subject = &escape($subject);
+
+my $script = <<"EOS";
+tell application "Mail"
+    set newMessage to make new outgoing message
+    tell newMessage
+        set subject to "$subject"
+        set content to "$body"
+EOS
+
+for (@to)  { $script .= &recipient('to', $_); }
+for (@cc)  { $script .= &recipient('cc', $_); }
+for (@bcc) { $script .= &recipient('bcc', $_); }
+
+my $visible = $gui ? "true" : "false";
+my $activate = $gui ? "activate" : "send newMessage";
+my $fromln = $from ? "set sender to \"$from\"" : "";
+
+$script .= <<"EOS";
+        $fromln
+        set visible to $visible
+    end tell
+    $activate
+end tell
+EOS
+
+if ($verbose >= 1) {
+    print "From: $from\n" if $from;
+    print "To: ", join(',', @to), "\n" if @to;
+    print "Cc: ", join(',', @cc), "\n" if @cc;
+    print "Bcc: ", join(',', @bcc), "\n" if @bcc;
+
+    if ($verbose >= 2) {
+        print "Script >>>\n";
+        print $script;
+        print "<<<\n";
+        print "\n";
+        print $body;
+    }
+}
+
+open(SCRIPT, "| osascript > /dev/null") || die "Couldn't fork osascript: $!\n";
+print SCRIPT $script;
+close SCRIPT;
+
+exit 0;
+
+sub escape {
+    my $x = shift;
+    $x =~ s/\\/\\\\/gm;
+    $x =~ s/"/\\"/gm;
+    $x =~ s/\n/\\n/gm;
+    $x;
+}
+
+sub recipient {
+    my ($type,$addr) = @_;
+    return <<"EOS"
+        make new $type recipient at end of $type recipients with properties {address: "$addr"}
+EOS
+}
+
+sub usage {
+    my $error = shift;
+    print STDERR "Error: $error\n" if $error;
+    print STDERR <<"EOS";
+usage: $prog [<options>] <recipients>
+    options:
+        -v           be verbose
+        -g           activate Mail.app to approve the message
+        -F <from>    specify the From: address
+        -b <bcc>     specify Bcc: recipients in a comma-separated list
+        -c <cc>      specify Cc: recipients in a comma-separated list
+        -s <subject> specify the message subject
+EOS
+    exit 1;
+}
diff -ruN ccp4-6.0.2-orig/ccp4i/src/local.tcl ccp4-6.0.2/ccp4i/src/local.tcl
--- ccp4-6.0.2-orig/ccp4i/src/local.tcl	2006-11-21 12:32:56.000000000 -0800
+++ ccp4-6.0.2/ccp4i/src/local.tcl	2006-11-21 13:10:06.000000000 -0800
@@ -34,7 +34,7 @@
 #d_arg mail_address Mail addressee
 
 return [expr {1 - [catch \
-   "exec Mail -s \"$subject\" $mail_address < $tmp_file"  ]}]
+   "exec osx_ccp4_mail -s \"$subject\" $mail_address < $tmp_file"  ]}]
 }
 
 #d_index_title Interaction with Netscape
diff -ruN ccp4-6.0.2-orig/configure ccp4-6.0.2/configure
--- ccp4-6.0.2-orig/configure	2006-11-21 12:35:50.000000000 -0800
+++ ccp4-6.0.2/configure	2006-11-21 13:27:28.000000000 -0800
@@ -2301,17 +2301,17 @@
 fi # CXX_LIBS
 
 #defaults
-  FOPTIM=${FOPTIM:-"-O2"}
-  COPTIM=${COPTIM:-"-O2"}
-  CXXOPTIM=${CXXOPTIM:-"-O2"}
+  FOPTIM=${FOPTIM:-"-O3"}
+  COPTIM=${COPTIM:-"-O3 -ffast-math"}
+  CXXOPTIM=${CXXOPTIM:-"-O3 -ffast-math"}
   INSTALL_DATA=${INSTALL_DATA:-"cp"}
   INSTALL_PROGRAM=${INSTALL_PROGRAM:-"cp"}
   SETFLAGS=${SETFLAGS:-"sftools_FLAGS='$XFFLAGS $FOPTIM' \
-                      refmac5_FLAGS='$XFFLAGS -O1' \
+                      refmac5_FLAGS='$XFFLAGS -O3' \
                       arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' \
-                      mplot_FLAGS='$XFFLAGS -O1' \
-                      molrep_FLAGS='$XFFLAGS -O1' \
-                      xdlmapman_FLAGS='$XFFLAGS -O1'"}
+                      mplot_FLAGS='$XFFLAGS -O3' \
+                      molrep_FLAGS='$XFFLAGS -O3' \
+                      xdlmapman_FLAGS='$XFFLAGS -O3'"}
   XDL_LIB=${XDL_LIB:-"-L${CCP4_LIB} -lxdl_view"}
   XWIN_LIB=${XWIN_LIB:-"-L/usr/X11R6/lib -lXt -lSM -lX11 -lICE"}
   XTYPE=${XTYPE:-"LINUX"}
@@ -2323,8 +2323,8 @@
   XMKMF="IMAKECPP=/usr/bin/cpp xmkmf"
   if test "$shared_lib" = yes; then
     SHARED_LIB_CFLAGS=${SHARED_LIB_CFLAGS:-'-fPIC -fno-common'}
-    SHARE_LIB='${CC} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name libmmdb.dylib -all_load libmmdb.a -o libmmdb.dylib -lstdc++; ${CC} -dynamiclib -flat_namespace -undefined suppress ${SHARED_LIB_CFLAGS} -install_name libccp4c.dylib -all_load libccp4c.a  -o libccp4c.dylib'
-    SHARE_INST='${INSTALL_DATA} `pwd`/libmmdb.dylib ${libdir}/libmmdb.dylib; ${INSTALL_DATA} `pwd`/libccp4c.dylib ${libdir}/libccp4c.dylib'
+    SHARE_LIB='${CC} -dynamiclib -single_module -undefined dynamic_lookup ${SHARED_LIB_CFLAGS} -install_name ${RPATH}/libmmdb.dylib -all_load libmmdb.a -o libmmdb.dylib -lstdc++; ${CC} -dynamiclib -single_module -undefined dynamic_lookup ${SHARED_LIB_CFLAGS} -install_name ${RPATH}/libccp4c.dylib -all_load libccp4c.a  -o libccp4c.dylib'
+	SHARE_INST='${INSTALL_DATA} `pwd`/libmmdb.dylib ${libdir}/libmmdb.dylib; ${INSTALL_DATA} `pwd`/libccp4c.dylib ${libdir}/libccp4c.dylib'
   fi     
 #need -lcc_dynamic to get restFP and saveFP for g77 3.4 under darwin 7
   case `$FC --version` in
diff -ruN ccp4-6.0.2-orig/etc/xloggraph ccp4-6.0.2/etc/xloggraph
--- ccp4-6.0.2-orig/etc/xloggraph	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0.2/etc/xloggraph	2006-11-21 13:30:53.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xloggraph.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-6.0.2-orig/etc/xplot84 ccp4-6.0.2/etc/xplot84
--- ccp4-6.0.2-orig/etc/xplot84	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0.2/etc/xplot84	2006-11-21 13:31:20.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xplot84driver.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-6.0.2-orig/etc/xplot84driver ccp4-6.0.2/etc/xplot84driver
--- ccp4-6.0.2-orig/etc/xplot84driver	1969-12-31 16:00:00.000000000 -0800
+++ ccp4-6.0.2/etc/xplot84driver	2006-11-21 13:31:20.000000000 -0800
@@ -0,0 +1,6 @@
+#!/bin/zsh
+export XUSERFILESEARCHPATH=$CLIB/X11/app-defaults/XCCPJiffy
+xplot84driver.exe "$@" &
+export XUSERFILESEARCHPATH=""
+print "Plot button sends pdf to Preview.  Print or save pdf in Preview window."
+exit 0
diff -ruN ccp4-6.0.2-orig/include/ccp4.setup-bash ccp4-6.0.2/include/ccp4.setup-bash
--- ccp4-6.0.2-orig/include/ccp4.setup-bash	2006-11-21 12:35:39.000000000 -0800
+++ ccp4-6.0.2/include/ccp4.setup-bash	2006-11-21 13:35:28.000000000 -0800
@@ -196,27 +196,27 @@
 
 # LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
 # at runtime
-if test "$LD_LIBRARY_PATH"; then
-  if [ $ccp4_first_in_path -eq 1 ]; then
-    setenv LD_LIBRARY_PATH ${CLIB}:${LD_LIBRARY_PATH}
-  else
-    setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:${CLIB}
-  fi
-else
-  setenv LD_LIBRARY_PATH ${CLIB}
-fi
-
-# DYLD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.dylib)
-# at runtime (used on Mac OS X)
-if test "$DYLD_LIBRARY_PATH"; then
-  if [ $ccp4_first_in_path -eq 1 ]; then
-    setenv DYLD_LIBRARY_PATH ${CLIB}:${DYLD_LIBRARY_PATH}
-  else
-    setenv DYLD_LIBRARY_PATH ${DYLD_LIBRARY_PATH}:${CLIB}
-  fi
-else
-  setenv DYLD_LIBRARY_PATH ${CLIB}
-fi
+#if test "$LD_LIBRARY_PATH"; then
+#  if [ $ccp4_first_in_path -eq 1 ]; then
+#    setenv LD_LIBRARY_PATH ${CLIB}:${LD_LIBRARY_PATH}
+#  else
+#    setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:${CLIB}
+#  fi
+#else
+#  setenv LD_LIBRARY_PATH ${CLIB}
+#fi
+#
+## DYLD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.dylib)
+## at runtime (used on Mac OS X)
+#if test "$DYLD_LIBRARY_PATH"; then
+#  if [ $ccp4_first_in_path -eq 1 ]; then
+#    setenv DYLD_LIBRARY_PATH ${CLIB}:${DYLD_LIBRARY_PATH}
+#  else
+#    setenv DYLD_LIBRARY_PATH ${DYLD_LIBRARY_PATH}:${CLIB}
+#  fi
+#else
+#  setenv DYLD_LIBRARY_PATH ${CLIB}
+#fi
 
 ### XAPPLRESDIR ###
 
@@ -234,11 +234,11 @@
 # not be set at the time this file is read.  Thus edit this part as
 # appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
 # instead of /usr; others may want /usr/local/lib or somw such):
-if test "$XUSERFILESEARCHPATH"; then
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
-else
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
-fi
+#if test "$XUSERFILESEARCHPATH"; then
+#  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
+#else
+#  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
+#fi
 
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
@@ -361,13 +361,3 @@
   unset alias  # clean up
 fi             # ksh test
 
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
-
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
diff -ruN ccp4-6.0.2-orig/include/ccp4.setup-dist ccp4-6.0.2/include/ccp4.setup-dist
--- ccp4-6.0.2-orig/include/ccp4.setup-dist	2006-11-21 12:35:39.000000000 -0800
+++ ccp4-6.0.2/include/ccp4.setup-dist	2006-11-21 13:38:50.000000000 -0800
@@ -107,7 +107,7 @@
     setenv CBIN      $CCP4/bin		
     setenv CLIB      $CCP4/lib	
 
-    setenv CCP4_BROWSER  netscape             
+    setenv CCP4_BROWSER  open             
 
     if (${?MANPATH}) then
       if ($ccp4_first_in_path) then
@@ -183,28 +183,28 @@
 
 # LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
 # at runtime
-if (${?LD_LIBRARY_PATH}) then
-  if ($ccp4_first_in_path) then
-    setenv LD_LIBRARY_PATH ${CLIB}:${LD_LIBRARY_PATH}:${CCP4}/extralib
-  else
-    setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:${CLIB}:${CCP4}/extralib
-  endif
-else
-  setenv LD_LIBRARY_PATH ${CLIB}:${CCP4}/extralib
-endif
-
-# DYLD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.dylib)
-# at runtime (used on Mac OS X)
-if (${?DYLD_LIBRARY_PATH}) then
-  if ($ccp4_first_in_path) then
-    setenv DYLD_LIBRARY_PATH ${CLIB}:${CCP4}/extralib:${DYLD_LIBRARY_PATH}
-  else
-    setenv DYLD_LIBRARY_PATH ${DYLD_LIBRARY_PATH}:${CLIB}:${CCP4}/extralib
-  endif
-else
-  setenv DYLD_LIBRARY_PATH ${CLIB}:${CCP4}/extralib
-endif
-
+# if (${?LD_LIBRARY_PATH}) then
+#   if ($ccp4_first_in_path) then
+#     setenv LD_LIBRARY_PATH ${CLIB}:${LD_LIBRARY_PATH}:${CCP4}/extralib
+#   else
+#     setenv LD_LIBRARY_PATH ${LD_LIBRARY_PATH}:${CLIB}:${CCP4}/extralib
+#   endif
+# else
+#   setenv LD_LIBRARY_PATH ${CLIB}:${CCP4}/extralib
+# endif
+# 
+# # DYLD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.dylib)
+# # at runtime (used on Mac OS X)
+# if (${?DYLD_LIBRARY_PATH}) then
+#   if ($ccp4_first_in_path) then
+#     setenv DYLD_LIBRARY_PATH ${CLIB}:${CCP4}/extralib:${DYLD_LIBRARY_PATH}
+#   else
+#     setenv DYLD_LIBRARY_PATH ${DYLD_LIBRARY_PATH}:${CLIB}:${CCP4}/extralib
+#   endif
+# else
+#   setenv DYLD_LIBRARY_PATH ${CLIB}:${CCP4}/extralib
+# endif
+# 
 ### XAPPLRESDIR ###
 
 # If you want to use xloggraph/xplot84driver, you need to get the application
@@ -221,11 +221,11 @@
 # not be set at the time this file is read.  Thus edit this part as
 # appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
 # instead of /usr; others may want /usr/local/lib or somw such):
-if ($?XUSERFILESEARCHPATH) then
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
-else
-  setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
-endif
+# if ($?XUSERFILESEARCHPATH) then
+#   setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
+# else
+#   setenv XUSERFILESEARCHPATH $CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
+# endif
 
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
@@ -349,13 +349,13 @@
   alias lbin   'pushd $CBIN>/dev/null'
 #
 
-# Set-up cctbx environment
-if (-e $CCP4/lib/cctbx/cctbx_build/setpaths.csh) source $CCP4/lib/cctbx/cctbx_build/setpaths.csh
-
-# Set-up phaser environment
-if (-d $CCP4/src/phaser) then
-  set phaser_mtype = `$CCP4/src/phaser/bin/machine_type`
-  set phaser_version = `grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  set phaser_setup_file = "${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.csh"
-  if (-e $phaser_setup_file) source $phaser_setup_file
-endif
+# # Set-up cctbx environment
+# if (-e $CCP4/lib/cctbx/cctbx_build/setpaths.csh) source $CCP4/lib/cctbx/cctbx_build/setpaths.csh
+# 
+# # Set-up phaser environment
+# if (-d $CCP4/src/phaser) then
+#   set phaser_mtype = `$CCP4/src/phaser/bin/machine_type`
+#   set phaser_version = `grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
+#   set phaser_setup_file = "${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.csh"
+#   if (-e $phaser_setup_file) source $phaser_setup_file
+# endif
diff -ruN ccp4-6.0.2-orig/include/ccp4.setup-sh ccp4-6.0.2/include/ccp4.setup-sh
--- ccp4-6.0.2-orig/include/ccp4.setup-sh	2006-11-21 12:35:39.000000000 -0800
+++ ccp4-6.0.2/include/ccp4.setup-sh	2006-11-21 14:25:30.000000000 -0800
@@ -99,7 +99,8 @@
     export CBIN=$CCP4/bin		
     export CLIB=$CCP4/lib	
 
-    export CCP4_BROWSER=mozilla             
+    # export CCP4_BROWSER=mozilla    
+    CCP4_BROWSER="" ; export CCP4_BROWSER=open 
     export MANPATH=$CCP4/man:$MANPATH           # edit this if necessary
     export MCTYPE=unix 			# (only for Laue)
 #     ;;
@@ -118,8 +119,8 @@
 export CLASSPATH=$CBIN:$CLASSPATH                      # edit this if necessary
 
 ### PLOT_COMMAND PRINT_COMMAND for the XCCPJIFFY programs to compile ###
-export PLOT_COMMAND='lp -s'  
-export PRINT_COMMAND='lp -s'    
+export PLOT_COMMAND='lpr'  
+export PRINT_COMMAND='lpr'    
 
 # HARVESTHOME specifies location of harvesting files (defaults to $HOME)
 export HARVESTHOME=$HOME     
@@ -131,58 +132,7 @@
 
 export CCP4_OPEN=UNKNOWN	
 
-### BINSORT_MEM ###
-# BINSORT_MEM is workspace used by the binsort program.  In principle this
-# value is machine-dependent.  It may benefit from being enlarged, but values
-# higher than 2M have been reported to cause excessive paging on some systems.
-# You might like to experiment with a program such as fft with different
-# values -- 102400 (bytes) is the default.  csh's `time' command can tell you
-# about paging.
-#
-#  export BINSORT_MEM=8388608
-
-# LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-# at runtime
-if test "LD_LIBRARY_PATH"; then
-  if test $ccp4_first_in_path -eq 1; then
-    export LD_LIBRARY_PATH=$CLIB:$LD_LIBRARY_PATH:$CCP4/extralib
-  else
-    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CLIB:$CCP4/extralib
-  fi
-else
-  export LD_LIBRARY_PATH=$CLIB:$CCP4/extralib
-fi
-
-# DYLD_LIBRARY_PATH specifies where to find dynamic libraries
-# (e.g. libccp4.dylib) at runtime
-if test "DYLD_LIBRARY_PATH"; then
-  if test $ccp4_first_in_path -eq 1; then
-    export DYLD_LIBRARY_PATH=$CLIB:$CCP4/extralib:$DYLD_LIBRARY_PATH
-  else
-    export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:$CLIB:$CCP4/extralib
-  fi
-else
-  export DYLD_LIBRARY_PATH=$CLIB:$CCP4/extralib
-fi
-
-### XAPPLRESDIR ###
-
-# If you want to use xloggraph/xplot84driver, you need to get the application
-# defaults picked up somehow.  As distributed, the file can't just live in an
-# application defaults directory since it requires reading by xrdb to sort out
-# the differences for monochrome displays.  At Daresbury a version of the file
-# assuming a monochrome display is kept in the directory
-# $CCP4_LIB/X11/app-defaults and this is picked up through the
-# XUSERFILESEARCHPATH environment variable.  That means you only see black and
-# white on a colour display.  Alternatively you might make sure that it is
-# read by xrdb on startup of the X Windows system or delegate the
-# responsibility to users to run it.  There are disadvantages to putting an
-# invocation of xrdb in here, one being that the correct value of DISPLAY may
-# not be set at the time this file is read.  Thus edit this part as
-# appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-# instead of /usr; others may want /usr/local/lib or somw such):
-
-export XAPPLRESDIR=/sw/etc/app-defaults/
+ 
 
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
@@ -237,20 +187,20 @@
 # binaries of the same name.  Put ccp4 stuff after the current path to avoid
 # confusion with `.' or whatever in the path:
 #
-# This construct prevents the path getting longer each time ccp4.setup is
-# executed (A. Perrakis)
-ccp4pathlist="${CCP4}/etc ${CBIN} ${CCP4I_TOP}/bin "
-#
-for dir in ${ccp4pathlist}
-do
-  if [ `expr ":${PATH}:" : ".*:${dir}:"` -eq 0 ]; then
-    if test $ccp4_first_in_path -eq 1; then
-      PATH=${dir}:${PATH}
-    else
-      PATH=${PATH}:${dir}
-    fi
-  fi
-done
+# # This construct prevents the path getting longer each time ccp4.setup is
+# # executed (A. Perrakis)
+ PATH=${PATH}:${CCP4}/etc:${CBIN}:${CCP4I_TOP}/bin  ; export PATH
+# #
+# for dir in ${ccp4pathlist}
+# do
+#   if [ `expr ":${PATH}:" : ".*:${dir}:"` -eq 0 ]; then
+#     if test $ccp4_first_in_path -eq 1; then
+#       PATH=${dir}:${PATH}
+#     else
+#       PATH=${PATH}:${dir}
+#     fi
+#   fi
+# done
 
 # Optional (useful) additional environment variables
   export CCP4=$CCP4
@@ -302,13 +252,13 @@
   alias lgnoms='pushd $CCP4_MASTER/laue/gnom/src>/dev/null'
   alias lbin='pushd $CBIN>/dev/null'
 
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
-
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
+# # Set-up cctbx environment
+# test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
+# 
+# # Set-up phaser environment
+# if ( test -d $CCP4/src/phaser) ; then
+#   phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
+#   phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
+#   phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
+#   test -r $phaser_setup_file && . $phaser_setup_file
+# fi
diff -ruN ccp4-6.0.2-orig/include/ccp4.setup-zsh ccp4-6.0.2/include/ccp4.setup-zsh
--- ccp4-6.0.2-orig/include/ccp4.setup-zsh	2006-11-21 12:35:39.000000000 -0800
+++ ccp4-6.0.2/include/ccp4.setup-zsh	2006-11-21 14:33:38.000000000 -0800
@@ -70,7 +70,7 @@
 #               but note the SGI distributed version of Tcl/Tk is not 
 #               appropriate version
 
-export CCP4I_TCLTK=/prefix/bin
+export CCP4I_TCLTK=@PREFIX@/bin
     
 # CCP4I_HELP - directory contain ccp4i help - default is $CCP4I_TOP/help
 export CCP4I_HELP=$CCP4I_TOP/help
@@ -122,13 +122,14 @@
 
     
     if [[ $(uname) = Darwin ]]; then
-        export CCP4_BROWSER=open            # open in OS X default browser
+        CCP4_BROWSER="" ; export CCP4_BROWSER=open            # open in OS X default browser
     elif [[ $(uname) = Linux ]];then
-        export  CCP4_BROWSER=konqueror 
-        # export CCP4_BROWSER=mozilla       # specify favorite browser
-        # export CCP4_BROWSER=netscape
+        CCP4_BROWSER="" ; export CCP4_BROWSER=firefox
+		# CCP4_BROWSER="" ; export  CCP4_BROWSER=konqueror 
+        # CCP4_BROWSER="" ; export CCP4_BROWSER=mozilla       # specify favorite browser
+        # CCP4_BROWSER="" ; export CCP4_BROWSER=netscape
     else
-        export CCP4_BROWSER=netscape
+        CCP4_BROWSER="" ; export CCP4_BROWSER=netscape
     fi 
     
     MANPATH=$CCP4/man:$MANPATH           # edit this if necessary
@@ -175,67 +176,6 @@
 #  export BINSORT_MEM=8388608
 
 
-# If installed via fink, skip this bit:
-
-if [[ -z $SWPREFIX ]];then
-  if [[ -d /sw/bin/fink-virtual-pkgs ]];then
-    SWPREFIX=$(dirname $(dirname $(which /sw/bin/fink-virtual-pkgs)))
-  fi
-fi
-
-if [[ -z $SWPREFIX || $CCP4_MASTER != $SWPREFIX/share/xtal ]];then 
-    
-    # LD_LIBRARY_PATH specifies where to find dynamic libraries (e.g. libccp4.so)
-    # at runtime
-    
-    if test "$LD_LIBRARY_PATH"; then
-      if [[ $ccp4_first_in_path == 1 ]]; then
-        export LD_LIBRARY_PATH=$CLIB:$LD_LIBRARY_PATH
-      else
-        export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CLIB
-      fi
-    else
-      export LD_LIBRARY_PATH=$CLIB
-    fi
-    # DYLD_LIBRARY_PATH specifies where to find dynamic libraries
-    # (e.g. libccp4.dylib) at runtime
-    if test "$DYLD_LIBRARY_PATH"; then
-      if [[ $ccp4_first_in_path == 1 ]]; then
-        export DYLD_LIBRARY_PATH=$CLIB:$DYLD_LIBRARY_PATH
-      else
-        export DYLD_LIBRARY_PATH=$DYLD_LIBRARY_PATH:$CLIB
-      fi
-    else
-      export DYLD_LIBRARY_PATH=$CLIB
-    fi
-    
-    ### XAPPLRESDIR ###
-    
-    # If you want to use xloggraph/xplot84driver, you need to get the application
-    # defaults picked up somehow.  As distributed, the file can't just live in an
-    # application defaults directory since it requires reading by xrdb to sort out
-    # the differences for monochrome displays.  At Daresbury a version of the file
-    # assuming a monochrome display is kept in the directory
-    # $CCP4_LIB/X11/app-defaults and this is picked up through the
-    # XUSERFILESEARCHPATH environment variable.  That means you only see black and
-    # white on a colour display.  Alternatively you might make sure that it is
-    # read by xrdb on startup of the X Windows system or delegate the
-    # responsibility to users to run it.  There are disadvantages to putting an
-    # invocation of xrdb in here, one being that the correct value of DISPLAY may
-    # not be set at the time this file is read.  Thus edit this part as
-    # appropriate.  (SunOS will normally want to use /usr/openwin or $OPENWINHOME
-    # instead of /usr; others may want /usr/local/lib or somw such):
-
-    if [[ -n "$XUSERFILESEARCHPATH" ]]; then
-        XUSERFILESEARCHPATH=$CCP4_LIB/X11/app-defaults/%N:$XUSERFILESEARCHPATH
-    else
-        XUSERFILESEARCHPATH=$CCP4_LIB/X11/app-defaults/%N:/usr/lib/X11/app-defaults
-    fi
-
-    export XUSERFILESEARCHPATH
-    
-fi
-
 ### TRAPPFE ###
 # TRAPFPE is set to ensure (in collaboration with -lfpe) an abort on floating
 # point exceptions under IRIX.  It shouldn't cause harm on other systems, but
@@ -383,16 +323,16 @@
     typeset -U manpath
     typeset -U classpath
      
-# Set-up cctbx environment
-test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
- 
-# Set-up phaser environment
-if ( test -d $CCP4/src/phaser) ; then
-  phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
-  phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
-  phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
-  test -r $phaser_setup_file && . $phaser_setup_file
-fi
+#  # Set-up cctbx environment
+#  test -r $CCP4/lib/cctbx/cctbx_build/setpaths.sh && . $CCP4/lib/cctbx/cctbx_build/setpaths.sh
+#   
+#  # Set-up phaser environment
+#  if ( test -d $CCP4/src/phaser) ; then
+#    phaser_mtype=`$CCP4/src/phaser/bin/machine_type`
+#    phaser_version=`grep PHASER_VERSION $CCP4/src/phaser/conf/version | awk '{print $3}'`
+#    phaser_setup_file="${CCP4}/src/phaser/phaser-${phaser_version}/build/${phaser_mtype}/setpaths.sh"
+#    test -r $phaser_setup_file && . $phaser_setup_file
+#  fi
 
 
 
diff -ruN ccp4-6.0.2-orig/lib/ccif/configure ccp4-6.0.2/lib/ccif/configure
--- ccp4-6.0.2-orig/lib/ccif/configure	2006-11-21 12:35:37.000000000 -0800
+++ ccp4-6.0.2/lib/ccif/configure	2006-11-21 13:05:57.000000000 -0800
@@ -1873,8 +1873,8 @@
          else
            SHARED_LIB_PATH='DYLD_LIBRARY_PATH=`pwd`'
          fi
-         SHARED_LIB_CMD=' $(LD) -dylib -dynamic -flat_namespace \\\
-                          -undefined suppress -dylib_install_name $(SHARED_LIB_NAME) \\\
+         SHARED_LIB_CMD=' $(LD) -dylib -dynamic -single_module \\\
+                          -undefined dynamic_lookup -dylib_install_name ${RPATH}/$(SHARED_LIB_NAME) \\\
                           -all_load $L \\\
                           -o $(SHARED_LIB_NAME) -ldylib1.o'
          SHARED_LIB_EXPORTS_CMD=''
@@ -1890,8 +1890,8 @@
          else
            SHARED_LIB_PATH='DYLD_LIBRARY_PATH=`pwd`'
          fi
-         SHARED_LIB_CMD=' $(LD) -dylib -dynamic -flat_namespace \\\
-                          -undefined suppress -dylib_install_name $(SHARED_LIB_NAME) \\\
+         SHARED_LIB_CMD=' $(LD) -dylib -dynamic -single_module \\\
+                          -undefined dynamic_lookup -dylib_install_name ${RPATH}/$(SHARED_LIB_NAME) \\\
                           -all_load $L \\\
                           -o $(SHARED_LIB_NAME) -ldylib1.o'
          SHARED_LIB_EXPORTS_CMD=''
@@ -1907,9 +1907,9 @@
          else
            SHARED_LIB_PATH='DYLD_LIBRARY_PATH=`pwd`'
          fi
-         SHARED_LIB_CMD='$(CC) $(SHARED_LIB_CFLAGS) -dynamiclib -flat_namespace \\\
-                               -undefined suppress -install_name \\\
-                                $(SHARED_LIB_NAME) \\\
+         SHARED_LIB_CMD='$(CC) $(SHARED_LIB_CFLAGS) -dynamiclib -single_module \\\
+                               -undefined dynamic_lookup -install_name \\\
+                                ${RPATH}/$(SHARED_LIB_NAME) \\\
                                -all_load $L \\\
                                -o $(SHARED_LIB_NAME)'
          SHARED_LIB_EXPORTS_CMD=''
diff -ruN ccp4-6.0.2-orig/lib/cctbx/ccp4_build ccp4-6.0.2/lib/cctbx/ccp4_build
--- ccp4-6.0.2-orig/lib/cctbx/ccp4_build	2006-11-21 12:35:30.000000000 -0800
+++ ccp4-6.0.2/lib/cctbx/ccp4_build	2006-11-21 13:54:47.000000000 -0800
@@ -1,53 +1,5 @@
-#! /bin/sh
+#! /bin/sh  -ef 
 
-usage='echo "Usage: ccp4_build [--help] [--libdir=DIR]" '
-
-if ( eval test -d cctbx_build || eval mkdir cctbx_build ) ; then :
-else
-  eval echo "! No directory cctbx_build and can\'t create it."
-  exit 1
-fi
-
-cctbxopts="--command_version_suffix=ccp4-6.0 --build=release"
-for arg
-do
-
-    case $arg in
-
-    -help | --help | -h | help)
-      eval $usage; exit 0;;
-
-    -libdir=* | --libdir=* | --libdi=* | --libd=* | --lib=* | --li=* | --l=*)
-      libdir=`echo $arg | sed 's/[-a-z_]*=//'` ; break;;
-
-    # all other arguments passed to cctbx build
-    *)
-      cctbxopts="$cctbxopts $arg" ;;
-
-    esac
-
-done
-
-if ( eval test -z \"\$CCP4\" ) ; then
-  echo "! Please set CCP4 environment, e.g. source ccp4.setup "
-  exit 1
-else true; fi
-
-libdir=${libdir:-$CCP4_LIB}
-
-echo "Changing directory to cctbx_build"
-cd cctbx_build
-
-echo "Running libtbx/configure.py"
-python ../cctbx_sources/libtbx/configure.py $cctbxopts ccp4io=${CCP4} mmtbx
-
-echo "Running setpaths.sh"
-. ./setpaths.sh
-
-echo "Building cctbx"
-libtbx.scons .
-
-# sunos 32 vs 64
-# use of sunos compilers
-# installation ??
+echo "Skipping final build of cctbx"
+echo "Install fink's cctbx package if you need this"
 
diff -ruN ccp4-6.0.2-orig/lib/cctbx/cctbx_install_script.csh ccp4-6.0.2/lib/cctbx/cctbx_install_script.csh
--- ccp4-6.0.2-orig/lib/cctbx/cctbx_install_script.csh	2006-11-21 12:35:30.000000000 -0800
+++ ccp4-6.0.2/lib/cctbx/cctbx_install_script.csh	2006-11-21 13:56:24.000000000 -0800
@@ -1,232 +1,6 @@
-#! /bin/csh -f
+#! /bin/csh -ef
 
-set install_root="$cwd"
-set bundle="cctbx"
-set sources="$cwd/${bundle}_sources"
-set build="$cwd/${bundle}_build"
-set prefer_usr_bin_python=0
+echo "Skipping final build of cctbx"
+echo "Install fink's cctbx package if you need this"
 
-unalias cat
-unalias cd
-unalias grep
-unalias ls
-unalias mkdir
-
-unsetenv PYTHONHOME
-
-if (-f "$sources/TAG") then
-  echo "Build tag:"
-  cat "$sources/TAG"
-endif
-
-if (-d "$sources/boost") then
-  set have_sources=1
-else
-  set have_sources=0
-endif
-
-set python_exe=None
-set build_mode=release
-
-if ("`uname`" == "Darwin") then
-  set python_exe="/Library/Frameworks/Python.framework/Versions/2.3/bin/python"
-  if (! -x "$python_exe") then
-    set python_exe="/System$python_exe"
-  endif
-  "$python_exe" -V
-  if ($status != 0) then
-    echo "Under Mac OS 10 Python 2.3 must be pre-installed."
-    echo "Please refer to the following web page for more information:"
-    echo "http://cci.lbl.gov/cctbx_build/mac_os_x_notes.html"
-    exit 1
-  endif
-endif
-
-if ($have_sources == 0) then
-
-  if (-d "$build/python") then
-    set python_exe="$build/python/bin/python"
-  endif
-  if ($prefer_usr_bin_python) then
-    if ("$python_exe" == None && -x /usr/bin/python) then
-      /usr/bin/python -V |& head -1
-      if ($status == 0) then
-        set python_exe=/usr/bin/python
-      endif
-    endif
-  endif
-  if ("$python_exe" == None) then
-    python -V |& head -1
-    if ($status == 0) then
-      set python_exe=python
-    endif
-  endif
-  if (! $prefer_usr_bin_python) then
-    if ("$python_exe" == None && -x /usr/bin/python) then
-      /usr/bin/python -V |& head -1
-      if ($status == 0) then
-        set python_exe=/usr/bin/python
-      endif
-    endif
-  endif
-
-else
-
-  if ($#argv == 0) then
-    echo -n "Please enter the number of available CPU's [1]: "
-    set n_cpu_s=(`echo "$<"`)
-    if ($#n_cpu_s > 1) then
-      echo "Not a number! Please try again."
-      exit 1
-    else if ($#n_cpu_s == 0) then
-      set n_cpu_s=1
-    else
-      set n_cpu_s="$n_cpu_s[1]"
-    endif
-  else if ($#argv == 1) then
-    set n_cpu_s="$1"
-  else
-    echo "usage: $0 number_of_cpu_s"
-    exit 1
-  endif
-  echo "Number of available CPU's: $n_cpu_s"
-  if ("$n_cpu_s" == "0") exit 0
-
-  if ("$python_exe" == None) then
-
-    set python_sources=(`ls | grep Python-`)
-    if ($#python_sources == 0) then
-      set python_sources=None
-    else if ($#python_sources == 1) then
-      set python_sources="$python_sources[1]"
-    else
-      echo "ERROR: Multiple Python source code directories."
-      echo "       Move or remove all but one directory."
-      exit 1
-    endif
-
-    if ("$python_sources" == None) then
-
-      echo "Trying to find a pre-installed Python:"
-      set python_exe=None
-      if (-x "$build/python/bin/python") then
-        "$build/python/bin/python" -V |& head -1
-        if ($status == 0) then
-          set python_exe="$build/python/bin/python"
-        endif
-      endif
-      if ("$python_exe" == None) then
-        python -V |& head -1
-        if ($status == 0) then
-          set python_exe=python
-        endif
-      endif
-      if ("$python_exe" == None) then
-        python2 -V |& head -1
-        if ($status == 0) then
-          set python_exe=python2
-        endif
-      endif
-      if ("$python_exe" == None && -x /usr/bin/python) then
-        /usr/bin/python -V |& head -1
-        if ($status == 0) then
-          set python_exe=/usr/bin/python
-        endif
-      endif
-      if ("$python_exe" != None) then
-        set python_version=(`"$python_exe" -V |& tr "." " "`)
-        if ("$python_version[2]") then
-          set minor=`echo "$python_version[3]" | cut -c-1`
-          if ($minor < 2 || ($minor == 2 && $#python_version == 3)) then
-            echo "A more recent Python version is required (2.2.1 or higher)."
-            set python_exe=None
-          endif
-        endif
-      endif
-      if ("$python_exe" == None) then
-        echo ""
-        echo "Cannot find a Python interpreter."
-        echo ""
-        echo "Please download an installer with Python included"
-        echo "or add a matching Python to the PATH environment variable."
-        echo ""
-        echo "Installation aborted."
-        exit 1
-      endif
-
-    else
-
-      echo "Installing $python_sources from sources"
-      mkdir -p "$build"
-      cd "$build"
-      cd ..
-      cd "$python_sources"
-      set py_install_log="../py_install_log"
-      echo "Configuring Python"
-      ./configure --prefix="$build/python" >& "$py_install_log"
-      echo "Compiling Python. This may take a while."
-      make >>& "$py_install_log"
-      echo "Installing Python"
-      make install >>& "$py_install_log"
-      echo "Done installing Python."
-      cd "$install_root"
-      set python_exe="$build/python/bin/python"
-      "$python_exe" -V
-      if ($status != 0) then
-        echo "ERROR: Python installation failed."
-        echo "Please check the log file for errors:"
-        echo "  $py_install_log"
-        exit 1
-      endif
-
-    endif
-
-  endif
-
-  mkdir -p "$build"
-
-endif
-
-echo ""
-echo "Precompiling all .py files. This may take a minute or two."
-"$python_exe" "$sources/libtbx/libtbx/command_line/py_compile_all.py"
-
-echo ""
-cd "$build"
-echo "Configuring $bundle build directory"
-"$python_exe" "$sources/libtbx/configure.py" --build="$build_mode" mmtbx clipper
-source setpaths_all.csh
-
-if ($have_sources != 0) then
-  echo ""
-  echo "Installing $bundle modules. This may take a while."
-  libtbx.scons -j "$n_cpu_s" .
-endif
-
-set test_py="$BOOST_ADAPTBX_DIST/tst_rational.py"
-if (-f "$test_py") then
-  echo ""
-  echo "Running a selected test"
-  set cmd='libtbx.python "'"$test_py"'"'
-  echo "$cmd"
-  eval $cmd
-endif
-
-cat << EOT
-
-***
-*** csh and tcsh users:
-***     To use this installation in a new shell or process run the command:
-***
-***         source "$LIBTBX_BUILD/setpaths.csh"
-***
-***     You may want to add this line to your .cshrc file.
-***
-*** sh and bash users:
-***     To use this installation in a new shell or process run the command:
-***
-***         . "$LIBTBX_BUILD/setpaths.sh"
-***
-***     You may want to add this line to your .profile or .bashrc file.
-***
-EOT
+ 
\ No newline at end of file
diff -ruN ccp4-6.0.2-orig/lib/clipper/clipper/mmdb/Makefile.in ccp4-6.0.2/lib/clipper/clipper/mmdb/Makefile.in
--- ccp4-6.0.2-orig/lib/clipper/clipper/mmdb/Makefile.in	2006-11-21 12:35:30.000000000 -0800
+++ ccp4-6.0.2/lib/clipper/clipper/mmdb/Makefile.in	2006-11-21 12:40:37.000000000 -0800
@@ -143,7 +143,7 @@
 LTLIBRARIES = $(lib_LTLIBRARIES)
 
 libclipper_mmdb_la_LDFLAGS =
-libclipper_mmdb_la_LIBADD =
+libclipper_mmdb_la_LIBADD = $(MMDB_LIBS)
 am_libclipper_mmdb_la_OBJECTS = clipper_mmdb.lo
 libclipper_mmdb_la_OBJECTS = $(am_libclipper_mmdb_la_OBJECTS)
 
diff -ruN ccp4-6.0.2-orig/lib/fftw/configure ccp4-6.0.2/lib/fftw/configure
--- ccp4-6.0.2-orig/lib/fftw/configure	2006-11-21 12:35:37.000000000 -0800
+++ ccp4-6.0.2/lib/fftw/configure	2006-11-21 13:58:21.000000000 -0800
@@ -1907,7 +1907,8 @@
   enableval="$enable_shared"
   p=${PACKAGE-default}
     case $enableval in
-    yes) enable_shared=yes ;;
+    # brute force it not to build shared fftw libs
+    yes) enable_shared=no ;;
     no) enable_shared=no ;;
     *)
       enable_shared=no
@@ -1916,7 +1917,7 @@
       for pkg in $enableval; do
 	IFS="$lt_save_ifs"
 	if test "X$pkg" = "X$p"; then
-	  enable_shared=yes
+	  enable_shared=no
 	fi
       done
       IFS="$lt_save_ifs"
diff -ruN ccp4-6.0.2-orig/src/refmac5_/make_unix_ccp4.f ccp4-6.0.2/src/refmac5_/make_unix_ccp4.f
--- ccp4-6.0.2-orig/src/refmac5_/make_unix_ccp4.f	2006-11-21 12:33:10.000000000 -0800
+++ ccp4-6.0.2/src/refmac5_/make_unix_ccp4.f	2006-11-21 12:44:43.000000000 -0800
@@ -82,10 +82,11 @@
 C
       INTEGER*4 IH(7)
 C ******
-      CHARACTER CID*10
+      CHARACTER CID*10,CID2*8
 c --------------------------------
 
       CALL UTIME(CID)
+      CALL DATE_AND_TIME(DATE=CID2)
 
 c          UTIME - Get current time hh:mm:ss          
 c Input:     none
@@ -96,13 +97,14 @@
 cpjx  the date as hh:mm:ss
 
       READ(CID,'(I2,1X,I2,1X,I2,2X)') IH(4),IH(3),IH(2)
+      READ(CID2,'(I4,I2,I2)') IYR,IMON,IDAY
 
-      CALL IDATE(IMON,IDAY,IYR)
-      IF(IYR.GE.99) THEN
-        IYR=IYR+1900
-      ELSE
-        IYR=IYR+2000
-      ENDIF
+#      CALL IDATE(IMON,IDAY,IYR)
+#      IF(IYR.GE.99) THEN
+#        IYR=IYR+1900
+#      ELSE
+#        IYR=IYR+2000
+#      ENDIF
       IH(5)=IDAY
       IH(6)=IMON
       IH(7)=IYR
--- ccp4-6.0.2/configure.sav	2008-03-09 12:56:18.000000000 -0400
+++ ccp4-6.0.2/configure	2008-03-09 12:58:40.000000000 -0400
@@ -1961,12 +1961,12 @@
   case $FC in
    *gfortran* )
     case `$FC -dumpversion 2>&1` in
-      GNU\ Fortran\ 95\ \(GCC\ 4.1.0\)* ) SETFLAGS=${SETFLAGS:-"refmac5_FLAGS='$XFFLAGS -O0' lgglib_FLAGS='$XFFLAGS -O0' arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' " } ;;
-      * ) SETFLAGS=${SETFLAGS:-"lgglib_FLAGS='$XFFLAGS -O0' arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' " } ;;
+      GNU\ Fortran\ 95\ \(GCC\ 4.1.0\)* ) SETFLAGS=${SETFLAGS:-"refmac5_FLAGS='$XFFLAGS -O0' lgglib_FLAGS='$XFFLAGS -O0' arp_waters_FLAGS='$XFFLAGS $FOPTIM' " } ;;
+      * ) SETFLAGS=${SETFLAGS:-"lgglib_FLAGS='$XFFLAGS -O0' arp_waters_FLAGS='$XFFLAGS $FOPTIM' " } ;;
       esac
       ;;
    * ) SETFLAGS=${SETFLAGS:-"sftools_FLAGS='$XFFLAGS $FOPTIM' \
-                      arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' \
+                      arp_waters_FLAGS='$XFFLAGS $FOPTIM' \
                       mlphare_FLAGS='$XFFLAGS $FOPTIM -fno-move-all-movables' \
                       stereo_FLAGS='$XFFLAGS $FOPTIM -fno-move-all-movables' "} ;;
     esac
@@ -2187,7 +2187,7 @@
         i386 ) FOPTIM="-O1" 
                SETFLAGS=${SETFLAGS:-"sftools_FLAGS='$XFFLAGS $FOPTIM' \
                       refmac5_FLAGS='$XFFLAGS -O1' \
-                      arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' \
+                      arp_waters_FLAGS='$XFFLAGS $FOPTIM' \
                       mplot_FLAGS='$XFFLAGS -O1' \
                       molrep_FLAGS='$XFFLAGS -O0' \
                       xdlmapman_FLAGS='$XFFLAGS -O1'\
@@ -2308,7 +2308,7 @@
   INSTALL_PROGRAM=${INSTALL_PROGRAM:-"cp"}
   SETFLAGS=${SETFLAGS:-"sftools_FLAGS='$XFFLAGS $FOPTIM' \
                       refmac5_FLAGS='$XFFLAGS -O3' \
-                      arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem' \
+                      arp_waters_FLAGS='$XFFLAGS $FOPTIM' \
                       mplot_FLAGS='$XFFLAGS -O3' \
                       molrep_FLAGS='$XFFLAGS -O3' \
                       xdlmapman_FLAGS='$XFFLAGS -O3'"}
@@ -2634,7 +2634,7 @@
     INSTALL_DATA=${INSTALL_DATA:-"cp"}
     INSTALL_PROGRAM=${INSTALL_PROGRAM:-"cp"}
     SETFLAGS=${SETFLAGS:-"sftools_FLAGS='$XFFLAGS $FOPTIM' \
-                      arp_waters_FLAGS='$XFFLAGS $FOPTIM -fforce-mem'"}
+                      arp_waters_FLAGS='$XFFLAGS $FOPTIM'"}
     XDL_LIB=${XDL_LIB:-"-L${CCP4_LIB} -lxdl_view"}
     XWIN_LIB=${XWIN_LIB:-"-L/usr/X11R6/lib -lXt -lSM -lX11 -lICE"}
     XTYPE=${XTYPE:-"LINUX"}
