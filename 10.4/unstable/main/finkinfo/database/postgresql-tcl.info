Package: postgresql-tcl
Version: 8.2.13
Revision: 1
Description: PostgreSQL TCL tools
License: BSD
Maintainer: Benjamin Reed <postgresql-tcl@fink.racoonfink.com>

Depends: <<
	postgresql82-shlibs,
	postgresql82,
	tcltk
<<
BuildDepends: <<
	fink (>= 0.28.0-1),
	fink-mirrors (>= 0.28.7.1-1),
	tcltk,
	tcltk-dev,
	postgresql82-dev,
	bison,
	readline5,
	system-openssl-dev
<<
# lclint installs %p/lib/Makefile, which leads configure to believe
# it has to use tcltk from its builddir, hence failure :
BuildConflicts: lclint
Conflicts: postgresql-ssl-tcl (<< %v-%r)
Replaces: <<
	postgresql-ssl-tcl (<< %v-%r),
	postgresql,
	postgresql-ssl
<<

Source: mirror:postgresql:source/v%v/postgresql-%v.tar.bz2
Source-MD5: 6cabbab9620d0dda788cca202c87bb78
Source2: http://gborg.postgresql.org/download/pgtclng/stable/pgtcl1.5.2.tar.gz
Source2-MD5: d19dfdcb54c334495d32456a043e0232
PatchFile: postgresql82.patch
PatchFile-MD5: 6b399f03d00dbe624d2dff4d3891c51f
PatchScript: sed 's|@INSTPREFIX@|%p|g' < %{PatchFile} | patch -p1

SetCPPFLAGS: -I%p/include/postgresql -I%p/include
SetLIBS: -L%p/lib -lpq
NoSetCPPFLAGS: true
NoSetLDFLAGS: true
ConfigureParams: --prefix=%p --with-docdir=%p/share/doc --mandir=%p/share/man --enable-multibyte --enable-recode --with-CXX --without-perl --without-python --with-openssl --with-libraries=%p/lib --with-includes=%p/include --with-tcl --with-tclconfig=%p/lib --with-tkconfig=%p/lib --without-java --enable-odbc --with-pam --with-rendezvous
CompileScript: <<
#!/bin/sh -ev

	export lt_cv_sys_max_cmd_len=65536
	export CPPFLAGS="-I%p/lib/system-openssl/include -I%p/include/postgresql -I%p/include -DHAVE_OPTRESET -fno-common"
	export LDFLAGS="-L%p/lib/system-openssl/lib -L%p/lib"

	pushd ../pgtcl1.5.2
	./configure --prefix=%p --with-postgres-lib=%p/lib --with-postgres-include=%p/include/postgresql --with-tcl=%p/lib
	make
	popd

	./configure %c

	pushd src/pl/tcl
	make BE_DLLLIBS="-bundle_loader %p/bin/postgres-8.2"
	popd
<<

InstallScript: <<
#!/bin/sh -ev

	pushd ../pgtcl1.5.2
	make install DESTDIR=%d
	popd

	pushd src/pl/tcl
	make install DESTDIR=%d INSTALLSITEMAN3DIR=%i/share/man/man3
	popd

	install_name_tool -id %p/lib/pgtcl1.5.2/libpgtcl1.5.2.dylib %i/lib/pgtcl1.5.2/libpgtcl1.5.2.dylib

	rm -R %i/include
<<
Shlibs: !%p/lib/pgtcl1.5.2/libpgtcl1.5.2.dylib
DocFiles: COPYRIGHT HISTORY INSTALL
SplitOff2: <<
	Package: postgresql-ssl-tcl
	Depends: postgresql-tcl (>= %v-%r)
	DocFiles: COPYRIGHT HISTORY INSTALL
<<

PostInstScript: <<
	cat <<END
*** WARNING ***

To be able to use this (pltcl) in PostgreSQL, you will need to
start your database:

	sudo %p/bin/pgsql.sh start

...and then run:

	sudo -u postgres %p/bin/createlang pltcl template1

...or, for the "untrusted" interpreter:

	sudo -u postgres %p/bin/createlang pltclu template1

*** WARNING ***
END
<<
PostRmScript: <<
	if [ "$1" != "upgrade" ]; then
		sudo -u postgres %p/bin/droplang pltcl template1 >/dev/null 2>&1 || :
	fi
<<

Homepage: http://www.postgresql.org/
DescDetail: <<
To be able to use this (pltcl) in PostgreSQL, you will need to
start your database:

	sudo %p/bin/pgsql.sh start

...and then run:

	sudo -u postgres %p/bin/createlang pltcl template1

...or, for the "untrusted" interpreter:

	sudo -u postgres %p/bin/createlang pltclu template1
<<

