Package: lighttpd
Version: 1.4.25
Revision: 1
DocFiles: AUTHORS COPYING INSTALL NEWS README
Description: Lightning fast web server
License: BSD
Maintainer: Alexey Zakhlestin <indeyets@gmail.com>
HomePage: http://lighttpd.net

BuildDepends: fink (>= 0.24.12), mysql-unified-dev, pcre, pkgconfig, system-openssl-dev, openldap23-dev, cyrus-sasl2-dev, bzip2-dev, gdbm3, lua51-dev, libxml2, libiconv-dev, sqlite3-dev, geoip-dev, automake1.11, autoconf, libtool2, libmemcache
Depends: daemonic, pcre-shlibs
Provides: httpd
Recommends: lighttpd-access, lighttpd-accesslog

Source: http://download.lighttpd.net/lighttpd/releases-1.4.x/lighttpd-%v.tar.bz2
Source-MD5: 2027c49fb46530e45338c5e2da13c02f 
Source2: http://redmine.lighttpd.net/attachments/download/716/mod_geoip_for_1.4.c
Source2-MD5: a60d4091280b95296c2e5e1a7a8c22d4 
Source3: http://redmine.lighttpd.net/attachments/download/197/mod_useronline.c
Source3-MD5: 0b843ffd21d254d8533765660cb7724d

PatchFile: %n.patch
PatchFile-MD5: 1d634230a50efb14593241dd2b0c45a7
PatchScript: <<
  cat %{PatchFile} | sed 's|@PREFIX@|%p|g' | patch -p1
  libtoolize --copy --force
  aclocal-1.11
  autoheader
  automake-1.11 --add-missing --copy -Wno-portability
  autoconf
  mv ../mod_geoip_for_1.4.c src/mod_geoip.c
  mv ../mod_useronline.c src/mod_useronline.c
<<

SetCFLAGS: -L%p/lib/system-openssl/lib
SetLDFLAGS: -L%p/lib/system-openssl/lib
ConfigureParams: --libdir='${prefix}/lib/%n' --with-openssl=%p/lib/system-openssl --with-ldap --with-mysql=%p/bin/mysql_config --with-bzip2 --with-gdbm --with-attr --disable-dependency-tracking --with-pcre --with-webdav-props --without-webdav-locks --with-lua --with-memcache
CompileScript: <<
	./configure %c
	make
<<
InstallScript: <<
 mkdir -p %i/etc/%n
 mkdir -p %i/etc/%n/mods-enabled
 mkdir -p %i/var/log/%n
 mkdir -p %i/share/doc/%n
 mkdir -p %i/share/man/man1
 mkdir -p %i/sbin
 mkdir -p %i/bin
 cp -R fink/etc/* %i/etc/lighttpd/
 cp -R doc %i/share/doc/%n
 make install prefix=%i
 rm -f %i/lib/%n/mod_*.la
 rm -f %i/share/doc/%n/doc/*.1 %i/share/doc/%n/doc/Makefile*
<<
ConfFiles: %p/etc/lighttpd/lighttpd.conf
Shlibs: <<
  %p/lib/lighttpd/liblightcomp.dylib 0.0.0 lighttpd (>= 1.4.16-1) 32
<<
DaemonicName: %n
DaemonicFile: <<
<service>
	<description>Lighttpd web server</description>
	<message>Lighttpd %v</message>

	<daemon name="%n">
		<executable background="yes">%p/sbin/lighttpd</executable>
		<parameters>-f %p/etc/%n/lighttpd.conf</parameters>
		<configfile>%p/etc/%n/lighttpd.conf</configfile>
		<pidfile>%p/var/run/%n.pid</pidfile>
	</daemon>
</service>
<<

PostInstScript: <<
set +e
if [ "$1" = "configure" ]; then
  chown www:www %p/var/log/%n
  %p/bin/daemonic install %n
fi

if [ "$1" = "upgrade" ]; then
  %p/bin/daemonic update %n
fi

%p/bin/daemonic enable %n

if [ -f %p/var/run/%n.pid ]; then
  echo "Stopping %n"
  killall %n 2>/dev/null
  echo "Starting %n"
  %p/sbin/lighttpd -f %p/etc/%n/lighttpd.conf
fi
<<

PreRmScript: <<
set +e
if [ "$1" != "upgrade" ]; then
  if [ -f %p/var/run/%n.pid ]; then
    echo "Stopping %n"
    killall %n 2>/dev/null
  fi

	%p/bin/daemonic disable %n
fi
<<

DescDetail: <<
lighttpd is a secure, fast, compliant and very flexible web-server which has
been optimized for high-performance environments. It has a very low memory
footprint compared to other webservers and takes care of cpu-load. Its
advanced feature-set (FastCGI, CGI, Auth, Output-Compression, URL-Rewriting
and many more) make lighttpd the perfect webserver-software for every server
that is suffering load problems.
<<
DescPackaging: <<
liblightcomp.dylib is a private library only.

Patched to fix http://trac.lighttpd.net/trac/changeset/1899
<<

# SplitOffs follow

SplitOff: <<
  Package: lighttpd-access
  Depends: %N (=%v-%r)
  Description: mod_access for lighttpd
  Files: <<
    lib/%N/mod_access.so
    share/doc/%N/doc/access.txt
    etc/%N/mods-available/access.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/access.conf
<<

SplitOff2: <<
  Package: lighttpd-accesslog
  Depends: %N (=%v-%r)
  Description: mod_accesslog for lighttpd
  Files: <<
    lib/%N/mod_accesslog.so
    share/doc/%N/doc/accesslog.txt
    etc/%N/mods-available/accesslog.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/accesslog.conf
<<

SplitOff3: <<
  Package: lighttpd-alias
  Depends: %N (=%v-%r)
  Description: mod_alias for lighttpd
  Files: <<
    lib/%N/mod_alias.so
    share/doc/%N/doc/alias.txt
    etc/%N/mods-available/alias.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/alias.conf
<<

SplitOff4: <<
  Package: lighttpd-auth
  Depends: %N (=%v-%r), openldap23-shlibs
  Description: mod_auth for lighttpd
  Files: <<
    lib/%N/mod_auth.so
    share/doc/%N/doc/authentication.txt
    etc/%N/mods-available/auth.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/auth.conf
<<

SplitOff5: <<
  Package: lighttpd-cgi
  Depends: %N (=%v-%r)
  Description: mod_cgi for lighttpd
  Files: <<
    lib/%N/mod_cgi.so
    share/doc/%N/doc/cgi.txt
    etc/%N/mods-available/cgi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/cgi.conf
<<

SplitOff6: <<
  Package: lighttpd-cml
  Depends: %N (=%v-%r), lua51-shlibs, libmemcache-shlibs
  Description: mod_cml (Cache Meta Language) for lighttpd
  Files: <<
    lib/%N/mod_cml.so
    share/doc/%N/doc/cml.txt
    etc/%N/mods-available/cml.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/cml.conf
<<

SplitOff7: <<
  Package: lighttpd-compress
  Depends: %N (=%v-%r), bzip2-shlibs
  Description: mod_compress for lighttpd
  Files: <<
    lib/%N/mod_compress.so
    share/doc/%N/doc/compress.txt
    etc/%N/mods-available/compress.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/compress.conf
<<

SplitOff8: <<
  Package: lighttpd-evhost
  Depends: %N (=%v-%r)
  Description: mod_evhost (Enchanced Virtual Host support) for lighttpd
  Files: <<
    lib/%N/mod_evhost.so
    share/doc/%N/doc/evhost.txt
    etc/%N/mods-available/evhost.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/evhost.conf
<<

SplitOff9: <<
  Package: lighttpd-expire
  Depends: %N (=%v-%r)
  Description: mod_expire for lighttpd
  Files: <<
    lib/%N/mod_expire.so
    share/doc/%N/doc/expire.txt
    etc/%N/mods-available/expire.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/expire.conf
<<

SplitOff10: <<
  Package: lighttpd-fastcgi
  Depends: %N (=%v-%r)
  Description: mod_fastcgi for lighttpd
  Files: <<
    lib/%N/mod_fastcgi.so
    share/doc/%N/doc/fastcgi.txt
    share/doc/%N/doc/fastcgi-state.dot
    share/doc/%N/doc/fastcgi-state.txt
    etc/%N/mods-available/fastcgi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/fastcgi.conf
<<

SplitOff11: <<
  Package: lighttpd-proxy
  Depends: %N (=%v-%r)
  Description: mod_proxy for lighttpd
  Files: <<
    lib/%N/mod_proxy.so
    share/doc/%N/doc/proxy.txt
    etc/%N/mods-available/proxy.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/proxy.conf
<<

SplitOff12: <<
  Package: lighttpd-redirect
  Depends: %N (=%v-%r)
  Description: mod_redirect for lighttpd
  Files: <<
    lib/%N/mod_redirect.so
    share/doc/%N/doc/redirect.txt
    etc/%N/mods-available/redirect.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/redirect.conf
<<

SplitOff13: <<
  Package: lighttpd-rewrite
  Depends: %N (=%v-%r)
  Description: mod_rewrite for lighttpd
  Files: <<
    lib/%N/mod_rewrite.so
    share/doc/%N/doc/rewrite.txt
    etc/%N/mods-available/rewrite.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/rewrite.conf
<<

SplitOff14: <<
  Package: lighttpd-rrdtool
  Depends: %N (=%v-%r), rrdtool
  Description: mod_rrdtool (logging into Round Robin Database) for lighttpd
  Files: <<
    lib/%N/mod_rrdtool.so
    share/doc/%N/doc/rrdtool.txt
    share/doc/%N/doc/rrdtool-graph.sh
    etc/%N/mods-available/rrdtool.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/rrdtool.conf
<<

SplitOff15: <<
  Package: lighttpd-secdownload
  Depends: %N (=%v-%r)
  Description: mod_secdownload (Secure Download) for lighttpd
  Files: <<
    lib/%N/mod_secdownload.so
    share/doc/%N/doc/secdownload.txt
    etc/%N/mods-available/secdownload.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/secdownload.conf
<<

SplitOff16: <<
  Package: lighttpd-setenv
  Depends: %N (=%v-%r)
  Description: mod_setenv for lighttpd
  Files: <<
    lib/%N/mod_setenv.so
    share/doc/%N/doc/setenv.txt
    etc/%N/mods-available/setenv.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/setenv.conf
<<

SplitOff17: <<
  Package: lighttpd-simple-vhost
  Depends: %N (=%v-%r)
  Description: mod_simple_vhost for lighttpd
  Files: <<
    lib/%N/mod_simple_vhost.so
    share/doc/%N/doc/simple-vhost.txt
    etc/%N/mods-available/simple_vhost.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/simple_vhost.conf
<<

SplitOff18: <<
  Package: lighttpd-ssi
  Depends: %N (=%v-%r)
  Description: mod_ssi for lighttpd
  Files: <<
    lib/%N/mod_ssi.so
    share/doc/%N/doc/ssi.txt
    etc/%N/mods-available/ssi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/ssi.conf
<<

SplitOff19: <<
  Package: lighttpd-status
  Depends: %N (=%v-%r)
  Description: mod_status for lighttpd
  Files: <<
    lib/%N/mod_status.so
    share/doc/%N/doc/status.txt
    etc/%N/mods-available/status.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/status.conf
<<

SplitOff20: <<
  Package: lighttpd-trigger-b4dl
  Depends: %N (=%v-%r), gdbm3-shlibs, libmemcache-shlibs
  Description: mod_trigger_b4_dl (trigger before download) for lighttpd
  Files: <<
    lib/%N/mod_trigger_b4_dl.so
    share/doc/%N/doc/trigger_b4_dl.txt
    etc/%N/mods-available/trigger_b4_dl.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/trigger_b4_dl.conf
<<

SplitOff21: <<
  Package: lighttpd-userdir
  Depends: %N (=%v-%r)
  Description: mod_userdir for lighttpd
  Files: <<
    lib/%N/mod_userdir.so
    share/doc/%N/doc/userdir.txt
    etc/%N/mods-available/userdir.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/userdir.conf
<<

SplitOff22: <<
  Package: lighttpd-usertrack
  Depends: %N (=%v-%r)
  Description: mod_usertrack (Cookies) for lighttpd
  Files: <<
    lib/%N/mod_usertrack.so
    etc/%N/mods-available/usertrack.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/usertrack.conf
<<

SplitOff23: <<
  Package: lighttpd-evasive
  Depends: %N (=%v-%r)
  Description: mod_evasive (limit of connections per ip) for lighttpd
  Files: <<
    lib/%N/mod_evasive.so
    etc/%N/mods-available/evasive.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/evasive.conf
<<

SplitOff24: <<
  Package: lighttpd-flv-streaming
  Depends: %N (=%v-%r)
  Description: mod_flv_streaming (Flash Video) for lighttpd
  Files: <<
    lib/%N/mod_flv_streaming.so
    etc/%N/mods-available/flv_streaming.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/flv_streaming.conf
<<

SplitOff25: <<
  Package: lighttpd-magnet
  Depends: %N (=%v-%r), lua51-shlibs
  Description: mod_magnet (control the request handling) for lighttpd
  Files: <<
    lib/%N/mod_magnet.so
    share/doc/%N/doc/magnet.txt
    etc/%N/mods-available/magnet.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/magnet.conf
<<

SplitOff26: <<
  Package: lighttpd-mysql-vhost
  Depends: %N (=%v-%r), mysql-unified-shlibs
  Description: mod_mysql_vhost for lighttpd
  Files: <<
    lib/%N/mod_mysql_vhost.so
    share/doc/%N/doc/mysqlvhost.txt
    etc/%N/mods-available/mysql_vhost.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/mysql_vhost.conf
<<

SplitOff27: <<
  Package: lighttpd-scgi
  Depends: %N (=%v-%r)
  Description: mod_scgi for lighttpd
  Files: <<
    lib/%N/mod_scgi.so
    share/doc/%N/doc/scgi.txt
    etc/%N/mods-available/scgi.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/scgi.conf
<<

SplitOff28: <<
  Package: lighttpd-webdav
  Depends: %N (=%v-%r), libxml2-shlibs, sqlite3-shlibs
  Description: mod_webdav for lighttpd
  Files: <<
    lib/%N/mod_webdav.so
    share/doc/%N/doc/webdav.txt
    etc/%N/mods-available/webdav.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/webdav.conf
<<

SplitOff29: <<
  Package: lighttpd-geoip
  Depends: %N (=%v-%r), geoip, geoip-shlibs
  Description: mod_geoip for lighttpd [*UNOFFICIAL*]
  Files: <<
    lib/%N/mod_geoip.so
    etc/%N/mods-available/geoip.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/geoip.conf
<<

SplitOff30: <<
  Package: lighttpd-extforward
  Depends: %N (=%v-%r)
  Description: mod_extforward (get real ip from X-Forwarded-For) for lighttpd [*UNOFFICIAL*]
  Files: <<
    lib/%N/mod_extforward.so
    etc/%N/mods-available/extforward.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/extforward.conf
<<

SplitOff31: <<
  Package: lighttpd-useronline
  Depends: %N (=%v-%r)
  Description: mod_useronline (track online/active users by unique IPs) for lighttpd [*UNOFFICIAL*]
  Files: <<
    lib/%N/mod_useronline.so
    etc/%N/mods-available/useronline.conf
  <<
  ConfFiles: %p/etc/%N/mods-available/useronline.conf
<<
