Package: fontconfig2-dev
Version: 2.4.1
Revision: 106
Distribution: 10.5, 10.6
Description: Font configuration library
Type: nosource
License: Restrictive/Distributable
Maintainer: Benjamin Reed <fontconfig2@fink.racoonfink.com>

Depends: <<
	system-xfree86-dev (>= 2:7.2-1),
	fontconfig2-shlibs (= %v-%r)
<<
BuildDependsOnly: true

CompileScript: echo "no compilation necessary"

InstallScript: <<
#!/bin/sh -ev

	FC_ROOT="%i/lib/fontconfig2"
	FC_LIB="%p/lib/fontconfig2/lib"
	FT_LIB="%p/lib/freetype219/lib"
	X11_ROOT="/usr/X11"

	declare -a bad_files

	bad_file() {
		bad_files[${#bad_files[*]}]="$1"
	}

	install -d -m 755 $FC_ROOT/{bin,include,lib,lib/pkgconfig}

	for file in \
		fcfreetype.h \
		fcprivate.h \
		fontconfig.h \
	; do
		[ -e "$X11_ROOT/include/fontconfig/$file" ] || bad_file "$X11_ROOT/include/fontconfig/$file"
	done

	for file in \
		include/fontconfig \
		lib/libfontconfig.1.dylib \
		lib/libfontconfig.dylib \
		bin/fc-cache \
		bin/fc-cat \
		bin/fc-list \
		bin/fc-match \
	; do
		[ -e "$X11_ROOT/$file" ] || bad_file "$X11_ROOT/$file"
		/bin/ln -sfh "$X11_ROOT/$file" "$FC_ROOT/$file"
	done

	# Use fink's freetype219 and expat1
	test -e "$X11_ROOT/lib/libfontconfig.la" && \
	sed -e "s|-L$X11_ROOT/lib||g" \
	    -e "s|$X11_ROOT/lib/libfreetype.la|-L$FT_LIB $FT_LIB/libfreetype.la|" \
	    -e "s|/usr/lib/libexpat.la|-L%p/lib %p/lib/libexpat.la|" \
	    -e "s|libdir=$X11_ROOT/lib|libdir=$FC_LIB|" \
	    -e "s|libfontconfig\.[0-9]*\.[0-9]*\.[0-9]*\.dylib||" \
	"$X11_ROOT/lib/libfontconfig.la" > "$FC_ROOT/lib/libfontconfig.fink.la"
	/bin/ln -sfh "$FC_LIB/libfontconfig.fink.la" \
		"$FC_ROOT/lib/libfontconfig.la"
	sed -e "s|$X11_ROOT|%p/lib/fontconfig2|" \
		"$X11_ROOT/lib/pkgconfig/fontconfig.pc" \
		> "$FC_ROOT/lib/pkgconfig/fontconfig.fink.pc"
	/bin/ln -sfh "$FC_LIB/pkgconfig/fontconfig.fink.pc" \
		"$FC_ROOT/lib/pkgconfig/fontconfig.pc"

	if [ ${#bad_files[*]} -gt 0 ]; then
		echo ""
		echo ""
		echo ""
		echo "=== ERROR === ERROR === ERROR === ERROR === ERROR === ERROR === ERROR ==="
		echo ""
		echo "Your X11 installation appears to be missing one or more required files:"
		for file in "${bad_files[@]}"; do
			echo "    $file"
		done
		echo ""
		echo "You may need to reinstall the X11User or X11SDK packages from your"
		echo "Leopard install media."
		echo ""
		echo "=== ERROR === ERROR === ERROR === ERROR === ERROR === ERROR === ERROR ==="
		echo ""
		echo ""
		echo ""
		exit 1
	fi
<<
SplitOff: <<
	Package: fontconfig2-shlibs
	Description: Fontconfig 2, shared libs (dummy)
	Depends: system-xfree86-shlibs (>= 2:7.2-1)
	Files: <<
		lib/fontconfig2/bin
		lib/fontconfig2/lib/libfontconfig.1*dylib
	<<
	PreInstScript: <<
for file in "%p/lib/fontconfig2/include/fontconfig" "%p/lib/fontconfig2/lib/pkgconfig/fontconfig.pc" \
	"%p/lib/fontconfig2/lib"/libfontconfig.*.dylib \
	"%p/lib/fontconfig2/lib"/libfontconfig.la; do
	if [ ! -L "$file" ]; then
		rm -rf "$file"
	fi
done
	<<
	PostInstScript: %p/lib/fontconfig2/bin/fc-cache --force >/tmp/fc-cache.log 2>&1 || :
<<

PreInstScript: <<
	for file in "%p/lib/fontconfig2/include/fontconfig" "%p/lib/fontconfig2/lib/pkgconfig/fontconfig.pc" \
		"%p/lib/fontconfig2/lib"/libfontconfig.*.dylib \
		"%p/lib/fontconfig2/lib"/libfontconfig.la; do
		if [ ! -L "$file" ]; then
			rm -rf "$file"
		fi
	done
<<

Homepage: http://www.fontconfig.org
DescDetail: <<
A library for font customization and configuration.

This version is a dummy package to take over for the previously-
supplied fontconfig2 package in Fink.
<<

