diff -Nurd kdebase-3.5.10/applnk/Makefile.am kdebase-3.5.10-new/applnk/Makefile.am
--- kdebase-3.5.10/applnk/Makefile.am	2007-01-15 03:32:11.000000000 -0800
+++ kdebase-3.5.10-new/applnk/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 xdg_menu_DATA = kde-settings.menu kde-information.menu kde-screensavers.menu
 
 xdg_mergedmenu_DATA = kde-essential.menu
-xdg_mergedmenudir = $(xdg_menudir)/applications-merged
+xdg_mergedmenudir = $(xdg_menudir)/kde-applications-merged
 
 xdg_directory_DATA = \
 kde-main.directory \
diff -Nurd kdebase-3.5.10/doc/userguide/kde-for-admins.docbook kdebase-3.5.10-new/doc/userguide/kde-for-admins.docbook
--- kdebase-3.5.10/doc/userguide/kde-for-admins.docbook	2006-07-22 01:15:40.000000000 -0700
+++ kdebase-3.5.10-new/doc/userguide/kde-for-admins.docbook	2010-05-13 05:26:40.000000000 -0700
@@ -1669,7 +1669,7 @@
 </para>
 
 <informalexample>
-<para>Example from <filename>applications.menu</filename>:
+<para>Example from <filename>kde-applications.menu</filename>:
 <programlisting>
 <markup>
 	&lt;Menu&gt;
@@ -1743,7 +1743,7 @@
 information, see <ulink url="http://www.freedesktop.org/Standards/basedir-spec">http://www.freedesktop.org/Standards/basedir-spec</ulink></para>
 
 <informalexample>
-<para>Example from <filename>applications.menu</filename>:
+<para>Example from <filename>kde-applications.menu</filename>:
 <programlisting>
 <markup>
              &lt;Menu&gt;
@@ -1795,7 +1795,7 @@
 <title>Essential Menus</title>
 
 <para><filename
-class="directory">$<envar>KDEDIR</envar>/etc/xdg/menus/applications-merged/</filename>
+class="directory">$<envar>KDEDIR</envar>/etc/xdg/menus/kde-applications-merged/</filename>
 contains <filename>kde-essential.menu</filename> which includes some
 essential menus that are normally not shown in the &kde; menu itself:
 <itemizedlist>
diff -Nurd kdebase-3.5.10/drkonqi/Makefile.am kdebase-3.5.10-new/drkonqi/Makefile.am
--- kdebase-3.5.10/drkonqi/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/drkonqi/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -8,15 +8,17 @@
 
 EXTRA_DIST = LICENSE
 
-bin_PROGRAMS = drkonqi
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = drkonqi.la
 
 # Libraries:
-AM_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-LDADD  = $(LIB_KDEUI) $(LIB_KIO)
+drkonqi_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+drkonqi_la_LIBADD  = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 # toplevel.cpp must be last in row due to X-headers being included. (--enable-final)
 # Did I mention already that X header files really suck?
-drkonqi_SOURCES = krashdcopinterface.skel main.cpp debugger.cpp krashconf.cpp drbugreport.cpp backtrace.cpp toplevel.cpp
+drkonqi_la_SOURCES = krashdcopinterface.skel main.cpp debugger.cpp krashconf.cpp drbugreport.cpp backtrace.cpp toplevel.cpp
 
 
 check_PROGRAMS = crashtest
diff -Nurd kdebase-3.5.10/drkonqi/main.cpp kdebase-3.5.10-new/drkonqi/main.cpp
--- kdebase-3.5.10/drkonqi/main.cpp	2006-07-22 01:15:52.000000000 -0700
+++ kdebase-3.5.10-new/drkonqi/main.cpp	2010-05-13 05:26:40.000000000 -0700
@@ -57,7 +57,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char* argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char* argv[] )
 {
   // Drop privs.
   setgid(getgid());
diff -Nurd kdebase-3.5.10/kappfinder/Makefile.am kdebase-3.5.10-new/kappfinder/Makefile.am
--- kdebase-3.5.10/kappfinder/Makefile.am	2005-09-10 01:25:41.000000000 -0700
+++ kdebase-3.5.10-new/kappfinder/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -1,13 +1,21 @@
 SUBDIRS = apps
 
-bin_PROGRAMS = kappfinder
-kappfinder_SOURCES = main.cpp toplevel.cpp common.cpp
-kappfinder_LDADD = $(LIB_KDEUI) $(LIB_KIO)
-kappfinder_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kappfinder.la
+
+kappfinder_la_SOURCES = main.cpp toplevel.cpp kacommon.cpp
+kappfinder_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
+kappfinder_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+
+$(srcdir)/kacommon.cpp: $(srcdir)/common.cpp
+	cat $(srcdir)/common.cpp > $(srcdir)/kacommon.cpp
+
+DISTCLEANFILES = kacommon.cpp
 
 noinst_PROGRAMS = kappfinder_install
 kappfinder_install_SOURCES = main_install.cpp common.cpp
-kappfinder_install_LDADD = $(LIB_KDEUI)
+kappfinder_install_LDADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 kappfinder_install_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 INCLUDES = $(all_includes)
diff -Nurd kdebase-3.5.10/kappfinder/main.cpp kdebase-3.5.10-new/kappfinder/main.cpp
--- kdebase-3.5.10/kappfinder/main.cpp	2007-10-08 02:51:26.000000000 -0700
+++ kdebase-3.5.10-new/kappfinder/main.cpp	2010-05-13 05:26:40.000000000 -0700
@@ -31,7 +31,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char *argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char *argv[] )
 {
   KAboutData aboutData( "kappfinder", I18N_NOOP( "KAppfinder" ),
                         "1.0", description, KAboutData::License_GPL,
diff -Nurd kdebase-3.5.10/kate/app/Makefile.am kdebase-3.5.10-new/kate/app/Makefile.am
--- kdebase-3.5.10/kate/app/Makefile.am	2005-10-10 08:03:41.000000000 -0700
+++ kdebase-3.5.10-new/kate/app/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -12,7 +12,7 @@
   kateexternaltools.cpp katesavemodifieddialog.cpp kateviewspacecontainer.cpp \
   katemwmodonhddialog.cpp katesession.cpp katemdi.cpp katetabwidget.cpp
 
-libkateinterfaces_la_LIBADD   = ../interfaces/libkateinterfacesprivate.la $(LIB_KUTILS) ../utils/libkateutils.la
+libkateinterfaces_la_LIBADD   = ../interfaces/libkateinterfacesprivate.la $(LIB_KUTILS) ../utils/libkateutils.la -lDCOP $(LIB_KPARTS) -lktexteditor
 
 libkateinterfaces_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined
 
@@ -21,7 +21,7 @@
 kate_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
 
 kwrite_la_SOURCES = kwritemain.cpp
-kwrite_la_LIBADD   = -lkatepartinterfaces  ../utils/libkateutils.la
+kwrite_la_LIBADD   = -lkatepartinterfaces  ../utils/libkateutils.la -lDCOP $(LIB_KPARTS) -lktexteditor
 kwrite_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kate/utils/Makefile.am kdebase-3.5.10-new/kate/utils/Makefile.am
--- kdebase-3.5.10/kate/utils/Makefile.am	2005-09-10 01:24:58.000000000 -0700
+++ kdebase-3.5.10-new/kate/utils/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -8,7 +8,7 @@
 
 libkateutils_la_LDFLAGS = $(all_libraries) -no-undefined
                       
-libkateutils_la_LIBADD = $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_KIO)
+libkateutils_la_LIBADD = $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_KIO) $(LIB_QT)
 
 libkateutils_la_METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kcminit/Makefile.am kdebase-3.5.10-new/kcminit/Makefile.am
--- kdebase-3.5.10/kcminit/Makefile.am	2006-05-22 11:12:41.000000000 -0700
+++ kdebase-3.5.10-new/kcminit/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -22,11 +22,11 @@
 lib_LTLIBRARIES=
 
 kcminit_la_SOURCES = main.cpp main.skel
-kcminit_la_LIBADD = $(LIB_KDEUI) $(LIB_KUTILS)
+kcminit_la_LIBADD = $(LIB_KDEUI) $(LIB_KUTILS) $(LIB_QT) $(LIB_KDECORE) -lDCOP $(LIB_KIO)
 kcminit_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 kcminit_startup_la_SOURCES = main.cpp main.skel
-kcminit_startup_la_LIBADD = $(LIB_KDEUI) $(LIB_KUTILS)
+kcminit_startup_la_LIBADD = $(LIB_KDEUI) $(LIB_KUTILS) $(LIB_QT) $(LIB_KDECORE) -lDCOP $(LIB_KIO)
 kcminit_startup_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 AM_CPPFLAGS = $(all_includes)
diff -Nurd kdebase-3.5.10/kcontrol/access/Makefile.am kdebase-3.5.10-new/kcontrol/access/Makefile.am
--- kdebase-3.5.10/kcontrol/access/Makefile.am	2005-09-10 01:25:08.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/access/Makefile.am	2010-05-13 05:26:51.000000000 -0700
@@ -9,11 +9,11 @@
 
 kaccess_la_SOURCES = kaccess.cpp main.cpp
 kaccess_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kaccess_la_LIBADD = $(LIB_KDEUI)
+kaccess_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 kcm_access_la_SOURCES = kcmaccess.cpp 
 kcm_access_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_access_la_LIBADD = $(LIB_KIO)
+kcm_access_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 noinst_HEADERS = kcmaccess.h
 
diff -Nurd kdebase-3.5.10/kcontrol/accessibility/Makefile.am kdebase-3.5.10-new/kcontrol/accessibility/Makefile.am
--- kdebase-3.5.10/kcontrol/accessibility/Makefile.am	2006-03-17 02:17:12.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/accessibility/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 
 kcm_accessibility_la_SOURCES = accessibility.cpp accessibilityconfigwidget.ui
 kcm_accessibility_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_accessibility_la_LIBADD = $(LIB_KIO)
+kcm_accessibility_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 
 noinst_HEADERS = accessibility.h
 
diff -Nurd kdebase-3.5.10/kcontrol/arts/Makefile.am kdebase-3.5.10-new/kcontrol/arts/Makefile.am
--- kdebase-3.5.10/kcontrol/arts/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/arts/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_arts_la_SOURCES = arts.cpp generaltab.ui hardwaretab.ui krichtextlabel.cpp
 
 kcm_arts_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_arts_la_LIBADD = $(LIB_KIO) $(LIB_KUTILS) -lkmid
+kcm_arts_la_LIBADD = $(LIB_KIO) $(LIB_KUTILS) -lkmid $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 AM_CPPFLAGS = -I$(kde_includes)/arts  $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/background/Makefile.am kdebase-3.5.10-new/kcontrol/background/Makefile.am
--- kdebase-3.5.10/kcontrol/background/Makefile.am	2006-03-17 02:17:11.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/background/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -6,7 +6,7 @@
 
 kcm_background_la_SOURCES = main.cpp
 kcm_background_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_background_la_LIBADD = libkcmbgnd.la libbgnd.la $(LIB_KFILE) $(LIB_KNEWSTUFF)
+kcm_background_la_LIBADD = libkcmbgnd.la libbgnd.la $(LIB_KFILE) $(LIB_KNEWSTUFF) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lkdefx -lDCOP
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kcontrol/bell/Makefile.am kdebase-3.5.10-new/kcontrol/bell/Makefile.am
--- kdebase-3.5.10/kcontrol/bell/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/bell/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_bell_la_SOURCES = bell.cpp
 
 kcm_bell_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_bell_la_LIBADD = -lkdeui
+kcm_bell_la_LIBADD = -lkdeui $(LIB_QT) $(LIB_KDECORE)
 
 AM_CPPFLAGS= $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/clock/Makefile.am kdebase-3.5.10-new/kcontrol/clock/Makefile.am
--- kdebase-3.5.10/kcontrol/clock/Makefile.am	2005-09-10 01:25:11.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/clock/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_clock_la_SOURCES = dtime.cpp tzone.cpp main.cpp 
 
 kcm_clock_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_clock_la_LIBADD = $(LIB_KIO)
+kcm_clock_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 AM_CPPFLAGS = $(all_includes)
  
diff -Nurd kdebase-3.5.10/kcontrol/colors/Makefile.am kdebase-3.5.10-new/kcontrol/colors/Makefile.am
--- kdebase-3.5.10/kcontrol/colors/Makefile.am	2006-03-17 02:17:17.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/colors/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -4,7 +4,7 @@
 
 kcm_colors_la_SOURCES = colorscm.cpp widgetcanvas.cpp 
 kcm_colors_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_colors_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(top_builddir)/kcontrol/krdb/libkrdb.la
+kcm_colors_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(top_builddir)/kcontrol/krdb/libkrdb.la $(LIB_QT) $(LIB_KDECORE) -lDCOP -lkdefx
 METASOURCES = colorscm.moc widgetcanvas.moc
 
 noinst_HEADERS = colorscm.h widgetcanvas.h
diff -Nurd kdebase-3.5.10/kcontrol/componentchooser/Makefile.am kdebase-3.5.10-new/kcontrol/componentchooser/Makefile.am
--- kdebase-3.5.10/kcontrol/componentchooser/Makefile.am	2005-09-10 01:25:04.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/componentchooser/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -7,7 +7,7 @@
 
 kcm_componentchooser_la_SOURCES = componentchooser_ui.ui componentconfig_ui.ui emailclientconfig_ui.ui terminalemulatorconfig_ui.ui browserconfig_ui.ui componentchooser.cpp kcm_componentchooser.cpp
 kcm_componentchooser_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_componentchooser_la_LIBADD =  $(LIB_KIO)
+kcm_componentchooser_la_LIBADD =  $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 xdg_apps_DATA = componentchooser.desktop
 
diff -Nurd kdebase-3.5.10/kcontrol/crypto/Makefile.am kdebase-3.5.10-new/kcontrol/crypto/Makefile.am
--- kdebase-3.5.10/kcontrol/crypto/Makefile.am	2007-10-08 02:51:15.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/crypto/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -6,7 +6,7 @@
 AM_CXXFLAGS = $(CXXFLAGS) -DLIBDIR=$(libdir)
 
 kcm_crypto_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) $(SSL_LDFLAGS) -module -avoid-version -no-undefined
-kcm_crypto_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSSL)
+kcm_crypto_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSSL) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kcontrol/css/Makefile.am kdebase-3.5.10-new/kcontrol/css/Makefile.am
--- kdebase-3.5.10/kcontrol/css/Makefile.am	2005-09-10 01:25:10.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/css/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -6,7 +6,7 @@
 kde_module_LTLIBRARIES = kcm_css.la
 kcm_css_la_SOURCES = template.cpp cssconfig.ui csscustom.ui kcmcss.cpp preview.ui
 kcm_css_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_css_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_css_la_LIBADD = -lkdeui $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
  
diff -Nurd kdebase-3.5.10/kcontrol/display/Makefile.am kdebase-3.5.10-new/kcontrol/display/Makefile.am
--- kdebase-3.5.10/kcontrol/display/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/display/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_display_la_SOURCES = display.cpp
 
 kcm_display_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_display_la_LIBADD = $(LIB_KUTILS)
+kcm_display_la_LIBADD = $(LIB_KUTILS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 AM_CPPFLAGS = $(all_includes) 
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kcontrol/dnssd/Makefile.am kdebase-3.5.10-new/kcontrol/dnssd/Makefile.am
--- kdebase-3.5.10/kcontrol/dnssd/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/dnssd/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 kcm_kdnssd_la_SOURCES = configdialog.ui kcmdnssd.cpp kcmdnssd.h
 
 xdg_apps_DATA = kcm_kdnssd.desktop
-kcm_kdnssd_la_LIBADD = $(LIB_KDNSSD) $(LIB_KDEUI)
+kcm_kdnssd_la_LIBADD = $(LIB_KDNSSD) $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 messages: rc.cpp
 	$(EXTRACTRC) *.ui *.rc >> rc.cpp
diff -Nurd kdebase-3.5.10/kcontrol/ebrowsing/Makefile.am kdebase-3.5.10-new/kcontrol/ebrowsing/Makefile.am
--- kdebase-3.5.10/kcontrol/ebrowsing/Makefile.am	2006-01-19 09:00:46.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/ebrowsing/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -9,7 +9,7 @@
 kcm_kurifilt_la_SOURCES = filteropts.cpp main.cpp
 
 kcm_kurifilt_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kurifilt_la_LIBADD = $(LIB_KSYCOCA)
+kcm_kurifilt_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 # Don't link this lib to the plugins. They are dlopened and linking to them
 # results in crashes when closing kcmshell.
 # plugins/ikws/libkuriikwsfilter.la plugins/shorturi/libkshorturifilter.la
diff -Nurd kdebase-3.5.10/kcontrol/ebrowsing/plugins/ikws/Makefile.am kdebase-3.5.10-new/kcontrol/ebrowsing/plugins/ikws/Makefile.am
--- kdebase-3.5.10/kcontrol/ebrowsing/plugins/ikws/Makefile.am	2005-09-10 01:25:07.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/ebrowsing/plugins/ikws/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -9,10 +9,10 @@
 kde_module_LTLIBRARIES = libkuriikwsfilter.la libkurisearchfilter.la
 
 libkuriikwsfilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-libkuriikwsfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkuriikwsfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 libkurisearchfilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-libkurisearchfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkurisearchfilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 libkuriikwsfilter_la_SOURCES = kuriikwsfiltereng.cpp kuriikwsfilter.skel \
     kuriikwsfilter.cpp searchprovider.cpp
diff -Nurd kdebase-3.5.10/kcontrol/ebrowsing/plugins/localdomain/Makefile.am kdebase-3.5.10-new/kcontrol/ebrowsing/plugins/localdomain/Makefile.am
--- kdebase-3.5.10/kcontrol/ebrowsing/plugins/localdomain/Makefile.am	2008-08-19 11:16:48.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/ebrowsing/plugins/localdomain/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = liblocaldomainurifilter.la
 
 liblocaldomainurifilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-liblocaldomainurifilter_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KDECORE)
+liblocaldomainurifilter_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT) -lDCOP
 
 liblocaldomainurifilter_la_SOURCES = localdomainurifilter.cpp localdomainurifilter.skel
 
diff -Nurd kdebase-3.5.10/kcontrol/ebrowsing/plugins/shorturi/Makefile.am kdebase-3.5.10-new/kcontrol/ebrowsing/plugins/shorturi/Makefile.am
--- kdebase-3.5.10/kcontrol/ebrowsing/plugins/shorturi/Makefile.am	2008-08-19 11:16:48.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/ebrowsing/plugins/shorturi/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = libkshorturifilter.la
 
 libkshorturifilter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-libkshorturifilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+libkshorturifilter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 libkshorturifilter_la_SOURCES = kshorturifilter.cpp kshorturifilter.skel
 
diff -Nurd kdebase-3.5.10/kcontrol/energy/Makefile.am kdebase-3.5.10-new/kcontrol/energy/Makefile.am
--- kdebase-3.5.10/kcontrol/energy/Makefile.am	2006-03-17 02:17:17.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/energy/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -6,7 +6,7 @@
 
 kcm_energy_la_SOURCES = energy.cpp
 kcm_energy_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_energy_la_LIBADD = $(DPMSLIB) $(LIB_KDEUI) $(LIB_KIO)
+kcm_energy_la_LIBADD = $(DPMSLIB) $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 METASOURCES = energy.moc
 
 noinst_HEADERS = energy.h
diff -Nurd kdebase-3.5.10/kcontrol/filetypes/Makefile.am kdebase-3.5.10-new/kcontrol/filetypes/Makefile.am
--- kdebase-3.5.10/kcontrol/filetypes/Makefile.am	2005-09-10 01:25:08.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/filetypes/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -1,6 +1,6 @@
 AM_CPPFLAGS = $(all_includes)
 
-kcm_filetypes_la_LIBADD	= libfiletypes.la $(LIB_KIO)
+kcm_filetypes_la_LIBADD	= libfiletypes.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 kcm_filetypes_la_LDFLAGS = -module -avoid-version -no-undefined $(all_libraries)
 METASOURCES = AUTO
 
@@ -12,16 +12,18 @@
 	kservicelistwidget.h typeslistitem.h newtypedlg.h \
 	kserviceselectdlg.h
 
-bin_PROGRAMS = keditfiletype
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = keditfiletype.la
 
 noinst_LTLIBRARIES = libfiletypes.la
 libfiletypes_la_SOURCES = filetypesview.cpp filetypedetails.cpp filegroupdetails.cpp \
 		 kservicelistwidget.cpp typeslistitem.cpp newtypedlg.cpp \
 		 kserviceselectdlg.cpp
 
-keditfiletype_SOURCES = keditfiletype.cpp
-keditfiletype_LDADD = libfiletypes.la $(LIB_KIO)
-keditfiletype_LDFLAGS = $(KDE_RPATH) $(all_libraries)
+keditfiletype_la_SOURCES = keditfiletype.cpp
+keditfiletype_la_LIBADD = libfiletypes.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
+keditfiletype_la_LDFLAGS = $(KDE_PLUGIN) $(all_libraries) -module
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/filetypes.pot
diff -Nurd kdebase-3.5.10/kcontrol/filetypes/keditfiletype.cpp kdebase-3.5.10-new/kcontrol/filetypes/keditfiletype.cpp
--- kdebase-3.5.10/kcontrol/filetypes/keditfiletype.cpp	2007-05-14 00:55:38.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/filetypes/keditfiletype.cpp	2010-05-13 05:26:40.000000000 -0700
@@ -108,7 +108,7 @@
   KCmdLineLastOption
 };
 
-int main(int argc, char ** argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char ** argv)
 {
   KLocale::setMainCatalogue("filetypes");
   KAboutData aboutData( "keditfiletype", I18N_NOOP("KEditFileType"), "1.0",
diff -Nurd kdebase-3.5.10/kcontrol/fonts/Makefile.am kdebase-3.5.10-new/kcontrol/fonts/Makefile.am
--- kdebase-3.5.10/kcontrol/fonts/Makefile.am	2007-05-14 00:55:34.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/fonts/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -1,16 +1,17 @@
 noinst_LTLIBRARIES = libkxftconfig.la
 
 libkxftconfig_la_SOURCES = kxftconfig.cpp
-libkxftconfig_la_LIBADD = $(LIBFONTCONFIG_LIBS)
+libkxftconfig_la_LIBADD = $(LIBFONTCONFIG_LIBS) $(LIB_QT) $(LIB_KDECORE)
 libkxftconfig_la_LDFLAGS = $(LIBFONTCONFIG_RPATH)
 
-AM_CPPFLAGS  = $(all_includes) $(LIBFONTCONFIG_CFLAGS) $(FREETYPE2_CFLAGS) -D_LARGEFILE64_SOURCE
+AM_CPPFLAGS  = $(LIBFONTCONFIG_CFLAGS) $(FREETYPE2_CFLAGS) -D_LARGEFILE64_SOURCE $(all_includes)
+AM_LDFLAGS = $(LIBFONTCONFIG_LDFLAGS) $(FREETYPE2_LDFLAGS) $(all_libraries)
 
 kde_module_LTLIBRARIES = kcm_fonts.la
 
 kcm_fonts_la_SOURCES = fonts.cpp
-kcm_fonts_la_LDFLAGS = $(KDE_RPATH) $(LIBFONTCONFIG_RPATH) $(FREETYPE2_LDFLAGS) -module -avoid-version $(all_libraries) -no-undefined
-kcm_fonts_la_LIBADD = libkxftconfig.la $(top_builddir)/kcontrol/krdb/libkrdb.la $(LIB_KDEUI) $(LIBFONTCONFIG_LIBS)
+kcm_fonts_la_LDFLAGS = $(LIBFONTCONFIG_LIBS) $(FREETYPE2_LDFLAGS) $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined
+kcm_fonts_la_LIBADD = $(LIBFONTCONFIG_LIBS) libkxftconfig.la $(top_builddir)/kcontrol/krdb/libkrdb.la $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP -lkdefx
 METASOURCES = AUTO
 
 noinst_HEADERS = fonts.h kxftconfig.h
diff -Nurd kdebase-3.5.10/kcontrol/fonts/configure.in.in kdebase-3.5.10-new/kcontrol/fonts/configure.in.in
--- kdebase-3.5.10/kcontrol/fonts/configure.in.in	2007-05-14 00:55:34.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/fonts/configure.in.in	2010-05-13 05:26:40.000000000 -0700
@@ -1,8 +1,6 @@
-KDE_FIND_PATH(fontconfig-config, FONTCONFIG_CONFIG, [${prefix}/bin ${exec_prefix}/bin /usr/bin /usr/local/bin /opt/local/bin], [
         KDE_FIND_PATH(pkg-config, PKGCONFIG, [${prefix}/bin ${exec_prefix}/bin /usr/bin /usr/local/bin /opt/local/bin], [
             AC_MSG_WARN([Could not find neither pkg-config nor fontconfig-config, check http://www.fontconfig.org/ ])
         ])
-])
 
 if test -n "$PKGCONFIG"; then
   vers=`$PKGCONFIG fontconfig --modversion 2>/dev/null | sed -e 's/libfontconfig //' | awk 'BEGIN { FS = "."; } { printf "%d", ($1 * 1000 + $2) * 1000 + $3;}'`
diff -Nurd kdebase-3.5.10/kcontrol/icons/Makefile.am kdebase-3.5.10-new/kcontrol/icons/Makefile.am
--- kdebase-3.5.10/kcontrol/icons/Makefile.am	2006-03-17 02:17:18.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/icons/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -4,7 +4,7 @@
 
 kcm_icons_la_SOURCES = iconthemes.cpp icons.cpp main.cpp
 kcm_icons_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_icons_la_LIBADD = $(LIB_KIO)
+kcm_icons_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 METASOURCES = AUTO 
 
@@ -13,7 +13,7 @@
 check_PROGRAMS = testicons
 testicons_SOURCES = testicons.cpp 
 testicons_LDFLAGS = $(all_libraries)
-testicons_LDADD = $(LIB_KDEUI) icons.lo
+testicons_LDADD = $(LIB_KDEUI) icons.lo $(LIB_QT) $(LIB_KDECORE)
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/kcmicons.pot
diff -Nurd kdebase-3.5.10/kcontrol/info/Makefile.am kdebase-3.5.10-new/kcontrol/info/Makefile.am
--- kdebase-3.5.10/kcontrol/info/Makefile.am	2006-07-22 01:15:25.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/info/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -7,7 +7,7 @@
 kcm_info_la_SOURCES = main.cpp memory.cpp opengl.cpp
 
 kcm_info_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined $(FRAMEWORK_COREAUDIO)
-kcm_info_la_LIBADD = $(LIBALIB) $(LIB_KDEUI) $(LIB_TRU64_MACH) $(LIBCFG) $(LIBODM) $(LIBKSTAT) $(LIBDEVINFO) $(GLLIB)
+kcm_info_la_LIBADD = $(LIBALIB) $(LIB_KDEUI) $(LIB_TRU64_MACH) $(LIBCFG) $(LIBODM) $(LIBKSTAT) $(LIBDEVINFO) $(GLLIB) $(LIB_QT) $(LIB_KDECORE)
 METASOURCES = AUTO
 
 AM_CPPFLAGS= $(all_includes) $(GLINC)
diff -Nurd kdebase-3.5.10/kcontrol/info/info_osx.cpp kdebase-3.5.10-new/kcontrol/info/info_osx.cpp
--- kdebase-3.5.10/kcontrol/info/info_osx.cpp	2005-10-10 08:03:43.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/info/info_osx.cpp	2010-05-13 05:26:40.000000000 -0700
@@ -113,7 +113,7 @@
 
 bool GetInfo_Sound (QListView *lBox)
 {
-#ifdef HAVE_COREAUDIO
+#if defined(HAVE_COREAUDIO) && !defined(__x86_64__)
 #define kMaxStringSize 1024
 	OSStatus status;
 	AudioDeviceID gOutputDeviceID;
diff -Nurd kdebase-3.5.10/kcontrol/input/Makefile.am kdebase-3.5.10-new/kcontrol/input/Makefile.am
--- kdebase-3.5.10/kcontrol/input/Makefile.am	2005-09-10 01:25:07.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/input/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -16,13 +16,13 @@
 
 kapplymousetheme_SOURCES = kapplymousetheme.cpp
 kapplymousetheme_LDFLAGS = $(all_libraries)
-kapplymousetheme_LDADD = $(LIB_XCURSOR) $(LIB_X11)
+kapplymousetheme_LDADD = $(LIB_XCURSOR) $(LIB_X11) $(LIB_QT) $(LIB_KDECORE)
 
 kde_module_LTLIBRARIES = kcm_input.la
 
 kcm_input_la_SOURCES = mouse.cpp kmousedlg.ui main.cpp logitechmouse.cpp logitechmouse_base.ui
 kcm_input_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_input_la_LIBADD = $(THEMEPAGE_LIB) $(XTESTLIB) $(LIB_KIO) $(LIB_XCURSOR) $(USB_LIBS)
+kcm_input_la_LIBADD = $(THEMEPAGE_LIB) $(XTESTLIB) $(LIB_KIO) $(LIB_XCURSOR) $(USB_LIBS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP $(LIB_XRENDER)
 
 METASOURCES = AUTO 
 
diff -Nurd kdebase-3.5.10/kcontrol/ioslaveinfo/Makefile.am kdebase-3.5.10-new/kcontrol/ioslaveinfo/Makefile.am
--- kdebase-3.5.10/kcontrol/ioslaveinfo/Makefile.am	2006-03-17 02:17:16.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/ioslaveinfo/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_ioslaveinfo_la_SOURCES = kcmioslaveinfo.cpp
 
 kcm_ioslaveinfo_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_ioslaveinfo_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_ioslaveinfo_la_LIBADD = -lkdeui $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 
 AM_CPPFLAGS= $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/joystick/Makefile.am kdebase-3.5.10-new/kcontrol/joystick/Makefile.am
--- kdebase-3.5.10/kcontrol/joystick/Makefile.am	2005-09-10 01:25:11.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/joystick/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kcm_joystick.la
 
 kcm_joystick_la_SOURCES = joystick.cpp joywidget.cpp poswidget.cpp joydevice.cpp caldialog.cpp
-kcm_joystick_la_LIBADD = $(LIB_KDEUI)
+kcm_joystick_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 kcm_joystick_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
 
 xdg_apps_DATA = joystick.desktop
diff -Nurd kdebase-3.5.10/kcontrol/kcontrol/Makefile.am kdebase-3.5.10-new/kcontrol/kcontrol/Makefile.am
--- kdebase-3.5.10/kcontrol/kcontrol/Makefile.am	2005-10-10 08:03:43.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kcontrol/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -32,7 +32,7 @@
 	moduleIface.cpp moduleIface.skel global.cpp modules.cpp \
 	proxywidget.cpp kcrootonly.cpp searchwidget.cpp
 
-kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KUTILS) $(LIB_KHTML)
+kcontrol_la_LIBADD  = $(LIB_KDEUI) $(LIB_KUTILS) $(LIB_KHTML) $(LIB_QT) $(LIB_KDECORE) -lDCOP $(LIB_KIO)
 kcontrol_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 rccontroldir = $(kde_datadir)/kcontrol
diff -Nurd kdebase-3.5.10/kcontrol/kded/Makefile.am kdebase-3.5.10-new/kcontrol/kded/Makefile.am
--- kdebase-3.5.10/kcontrol/kded/Makefile.am	2005-09-10 01:25:08.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kded/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_kded_la_SOURCES = kcmkded.cpp
 
 kcm_kded_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kded_la_LIBADD =  $(LIB_KIO)
+kcm_kded_la_LIBADD =  $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 AM_CPPFLAGS= $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/kdm/Makefile.am kdebase-3.5.10-new/kcontrol/kdm/Makefile.am
--- kdebase-3.5.10/kcontrol/kdm/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kdm/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 	kdm-users.cpp kdm-conv.cpp main.cpp kbackedcombobox.cpp
 
 kcm_kdm_la_LDFLAGS  = $(KDE_RPATH) $(all_libraries) -module -avoid-version -no-undefined
-kcm_kdm_la_LIBADD = $(top_builddir)/kcontrol/background/libkcmbgnd.la $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_KIO) $(LIB_KNEWSTUFF)
+kcm_kdm_la_LIBADD = $(top_builddir)/kcontrol/background/libkcmbgnd.la $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_KIO) $(LIB_KNEWSTUFF) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lkdefx -lDCOP
 
 AM_CPPFLAGS= -I$(top_builddir)/kcontrol/background \
           -I$(top_srcdir)/kcontrol/background \
diff -Nurd kdebase-3.5.10/kcontrol/keys/Makefile.am kdebase-3.5.10-new/kcontrol/keys/Makefile.am
--- kdebase-3.5.10/kcontrol/keys/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/keys/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -1,7 +1,7 @@
 kde_module_LTLIBRARIES = kcm_keys.la
 
 kcm_keys_la_SOURCES =  shortcuts.cpp modifiers.cpp main.cpp khotkeys.cpp treeview.cpp commandShortcuts.cpp
-kcm_keys_la_LIBADD   = -lkdeui -lkio
+kcm_keys_la_LIBADD   = -lkdeui -lkio $(LIB_QT) $(LIB_KDECORE)
 kcm_keys_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
 
 AM_CPPFLAGS= $(all_includes)
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/configure.in.in kdebase-3.5.10-new/kcontrol/kfontinst/configure.in.in
--- kdebase-3.5.10/kcontrol/kfontinst/configure.in.in	2006-01-19 09:00:50.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/kfontinst/configure.in.in	2010-05-13 05:26:40.000000000 -0700
@@ -36,11 +36,9 @@
 
     KFI_FOUND_FONTCONFIG=0
     # check for fontconfig...
-    KDE_FIND_PATH(fontconfig-config, FONTCONFIG_CONFIG, [${prefix}/bin ${exec_prefix}/bin /usr/bin /usr/local/bin /opt/local/bin], [
             KDE_FIND_PATH(pkg-config, PKGCONFIG, [${prefix}/bin ${exec_prefix}/bin /usr/bin /usr/local/bin /opt/local/bin], [
                 AC_MSG_WARN([Could not find neither pkg-config nor fontconfig-config, check http://www.fontconfig.org/ ])
             ])
-    ])
 
     if test -n "$PKGCONFIG"; then
         vers=`$PKGCONFIG fontconfig --modversion 2>/dev/null | sed -e 's/libfontconfig //' | awk 'BEGIN { FS = "."; } { printf "%d", ($1 * 1000 + $2) * 1000 + $3;}'`
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/kcmfontinst/Makefile.am kdebase-3.5.10-new/kcontrol/kfontinst/kcmfontinst/Makefile.am
--- kdebase-3.5.10/kcontrol/kfontinst/kcmfontinst/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/kcmfontinst/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -4,10 +4,10 @@
 endif
 
 kde_module_LTLIBRARIES = kcm_fontinst.la
-kcm_fontinst_la_LIBADD  = $(LIB_KIO) $(FONTINST_PRINT_LIB) $(LIBFREETYPE_LIBS) $(LIBFONTCONFIG_LIBS) ../lib/libkfontinst.la
+kcm_fontinst_la_LIBADD  = $(LIBFREETYPE_LIBS) $(LIBFONTCONFIG_LIBS) $(LIB_KIO) $(FONTINST_PRINT_LIB) ../lib/libkfontinst.la
 METASOURCES = AUTO
 kcm_fontinst_la_LDFLAGS = $(KDE_PLUGIN) $(all_libraries) $(KDE_RPATH) -module -avoid-version -no-undefined
-AM_CPPFLAGS = -I$(srcdir)/../lib $(FONTINST_PRINT_INC) -I$(srcdir)/../../fonts $(all_includes) $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS)
+AM_CPPFLAGS = -I$(srcdir)/../lib $(FONTINST_PRINT_INC) -I$(srcdir)/../../fonts $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS) $(all_includes)
  
 xdg_apps_DATA = kcmfontinst.desktop
  
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/kfile-plugin/Makefile.am kdebase-3.5.10-new/kcontrol/kfontinst/kfile-plugin/Makefile.am
--- kdebase-3.5.10/kcontrol/kfontinst/kfile-plugin/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/kfile-plugin/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -1,13 +1,13 @@
 kde_module_LTLIBRARIES = kfile_font.la
 
 kfile_font_la_SOURCES = KFileFont.cpp
-kfile_font_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LIBFREETYPE_RPATH) -module $(KDE_PLUGIN)
-kfile_font_la_LIBADD = $(LIB_KIO) $(LIBFREETYPE_LIBS) ../lib/libkfontinst.la
+kfile_font_la_LDFLAGS = $(LIBFREETYPE_RPATH) $(all_libraries) $(KDE_RPATH) -module $(KDE_PLUGIN)
+kfile_font_la_LIBADD = $(LIBFREETYPE_LIBS) $(LIB_KIO) ../lib/libkfontinst.la
 
 kdelnkdir = $(kde_servicesdir)
 kde_services_DATA = kfile_font.desktop
 
-AM_CPPFLAGS = -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(all_includes) $(LIBFREETYPE_CFLAGS)
+AM_CPPFLAGS = -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(LIBFREETYPE_CFLAGS) $(all_includes)
 
 METASOURCES = AUTO
 noinst_HEADERS = KFileFont.h
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/kfontinst/Main.cpp kdebase-3.5.10-new/kcontrol/kfontinst/kfontinst/Main.cpp
--- kdebase-3.5.10/kcontrol/kfontinst/kfontinst/Main.cpp	2007-05-14 00:55:38.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/kfontinst/Main.cpp	2010-05-13 05:26:40.000000000 -0700
@@ -190,7 +190,7 @@
         KFI::CXConfig::refreshPaths(true);
 }
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
 #ifdef HAVE_GETOPT_H
     static struct option options[]=
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/kfontinst/Makefile.am kdebase-3.5.10-new/kcontrol/kfontinst/kfontinst/Makefile.am
--- kdebase-3.5.10/kcontrol/kfontinst/kfontinst/Makefile.am	2007-05-14 00:55:38.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/kfontinst/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -1,5 +1,8 @@
-bin_PROGRAMS = kfontinst
-kfontinst_SOURCES = \
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kfontinst.la
+
+kfontinst_la_SOURCES = \
 Main.cpp \
 FontEngine.cpp \
 Fontmap.cpp \
@@ -11,6 +14,6 @@
 Fontmap.h \
 XConfig.h
 
-kfontinst_LDADD = ../../fonts/libkxftconfig.la $(LIBFONTCONFIG_LIBS) $(LIBFREETYPE_LIBS) $(LIBZ) $(LIB_KIO) ../lib/libkfontinst.la
-kfontinst_LDFLAGS = $(all_libraries) $(LIBFONTCONFIG_RPATH) $(LIBFREETYPE_RPATH) $(KDE_RPATH)
-AM_CPPFLAGS= -DOS_$(UNAME) -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(all_includes) $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS)
+kfontinst_la_LIBADD = $(LIBFONTCONFIG_LIBS) $(LIBFREETYPE_LIBS) ../../fonts/libkxftconfig.la $(LIBZ) $(LIB_KIO) ../lib/libkfontinst.la
+kfontinst_la_LDFLAGS = $(LIBFONTCONFIG_RPATH) $(LIBFREETYPE_RPATH) $(all_libraries) $(KDE_PLUGIN) -module
+AM_CPPFLAGS= -DOS_$(UNAME) -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS) $(all_includes)
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/kio/Makefile.am kdebase-3.5.10-new/kcontrol/kfontinst/kio/Makefile.am
--- kdebase-3.5.10/kcontrol/kfontinst/kio/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/kio/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -2,9 +2,9 @@
 kio_fonts_la_SOURCES = \
 KioFonts.cpp
 
-kio_fonts_la_LIBADD = ../../fonts/libkxftconfig.la $(LIBFONTCONFIG_LIBS) $(LIBFREETYPE_LIBS) $(LIB_KIO) -lkdesu ../lib/libkfontinst.la
-kio_fonts_la_LDFLAGS = $(KDE_PLUGIN) $(all_libraries) $(KDE_RPATH) $(LIBFONTCONFIG_RPATH) $(LIBFREETYPE_RPATH) -module -avoid-version -no-undefined
-AM_CPPFLAGS= -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(all_includes) $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS) -D_LARGEFILE64_SOURCE
+kio_fonts_la_LIBADD = $(LIBFONTCONFIG_LIBS) $(LIBFREETYPE_LIBS) ../../fonts/libkxftconfig.la $(LIB_KIO) -lkdesu ../lib/libkfontinst.la
+kio_fonts_la_LDFLAGS = $(LIBFONTCONFIG_RPATH) $(LIBFREETYPE_RPATH) $(KDE_PLUGIN) $(all_libraries) $(KDE_RPATH) -module -avoid-version -no-undefined
+AM_CPPFLAGS= -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS) -D_LARGEFILE64_SOURCE $(all_includes)
 
 # The kxftconfig stuf really belongs to kdebase/kcontrol/fonts - here only so that can distribute this as an archive.
 noinst_HEADERS = \
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/lib/FcEngine.h kdebase-3.5.10-new/kcontrol/kfontinst/lib/FcEngine.h
--- kdebase-3.5.10/kcontrol/kfontinst/lib/FcEngine.h	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/lib/FcEngine.h	2010-05-13 05:26:40.000000000 -0700
@@ -5,6 +5,8 @@
 #include "config.h"
 #endif
 
+#define KFI_FC_NO_WIDTHS 1
+
 #include <qstring.h>
 #include <qvaluevector.h>
 #include <qfont.h>
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/lib/Makefile.am kdebase-3.5.10-new/kcontrol/kfontinst/lib/Makefile.am
--- kdebase-3.5.10/kcontrol/kfontinst/lib/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/lib/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -9,6 +9,6 @@
 FcEngine.h \
 KfiConstants.h
 
-libkfontinst_la_LIBADD = $(LIB_KDECORE) $(LIBFONTCONFIG_LIBS) $(LIBFREETYPE_LIBS) $(LIB_KIO) $(LIBXFT_LIB)
-libkfontinst_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LIBFONTCONFIG_RPATH) $(LIBFREETYPE_RPATH) -no-undefined
-AM_CPPFLAGS= $(all_includes) $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS) -D_LARGEFILE64_SOURCE
+libkfontinst_la_LIBADD = $(LIBFONTCONFIG_LIBS) $(LIBFREETYPE_LIBS) $(LIB_KDECORE) $(LIB_KIO) $(LIBXFT_LIB)
+libkfontinst_la_LDFLAGS = $(LIBFONTCONFIG_RPATH) $(LIBFREETYPE_RPATH) $(all_libraries) $(KDE_RPATH) -no-undefined
+AM_CPPFLAGS= $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS) -D_LARGEFILE64_SOURCE $(all_includes)
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/thumbnail/Makefile.am kdebase-3.5.10-new/kcontrol/kfontinst/thumbnail/Makefile.am
--- kdebase-3.5.10/kcontrol/kfontinst/thumbnail/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/thumbnail/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -2,7 +2,7 @@
 
 fontthumbnail_la_SOURCES = FontThumbnail.cpp
 fontthumbnail_la_LIBADD = $(LIBFREETYPE_LIBS) $(LIB_KDECORE) $(LIB_KIO) ../lib/libkfontinst.la
-fontthumbnail_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LIBFREETYPE_RPATH) -module $(KDE_PLUGIN)
+fontthumbnail_la_LDFLAGS = $(KDE_RPATH) $(LIBFREETYPE_RPATH) -module $(KDE_PLUGIN) $(all_libraries)
 METASOURCES = AUTO
 
 noinst_HEADERS = FontThumbnail.h
@@ -11,4 +11,4 @@
 
 kde_services_DATA = fontthumbnail.desktop
 
-AM_CPPFLAGS= -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(all_includes) $(LIBFREETYPE_CFLAGS)
+AM_CPPFLAGS= -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(LIBFREETYPE_CFLAGS) $(all_includes)
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/viewpart/FontViewerApp.cpp kdebase-3.5.10-new/kcontrol/kfontinst/viewpart/FontViewerApp.cpp
--- kdebase-3.5.10/kcontrol/kfontinst/viewpart/FontViewerApp.cpp	2005-10-10 08:03:47.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/viewpart/FontViewerApp.cpp	2010-05-13 05:26:40.000000000 -0700
@@ -116,7 +116,7 @@
                             KAboutData::License_GPL,
                             I18N_NOOP("(c) Craig Drummond, 2004"));
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
     KCmdLineArgs::init(argc, argv, &aboutData);
     KCmdLineArgs::addCmdLineOptions(options);
diff -Nurd kdebase-3.5.10/kcontrol/kfontinst/viewpart/Makefile.am kdebase-3.5.10-new/kcontrol/kfontinst/viewpart/Makefile.am
--- kdebase-3.5.10/kcontrol/kfontinst/viewpart/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kfontinst/viewpart/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -13,18 +13,21 @@
 
 kde_services_DATA = kfontviewpart.desktop
 
-AM_CPPFLAGS = -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(all_includes) $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS)
+AM_CPPFLAGS = -I$(srcdir)/../lib -I$(srcdir)/../../fonts $(LIBFREETYPE_CFLAGS) $(LIBFONTCONFIG_CFLAGS) $(all_includes)
 METASOURCES = AUTO
 
-kfontview_LDADD = $(LIB_KPARTS)
-kfontview_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kfontview_la_LIBADD = $(LIB_KPARTS)
+kfontview_la_LDFLAGS = $(KDE_PLUGIN) -module $(all_libraries)
+
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kfontview.la
 
-bin_PROGRAMS = kfontview
 xdg_apps_DATA = kfontview.desktop
 
 appdata_DATA = kfontviewpart.rc kfontviewui.rc
 appdatadir = $(kde_datadir)/kfontview
 
-kfontview_SOURCES = FontViewerApp.cpp
+kfontview_la_SOURCES = FontViewerApp.cpp
 
 
diff -Nurd kdebase-3.5.10/kcontrol/kicker/Makefile.am kdebase-3.5.10-new/kcontrol/kicker/Makefile.am
--- kdebase-3.5.10/kcontrol/kicker/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kicker/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -7,7 +7,7 @@
                         positionconfig.cpp hidingconfig.cpp menuconfig.cpp lookandfeelconfig.cpp
 
 kcm_kicker_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_kicker_la_LIBADD = $(top_builddir)/kicker/libkicker/libkickermain.la ../background/libbgnd.la $(LIB_KIO) $(LIB_KUTILS)
+kcm_kicker_la_LIBADD = $(top_builddir)/kicker/libkicker/libkickermain.la ../background/libbgnd.la $(LIB_KIO) $(LIB_KUTILS) $(LIB_QT) $(LIB_KDECORE) -lkdefx -lDCOP
 AM_CPPFLAGS = -I$(top_srcdir)/kicker/kicker/core -I$(top_srcdir)/kicker/libkicker \
 	-I$(top_builddir)/kicker/libkicker -I$(srcdir)/../background $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/kio/Makefile.am kdebase-3.5.10-new/kcontrol/kio/Makefile.am
--- kdebase-3.5.10/kcontrol/kio/Makefile.am	2005-09-10 01:25:10.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kio/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -17,7 +17,7 @@
       manualproxy_ui.ui envvarproxy_ui.ui cache_ui.ui
 
 kcm_kio_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-kcm_kio_la_LIBADD = $(LIB_KIO) $(LIB_KUTILS)
+kcm_kio_la_LIBADD = $(LIB_KIO) $(LIB_KUTILS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/kcmkio.pot
diff -Nurd kdebase-3.5.10/kcontrol/knotify/Makefile.am kdebase-3.5.10-new/kcontrol/knotify/Makefile.am
--- kdebase-3.5.10/kcontrol/knotify/Makefile.am	2005-09-10 01:25:04.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/knotify/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 kcm_knotify_la_SOURCES = knotify.cpp playersettings.ui
 
 kcm_knotify_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_knotify_la_LIBADD = $(LIB_KIO)
+kcm_knotify_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 AM_CPPFLAGS = $(all_includes)
  
 METASOURCES = AUTO 
diff -Nurd kdebase-3.5.10/kcontrol/konq/Makefile.am kdebase-3.5.10-new/kcontrol/konq/Makefile.am
--- kdebase-3.5.10/kcontrol/konq/Makefile.am	2005-09-10 01:25:08.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/konq/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -11,7 +11,7 @@
 		desktopbehavior.ui
 
 kcm_konq_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konq_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_KUTILS)
+kcm_konq_la_LIBADD = $(LIB_KIO) $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_KUTILS) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 kcm_konq_la_DATA = overlapping.png onlyone.png
 kcm_konq_ladir = $(kde_datadir)/kcontrol/pics
diff -Nurd kdebase-3.5.10/kcontrol/konqhtml/Makefile.am kdebase-3.5.10-new/kcontrol/konqhtml/Makefile.am
--- kdebase-3.5.10/kcontrol/konqhtml/Makefile.am	2005-09-10 01:25:11.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/konqhtml/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -13,7 +13,7 @@
 			     filteropts.cpp
 
 kcm_konqhtml_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konqhtml_la_LIBADD = -lkhtml -lkdeui
+kcm_konqhtml_la_LIBADD = -lkhtml -lkdeui $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP $(LIB_KIO)
 
 xdg_apps_DATA = khtml_behavior.desktop khtml_java_js.desktop khtml_fonts.desktop khtml_filter.desktop
 
diff -Nurd kdebase-3.5.10/kcontrol/konsole/Makefile.am kdebase-3.5.10-new/kcontrol/konsole/Makefile.am
--- kdebase-3.5.10/kcontrol/konsole/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/konsole/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -4,7 +4,7 @@
 	schemadialog.ui sessiondialog.ui kcmkonsoledialog.ui
 
 kcm_konsole_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_konsole_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_konsole_la_LIBADD = -lkdeui $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP -lkdefx
 AM_CPPFLAGS = $(all_includes) 
 
 METASOURCES = AUTO 
diff -Nurd kdebase-3.5.10/kcontrol/krdb/Makefile.am kdebase-3.5.10-new/kcontrol/krdb/Makefile.am
--- kdebase-3.5.10/kcontrol/krdb/Makefile.am	2005-09-10 01:25:01.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/krdb/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 
 noinst_LTLIBRARIES = libkrdb.la
 libkrdb_la_SOURCES = krdb.cpp
-libkrdb_la_LIBADD = $(LIB_KDECORE)
+libkrdb_la_LIBADD = $(LIB_KDECORE) $(LIB_QT) $(LIB_KDECORE)
 libkrdb_la_LDFLAGS = -no-undefined $(all_libraries) 
 
 messages:
diff -Nurd kdebase-3.5.10/kcontrol/kthememanager/Makefile.am kdebase-3.5.10-new/kcontrol/kthememanager/Makefile.am
--- kdebase-3.5.10/kcontrol/kthememanager/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/kthememanager/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kcm_kthememanager.la
 
 kcm_kthememanager_la_SOURCES = kthemedlg.ui newthemewidget.ui knewthemedlg.cpp ktheme.cpp kthememanager.cpp
-kcm_kthememanager_la_LIBADD = $(LIB_KIO)
+kcm_kthememanager_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP -lkdefx
 kcm_kthememanager_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 noinst_HEADERS = kthememanager.h ktheme.h knewthemedlg.h kthemedlg.ui.h
diff -Nurd kdebase-3.5.10/kcontrol/launch/Makefile.am kdebase-3.5.10-new/kcontrol/launch/Makefile.am
--- kdebase-3.5.10/kcontrol/launch/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/launch/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 AM_CPPFLAGS                      = $(all_includes) 
 kcm_launch_la_SOURCES      = kcmlaunch.cpp
 kcm_launch_la_LDFLAGS      = $(all_libraries) $(KDE_PLUGIN) -module
-kcm_launch_la_LIBADD       = $(LIB_KDEUI)
+kcm_launch_la_LIBADD       = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 METASOURCES  = AUTO
 noinst_HEADERS                = kcmlaunch.h
 xdg_apps_DATA = kcmlaunch.desktop
diff -Nurd kdebase-3.5.10/kcontrol/locale/Makefile.am kdebase-3.5.10-new/kcontrol/locale/Makefile.am
--- kdebase-3.5.10/kcontrol/locale/Makefile.am	2005-09-10 01:25:08.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/locale/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -10,7 +10,7 @@
 noinst_HEADERS = toplevel.h kcmlocale.h klocalesample.h localenum.h localemon.h localetime.h localeother.h 
 
 kcm_locale_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_locale_la_LIBADD = $(LIB_KIO)
+kcm_locale_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 # Note: newer glibc (e.g. zonetab version 1.31 (cvs revision 1.22) have more/other data than older ones (e.g. zonetab version 1.28)
 
diff -Nurd kdebase-3.5.10/kcontrol/nics/Makefile.am kdebase-3.5.10-new/kcontrol/nics/Makefile.am
--- kdebase-3.5.10/kcontrol/nics/Makefile.am	2005-09-10 01:25:05.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/nics/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_nic_la_SOURCES = nic.cpp
 
 kcm_nic_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_nic_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSOCKET)
+kcm_nic_la_LIBADD = -lkdeui $(LIB_KIO) $(LIBSOCKET) $(LIB_QT) $(LIB_KDECORE)
 
 AM_CPPFLAGS= $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/performance/Makefile.am kdebase-3.5.10-new/kcontrol/performance/Makefile.am
--- kdebase-3.5.10/kcontrol/performance/Makefile.am	2005-09-10 01:25:11.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/performance/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -2,7 +2,7 @@
 
 kcm_performance_la_SOURCES = kcmperformance.cpp konqueror.cpp konqueror_ui.ui system.cpp system_ui.ui
 kcm_performance_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_performance_la_LIBADD = -lkdeui
+kcm_performance_la_LIBADD = -lkdeui $(LIB_QT) $(LIB_KDECORE) -lDCOP
 AM_CPPFLAGS= $(all_includes) 
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kcontrol/privacy/Makefile.am kdebase-3.5.10-new/kcontrol/privacy/Makefile.am
--- kdebase-3.5.10/kcontrol/privacy/Makefile.am	2005-09-10 01:25:09.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/privacy/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -4,7 +4,7 @@
 kcm_privacy_la_SOURCES = privacy.cpp kprivacysettings.ui kcmprivacydialog.ui kprivacymanager.cpp
 
 kcm_privacy_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_privacy_la_LIBADD = $(LIB_KDEUI) -lkio
+kcm_privacy_la_LIBADD = $(LIB_KDEUI) -lkio $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kcontrol/randr/Makefile.am kdebase-3.5.10-new/kcontrol/randr/Makefile.am
--- kdebase-3.5.10/kcontrol/randr/Makefile.am	2006-03-17 02:17:17.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/randr/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -10,7 +10,7 @@
 
 kcm_randr_la_SOURCES = krandrmodule.cpp
 kcm_randr_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_randr_la_LIBADD = librandrinternal.la $(LIB_KDEUI) $(LIB_XRANDR)
+kcm_randr_la_LIBADD = librandrinternal.la $(LIB_KDEUI) $(LIB_XRANDR) $(LIB_QT) $(LIB_KDECORE)
 
 noinst_HEADERS = randr.h krandrmodule.h krandrtray.h krandrapp.h ktimerdialog.h \
     krandrpassivepopup.h
@@ -30,7 +30,7 @@
 
 krandrtray_SOURCES = main.cpp krandrtray.cpp krandrapp.cpp krandrpassivepopup.cpp
 krandrtray_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-krandrtray_LDADD = librandrinternal.la $(LIB_KFILE) $(LIB_KUTILS) $(LIB_XRANDR)
+krandrtray_LDADD = librandrinternal.la $(LIB_KFILE) $(LIB_KUTILS) $(LIB_XRANDR) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp -o $(podir)/krandr.pot
diff -Nurd kdebase-3.5.10/kcontrol/samba/Makefile.am kdebase-3.5.10-new/kcontrol/samba/Makefile.am
--- kdebase-3.5.10/kcontrol/samba/Makefile.am	2005-09-10 01:25:10.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/samba/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_samba_la_SOURCES = main.cpp ksmbstatus.cpp kcmsambaimports.cpp kcmsambalog.cpp kcmsambastatistics.cpp
 
 kcm_samba_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_samba_la_LIBADD = $(LIB_KIO)
+kcm_samba_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 AM_CPPFLAGS = $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/screensaver/Makefile.am kdebase-3.5.10-new/kcontrol/screensaver/Makefile.am
--- kdebase-3.5.10/kcontrol/screensaver/Makefile.am	2005-09-10 01:25:10.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/screensaver/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -6,7 +6,7 @@
 kcm_screensaver_la_SOURCES = advanceddialogimpl.ui scrnsave.cpp testwin.cpp saverlist.cpp \
         saverconfig.cpp advanceddialog.cpp kswidget.cpp
 kcm_screensaver_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_screensaver_la_LIBADD = $(LIB_KSYCOCA) $(DPMSLIB) $(GLLIB)
+kcm_screensaver_la_LIBADD = $(LIB_KSYCOCA) $(DPMSLIB) $(GLLIB) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 METASOURCES = AUTO
 
 noinst_HEADERS = scrnsave.h
diff -Nurd kdebase-3.5.10/kcontrol/smartcard/Makefile.am kdebase-3.5.10-new/kcontrol/smartcard/Makefile.am
--- kdebase-3.5.10/kcontrol/smartcard/Makefile.am	2005-09-10 01:25:00.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/smartcard/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -5,7 +5,7 @@
 
 kcm_smartcard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
 
-kcm_smartcard_la_LIBADD = -lkdeui -lksmartcard $(LIB_KIO)
+kcm_smartcard_la_LIBADD = -lkdeui -lksmartcard $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kcontrol/smserver/Makefile.am kdebase-3.5.10-new/kcontrol/smserver/Makefile.am
--- kdebase-3.5.10/kcontrol/smserver/Makefile.am	2005-09-10 01:25:08.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/smserver/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -2,7 +2,7 @@
 
 kcm_smserver_la_SOURCES = kcmsmserver.cpp smserverconfigdlg.ui smserverconfigimpl.cpp
 kcm_smserver_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_smserver_la_LIBADD = -lkdeui
+kcm_smserver_la_LIBADD = -lkdeui $(LIB_QT) $(LIB_KDECORE) -lDCOP
 AM_CPPFLAGS= $(all_includes) 
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kcontrol/spellchecking/Makefile.am kdebase-3.5.10-new/kcontrol/spellchecking/Makefile.am
--- kdebase-3.5.10/kcontrol/spellchecking/Makefile.am	2005-09-10 01:25:12.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/spellchecking/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_spellchecking_la_SOURCES = spellchecking.cpp
 
 kcm_spellchecking_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_spellchecking_la_LIBADD = -lkdeui
+kcm_spellchecking_la_LIBADD = -lkdeui $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 AM_CPPFLAGS= $(all_includes)
 
diff -Nurd kdebase-3.5.10/kcontrol/style/Makefile.am kdebase-3.5.10-new/kcontrol/style/Makefile.am
--- kdebase-3.5.10/kcontrol/style/Makefile.am	2006-03-17 02:17:17.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/style/Makefile.am	2010-05-13 05:26:40.000000000 -0700
@@ -6,7 +6,7 @@
 
 kcm_style_la_SOURCES = kcmstyle.cpp stylepreview.ui menupreview.cpp styleconfdialog.cpp
 kcm_style_la_LDFLAGS = $(KDE_RPATH) -module -avoid-version $(all_libraries) -no-undefined
-kcm_style_la_LIBADD = $(LIB_KIO) ../krdb/libkrdb.la
+kcm_style_la_LIBADD = $(LIB_KIO) ../krdb/libkrdb.la $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP -lkdefx
 METASOURCES = AUTO 
 
 noinst_HEADERS = kcmstyle.h stylepreview.h menupreview.h
diff -Nurd kdebase-3.5.10/kcontrol/style/keramik/Makefile.am kdebase-3.5.10-new/kcontrol/style/keramik/Makefile.am
--- kdebase-3.5.10/kcontrol/style/keramik/Makefile.am	2005-09-10 01:25:11.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/style/keramik/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 noinst_HEADERS = keramikconf.h
 kde_module_LTLIBRARIES = kstyle_keramik_config.la
 kstyle_keramik_config_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kstyle_keramik_config_la_LIBADD  = $(LIB_KDEUI)
+kstyle_keramik_config_la_LIBADD  = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 kstyle_keramik_config_la_SOURCES = keramikconf.cpp
 METASOURCES = AUTO 
 
diff -Nurd kdebase-3.5.10/kcontrol/taskbar/Makefile.am kdebase-3.5.10-new/kcontrol/taskbar/Makefile.am
--- kdebase-3.5.10/kcontrol/taskbar/Makefile.am	2005-09-10 01:25:04.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/taskbar/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -2,7 +2,7 @@
 
 kcm_taskbar_la_SOURCES = kcmtaskbarui.ui kcmtaskbar.cpp
 kcm_taskbar_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_taskbar_la_LIBADD = $(top_builddir)/kicker/taskbar/libtaskbar.la -lkdeui
+kcm_taskbar_la_LIBADD = $(top_builddir)/kicker/taskbar/libtaskbar.la -lkdeui $(LIB_QT) $(LIB_KDECORE)
 AM_CPPFLAGS = -I$(top_builddir)/kicker/taskbar $(all_includes) 
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kcontrol/usbview/Makefile.am kdebase-3.5.10-new/kcontrol/usbview/Makefile.am
--- kdebase-3.5.10/kcontrol/usbview/Makefile.am	2006-01-19 09:00:37.000000000 -0800
+++ kdebase-3.5.10-new/kcontrol/usbview/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_usb_la_SOURCES = kcmusb.cpp usbdevices.cpp usbdb.cpp
 
 kcm_usb_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_usb_la_LIBADD = $(LIB_KDEUI)
+kcm_usb_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 AM_CPPFLAGS= $(all_includes) 
 
diff -Nurd kdebase-3.5.10/kcontrol/view1394/Makefile.am kdebase-3.5.10-new/kcontrol/view1394/Makefile.am
--- kdebase-3.5.10/kcontrol/view1394/Makefile.am	2005-09-10 01:25:11.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/view1394/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_view1394_la_SOURCES = view1394widget.ui view1394.cpp
 
 kcm_view1394_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_view1394_la_LIBADD = $(LIB_KDEUI) -lraw1394
+kcm_view1394_la_LIBADD = $(LIB_KDEUI) -lraw1394 $(LIB_QT) $(LIB_KDECORE)
 
 AM_CPPFLAGS= $(all_includes) 
 
diff -Nurd kdebase-3.5.10/kcontrol/xinerama/Makefile.am kdebase-3.5.10-new/kcontrol/xinerama/Makefile.am
--- kdebase-3.5.10/kcontrol/xinerama/Makefile.am	2005-09-10 01:25:11.000000000 -0700
+++ kdebase-3.5.10-new/kcontrol/xinerama/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 kcm_xinerama_la_SOURCES = kcmxinerama.cpp xineramawidget.ui
 
 kcm_xinerama_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_xinerama_la_LIBADD = -lkdeui
+kcm_xinerama_la_LIBADD = -lkdeui $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 METASOURCES = AUTO 
 
diff -Nurd kdebase-3.5.10/kdcop/Makefile.am kdebase-3.5.10-new/kdcop/Makefile.am
--- kdebase-3.5.10/kdcop/Makefile.am	2005-09-10 01:25:53.000000000 -0700
+++ kdebase-3.5.10-new/kdcop/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,10 +7,13 @@
 
 INCLUDES = $(all_includes)
 
-bin_PROGRAMS = kdcop
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kdcop.la
 
-kdcop_SOURCES = kdcop.cpp kdcopwindow.cpp kdcoplistview.cpp kdcopview.ui
-kdcop_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_KIO) -lDCOP $(LIB_QT)
+kdcop_la_SOURCES = kdcop.cpp kdcopwindow.cpp kdcoplistview.cpp kdcopview.ui
+kdcop_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kdcop_la_LIBADD  = $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_KIO) -lDCOP $(LIB_QT)
 
 noinst_HEADERS = kdcopwindow.h
 METASOURCES =	AUTO
diff -Nurd kdebase-3.5.10/kdcop/kdcop.cpp kdebase-3.5.10-new/kdcop/kdcop.cpp
--- kdebase-3.5.10/kdcop/kdcop.cpp	2005-09-10 01:25:53.000000000 -0700
+++ kdebase-3.5.10-new/kdcop/kdcop.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -15,7 +15,7 @@
     KCmdLineLastOption
 };
 
-int main( int argc, char ** argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char ** argv )
 {
   KAboutData aboutData( "kdcop", I18N_NOOP("KDCOP"),
 			"0.1", I18N_NOOP( "A graphical DCOP browser/client" ),
diff -Nurd kdebase-3.5.10/kdebugdialog/Makefile.am kdebase-3.5.10-new/kdebugdialog/Makefile.am
--- kdebase-3.5.10/kdebugdialog/Makefile.am	2005-09-10 01:24:57.000000000 -0700
+++ kdebase-3.5.10-new/kdebugdialog/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,12 +4,14 @@
 
 ####### Files
 
-bin_PROGRAMS = kdebugdialog
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kdebugdialog.la
 
-kdebugdialog_SOURCES = main.cpp kabstractdebugdialog.cpp kdebugdialog.cpp klistdebugdialog.cpp
-kdebugdialog_METASOURCES = AUTO
-kdebugdialog_LDFLAGS =       $(all_libraries) $(KDE_RPATH)
-kdebugdialog_LDADD   =       $(LIB_KDEUI)
+kdebugdialog_la_SOURCES = main.cpp kabstractdebugdialog.cpp kdebugdialog.cpp klistdebugdialog.cpp
+kdebugdialog_la_METASOURCES = AUTO
+kdebugdialog_la_LDFLAGS =       $(all_libraries) $(KDE_PLUGIN) -module
+kdebugdialog_la_LIBADD   =       $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 messages:
 	$(XGETTEXT) *.cpp -o $(podir)/kdebugdialog.pot	
diff -Nurd kdebase-3.5.10/kdebugdialog/main.cpp kdebase-3.5.10-new/kdebugdialog/main.cpp
--- kdebase-3.5.10/kdebugdialog/main.cpp	2005-10-10 08:03:40.000000000 -0700
+++ kdebase-3.5.10-new/kdebugdialog/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -75,7 +75,7 @@
   KCmdLineLastOption
 };
 
-int main(int argc, char ** argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char ** argv)
 {
   KAboutData data( "kdebugdialog", I18N_NOOP( "KDebugDialog"),
     "1.0", I18N_NOOP("A dialog box for setting preferences for debug output"),
diff -Nurd kdebase-3.5.10/kdepasswd/Makefile.am kdebase-3.5.10-new/kdepasswd/Makefile.am
--- kdebase-3.5.10/kdepasswd/Makefile.am	2005-09-10 01:24:59.000000000 -0700
+++ kdebase-3.5.10-new/kdepasswd/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,10 +1,13 @@
 
 SUBDIRS = kcm
 
-bin_PROGRAMS = kdepasswd
-kdepasswd_SOURCES = kdepasswd.cpp passwd.cpp passwddlg.cpp
-kdepasswd_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kdepasswd_LDADD = $(LIB_KIO)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kdepasswd.la
+
+kdepasswd_la_SOURCES = kdepasswd.cpp passwd.cpp passwddlg.cpp
+kdepasswd_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kdepasswd_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KIO) $(LIB_KDEUI) -lkdesu
 
 METASOURCES =  AUTO
 AM_CPPFLAGS= -I$(top_srcdir)/libkonq $(all_includes)
diff -Nurd kdebase-3.5.10/kdepasswd/kcm/Makefile.am kdebase-3.5.10-new/kdepasswd/kcm/Makefile.am
--- kdebase-3.5.10/kdepasswd/kcm/Makefile.am	2005-09-10 01:24:59.000000000 -0700
+++ kdebase-3.5.10-new/kdepasswd/kcm/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 kcm_useraccount_la_SOURCES = main_widget.ui chfnprocess.cpp \
 			     main.cpp chfacedlg.cpp settings.kcfgc pass.kcfgc
 kcm_useraccount_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_useraccount_la_LIBADD = $(top_builddir)/libkonq/libkonq.la
+kcm_useraccount_la_LIBADD = $(top_builddir)/libkonq/libkonq.la -lkdesu
 
 AM_CPPFLAGS = -I$(top_srcdir)/libkonq $(all_includes)
 
diff -Nurd kdebase-3.5.10/kdepasswd/kdepasswd.cpp kdebase-3.5.10-new/kdepasswd/kdepasswd.cpp
--- kdebase-3.5.10/kdepasswd/kdepasswd.cpp	2005-09-10 01:24:59.000000000 -0700
+++ kdebase-3.5.10-new/kdepasswd/kdepasswd.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -26,7 +26,7 @@
 };
 
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
     KAboutData aboutData("kdepasswd", I18N_NOOP("KDE passwd"),
             VERSION, I18N_NOOP("Changes a UNIX password."),
diff -Nurd kdebase-3.5.10/kdeprint/kdeprint_part/Makefile.am kdebase-3.5.10-new/kdeprint/kdeprint_part/Makefile.am
--- kdebase-3.5.10/kdeprint/kdeprint_part/Makefile.am	2005-09-10 01:25:38.000000000 -0700
+++ kdebase-3.5.10-new/kdeprint/kdeprint_part/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 libkdeprint_part_la_SOURCES = printpart.cpp
 libkdeprint_part_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-libkdeprint_part_la_LIBADD = -lkdeprint_management $(LIB_KPARTS)
+libkdeprint_part_la_LIBADD = -lkdeprint_management $(LIB_KPARTS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 noinst_HEADERS = printpart.h
 
diff -Nurd kdebase-3.5.10/kdeprint/kdeprintfax/Makefile.am kdebase-3.5.10-new/kdeprint/kdeprintfax/Makefile.am
--- kdebase-3.5.10/kdeprint/kdeprintfax/Makefile.am	2005-09-10 01:25:38.000000000 -0700
+++ kdebase-3.5.10-new/kdeprint/kdeprintfax/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,11 +1,14 @@
 INCLUDES= $(all_includes)
 
-bin_PROGRAMS = kdeprintfax
-kdeprintfax_SOURCES = main.cpp kdeprintfax.cpp faxab.cpp faxctrl.cpp confgeneral.cpp configdlg.cpp \
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kdeprintfax.la
+
+kdeprintfax_la_SOURCES = main.cpp kdeprintfax.cpp faxab.cpp faxctrl.cpp confgeneral.cpp configdlg.cpp \
 		      conffax.cpp confsystem.cpp conffilters.cpp filterdlg.cpp defcmds.cpp
-kdeprintfax_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kdeprintfax_LDADD   = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDEPRINT) -lkabc
-kdeprintfax_METASOURCES = AUTO
+kdeprintfax_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kdeprintfax_la_LIBADD  = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDEPRINT) -lkabc $(LIB_QT) $(LIB_KDECORE)
+kdeprintfax_la_METASOURCES = AUTO
 
 xdg_apps_DATA = kdeprintfax.desktop
 
diff -Nurd kdebase-3.5.10/kdeprint/kdeprintfax/main.cpp kdebase-3.5.10-new/kdeprint/kdeprintfax/main.cpp
--- kdebase-3.5.10/kdeprint/kdeprintfax/main.cpp	2005-10-10 08:04:02.000000000 -0700
+++ kdebase-3.5.10-new/kdeprint/kdeprintfax/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -44,7 +44,7 @@
   // INSERT YOUR COMMANDLINE OPTIONS HERE
 };
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
 
   KAboutData aboutData( "kdeprintfax", I18N_NOOP("KdeprintFax"),
diff -Nurd kdebase-3.5.10/kdeprint/kjobviewer/Makefile.am kdebase-3.5.10-new/kdeprint/kjobviewer/Makefile.am
--- kdebase-3.5.10/kdeprint/kjobviewer/Makefile.am	2005-09-10 01:25:38.000000000 -0700
+++ kdebase-3.5.10-new/kdeprint/kjobviewer/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 
 kjobviewer_la_SOURCES = kjobviewer.cpp main.cpp
 kjobviewer_la_METASOURCES = AUTO
-kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI)
+kjobviewer_la_LIBADD = -lkdeprint_management $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lkdeprint -lDCOP
 kjobviewer_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
 
 noinst_HEADERS = kjobviewer.h
diff -Nurd kdebase-3.5.10/kdeprint/kprinter/Makefile.am kdebase-3.5.10-new/kdeprint/kprinter/Makefile.am
--- kdebase-3.5.10/kdeprint/kprinter/Makefile.am	2005-09-10 01:25:39.000000000 -0700
+++ kdebase-3.5.10-new/kdeprint/kprinter/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,7 +7,7 @@
 kdeinit_LTLIBRARIES = kprinter.la
 
 kprinter_la_SOURCES = main.cpp printwrapper.cpp
-kprinter_la_LIBADD = -lkdeprint
+kprinter_la_LIBADD = -lkdeprint $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO)
 kprinter_la_LDFLAGS = -module -avoid-version $(all_libraries) $(KDE_RPATH)
 kprinter_la_METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kdeprint/kprinter/printwrapper.cpp kdebase-3.5.10-new/kdeprint/kprinter/printwrapper.cpp
--- kdebase-3.5.10/kdeprint/kprinter/printwrapper.cpp	2007-01-15 03:32:07.000000000 -0800
+++ kdebase-3.5.10-new/kdeprint/kprinter/printwrapper.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -137,10 +137,6 @@
 {
 	KCmdLineArgs	*args = KCmdLineArgs::parsedArgs();
 
-#if defined(HAVE_SIGACTION) && !defined(HAVE_SIGSET)
-	struct sigaction action;
-#endif /* HAVE_SIGACTION && !HAVE_SIGSET*/
-
 	// read variables from command line
 	QString	printer = args->getOption("d");
 	QString	title = args->getOption("t");
@@ -325,6 +321,10 @@
 
 		// print from stdin
 
+#if defined(HAVE_SIGACTION) && !defined(HAVE_SIGSET)
+	struct sigaction action;
+#endif /* HAVE_SIGACTION && !HAVE_SIGSET*/
+
 #  if defined(HAVE_SIGSET)
 		sigset(SIGHUP, signal_handler);
 		sigset(SIGINT, signal_handler);
diff -Nurd kdebase-3.5.10/kdeprint/printmgr/Makefile.am kdebase-3.5.10-new/kdeprint/printmgr/Makefile.am
--- kdebase-3.5.10/kdeprint/printmgr/Makefile.am	2006-05-22 11:12:45.000000000 -0700
+++ kdebase-3.5.10-new/kdeprint/printmgr/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,7 +6,7 @@
 
 kcm_printmgr_la_SOURCES = kcmprintmgr.cpp
 kcm_printmgr_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_printmgr_la_LIBADD = -lkdeprint_management
+kcm_printmgr_la_LIBADD = -lkdeprint_management $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 noinst_HEADERS = kcmprintmgr.h
 
diff -Nurd kdebase-3.5.10/kdeprint/slave/Makefile.am kdebase-3.5.10-new/kdeprint/slave/Makefile.am
--- kdebase-3.5.10/kdeprint/slave/Makefile.am	2005-09-10 01:25:39.000000000 -0700
+++ kdebase-3.5.10-new/kdeprint/slave/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,7 +7,7 @@
 kde_module_LTLIBRARIES = kio_print.la
 
 kio_print_la_SOURCES = kio_print.cpp
-kio_print_la_LIBADD = $(LIB_KIO) -lkdeprint
+kio_print_la_LIBADD = $(LIB_KIO) -lkdeprint $(LIB_QT) $(LIB_KDECORE)
 kio_print_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kdesktop/Makefile.am kdebase-3.5.10-new/kdesktop/Makefile.am
--- kdebase-3.5.10/kdesktop/Makefile.am	2006-05-22 11:12:51.000000000 -0700
+++ kdebase-3.5.10-new/kdesktop/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -2,15 +2,15 @@
 
 INCLUDES = -I$(top_srcdir)/kcontrol/background -I$(top_srcdir)/libkonq -I$(top_srcdir)/kdmlib $(all_includes)
 kdesktop_la_LDFLAGS  = $(all_libraries) -module $(KDE_PLUGIN)
-kdesktop_la_LIBADD   = libkdesktopsettings.la $(top_builddir)/libkonq/libkonq.la $(top_builddir)/kcontrol/background/libbgnd.la $(top_builddir)/kdmlib/libdmctl.la $(LIB_XSS) $(LIB_KUTILS) $(LIB_XCURSOR)
+kdesktop_la_LIBADD   = libkdesktopsettings.la $(top_builddir)/libkonq/libkonq.la $(top_builddir)/kcontrol/background/libbgnd.la $(top_builddir)/kdmlib/libdmctl.la $(LIB_XSS) $(LIB_KUTILS) $(LIB_XCURSOR) -lkdesu
 
 SUBDIRS = . lock pics patterns programs init kwebdesktop
 
 ####### Files
 
-bin_PROGRAMS = kcheckrunning
+bin_PROGRAMS = 
 lib_LTLIBRARIES =
-kdeinit_LTLIBRARIES = kdesktop.la
+kdeinit_LTLIBRARIES = kdesktop.la kcheckrunning.la
 noinst_LTLIBRARIES = libkdesktopsettings.la
 
 libkdesktopsettings_la_LDFLAGS = $(all_libraries) -no-undefined
@@ -31,9 +31,9 @@
 	xautolock.h lockeng.h init.h minicli.h \
 	pixmapserver.h startupid.h xautolock_c.h
 
-kcheckrunning_SOURCES = kcheckrunning.cpp
-kcheckrunning_LDFLAGS = $(all_libraries)
-kcheckrunning_LDADD = $(LIB_X11)
+kcheckrunning_la_SOURCES = kcheckrunning.cpp
+kcheckrunning_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kcheckrunning_la_LIBADD = $(LIB_X11)
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kdesktop/kcheckrunning.cpp kdebase-3.5.10-new/kdesktop/kcheckrunning.cpp
--- kdebase-3.5.10/kdesktop/kcheckrunning.cpp	2005-10-10 08:04:11.000000000 -0700
+++ kdebase-3.5.10-new/kdesktop/kcheckrunning.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -18,8 +18,9 @@
 */
 
 #include <X11/Xlib.h>
+#include <kdemacros.h>
 
-int main()
+extern "C" KDE_EXPORT int kdemain()
     {
     Display* dpy = XOpenDisplay( NULL );
     if( dpy == NULL )
diff -Nurd kdebase-3.5.10/kdesktop/kwebdesktop/Makefile.am kdebase-3.5.10-new/kdesktop/kwebdesktop/Makefile.am
--- kdebase-3.5.10/kdesktop/kwebdesktop/Makefile.am	2005-09-10 01:25:45.000000000 -0700
+++ kdebase-3.5.10-new/kdesktop/kwebdesktop/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -2,12 +2,15 @@
 INCLUDES= $(all_includes)
 LDADD = $(LIB_KHTML)
 
-bin_PROGRAMS = 	kwebdesktop
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kwebdesktop.la
 
 METASOURCES = AUTO
 
-kwebdesktop_SOURCES = kwebdesktop.cpp kwebdesktopsettings.kcfgc 
-kwebdesktop_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kwebdesktop_la_SOURCES = kwebdesktop.cpp kwebdesktopsettings.kcfgc 
+kwebdesktop_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kwebdesktop_la_LIBADD  = $(LIB_KHTML) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO) $(LIB_KPARTS)
 
 kdesktop_kwebdesktop_data_DATA = kwebdesktop.desktop
 kdesktop_kwebdesktop_datadir = $(kde_datadir)/kdesktop/programs
diff -Nurd kdebase-3.5.10/kdesktop/kwebdesktop/kwebdesktop.cpp kdebase-3.5.10-new/kdesktop/kwebdesktop/kwebdesktop.cpp
--- kdebase-3.5.10/kdesktop/kwebdesktop/kwebdesktop.cpp	2007-01-15 03:32:10.000000000 -0800
+++ kdebase-3.5.10-new/kdesktop/kwebdesktop/kwebdesktop.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -84,7 +84,7 @@
 }
 
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
     KAboutData data( "kwebdesktop", I18N_NOOP("KDE Web Desktop"),
                      VERSION,
diff -Nurd kdebase-3.5.10/kdesktop/lock/Makefile.am kdebase-3.5.10-new/kdesktop/lock/Makefile.am
--- kdebase-3.5.10/kdesktop/lock/Makefile.am	2005-09-10 01:25:41.000000000 -0700
+++ kdebase-3.5.10-new/kdesktop/lock/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,14 +1,16 @@
 ## Makefile.am of kdebase/kdesktop/lock
 
 INCLUDES = -I.. -I$(top_srcdir)/kcheckpass -I$(top_srcdir)/kdmlib $(GLINC) $(all_includes)
-kdesktop_lock_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
-kdesktop_lock_LDADD    = ../libkdesktopsettings.la ../../kdmlib/libdmctl.la $(LIB_KIO) $(LIB_XF86MISC) $(GLLIB)
+kdesktop_lock_la_LDFLAGS  = $(all_libraries) $(KDE_RPATH) -module -avoid-version
+kdesktop_lock_la_LIBADD    = ../libkdesktopsettings.la ../../kdmlib/libdmctl.la $(LIB_KIO) $(LIB_XF86MISC) $(GLLIB) $(LIB_KDEUI) $(LIB_QT) -lDCOP
 
 ####### Files
 
-bin_PROGRAMS = kdesktop_lock
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kdesktop_lock.la
 
-kdesktop_lock_SOURCES = lockprocess.cc lockdlg.cc autologout.cc main.cc
+kdesktop_lock_la_SOURCES = lockprocess.cc lockdlg.cc autologout.cc main.cc
 
 noinst_HEADERS = lockprocess.h lockdlg.h autologout.h main.h
 
diff -Nurd kdebase-3.5.10/kdesktop/lock/main.cc kdebase-3.5.10-new/kdesktop/lock/main.cc
--- kdebase-3.5.10/kdesktop/lock/main.cc	2006-03-17 02:17:37.000000000 -0800
+++ kdebase-3.5.10-new/kdesktop/lock/main.cc	2010-05-13 05:26:41.000000000 -0700
@@ -59,7 +59,7 @@
 
 // -----------------------------------------------------------------------------
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
     KLocale::setMainCatalogue("kdesktop");
 
diff -Nurd kdebase-3.5.10/kdesu/kdesu/Makefile.am kdebase-3.5.10-new/kdesu/kdesu/Makefile.am
--- kdebase-3.5.10/kdesu/kdesu/Makefile.am	2005-09-10 01:26:14.000000000 -0700
+++ kdebase-3.5.10-new/kdesu/kdesu/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,11 +3,14 @@
 INCLUDES= $(all_includes)
 
 ## kdesu
-bin_PROGRAMS = 	kdesu
-kdesu_SOURCES = kdesu.cpp sudlg.cpp
-kdesu_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kdesu_LDADD   = $(LIB_KIO) -lkdesu
-kdesu_METASOURCES =  AUTO
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kdesu.la
+
+kdesu_la_SOURCES = kdesu.cpp sudlg.cpp
+kdesu_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kdesu_la_LIBADD  = $(LIB_KIO) -lkdesu $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
+kdesu_la_METASOURCES =  AUTO
 noinst_HEADERS = sudlg.h
 
 ## Messages
diff -Nurd kdebase-3.5.10/kdesu/kdesu/kdesu.cpp kdebase-3.5.10-new/kdesu/kdesu/kdesu.cpp
--- kdebase-3.5.10/kdesu/kdesu/kdesu.cpp	2008-02-13 01:40:49.000000000 -0800
+++ kdebase-3.5.10-new/kdesu/kdesu/kdesu.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -86,7 +86,7 @@
 
 static int startApp();
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
     // FIXME: this can be considered a poor man's solution, as it's not
     // directly obvious to a gui user. :)
diff -Nurd kdebase-3.5.10/kdesu/kdesud/Makefile.am kdebase-3.5.10-new/kdesu/kdesud/Makefile.am
--- kdebase-3.5.10/kdesu/kdesud/Makefile.am	2005-09-10 01:26:13.000000000 -0700
+++ kdebase-3.5.10-new/kdesu/kdesud/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,10 +4,13 @@
 
 KDE_CXXFLAGS = $(KDE_USE_FPIE)
 
-bin_PROGRAMS = kdesud
-kdesud_SOURCES = kdesud.cpp repo.cpp lexer.cpp handler.cpp secure.cpp 
-kdesud_LDFLAGS = $(KDE_USE_PIE) $(all_libraries) $(KDE_RPATH)
-kdesud_LDADD = $(LIB_KDECORE) -lkdesu $(LIBSOCKET)
+bin_PROGRAMS = 
+lib_LTLIBRARIES = 
+kdeinit_LTLIBRARIES = kdesud.la
+
+kdesud_la_SOURCES = kdesud.cpp repo.cpp lexer.cpp handler.cpp secure.cpp 
+kdesud_la_LDFLAGS = $(KDE_USE_PIE) $(all_libraries) $(KDE_PLUGIN) -module
+kdesud_la_LIBADD = $(LIB_KDECORE) -lkdesu $(LIBSOCKET) $(LIB_QT)
 noinst_HEADERS = repo.h handler.h lexer.h secure.h
 
 ## kdesud needs to be suid or sgid something
diff -Nurd kdebase-3.5.10/kdesu/kdesud/kdesud.cpp kdebase-3.5.10-new/kdesu/kdesud/kdesud.cpp
--- kdebase-3.5.10/kdesu/kdesud/kdesud.cpp	2007-05-14 00:55:53.000000000 -0700
+++ kdebase-3.5.10-new/kdesu/kdesud/kdesud.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -246,7 +246,7 @@
  * Main program
  */
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
     KAboutData aboutData("kdesud", I18N_NOOP("KDE su daemon"),
             Version, I18N_NOOP("Daemon used by kdesu"),
diff -Nurd kdebase-3.5.10/kdialog/Makefile.am kdebase-3.5.10-new/kdialog/Makefile.am
--- kdebase-3.5.10/kdialog/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kdialog/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,11 +1,13 @@
 KDE_CXXFLAGS = -DQT_NO_CAST_ASCII -DQT_NO_ASCII_CAST
 INCLUDES = $(all_includes)
 
-bin_PROGRAMS = kdialog
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kdialog.la
 
-kdialog_SOURCES = kdialog.cpp widgets.cpp klistboxdialog.cpp progressdialog.cpp progressdialogiface.skel
-kdialog_LDADD = $(LIB_KIO)
-kdialog_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kdialog_la_SOURCES = kdialog.cpp widgets.cpp klistboxdialog.cpp progressdialog.cpp progressdialogiface.skel
+kdialog_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
+kdialog_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kdialog/kdialog.cpp kdebase-3.5.10-new/kdialog/kdialog.cpp
--- kdebase-3.5.10/kdialog/kdialog.cpp	2006-05-22 11:12:42.000000000 -0700
+++ kdebase-3.5.10-new/kdialog/kdialog.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -660,7 +660,7 @@
 }
 
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
   KAboutData aboutData( "kdialog", I18N_NOOP("KDialog"),
                         "1.0", I18N_NOOP( "KDialog can be used to show nice dialog boxes from shell scripts" ),
diff -Nurd kdebase-3.5.10/kdm/kfrontend/Makefile.am kdebase-3.5.10-new/kdm/kfrontend/Makefile.am
--- kdebase-3.5.10/kdm/kfrontend/Makefile.am	2006-10-01 10:32:15.000000000 -0700
+++ kdebase-3.5.10-new/kdm/kfrontend/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -24,11 +24,11 @@
     kgreeter.cpp \
     kgapp.cpp
 kdm_greet_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kdm_greet_LDADD = themer/libkdmthemer.a $(LIB_KDEUI) $(XTESTLIB) $(LIBPOSIX4)
+kdm_greet_LDADD = themer/libkdmthemer.a $(LIB_KDEUI) $(XTESTLIB) $(LIBPOSIX4) $(LIB_QT) $(LIB_KDECORE) -lkdefx
 
 krootimage_SOURCES = krootimage.cpp
 krootimage_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-krootimage_LDADD = $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_KIO)
+krootimage_LDADD = $(top_builddir)/kcontrol/background/libbgnd.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lkdefx -lDCOP $(LIB_KDEUI)
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kdm/kfrontend/kdm_greet.c kdebase-3.5.10-new/kdm/kfrontend/kdm_greet.c
--- kdebase-3.5.10/kdm/kfrontend/kdm_greet.c	2005-10-10 08:04:31.000000000 -0700
+++ kdebase-3.5.10-new/kdm/kfrontend/kdm_greet.c	2010-05-13 05:26:41.000000000 -0700
@@ -44,8 +44,9 @@
 # include <sched.h>
 #endif
 
-#if defined(HAVE_XTEST) || defined(HAVE_XKB)
 # include <X11/Xlib.h>
+
+#if defined(HAVE_XTEST) || defined(HAVE_XKB)
 # include <X11/keysym.h>
 #endif
 
diff -Nurd kdebase-3.5.10/kdmlib/Makefile.am kdebase-3.5.10-new/kdmlib/Makefile.am
--- kdebase-3.5.10/kdmlib/Makefile.am	2005-10-10 08:03:54.000000000 -0700
+++ kdebase-3.5.10-new/kdmlib/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,11 +4,11 @@
 
 kgreet_classic_la_SOURCES = kgreet_classic.cpp
 kgreet_classic_la_LDFLAGS = -module -no-undefined $(KDE_PLUGIN) $(all_libraries)
-kgreet_classic_la_LIBADD = $(LIB_KDEUI)
+kgreet_classic_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 kgreet_winbind_la_SOURCES = kgreet_winbind.cpp
 kgreet_winbind_la_LDFLAGS = -module -no-undefined $(KDE_PLUGIN) $(all_libraries)
-kgreet_winbind_la_LIBADD = $(LIB_KDEUI)
+kgreet_winbind_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 noinst_LTLIBRARIES = libdmctl.la
 libdmctl_la_SOURCES = dmctl.cpp
diff -Nurd kdebase-3.5.10/kfind/Makefile.am kdebase-3.5.10-new/kfind/Makefile.am
--- kdebase-3.5.10/kfind/Makefile.am	2005-09-10 01:25:00.000000000 -0700
+++ kdebase-3.5.10-new/kfind/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -14,7 +14,7 @@
 
 libkfindpart_la_SOURCES = kfindpart.cpp
 libkfindpart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
-libkfindpart_la_LIBADD = libkfind_common.la $(LIB_KPARTS) $(top_builddir)/libkonq/libkonq.la 
+libkfindpart_la_LIBADD = libkfind_common.la $(LIB_KPARTS) $(top_builddir)/libkonq/libkonq.la
 
 noinst_HEADERS	= kftabdlg.h kfind.h version.h kquery.h  kdatecombo.h
 
@@ -28,9 +28,12 @@
 
 #And this is for kfind
 
-bin_PROGRAMS = kfind
-kfind_SOURCES = kfwin.cpp kfinddlg.cpp main.cpp 
-kfind_LDADD   =  libkfind_common.la $(LIB_KPARTS)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kfind.la
+
+kfind_la_SOURCES = kfwin.cpp kfinddlg.cpp main.cpp 
+kfind_la_LIBADD  =  libkfind_common.la $(LIB_KPARTS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO)
 
 # the library search path.
-kfind_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kfind_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
diff -Nurd kdebase-3.5.10/kfind/main.cpp kdebase-3.5.10-new/kfind/main.cpp
--- kdebase-3.5.10/kfind/main.cpp	2005-09-10 01:25:00.000000000 -0700
+++ kdebase-3.5.10-new/kfind/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -19,7 +19,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char ** argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char ** argv )
 {
   KLocale::setMainCatalogue("kfindpart");
   KAboutData aboutData( "kfind", I18N_NOOP("KFind"),
diff -Nurd kdebase-3.5.10/khelpcenter/Makefile.am kdebase-3.5.10-new/khelpcenter/Makefile.am
--- kdebase-3.5.10/khelpcenter/Makefile.am	2005-09-10 01:25:18.000000000 -0700
+++ kdebase-3.5.10-new/khelpcenter/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,17 +3,17 @@
 INCLUDES = $(all_includes)
 METASOURCES = AUTO
 
-bin_PROGRAMS = khc_indexbuilder
+bin_PROGRAMS = 
 lib_LTLIBRARIES = 
 
-khc_indexbuilder_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-khc_indexbuilder_LDADD = $(LIB_KDECORE)
-khc_indexbuilder_SOURCES = khc_indexbuilder.cpp
+khc_indexbuilder_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+khc_indexbuilder_la_LIBADD = $(LIB_KDECORE) $(LIB_QT) -lDCOP
+khc_indexbuilder_la_SOURCES = khc_indexbuilder.cpp
 
-kdeinit_LTLIBRARIES = khelpcenter.la
+kdeinit_LTLIBRARIES = khelpcenter.la khc_indexbuilder.la
 
 khelpcenter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-khelpcenter_la_LIBADD = $(LIB_KHTML)
+khelpcenter_la_LIBADD = $(LIB_KHTML) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO) $(LIB_KPARTS) -lDCOP
 khelpcenter_la_SOURCES = navigator.cpp \
 	navigatoritem.cpp navigatorappitem.cpp view.cpp \
 	searchwidget.cpp searchengine.cpp \
@@ -35,7 +35,7 @@
 EXTRA_PROGRAMS = testmetainfo
 
 testmetainfo_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-testmetainfo_LDADD = $(LIB_KDECORE) docentry.lo docmetainfo.lo \
+testmetainfo_LDADD = $(LIB_QT) $(LIB_KDECORE) docentry.lo docmetainfo.lo \
                      docentrytraverser.lo htmlsearch.lo
 testmetainfo_SOURCES = testmetainfo.cpp
 
diff -Nurd kdebase-3.5.10/khelpcenter/htmlsearch/Makefile.am kdebase-3.5.10-new/khelpcenter/htmlsearch/Makefile.am
--- kdebase-3.5.10/khelpcenter/htmlsearch/Makefile.am	2005-09-10 01:25:18.000000000 -0700
+++ kdebase-3.5.10-new/khelpcenter/htmlsearch/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -21,14 +21,15 @@
 
 xdg_apps_DATA = htmlsearch.desktop
 
-bin_PROGRAMS = khtmlindex
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = khtmlindex.la
 
 wrapperdir = $(kde_datadir)/khelpcenter/
 wrapper_SCRIPTS = meinproc_wrapper
 
-khtmlindex_SOURCES = index.cpp
-khtmlindex_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-khtmlindex_LDADD = libhtmlsearch.la $(LIB_KDEUI)
+khtmlindex_la_SOURCES = index.cpp
+khtmlindex_la_LDFLAGS = $(KDE_PLUGIN) $(all_libraries) -module
+khtmlindex_la_LIBADD = libhtmlsearch.la $(LIB_KDEUI)
 
 xpm_DATA = unchecked.xpm checked.xpm
 xpmdir = $(kde_datadir)/khelpcenter/pics
diff -Nurd kdebase-3.5.10/khelpcenter/htmlsearch/index.cpp kdebase-3.5.10-new/khelpcenter/htmlsearch/index.cpp
--- kdebase-3.5.10/khelpcenter/htmlsearch/index.cpp	2005-09-10 01:25:18.000000000 -0700
+++ kdebase-3.5.10-new/khelpcenter/htmlsearch/index.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -13,7 +13,7 @@
 };
 
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
   KAboutData aboutData( "khtmlindex", I18N_NOOP("KHtmlIndex"),
 	"",
diff -Nurd kdebase-3.5.10/khelpcenter/khc_indexbuilder.cpp kdebase-3.5.10-new/khelpcenter/khc_indexbuilder.cpp
--- kdebase-3.5.10/khelpcenter/khc_indexbuilder.cpp	2007-10-08 02:51:18.000000000 -0700
+++ kdebase-3.5.10-new/khelpcenter/khc_indexbuilder.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -168,7 +168,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData aboutData( "khc_indexbuilder",
                         I18N_NOOP("KHelpCenter Index Builder"),
diff -Nurd kdebase-3.5.10/khotkeys/app/Makefile.am kdebase-3.5.10-new/khotkeys/app/Makefile.am
--- kdebase-3.5.10/khotkeys/app/Makefile.am	2005-11-19 03:05:32.000000000 -0800
+++ kdebase-3.5.10-new/khotkeys/app/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kded_khotkeys.la
 
 khotkeys_la_SOURCES = app.cpp app.skel
-khotkeys_la_LIBADD   = ../shared/libkhotkeys_shared.la $(LIB_KDECORE)
+khotkeys_la_LIBADD   = ../shared/libkhotkeys_shared.la $(LIB_KDECORE) -lDCOP
 khotkeys_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
 
 kded_khotkeys_la_SOURCES = kded.cpp kded.skel
diff -Nurd kdebase-3.5.10/khotkeys/kcontrol/Makefile.am kdebase-3.5.10-new/khotkeys/kcontrol/Makefile.am
--- kdebase-3.5.10/khotkeys/kcontrol/Makefile.am	2005-11-19 03:05:33.000000000 -0800
+++ kdebase-3.5.10-new/khotkeys/kcontrol/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -12,12 +12,12 @@
     windowselector.cpp gestures_settings_tab.cpp general_settings_tab.cpp \
     voicerecorder.cpp voicerecordpage.cpp voice_settings_tab.cpp
     
-kcm_khotkeys_la_LIBADD  = ui/libui.la $(LIB_KDEUI) $(LIB_ARTS) 
+kcm_khotkeys_la_LIBADD  = ui/libui.la $(LIB_KDEUI) $(LIB_ARTS) -lDCOP
 kcm_khotkeys_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
 
 kcm_khotkeys_init_la_SOURCES = init.cpp
     
-kcm_khotkeys_init_la_LIBADD  = $(LIB_KDECORE)
+kcm_khotkeys_init_la_LIBADD  = $(LIB_QT) $(LIB_KDECORE) -lDCOP
 kcm_khotkeys_init_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
 
 noinst_HEADERS = menuedit.h window_trigger_widget.h \
diff -Nurd kdebase-3.5.10/khotkeys/kcontrol/ui/Makefile.am kdebase-3.5.10-new/khotkeys/kcontrol/ui/Makefile.am
--- kdebase-3.5.10/khotkeys/kcontrol/ui/Makefile.am	2005-11-19 03:05:33.000000000 -0800
+++ kdebase-3.5.10-new/khotkeys/kcontrol/ui/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,7 +7,7 @@
     gesture_triggers_tab_ui.ui gestures_settings_tab_ui.ui general_settings_tab_ui.ui \
     voice_input_widget_ui.ui voice_settings_tab_ui.ui
 
-libui_la_LIBADD  = ../../shared/libkhotkeys_shared.la $(LIB_KDEUI)
+libui_la_LIBADD  = ../../shared/libkhotkeys_shared.la $(LIB_KDEUI) -lDCOP
 libui_la_LDFLAGS = $(all_libraries)
 
 INCLUDES= -I$(srcdir)/.. -I$(top_srcdir)/khotkeys/shared $(all_includes)
diff -Nurd kdebase-3.5.10/khotkeys/shared/Makefile.am kdebase-3.5.10-new/khotkeys/shared/Makefile.am
--- kdebase-3.5.10/khotkeys/shared/Makefile.am	2006-01-19 09:02:21.000000000 -0800
+++ kdebase-3.5.10-new/khotkeys/shared/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 libkhotkeys_shared_la_SOURCES = action_data.cpp khotkeysglobal.cpp triggers.cpp windows.cpp \
     settings.cpp actions.cpp input.cpp conditions.cpp khlistview.cpp khlistbox.cpp \
     gestures.cpp voices.cpp voicesignature.cpp sound.cpp soundrecorder.cpp
-libkhotkeys_shared_la_LIBADD  = $(LIB_KIO) $(XTESTLIB) -lXext -lX11 $(X_PRE_LIBS)
+libkhotkeys_shared_la_LIBADD  = $(LIB_KIO) $(XTESTLIB) -lXext -lX11 $(X_PRE_LIBS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 libkhotkeys_shared_la_LDFLAGS = $(all_libraries) $(X_LDFLAGS) -version-info 1:0:0 -no-undefined
 
 INCLUDES = $(all_includes)
diff -Nurd kdebase-3.5.10/khotkeys/update/Makefile.am kdebase-3.5.10-new/khotkeys/update/Makefile.am
--- kdebase-3.5.10/khotkeys/update/Makefile.am	2005-11-19 03:05:32.000000000 -0800
+++ kdebase-3.5.10-new/khotkeys/update/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 
 khotkeys_update_SOURCES = update.cpp
 
-khotkeys_update_LDADD   = ../shared/libkhotkeys_shared.la $(LIB_KDECORE) $(KDE_RPATH)
+khotkeys_update_LDADD   = ../shared/libkhotkeys_shared.la $(LIB_KDECORE) $(KDE_RPATH) -lDCOP
 khotkeys_update_LDFLAGS = $(all_libraries)
 
 INCLUDES = -I$(srcdir)/../shared $(all_includes)
diff -Nurd kdebase-3.5.10/kicker/applets/clock/Makefile.am kdebase-3.5.10-new/kicker/applets/clock/Makefile.am
--- kdebase-3.5.10/kicker/applets/clock/Makefile.am	2005-09-10 01:25:35.000000000 -0700
+++ kdebase-3.5.10-new/kicker/applets/clock/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -16,7 +16,7 @@
 EXTRA_DIST = $(lnk_DATA) $(pic_DATA)
 
 clock_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-clock_panelapplet_la_LIBADD =  ../../libkicker/libkickermain.la $(LIB_KDEUI)
+clock_panelapplet_la_LIBADD =  ../../libkicker/libkickermain.la $(LIB_KDEUI) -lDCOP
 
 srcdoc:
 	kdoc -a -p -H -d $$HOME/web/src/clockapplet clockapplet *.h -lqt -lkdecore -lkdeui -lkfile
diff -Nurd kdebase-3.5.10/kicker/applets/lockout/Makefile.am kdebase-3.5.10-new/kicker/applets/lockout/Makefile.am
--- kdebase-3.5.10/kicker/applets/lockout/Makefile.am	2008-08-19 11:16:57.000000000 -0700
+++ kdebase-3.5.10-new/kicker/applets/lockout/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 
 lockout_panelapplet_la_SOURCES = lockout.cpp
 lockout_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-lockout_panelapplet_la_LIBADD = ../../libkicker/libkickermain.la $(LIB_KSYCOCA)
+lockout_panelapplet_la_LIBADD = ../../libkicker/libkickermain.la $(LIB_KSYCOCA) -lDCOP
 
 noinst_HEADERS = lockout.h
 
diff -Nurd kdebase-3.5.10/kicker/applets/menu/Makefile.am kdebase-3.5.10-new/kicker/applets/menu/Makefile.am
--- kdebase-3.5.10/kicker/applets/menu/Makefile.am	2005-09-10 01:25:31.000000000 -0700
+++ kdebase-3.5.10-new/kicker/applets/menu/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -14,7 +14,7 @@
 EXTRA_DIST = $(lnk_DATA)
 
 menu_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-menu_panelapplet_la_LIBADD = $(LIB_KDEUI)
+menu_panelapplet_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 messages:
 	$(XGETTEXT) *.cpp *.h -o $(podir)/kmenuapplet.pot
diff -Nurd kdebase-3.5.10/kicker/applets/minipager/Makefile.am kdebase-3.5.10-new/kicker/applets/minipager/Makefile.am
--- kdebase-3.5.10/kicker/applets/minipager/Makefile.am	2005-09-10 01:25:35.000000000 -0700
+++ kdebase-3.5.10-new/kicker/applets/minipager/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -14,7 +14,7 @@
 EXTRA_DIST = $(lnk_DATA) 
 
 minipager_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-minipager_panelapplet_la_LIBADD = $(LIB_KDEUI) \
+minipager_panelapplet_la_LIBADD = $(LIB_KDEUI) -lDCOP -lkdefx \
 	../../taskmanager/libtaskmanager.la \
 	../../libkicker/libkickermain.la
 
diff -Nurd kdebase-3.5.10/kicker/applets/run/Makefile.am kdebase-3.5.10-new/kicker/applets/run/Makefile.am
--- kdebase-3.5.10/kicker/applets/run/Makefile.am	2005-09-10 01:25:31.000000000 -0700
+++ kdebase-3.5.10-new/kicker/applets/run/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -13,7 +13,7 @@
 EXTRA_DIST = $(lnk_DATA)
 
 run_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-run_panelapplet_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI)
+run_panelapplet_la_LIBADD = $(LIB_KSYCOCA) $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 messages:
 	$(XGETTEXT) *.cpp *.h -o $(podir)/krunapplet.pot
diff -Nurd kdebase-3.5.10/kicker/applets/systemtray/Makefile.am kdebase-3.5.10-new/kicker/applets/systemtray/Makefile.am
--- kdebase-3.5.10/kicker/applets/systemtray/Makefile.am	2005-09-10 01:25:31.000000000 -0700
+++ kdebase-3.5.10-new/kicker/applets/systemtray/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -14,7 +14,7 @@
 EXTRA_DIST = $(lnk_DATA)
 
 systemtray_panelapplet_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-systemtray_panelapplet_la_LIBADD = ../../libkicker/libkickermain.la $(LIB_KDEUI) $(LIB_KIO)
+systemtray_panelapplet_la_LIBADD = ../../libkicker/libkickermain.la $(LIB_KDEUI) $(LIB_KIO) -lDCOP
 
 
 messages:
diff -Nurd kdebase-3.5.10/kicker/extensions/dockbar/Makefile.am kdebase-3.5.10-new/kicker/extensions/dockbar/Makefile.am
--- kdebase-3.5.10/kicker/extensions/dockbar/Makefile.am	2005-09-10 01:25:29.000000000 -0700
+++ kdebase-3.5.10-new/kicker/extensions/dockbar/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 dockbar_panelextension_la_SOURCES = dockcontainer.cpp dockbarextension.cpp
 dockbar_panelextension_la_METASOURCES = AUTO
 dockbar_panelextension_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-dockbar_panelextension_la_LIBADD = $(LIB_KDEUI)
+dockbar_panelextension_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 noinst_HEADERS = dockcontainer.h dockbarextension.h
 
diff -Nurd kdebase-3.5.10/kicker/extensions/kasbar/Makefile.am kdebase-3.5.10-new/kicker/extensions/kasbar/Makefile.am
--- kdebase-3.5.10/kicker/extensions/kasbar/Makefile.am	2005-09-10 01:25:29.000000000 -0700
+++ kdebase-3.5.10-new/kicker/extensions/kasbar/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -14,7 +14,7 @@
 			kasloaditem.cpp
 
 libkasbar_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -no-undefined
-libkasbar_la_LIBADD = $(LIB_KDEUI) ../../taskmanager/libtaskmanager.la
+libkasbar_la_LIBADD = $(LIB_KDEUI) ../../taskmanager/libtaskmanager.la -lkdefx
 
 #
 # Panel Extension
@@ -35,11 +35,13 @@
 
 EXTRA_DIST = $(lnk_DATA)
 
-bin_PROGRAMS = kasbar
-kasbar_SOURCES = kasbarapp.cpp
-kasbar_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kasbar_LDADD = 	libkasbar.la \
-		$(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
+bin_PROGRAMS = 
+kdeinit_LTLIBRARIES = kasbar.la
+
+kasbar_la_SOURCES = kasbarapp.cpp
+kasbar_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kasbar_la_LIBADD = 	libkasbar.la \
+		$(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 
 messages:
diff -Nurd kdebase-3.5.10/kicker/extensions/kasbar/kasbarapp.cpp kdebase-3.5.10-new/kicker/extensions/kasbar/kasbarapp.cpp
--- kdebase-3.5.10/kicker/extensions/kasbar/kasbarapp.cpp	2005-10-10 08:03:59.000000000 -0700
+++ kdebase-3.5.10-new/kicker/extensions/kasbar/kasbarapp.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -73,7 +73,7 @@
    KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KCmdLineArgs::init( argc, argv, "kasbar", "KasBar", I18N_NOOP( "An alternative task manager" ), VERSION_STRING );
   KCmdLineArgs::addCmdLineOptions( options );
diff -Nurd kdebase-3.5.10/kicker/libkicker/Makefile.am kdebase-3.5.10-new/kicker/libkicker/Makefile.am
--- kdebase-3.5.10/kicker/libkicker/Makefile.am	2005-09-10 01:25:29.000000000 -0700
+++ kdebase-3.5.10-new/kicker/libkicker/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -11,7 +11,7 @@
 libkickermain_la_METASOURCES = AUTO
 
 libkickermain_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -no-undefined
-libkickermain_la_LIBADD = $(LIB_KIO)
+libkickermain_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 kde_kcfg_DATA = kickerSettings.kcfg
 
diff -Nurd kdebase-3.5.10/kicker/menuext/recentdocs/Makefile.am kdebase-3.5.10-new/kicker/menuext/recentdocs/Makefile.am
--- kdebase-3.5.10/kicker/menuext/recentdocs/Makefile.am	2006-03-17 02:17:31.000000000 -0800
+++ kdebase-3.5.10-new/kicker/menuext/recentdocs/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 kickermenu_recentdocs_la_SOURCES = recentdocsmenu.cpp
 kickermenu_recentdocs_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kickermenu_recentdocs_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
+kickermenu_recentdocs_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 
 kickermenu_recentdocs_la_METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kicker/proxy/Makefile.am kdebase-3.5.10-new/kicker/proxy/Makefile.am
--- kdebase-3.5.10/kicker/proxy/Makefile.am	2006-10-01 10:31:51.000000000 -0700
+++ kdebase-3.5.10-new/kicker/proxy/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,16 +7,16 @@
 
 METASOURCES = AUTO
 
-appletproxy_la_LIBADD = $(LIB_KDEUI) ../libkicker/libkickermain.la
+appletproxy_la_LIBADD = $(LIB_KDEUI) ../libkicker/libkickermain.la -lDCOP
 appletproxy_la_SOURCES = appletproxy.cpp
 appletproxy_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
 
-extensionproxy_la_LIBADD = $(LIB_KDEUI) ../libkicker/libkickermain.la
+extensionproxy_la_LIBADD = $(LIB_KDEUI) ../libkicker/libkickermain.la -lDCOP
 extensionproxy_la_SOURCES = extensionproxy.cpp
 extensionproxy_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -avoid-version
 
 extensiondebugger_SOURCES = extensiondebugger.cpp
-extensiondebugger_LDADD = ../libkicker/libkickermain.la
+extensiondebugger_LDADD = ../libkicker/libkickermain.la -lDCOP
 extensiondebugger_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 messages:
diff -Nurd kdebase-3.5.10/kicker/taskbar/Makefile.am kdebase-3.5.10-new/kicker/taskbar/Makefile.am
--- kdebase-3.5.10/kicker/taskbar/Makefile.am	2005-09-10 01:25:29.000000000 -0700
+++ kdebase-3.5.10-new/kicker/taskbar/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -9,7 +9,7 @@
 libtaskbar_la_METASOURCES = AUTO
 
 libtaskbar_la_LDFLAGS = -version-info 3:0:2 $(all_libraries) -no-undefined
-libtaskbar_la_LIBADD = $(LIB_KDEUI) $(LIB_KUTILS) ../libkicker/libkickermain.la ../taskmanager/libtaskmanager.la
+libtaskbar_la_LIBADD = $(LIB_KDEUI) $(LIB_KUTILS) ../libkicker/libkickermain.la ../taskmanager/libtaskmanager.la -lDCOP -lkdefx
 
 messages: rc.cpp
 	$(XGETTEXT) *.cpp *.h -o $(podir)/libtaskbar.pot
diff -Nurd kdebase-3.5.10/kioslave/about/Makefile.am kdebase-3.5.10-new/kioslave/about/Makefile.am
--- kdebase-3.5.10/kioslave/about/Makefile.am	2006-03-17 02:17:35.000000000 -0800
+++ kdebase-3.5.10-new/kioslave/about/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 kde_module_LTLIBRARIES = kio_about.la
 
 kio_about_la_SOURCES = kio_about.cpp
-kio_about_la_LIBADD = $(LIB_KSYCOCA)
+kio_about_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KSYCOCA)
 kio_about_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = kio_about.h
 
diff -Nurd kdebase-3.5.10/kioslave/cgi/Makefile.am kdebase-3.5.10-new/kioslave/cgi/Makefile.am
--- kdebase-3.5.10/kioslave/cgi/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/cgi/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kio_cgi.la
 
 kio_cgi_la_SOURCES = cgi.cpp
-kio_cgi_la_LIBADD = $(LIB_KIO)
+kio_cgi_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KIO)
 kio_cgi_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = cgi.h
diff -Nurd kdebase-3.5.10/kioslave/cgi/kcmcgi/Makefile.am kdebase-3.5.10-new/kioslave/cgi/kcmcgi/Makefile.am
--- kdebase-3.5.10/kioslave/cgi/kcmcgi/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/cgi/kcmcgi/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 
 kcm_cgi_la_SOURCES = kcmcgi.cpp
 kcm_cgi_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_cgi_la_LIBADD = -lkdeui $(LIB_KIO)
+kcm_cgi_la_LIBADD = -lkdeui $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 
 INCLUDES= $(all_includes) 
 
diff -Nurd kdebase-3.5.10/kioslave/filter/Makefile.am kdebase-3.5.10-new/kioslave/filter/Makefile.am
--- kdebase-3.5.10/kioslave/filter/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/filter/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kio_filter.la
 
 kio_filter_la_SOURCES = filter.cc
-kio_filter_la_LIBADD = $(LIB_KSYCOCA)
+kio_filter_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE)
 kio_filter_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = filter.h
 
diff -Nurd kdebase-3.5.10/kioslave/finger/Makefile.am kdebase-3.5.10-new/kioslave/finger/Makefile.am
--- kdebase-3.5.10/kioslave/finger/Makefile.am	2005-09-10 01:25:38.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/finger/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -9,7 +9,7 @@
 kde_module_LTLIBRARIES = kio_finger.la
 
 kio_finger_la_SOURCES = kio_finger.cpp 
-kio_finger_la_LIBADD = -lkio
+kio_finger_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 kio_finger_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = kio_finger.h 
diff -Nurd kdebase-3.5.10/kioslave/fish/Makefile.am kdebase-3.5.10-new/kioslave/fish/Makefile.am
--- kdebase-3.5.10/kioslave/fish/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/fish/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 AM_LDFLAGS = $(all_libraries) $(KDE_RPATH)
 
 kio_fish_la_SOURCES = fish.cpp
-kio_fish_la_LIBADD = $(LIB_KSYCOCA) #$(LIBUTIL) 
+kio_fish_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE)
 kio_fish_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = fishcode.h fish.h
 
diff -Nurd kdebase-3.5.10/kioslave/floppy/Makefile.am kdebase-3.5.10-new/kioslave/floppy/Makefile.am
--- kdebase-3.5.10/kioslave/floppy/Makefile.am	2008-08-19 11:17:02.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/floppy/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 kde_module_LTLIBRARIES = kio_floppy.la
 
 kio_floppy_la_SOURCES = kio_floppy.cpp program.cpp
-kio_floppy_la_LIBADD = $(LIB_KIO)
+kio_floppy_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 kio_floppy_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 kdelnk_DATA = floppy.protocol
diff -Nurd kdebase-3.5.10/kioslave/home/Makefile.am kdebase-3.5.10-new/kioslave/home/Makefile.am
--- kdebase-3.5.10/kioslave/home/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/home/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,7 +7,7 @@
 kde_module_LTLIBRARIES = kio_home.la
 
 kio_home_la_SOURCES = dummy.cpp
-kio_home_la_LIBADD  = libkiohome.la $(LIB_KIO)
+kio_home_la_LIBADD  = libkiohome.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 kio_home_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN) -no-undefined
 
 dummy.cpp:
@@ -20,7 +20,7 @@
 
 check_PROGRAMS = testhome
 testhome_SOURCES = testhome.cpp
-testhome_LDADD = libkiohome.la $(LIB_KIO)
+testhome_LDADD = libkiohome.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 testhome_LDFLAGS = $(all_libraries)
 
 ## TODO in unsermake: TESTS = testhome
diff -Nurd kdebase-3.5.10/kioslave/info/Makefile.am kdebase-3.5.10-new/kioslave/info/Makefile.am
--- kdebase-3.5.10/kioslave/info/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/info/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -9,7 +9,7 @@
 kde_module_LTLIBRARIES = kio_info.la
 
 kio_info_la_SOURCES = info.cc
-kio_info_la_LIBADD = $(LIB_KIO)
+kio_info_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 kio_info_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = info.h
 
diff -Nurd kdebase-3.5.10/kioslave/info/kde-info2html.conf kdebase-3.5.10-new/kioslave/info/kde-info2html.conf
--- kdebase-3.5.10/kioslave/info/kde-info2html.conf	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/info/kde-info2html.conf	2010-05-13 05:26:41.000000000 -0700
@@ -25,6 +25,7 @@
 
 #-- location of info files.
 our @INFODIR = (
+	    "@FINKPREFIX@/share/info",
 	    "/usr/share/info",
 	    "/usr/info",
 	    "/usr/lib/info",
diff -Nurd kdebase-3.5.10/kioslave/ldap/Makefile.am kdebase-3.5.10-new/kioslave/ldap/Makefile.am
--- kdebase-3.5.10/kioslave/ldap/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/ldap/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -10,7 +10,7 @@
 kde_module_LTLIBRARIES = kio_ldap.la
 
 kio_ldap_la_SOURCES = kio_ldap.cpp
-kio_ldap_la_LIBADD = $(LIB_KIO) $(LDAP_LIBS) $(LIB_KABC)
+kio_ldap_la_LIBADD = $(LIB_KIO) $(LDAP_LIBS) $(LIB_KABC) $(LIB_QT) $(LIB_KDECORE)
 kio_ldap_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(LDAP_RPATH) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = kio_ldap.h
diff -Nurd kdebase-3.5.10/kioslave/ldap/configure.in.in kdebase-3.5.10-new/kioslave/ldap/configure.in.in
--- kdebase-3.5.10/kioslave/ldap/configure.in.in	2005-10-10 08:04:01.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/ldap/configure.in.in	2010-05-13 05:26:41.000000000 -0700
@@ -38,10 +38,11 @@
 case "$with_ldap" in
 no) AC_MSG_RESULT(no) ;;
 framework)
-  LDAP_LIBS="-Xlinker -framework -Xlinker LDAP"
+  LDAP_LIBS="-Wl,-framework,LDAP"
   AC_DEFINE_UNQUOTED(HAVE_LIBLDAP, 1, [Define if you have LDAP libraries])
   LDAP_SUBDIR="ldap"
   AC_MSG_RESULT(Apple framework)
+  with_ldap=FOUND
   ;;
 FOUND)
   AC_MSG_RESULT(incs=$ldap_incdir libs=$ldap_libdir)
diff -Nurd kdebase-3.5.10/kioslave/mac/Makefile.am kdebase-3.5.10-new/kioslave/mac/Makefile.am
--- kdebase-3.5.10/kioslave/mac/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/mac/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 kde_module_LTLIBRARIES = kio_mac.la
 
 kio_mac_la_SOURCES = kio_mac.cpp
-kio_mac_la_LIBADD = -lkio
+kio_mac_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 kio_mac_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = kio_mac.h
diff -Nurd kdebase-3.5.10/kioslave/man/Makefile.am kdebase-3.5.10-new/kioslave/man/Makefile.am
--- kdebase-3.5.10/kioslave/man/Makefile.am	2006-03-17 02:17:36.000000000 -0800
+++ kdebase-3.5.10-new/kioslave/man/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -16,13 +16,13 @@
 kde_module_LTLIBRARIES = kio_man.la  libkmanpart.la
 
 kio_man_la_SOURCES = man2html.cpp kio_man.cpp
-kio_man_la_LIBADD = $(LIB_KSYCOCA)
+kio_man_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE)
 kio_man_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = kio_man.h
 ### TODO Why is man2htmk.h distributed?
 
 libkmanpart_la_SOURCES = kmanpart.cpp
-libkmanpart_la_LIBADD = -lkhtml $(LIB_KPARTS)
+libkmanpart_la_LIBADD = -lkhtml $(LIB_KPARTS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO)
 libkmanpart_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN)
 
 kdelnk_DATA = man.protocol kmanpart.desktop
diff -Nurd kdebase-3.5.10/kioslave/man/kio_man.cpp kdebase-3.5.10-new/kioslave/man/kio_man.cpp
--- kdebase-3.5.10/kioslave/man/kio_man.cpp	2007-10-08 02:51:22.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/man/kio_man.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -50,7 +50,7 @@
 
 MANProtocol *MANProtocol::_self = 0;
 
-#define SGML2ROFF_DIRS "/usr/lib/sgml"
+#define SGML2ROFF_DIRS "@FINKPREFIX@/share/sgml"
 
 /*
  * Drop trailing ".section[.gz]" from name
@@ -895,6 +895,7 @@
 
     // Default paths
     static const char *manpaths[] = {
+        "@FINKPREFIX@/share/man",
         "/usr/X11/man",
         "/usr/X11R6/man",
         "/usr/man",
diff -Nurd kdebase-3.5.10/kioslave/media/Makefile.am kdebase-3.5.10-new/kioslave/media/Makefile.am
--- kdebase-3.5.10/kioslave/media/Makefile.am	2006-07-22 01:15:45.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/media/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -11,7 +11,7 @@
 kde_module_LTLIBRARIES = kio_media.la
 
 kio_media_la_SOURCES = dummy.cpp
-kio_media_la_LIBADD  = libkiomedia.la libmediacommon/libmediacommon.la $(LIB_KIO)
+kio_media_la_LIBADD  = libkiomedia.la libmediacommon/libmediacommon.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 kio_media_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN) -no-undefined
 
 dummy.cpp:
@@ -24,7 +24,7 @@
 
 check_PROGRAMS = testmedia
 testmedia_SOURCES = testmedia.cpp
-testmedia_LDADD = libkiomedia.la $(LIB_KIO)
+testmedia_LDADD = libkiomedia.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 testmedia_LDFLAGS = $(all_libraries)
 
 ## TODO in unsermake: TESTS = testmedia
diff -Nurd kdebase-3.5.10/kioslave/media/configure.in.in kdebase-3.5.10-new/kioslave/media/configure.in.in
--- kdebase-3.5.10/kioslave/media/configure.in.in	2007-05-14 00:55:41.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/media/configure.in.in	2010-05-13 05:26:41.000000000 -0700
@@ -182,3 +182,5 @@
 
 AC_CHECK_FUNCS(statvfs)
 
+AC_CHECK_FUNCS(statvfs)
+
diff -Nurd kdebase-3.5.10/kioslave/media/kcmodule/Makefile.am kdebase-3.5.10-new/kioslave/media/kcmodule/Makefile.am
--- kdebase-3.5.10/kioslave/media/kcmodule/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/media/kcmodule/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -9,7 +9,7 @@
                        main.cpp
 
 kcm_media_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-kcm_media_la_LIBADD = ../libmediacommon/libmediacommon.la $(LIB_KIO)
+kcm_media_la_LIBADD = ../libmediacommon/libmediacommon.la $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT) $(LIB_KDEUI) -lDCOP
 
 noinst_HEADERS = notifiermodule.h managermodule.h \
                  serviceconfigdialog.h mimetypelistboxitem.h \
diff -Nurd kdebase-3.5.10/kioslave/media/kfile-plugin/Makefile.am kdebase-3.5.10-new/kioslave/media/kfile-plugin/Makefile.am
--- kdebase-3.5.10/kioslave/media/kfile-plugin/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/media/kfile-plugin/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -2,7 +2,7 @@
 
 kfile_media_la_SOURCES = kfilemediaplugin.cpp
 kfile_media_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module $(KDE_PLUGIN)
-kfile_media_la_LIBADD = $(LIB_KIO) ../libmediacommon/libmediacommon.la
+kfile_media_la_LIBADD = $(LIB_KIO) ../libmediacommon/libmediacommon.la $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 kdelnkdir = $(kde_servicesdir)
 kde_services_DATA = kfile_media.desktop
diff -Nurd kdebase-3.5.10/kioslave/media/mounthelper/Makefile.am kdebase-3.5.10-new/kioslave/media/mounthelper/Makefile.am
--- kdebase-3.5.10/kioslave/media/mounthelper/Makefile.am	2006-07-22 01:15:42.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/media/mounthelper/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,12 +1,14 @@
-bin_PROGRAMS = kio_media_mounthelper
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kio_media_mounthelper.la
 
 INCLUDES = -I$(srcdir)/../libmediacommon $(all_includes)
 AM_LDFLAGS = $(all_libraries)
 
-kio_media_mounthelper_SOURCES = kio_media_mounthelper.cpp
+kio_media_mounthelper_la_SOURCES = kio_media_mounthelper.cpp
 
-kio_media_mounthelper_LDFLAGS = $(KDE_RPATH) $(all_libraries)
-kio_media_mounthelper_LDADD = ../libmediacommon/libmediacommon.la $(LIB_KIO)
+kio_media_mounthelper_la_LDFLAGS = $(KDE_RPATH) $(all_libraries) $(KDE_PLUGIN) -module
+kio_media_mounthelper_la_LIBADD = ../libmediacommon/libmediacommon.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP $(LIB_KDEUI)
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kioslave/media/mounthelper/kio_media_mounthelper.cpp kdebase-3.5.10-new/kioslave/media/mounthelper/kio_media_mounthelper.cpp
--- kdebase-3.5.10/kioslave/media/mounthelper/kio_media_mounthelper.cpp	2007-05-14 00:55:40.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/media/mounthelper/kio_media_mounthelper.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -188,7 +188,7 @@
 };
 
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
 	KCmdLineArgs::init(argc, argv, "kio_media_mounthelper",
 	                   "kio_media_mounthelper", "kio_media_mounthelper",
diff -Nurd kdebase-3.5.10/kioslave/nfs/Makefile.am kdebase-3.5.10-new/kioslave/nfs/Makefile.am
--- kdebase-3.5.10/kioslave/nfs/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/nfs/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 kde_module_LTLIBRARIES = kio_nfs.la
 
 kio_nfs_la_SOURCES = kio_nfs.cpp mount_xdr.c nfs_prot_xdr.c
-kio_nfs_la_LIBADD = -lkio $(LIBRPC)
+kio_nfs_la_LIBADD = $(LIB_KIO) $(LIBRPC) $(LIB_QT) $(LIB_KDECORE)
 kio_nfs_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = nfs_prot.h mount.h
 
diff -Nurd kdebase-3.5.10/kioslave/nfs/mount_xdr.c kdebase-3.5.10-new/kioslave/nfs/mount_xdr.c
--- kdebase-3.5.10/kioslave/nfs/mount_xdr.c	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/nfs/mount_xdr.c	2010-05-13 05:26:41.000000000 -0700
@@ -43,6 +43,13 @@
 
 /* from @(#)mount.x	1.3 91/03/11 TIRPC 1.0 */
 
+#if defined(__APPLE__) && !defined(IXDR_GET_INT32)
+#define IXDR_GET_INT32(buf)             ((int32_t)ntohl((u_int32_t)*(buf)++))
+#define IXDR_PUT_INT32(buf, v)          (*(buf)++ =(int32_t)htonl((u_int32_t)v))
+#define IXDR_GET_U_INT32(buf)           ((u_int32_t)IXDR_GET_INT32(buf))
+#define IXDR_PUT_U_INT32(buf, v)        IXDR_PUT_INT32((buf), ((int32_t)(v)))
+#endif
+
 bool_t
 xdr_fhandle(XDR *xdrs, fhandle objp)
 {
diff -Nurd kdebase-3.5.10/kioslave/nntp/Makefile.am kdebase-3.5.10-new/kioslave/nntp/Makefile.am
--- kdebase-3.5.10/kioslave/nntp/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/nntp/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kio_nntp.la
 
 kio_nntp_la_SOURCES = nntp.cpp
-kio_nntp_la_LIBADD  = $(LIB_KIO)
+kio_nntp_la_LIBADD  = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 kio_nntp_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kioslave/pop3/Makefile.am kdebase-3.5.10-new/kioslave/pop3/Makefile.am
--- kdebase-3.5.10/kioslave/pop3/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/pop3/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kio_pop3.la
 
 kio_pop3_la_SOURCES = pop3.cc
-kio_pop3_la_LIBADD  = $(LIB_KIO) $(SASL2_LIBS)
+kio_pop3_la_LIBADD  = $(LIB_KIO) $(SASL2_LIBS) $(LIB_QT) $(LIB_KDECORE)
 kio_pop3_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = pop3.h
diff -Nurd kdebase-3.5.10/kioslave/remote/Makefile.am kdebase-3.5.10-new/kioslave/remote/Makefile.am
--- kdebase-3.5.10/kioslave/remote/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/remote/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,7 +7,7 @@
 kde_module_LTLIBRARIES = kio_remote.la
 
 kio_remote_la_SOURCES = dummy.cpp
-kio_remote_la_LIBADD  = libkioremote.la $(LIB_KIO)
+kio_remote_la_LIBADD  = libkioremote.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 kio_remote_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN) -no-undefined
 
 dummy.cpp:
@@ -20,7 +20,7 @@
 
 check_PROGRAMS = testremote
 testremote_SOURCES = testremote.cpp
-testremote_LDADD = libkioremote.la $(LIB_KIO)
+testremote_LDADD = libkioremote.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 testremote_LDFLAGS = $(all_libraries)
 
 ## TODO in unsermake: TESTS = testremote
diff -Nurd kdebase-3.5.10/kioslave/settings/Makefile.am kdebase-3.5.10-new/kioslave/settings/Makefile.am
--- kdebase-3.5.10/kioslave/settings/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/settings/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = kio_settings.la
 
 kio_settings_la_SOURCES = kio_settings.cc
-kio_settings_la_LIBADD  = $(LIB_KSYCOCA)
+kio_settings_la_LIBADD  = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 kio_settings_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = kio_settings.h
diff -Nurd kdebase-3.5.10/kioslave/sftp/Makefile.am kdebase-3.5.10-new/kioslave/sftp/Makefile.am
--- kdebase-3.5.10/kioslave/sftp/Makefile.am	2005-09-10 01:25:38.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/sftp/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -14,7 +14,7 @@
 kde_module_LTLIBRARIES = kio_sftp.la
 
 kio_sftp_la_SOURCES = process.cpp atomicio.cpp kio_sftp.cpp sftpfileattr.cpp ksshprocess.cpp
-kio_sftp_la_LIBADD = $(LIB_KIO)
+kio_sftp_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lkdesu
 kio_sftp_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 noinst_HEADERS = atomicio.h kio_sftp.h ksshprocess.h process.h sftpfileattr.h sftp.h
 
diff -Nurd kdebase-3.5.10/kioslave/smb/Makefile.am kdebase-3.5.10-new/kioslave/smb/Makefile.am
--- kdebase-3.5.10/kioslave/smb/Makefile.am	2008-08-19 11:17:00.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/smb/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -12,7 +12,7 @@
              kio_smb_internal.cpp \
 	     kio_smb_mount.cpp
 
-kio_smb_la_LIBADD = -lkio -lsmbclient $(SMBCLIENT_EXTRA_LIBS)
+kio_smb_la_LIBADD = $(LIB_KIO) -lsmbclient $(SMBCLIENT_EXTRA_LIBS) $(LIB_QT) $(LIB_KDECORE)
 
 kio_smb_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
diff -Nurd kdebase-3.5.10/kioslave/smtp/Makefile.am kdebase-3.5.10-new/kioslave/smtp/Makefile.am
--- kdebase-3.5.10/kioslave/smtp/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/smtp/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = kio_smtp.la
 
 kio_smtp_la_SOURCES = smtp.cc request.cc response.cc capabilities.cc command.cc transactionstate.cc
-kio_smtp_la_LIBADD  = $(LIB_KIO) $(SASL2_LIBS)
+kio_smtp_la_LIBADD  = $(LIB_KIO) $(SASL2_LIBS) $(LIB_QT) $(LIB_KDECORE)
 kio_smtp_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = smtp.h request.h response.h capabilities.h command.h transactionstate.h
diff -Nurd kdebase-3.5.10/kioslave/system/Makefile.am kdebase-3.5.10-new/kioslave/system/Makefile.am
--- kdebase-3.5.10/kioslave/system/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/system/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,7 +6,7 @@
 kde_module_LTLIBRARIES = kio_system.la
 
 kio_system_la_SOURCES = dummy.cpp
-kio_system_la_LIBADD  = libkiosystem.la $(LIB_KIO)
+kio_system_la_LIBADD  = libkiosystem.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 kio_system_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN) -no-undefined
 
 dummy.cpp:
@@ -19,7 +19,7 @@
 
 check_PROGRAMS = testsystem
 testsystem_SOURCES = testsystem.cpp
-testsystem_LDADD = libkiosystem.la $(LIB_KIO)
+testsystem_LDADD = libkiosystem.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 testsystem_LDFLAGS = $(all_libraries)
 
 ## TODO in unsermake: TESTS = testsystem
diff -Nurd kdebase-3.5.10/kioslave/tar/Makefile.am kdebase-3.5.10-new/kioslave/tar/Makefile.am
--- kdebase-3.5.10/kioslave/tar/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/tar/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,13 +7,13 @@
 kde_module_LTLIBRARIES = kio_tar.la
 
 kio_tar_la_SOURCES = tar.cc
-kio_tar_la_LIBADD = $(LIB_KSYCOCA)
+kio_tar_la_LIBADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE)
 kio_tar_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 check_PROGRAMS = ktartest
 
 ktartest_SOURCES = ktartest.cpp
-ktartest_LDADD = $(LIB_KSYCOCA)
+ktartest_LDADD = $(LIB_KSYCOCA) $(LIB_QT) $(LIB_KDECORE)
 
 noinst_HEADERS = tar.h
 
diff -Nurd kdebase-3.5.10/kioslave/thumbnail/Makefile.am kdebase-3.5.10-new/kioslave/thumbnail/Makefile.am
--- kdebase-3.5.10/kioslave/thumbnail/Makefile.am	2006-01-19 09:00:59.000000000 -0800
+++ kdebase-3.5.10-new/kioslave/thumbnail/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -20,31 +20,31 @@
 	$(EXR_MODULE)
 
 kio_thumbnail_la_SOURCES = thumbnail.cpp
-kio_thumbnail_la_LIBADD = $(LIB_KIO)
+kio_thumbnail_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lkdefx
 kio_thumbnail_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 imagethumbnail_la_SOURCES = imagecreator.cpp
-imagethumbnail_la_LIBADD = $(LIB_KIO) # for kimageio
+imagethumbnail_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) # for kimageio
 imagethumbnail_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 textthumbnail_la_SOURCES = textcreator.cpp
-textthumbnail_la_LIBADD = $(LIB_KIO) # for kmimetype
+textthumbnail_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lkdefx # for kmimetype
 textthumbnail_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 htmlthumbnail_la_SOURCES = htmlcreator.cpp
-htmlthumbnail_la_LIBADD = $(LIB_KHTML)
+htmlthumbnail_la_LIBADD = $(LIB_KHTML) $(LIB_QT) $(LIB_KDECORE)
 htmlthumbnail_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 djvuthumbnail_la_SOURCES = djvucreator.cpp
-djvuthumbnail_la_LIBADD = $(LIB_KDECORE)
+djvuthumbnail_la_LIBADD = $(LIB_KDECORE) $(LIB_QT)
 djvuthumbnail_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 cursorthumbnail_la_SOURCES = cursorcreator.cpp
-cursorthumbnail_la_LIBADD = $(LIB_KDECORE) $(LIB_XCURSOR)
+cursorthumbnail_la_LIBADD = $(LIB_KDECORE) $(LIB_XCURSOR) $(LIB_QT)
 cursorthumbnail_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 exrthumbnail_la_SOURCES = exrcreator.cpp
-exrthumbnail_la_LIBADD = $(LIB_KDECORE) $(LIB_EXR)
+exrthumbnail_la_LIBADD = $(LIB_KDECORE) $(LIB_EXR) $(LIB_QT)
 exrthumbnail_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
 
 noinst_HEADERS = thumbnail.h imagecreator.h textcreator.h htmlcreator.h \
diff -Nurd kdebase-3.5.10/kioslave/trash/Makefile.am kdebase-3.5.10-new/kioslave/trash/Makefile.am
--- kdebase-3.5.10/kioslave/trash/Makefile.am	2005-09-10 01:25:37.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/trash/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,13 +6,16 @@
 kde_module_LTLIBRARIES = kio_trash.la
 
 kio_trash_la_SOURCES = kio_trash.cpp
-kio_trash_la_LIBADD  = libtrashcommon.la $(LIB_KIO)
+kio_trash_la_LIBADD  = libtrashcommon.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 kio_trash_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN) -no-undefined
 
-bin_PROGRAMS = ktrash
-ktrash_SOURCES = ktrash.cpp
-ktrash_LDADD = $(LIB_KIO)
-ktrash_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = ktrash.la
+
+ktrash_la_SOURCES = ktrash.cpp
+ktrash_la_LIBADD = $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
+ktrash_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 kde_services_DATA = trash.protocol
 
@@ -21,7 +24,7 @@
 
 check_PROGRAMS = testtrash
 testtrash_SOURCES = testtrash.cpp
-testtrash_LDADD = libtrashcommon.la $(LIB_KIO)
+testtrash_LDADD = libtrashcommon.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE)
 testtrash_LDFLAGS = $(all_libraries)
 
 TESTS = testtrash
diff -Nurd kdebase-3.5.10/kioslave/trash/kfile-plugin/Makefile.am kdebase-3.5.10-new/kioslave/trash/kfile-plugin/Makefile.am
--- kdebase-3.5.10/kioslave/trash/kfile-plugin/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/trash/kfile-plugin/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,7 +6,7 @@
 
 kfile_trash_la_SOURCES = kfile_trash.cpp
 kfile_trash_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-kfile_trash_la_LIBADD = ../libtrashcommon.la $(LIB_KIO)
+kfile_trash_la_LIBADD = ../libtrashcommon.la $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kioslave/trash/ktrash.cpp kdebase-3.5.10-new/kioslave/trash/ktrash.cpp
--- kdebase-3.5.10/kioslave/trash/ktrash.cpp	2005-10-10 08:04:01.000000000 -0700
+++ kdebase-3.5.10-new/kioslave/trash/ktrash.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -35,7 +35,7 @@
     KCmdLineLastOption
 };
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
     KApplication::disableAutoDcopRegistration();
     KCmdLineArgs::init( argc, argv, "ktrash",
diff -Nurd kdebase-3.5.10/klipper/Makefile.am kdebase-3.5.10-new/klipper/Makefile.am
--- kdebase-3.5.10/klipper/Makefile.am	2006-03-17 02:17:30.000000000 -0800
+++ kdebase-3.5.10-new/klipper/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 
 CLEANFILES = dummy.cpp
 
-libklipper_common_la_LIBADD = $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_XFIXES)
+libklipper_common_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KIO) $(LIB_KDEUI) $(LIB_KSYCOCA) $(LIB_XFIXES) -lDCOP
 libklipper_common_la_SOURCES = main.cpp toplevel.cpp urlgrabber.cpp configdialog.cpp \
     toplevel.skel clipboardpoll.cpp history.cpp historyitem.cpp historystringitem.cpp klipperpopup.cpp popupproxy.cpp \
     historyimageitem.cpp historyurlitem.cpp
@@ -16,7 +16,7 @@
 libklipper_common_la_METASOURCES = AUTO
 libklipper_common_la_LDFLAGS = $(all_libraries)
 
-klipper_la_LIBADD = libklipper_common.la
+klipper_la_LIBADD = libklipper_common.la $(LIB_QT) $(LIB_KDECORE) -lDCOP
 klipper_la_SOURCES = dummy.cpp
 klipper_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
diff -Nurd kdebase-3.5.10/kmenuedit/Makefile.am kdebase-3.5.10-new/kmenuedit/Makefile.am
--- kdebase-3.5.10/kmenuedit/Makefile.am	2006-03-17 02:17:38.000000000 -0800
+++ kdebase-3.5.10-new/kmenuedit/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -11,15 +11,15 @@
 libkmenueditcommon_la_SOURCES = basictab.cpp treeview.cpp kmenuedit.cpp \
 	khotkeys.cpp menufile.cpp menuinfo.cpp
 
-libkmenueditcommon_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO)
+libkmenueditcommon_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO)
 libkmenueditcommon_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 kmenuedit_la_SOURCES = main.cpp
-kmenuedit_la_LIBADD = libkmenueditcommon.la
+kmenuedit_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) libkmenueditcommon.la -lDCOP
 kmenuedit_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 kcontroledit_la_SOURCES = kcontrol_main.cpp
-kcontroledit_la_LIBADD = libkmenueditcommon.la
+kcontroledit_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) libkmenueditcommon.la
 kcontroledit_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 noinst_HEADERS = kmenuedit.h treeview.h basictab.h khotkeys.h \
diff -Nurd kdebase-3.5.10/knetattach/Makefile.am kdebase-3.5.10-new/knetattach/Makefile.am
--- kdebase-3.5.10/knetattach/Makefile.am	2005-09-10 01:25:49.000000000 -0700
+++ kdebase-3.5.10-new/knetattach/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,9 +1,12 @@
 INCLUDES= $(all_includes)
 
-bin_PROGRAMS = knetattach
-knetattach_SOURCES = knetattach.ui main.cpp
-knetattach_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-knetattach_LDADD   = $(LIB_KIO)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = knetattach.la
+
+knetattach_la_SOURCES = knetattach.ui main.cpp
+knetattach_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+knetattach_la_LIBADD  = $(LIB_QT) $(LIB_KDECORE) $(LIB_KIO) $(LIB_KDEUI) -lDCOP
 METASOURCES = AUTO
 xdg_apps_DATA = knetattach.desktop
 KDE_ICON = AUTO
diff -Nurd kdebase-3.5.10/knetattach/main.cpp kdebase-3.5.10-new/knetattach/main.cpp
--- kdebase-3.5.10/knetattach/main.cpp	2005-10-10 08:04:20.000000000 -0700
+++ kdebase-3.5.10-new/knetattach/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -25,7 +25,7 @@
 
 #include "knetattach.h"
 
-int main(int argc, char **argv) {
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv) {
 	KAboutData about("knetattach", I18N_NOOP("KDE Network Wizard"), "1.0",
 		I18N_NOOP("KDE Network Wizard"),
 		KAboutData::License_GPL,
diff -Nurd kdebase-3.5.10/konqueror/Makefile.am kdebase-3.5.10-new/konqueror/Makefile.am
--- kdebase-3.5.10/konqueror/Makefile.am	2007-10-08 02:51:30.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -49,7 +49,7 @@
 	konq_view.h konq_viewmgr.h konq_extensionmanager.h version.h
 
 konqueror_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
-konqueror_la_LIBADD = ../libkonq/libkonq.la libkonqueror_intern.la $(LIBMALLOC) $(LIB_KUTILS)
+konqueror_la_LIBADD = ../libkonq/libkonq.la libkonqueror_intern.la $(LIBMALLOC) $(LIB_KUTILS) $(LIB_QT) $(LIB_KDECORE)
 
 # Hmm, this experiment of a static konq failed, don't trust it...
 # (but feel free to fix it :)
diff -Nurd kdebase-3.5.10/konqueror/about/Makefile.am kdebase-3.5.10-new/konqueror/about/Makefile.am
--- kdebase-3.5.10/konqueror/about/Makefile.am	2005-09-10 01:25:48.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/about/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 INCLUDES = -I$(srcdir)/.. -I$(top_srcdir)/libkonq $(all_includes)
 konq_aboutpage_la_SOURCES = konq_aboutpage.cc
 konq_aboutpage_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-konq_aboutpage_la_LIBADD = $(LIB_KHTML)
+konq_aboutpage_la_LIBADD = $(LIB_KHTML) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KPARTS)
 
 kde_services_DATA = konq_aboutpage.desktop
 kde_servicetypes_DATA = konqaboutpage.desktop
diff -Nurd kdebase-3.5.10/konqueror/client/Makefile.am kdebase-3.5.10-new/konqueror/client/Makefile.am
--- kdebase-3.5.10/konqueror/client/Makefile.am	2005-09-10 01:25:48.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/client/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,7 +6,7 @@
 
 INCLUDES= -I.. $(all_includes)
 kfmclient_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kfmclient_la_LIBADD =  $(LIB_KIO)
+kfmclient_la_LIBADD =  $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) -lDCOP $(LIB_KDEUI)
 kfmclient_la_SOURCES = kfmclient.cc KonquerorIface.stub KDesktopIface.stub
 
 noinst_HEADERS = kfmclient.h
diff -Nurd kdebase-3.5.10/konqueror/keditbookmarks/Makefile.am kdebase-3.5.10-new/konqueror/keditbookmarks/Makefile.am
--- kdebase-3.5.10/konqueror/keditbookmarks/Makefile.am	2005-09-10 01:25:49.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/keditbookmarks/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -2,13 +2,13 @@
 
 METASOURCES = AUTO
 
-bin_PROGRAMS = kbookmarkmerger
+bin_PROGRAMS = 
 lib_LTLIBRARIES =
-kdeinit_LTLIBRARIES = keditbookmarks.la
+kdeinit_LTLIBRARIES = keditbookmarks.la kbookmarkmerger.la
 
-kbookmarkmerger_SOURCES = kbookmarkmerger.cpp
-kbookmarkmerger_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-kbookmarkmerger_LDADD = $(LIB_KIO)
+kbookmarkmerger_la_SOURCES = kbookmarkmerger.cpp
+kbookmarkmerger_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kbookmarkmerger_la_LIBADD = $(LIB_KIO) $(LIB_KDECORE) $(LIB_QT)
 
 dcop_DCOPIDLNG = true
 keditbookmarks_la_SOURCES = main.cpp listview.cpp toplevel.cpp actionsimpl.cpp commands.cpp importers.cpp dcop.skel dcop.cpp bookmarkiterator.cpp  \
diff -Nurd kdebase-3.5.10/konqueror/keditbookmarks/kbookmarkmerger.cpp kdebase-3.5.10-new/konqueror/keditbookmarks/kbookmarkmerger.cpp
--- kdebase-3.5.10/konqueror/keditbookmarks/kbookmarkmerger.cpp	2005-09-10 01:25:49.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/keditbookmarks/kbookmarkmerger.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -55,7 +55,7 @@
 	return XGetSelectionOwner( dpy, atom ) != None;
 }
 
-int main( int argc, char**argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char**argv )
 {
 	const bool kdeRunning = kdeIsRunning();
 
diff -Nurd kdebase-3.5.10/konqueror/kttsplugin/Makefile.am kdebase-3.5.10-new/konqueror/kttsplugin/Makefile.am
--- kdebase-3.5.10/konqueror/kttsplugin/Makefile.am	2005-09-10 01:25:46.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/kttsplugin/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 kde_module_LTLIBRARIES = libkhtmlkttsdplugin.la
 
 libkhtmlkttsdplugin_la_SOURCES = khtmlkttsd.cpp
-libkhtmlkttsdplugin_la_LIBADD  = $(LIB_KHTML)
+libkhtmlkttsdplugin_la_LIBADD  = $(LIB_KHTML) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KPARTS) $(LIB_KIO) -lDCOP
 libkhtmlkttsdplugin_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
 
 pluginsdir = $(kde_datadir)/khtml/kpartplugins
diff -Nurd kdebase-3.5.10/konqueror/shellcmdplugin/Makefile.am kdebase-3.5.10-new/konqueror/shellcmdplugin/Makefile.am
--- kdebase-3.5.10/konqueror/shellcmdplugin/Makefile.am	2005-09-10 01:25:48.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/shellcmdplugin/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 kde_module_LTLIBRARIES = konq_shellcmdplugin.la
 konq_shellcmdplugin_la_SOURCES = kshellcmdexecutor.cpp kshellcmddialog.cpp \
 	kshellcmdplugin.cpp
-konq_shellcmdplugin_la_LIBADD = $(top_builddir)/libkonq/libkonq.la
+konq_shellcmdplugin_la_LIBADD = $(top_builddir)/libkonq/libkonq.la -lkdesu
 konq_shellcmdplugin_la_LDFLAGS = -module $(KDE_PLUGIN) $(all_libraries)
 
 iconviewdir = $(kde_datadir)/konqiconview/kpartplugins
diff -Nurd kdebase-3.5.10/konqueror/sidebar/Makefile.am kdebase-3.5.10-new/konqueror/sidebar/Makefile.am
--- kdebase-3.5.10/konqueror/sidebar/Makefile.am	2005-09-10 01:25:47.000000000 -0700
+++ kdebase-3.5.10-new/konqueror/sidebar/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -26,7 +26,7 @@
 
 libkonqsidebarplugin_la_SOURCES=konqsidebarplugin.cpp
 libkonqsidebarplugin_la_LDFLAGS = -version-info 3:0:2 $(all_libraries) -no-undefined
-libkonqsidebarplugin_la_LIBADD = $(LIB_KPARTS)
+libkonqsidebarplugin_la_LIBADD = $(LIB_KPARTS) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 # this is where the desktop file will go 
 partdesktopdir   = $(kde_servicesdir)
diff -Nurd kdebase-3.5.10/konsole/konsole/Makefile.am kdebase-3.5.10-new/konsole/konsole/Makefile.am
--- kdebase-3.5.10/konsole/konsole/Makefile.am	2006-03-17 02:17:43.000000000 -0800
+++ kdebase-3.5.10-new/konsole/konsole/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -25,7 +25,7 @@
         sessioniface.skel
 
 libkonsolepart_la_LDFLAGS = $(KDE_PLUGIN) $(all_libraries)
-libkonsolepart_la_LIBADD = $(XTESTLIB) $(LIB_KPARTS)
+libkonsolepart_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(XTESTLIB) $(LIB_KPARTS) $(LIB_KIO) -lDCOP
 
 fontembedder_SOURCES = fontembedder.cpp
 fontembedder_LDFLAGS = $(all_libraries)
@@ -42,7 +42,7 @@
      konsole_wcwidth.cpp konsolebookmarkhandler.cpp konsolebookmarkmenu.cpp \
      zmodem_dialog.cpp printsettings.cpp
 konsole_la_LDFLAGS = $(all_libraries) -module -avoid-version
-konsole_la_LIBADD = $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDEPRINT) $(LIBUTIL) $(XTESTLIB) $(LIB_XRENDER)
+konsole_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO) $(LIB_KDEPRINT) $(LIBUTIL) $(XTESTLIB) $(LIB_XRENDER) -lDCOP
 
 # kcmkonsole_SOURCES = kcmkonsole.cpp schema.cpp
 # kcmkonsole_LDADD   = $(LIB_KDEUI)
diff -Nurd kdebase-3.5.10/kpager/Makefile.am kdebase-3.5.10-new/kpager/Makefile.am
--- kdebase-3.5.10/kpager/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kpager/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,14 +1,16 @@
 INCLUDES= $(all_includes)
 
-bin_PROGRAMS = kpager
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kpager.la
 
-kpager_SOURCES = desktop.cpp kpager.cpp config.cpp windowdrag.cpp \
+kpager_la_SOURCES = desktop.cpp kpager.cpp config.cpp windowdrag.cpp \
 	kpagerIface.skel main.cpp  
 
-kpager_METASOURCES = AUTO
-kpager_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kpager_la_METASOURCES = AUTO
+kpager_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
-kpager_LDADD = $(LIB_KDEUI)
+kpager_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) -lDCOP
 
 KDE_ICON = kpager
 
diff -Nurd kdebase-3.5.10/kpager/main.cpp kdebase-3.5.10-new/kpager/main.cpp
--- kdebase-3.5.10/kpager/main.cpp	2005-10-10 08:04:00.000000000 -0700
+++ kdebase-3.5.10-new/kpager/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -62,7 +62,7 @@
 
 };
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
     KAboutData *aboutdata = new KAboutData("kpager", "KPager", "1.5",
 					   I18N_NOOP("Desktop Overview"), KAboutData::License_GPL,
diff -Nurd kdebase-3.5.10/kpersonalizer/Makefile.am kdebase-3.5.10-new/kpersonalizer/Makefile.am
--- kdebase-3.5.10/kpersonalizer/Makefile.am	2005-09-10 01:25:00.000000000 -0700
+++ kdebase-3.5.10-new/kpersonalizer/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,11 +1,14 @@
-bin_PROGRAMS = kpersonalizer
-kpersonalizer_SOURCES = stylepreview.ui krefinepage.cpp \
+bin_PROGRAMS =
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kpersonalizer.la
+
+kpersonalizer_la_SOURCES = stylepreview.ui krefinepage.cpp \
       kstylepage.cpp keyecandypage.cpp kospage.cpp kcountrypage.cpp kpersonalizer.cpp \
       main.cpp kfindlanguage.cpp \
       kcountrypagedlg.ui kospagedlg.ui keyecandypagedlg.ui kstylepagedlg.ui \
       krefinepagedlg.ui  ksysinfo.cpp
 
-kpersonalizer_LDADD   = $(LIB_KIO) 
+kpersonalizer_la_LIBADD  = $(LIB_QT) $(LIB_KDECORE) $(LIB_KIO) $(LIB_KDEUI) -lDCOP -lkdefx
 
 EXTRA_DIST = main.cpp kpersonalizer.cpp kpersonalizer.h kpersonalizer.desktop kcountrypage.cpp kcountrypage.h kospage.cpp kospage.h keyecandypage.cpp keyecandypage.h kstylepage.cpp kstylepage.h krefinepage.cpp krefinepage.h cr16-app-kpersonalizer.png cr32-app-kpersonalizer.png README kcountrypagedlg.ui kospage.ui keyecandypagedlg.ui kstylepagedlg.ui krefinepagedlg.ui kfindlanguage.cpp kfindlanguage.h
 
@@ -38,7 +41,7 @@
 
 KDE_ICON= AUTO
 # the library search path. 
-kpersonalizer_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kpersonalizer_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 # Uncomment the following two lines if you add a ui.rc file for your application to make use of
 # KDEs XML GUI builing
diff -Nurd kdebase-3.5.10/kpersonalizer/main.cpp kdebase-3.5.10-new/kpersonalizer/main.cpp
--- kdebase-3.5.10/kpersonalizer/main.cpp	2005-09-10 01:25:00.000000000 -0700
+++ kdebase-3.5.10-new/kpersonalizer/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -33,7 +33,7 @@
         KCmdLineLastOption
 };
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
 	KAboutData aboutData( "kpersonalizer", I18N_NOOP("KPersonalizer"),
 		VERSION, description, KAboutData::License_GPL,
diff -Nurd kdebase-3.5.10/kreadconfig/Makefile.am kdebase-3.5.10-new/kreadconfig/Makefile.am
--- kdebase-3.5.10/kreadconfig/Makefile.am	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kreadconfig/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,12 +1,17 @@
 AM_CPPFLAGS = -DQT_NO_CAST_ASCII 
 
 INCLUDES = $(all_includes)
-AM_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-LDADD   =       $(LIB_KDECORE)
 
-bin_PROGRAMS	= kreadconfig kwriteconfig
-kreadconfig_SOURCES	= kreadconfig.cpp
-kwriteconfig_SOURCES	= kwriteconfig.cpp
+bin_PROGRAMS	= 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kreadconfig.la kwriteconfig.la
+kreadconfig_la_SOURCES = kreadconfig.cpp
+kreadconfig_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kreadconfig_la_LIBADD  = $(LIB_QT) $(LIB_KDECORE)
+
+kwriteconfig_la_SOURCES	= kwriteconfig.cpp
+kwriteconfig_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+kwriteconfig_la_LIBADD  = $(LIB_QT) $(LIB_KDECORE)
 
 messages:
 	$(XGETTEXT) $(kreadconfig_SOURCES) -o $(podir)/kreadconfig.pot
diff -Nurd kdebase-3.5.10/kreadconfig/kreadconfig.cpp kdebase-3.5.10-new/kreadconfig/kreadconfig.cpp
--- kdebase-3.5.10/kreadconfig/kreadconfig.cpp	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kreadconfig/kreadconfig.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -41,7 +41,7 @@
 	{ "type <type>", I18N_NOOP("Type of variable"), 0 },
         KCmdLineLastOption
 };
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
 	KAboutData aboutData("kreadconfig", I18N_NOOP("KReadConfig"),
 		"1.0.1",
diff -Nurd kdebase-3.5.10/kreadconfig/kwriteconfig.cpp kdebase-3.5.10-new/kreadconfig/kwriteconfig.cpp
--- kdebase-3.5.10/kreadconfig/kwriteconfig.cpp	2005-09-10 01:25:36.000000000 -0700
+++ kdebase-3.5.10-new/kreadconfig/kwriteconfig.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -23,7 +23,7 @@
 	{ "+value", I18N_NOOP( "The value to write. Mandatory, on a shell use '' for empty" ), 0 },
         KCmdLineLastOption
 };
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
 	KAboutData aboutData("kwriteconfig", I18N_NOOP("KWriteConfig"),
 		"1.0.0",
diff -Nurd kdebase-3.5.10/kscreensaver/Makefile.am kdebase-3.5.10-new/kscreensaver/Makefile.am
--- kdebase-3.5.10/kscreensaver/Makefile.am	2005-09-10 01:25:50.000000000 -0700
+++ kdebase-3.5.10-new/kscreensaver/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,15 +4,15 @@
 AM_CPPFLAGS = -UQT_NO_ASCII_CAST
 
 INCLUDES = $(all_includes)
-AM_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+AM_LDFLAGS = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(all_libraries) $(KDE_RPATH)
 
 bin_PROGRAMS = krandom.kss kblankscrn.kss
 
 krandom_kss_SOURCES = random.cpp
-krandom_kss_LDADD = $(LIB_KDEUI) -lm
+krandom_kss_LDADD = -lm
 
 kblankscrn_kss_SOURCES = blankscrn.cpp
-kblankscrn_kss_LDADD = $(LIB_KDEUI) -lkscreensaver -lm 
+kblankscrn_kss_LDADD = -lkscreensaver -lm 
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/ksmserver/Makefile.am kdebase-3.5.10-new/ksmserver/Makefile.am
--- kdebase-3.5.10/ksmserver/Makefile.am	2006-01-19 09:01:08.000000000 -0800
+++ kdebase-3.5.10-new/ksmserver/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -31,7 +31,7 @@
 	KSMServerInterface.skel server.skel
 
 ksmserver_la_LDFLAGS = $(all_libraries) -avoid-version -module
-ksmserver_la_LIBADD = ../kdmlib/libdmctl.la $(LIB_KDEUI)
+ksmserver_la_LIBADD = ../kdmlib/libdmctl.la $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP -lkdefx
 
 picsdir = $(kde_datadir)/ksmserver/pics
 pics_DATA = shutdownkonq.png
diff -Nurd kdebase-3.5.10/ksplashml/Makefile.am kdebase-3.5.10-new/ksplashml/Makefile.am
--- kdebase-3.5.10/ksplashml/Makefile.am	2005-09-10 01:25:51.000000000 -0700
+++ kdebase-3.5.10-new/ksplashml/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,10 +4,13 @@
 
 METASOURCES=AUTO
 
-bin_PROGRAMS = ksplash
-ksplash_SOURCES = wndmain.cpp ksplashiface.skel main.cpp
-ksplash_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-ksplash_LDADD = $(LIB_KDEUI) themeengine/default/libthemedefault.la themeengine/libksplashthemes.la $(LIB_KIO)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = ksplash.la
+
+ksplash_la_SOURCES = wndmain.cpp ksplashiface.skel main.cpp
+ksplash_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+ksplash_la_LIBADD = $(LIB_QT) $(LIB_KDEUI) themeengine/default/libthemedefault.la themeengine/libksplashthemes.la $(LIB_KIO) -lDCOP
 
 noinst_HEADERS = ksplashiface.h wndmain.h
 
diff -Nurd kdebase-3.5.10/ksplashml/kcmksplash/Makefile.am kdebase-3.5.10-new/ksplashml/kcmksplash/Makefile.am
--- kdebase-3.5.10/ksplashml/kcmksplash/Makefile.am	2005-09-10 01:25:50.000000000 -0700
+++ kdebase-3.5.10-new/ksplashml/kcmksplash/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -9,7 +9,7 @@
 kcm_ksplashthemes_la_SOURCES = installer.cpp main.cpp
 noinst_HEADERS = installer.h
 
-kcm_ksplashthemes_la_LIBADD = $(LIB_KIO) 
+kcm_ksplashthemes_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KIO) $(LIB_KDEUI)
 kcm_ksplashthemes_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 xdg_apps_DATA = ksplashthememgr.desktop
diff -Nurd kdebase-3.5.10/ksplashml/main.cpp kdebase-3.5.10-new/ksplashml/main.cpp
--- kdebase-3.5.10/ksplashml/main.cpp	2005-09-10 01:25:51.000000000 -0700
+++ kdebase-3.5.10-new/ksplashml/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -37,7 +37,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
   KAboutData about(
     "ksplash",
diff -Nurd kdebase-3.5.10/ksplashml/themeengine/Makefile.am kdebase-3.5.10-new/ksplashml/themeengine/Makefile.am
--- kdebase-3.5.10/ksplashml/themeengine/Makefile.am	2006-03-17 02:17:40.000000000 -0800
+++ kdebase-3.5.10-new/ksplashml/themeengine/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,7 +6,7 @@
 
 libksplashthemes_la_SOURCES = themeengine.cpp objkstheme.cpp
 libksplashthemes_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -no-undefined
-libksplashthemes_la_LIBADD = $(LIB_KDEUI) $(LIB_XCURSOR)
+libksplashthemes_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_XCURSOR)
 METASOURCES = AUTO
 
 # install this header for theme developers.
diff -Nurd kdebase-3.5.10/ksplashml/themeengine/redmond/Makefile.am kdebase-3.5.10-new/ksplashml/themeengine/redmond/Makefile.am
--- kdebase-3.5.10/ksplashml/themeengine/redmond/Makefile.am	2005-09-10 01:25:50.000000000 -0700
+++ kdebase-3.5.10-new/ksplashml/themeengine/redmond/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 ksplashredmond_la_SOURCES = previewredmond.cpp themeredmond.cpp
 ksplashredmond_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module $(KDE_PLUGIN)
-ksplashredmond_la_LIBADD  = $(LIB_KDEUI) $(LIB_KIO) ../libksplashthemes.la
+ksplashredmond_la_LIBADD  = $(LIB_KDEUI) $(LIB_KIO) ../libksplashthemes.la -lkdefx
 METASOURCES = AUTO
 
 kde_module_LTLIBRARIES = ksplashredmond.la
diff -Nurd kdebase-3.5.10/ksplashml/themeengine/simple/Makefile.am kdebase-3.5.10-new/ksplashml/themeengine/simple/Makefile.am
--- kdebase-3.5.10/ksplashml/themeengine/simple/Makefile.am	2005-09-10 01:25:50.000000000 -0700
+++ kdebase-3.5.10-new/ksplashml/themeengine/simple/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,7 +1,10 @@
 
 INCLUDES = $(all_includes)
 
-bin_PROGRAMS = ksplashsimple
-ksplashsimple_SOURCES = main.cpp
-ksplashsimple_LDFLAGS = $(all_libraries) $(KDE_RPATH)
-ksplashsimple_LDADD = $(LIB_XINERAMA) $(LIB_X11)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = ksplashsimple.la
+
+ksplashsimple_la_SOURCES = main.cpp
+ksplashsimple_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+ksplashsimple_la_LIBADD = $(LIB_XINERAMA) $(LIB_X11)
diff -Nurd kdebase-3.5.10/ksplashml/themeengine/simple/main.cpp kdebase-3.5.10-new/ksplashml/themeengine/simple/main.cpp
--- kdebase-3.5.10/ksplashml/themeengine/simple/main.cpp	2006-10-01 10:32:04.000000000 -0700
+++ kdebase-3.5.10-new/ksplashml/themeengine/simple/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -31,10 +31,11 @@
 # endif
 #endif
 
+#include <kdemacros.h>
 
 //#define DEBUG
 
-int main( int argc, char* argv[])
+extern "C" KDE_EXPORT int kdemain( int argc, char* argv[])
     {
     if( fork() != 0 )
         return 0;
diff -Nurd kdebase-3.5.10/ksplashml/themeengine/standard/Makefile.am kdebase-3.5.10-new/ksplashml/themeengine/standard/Makefile.am
--- kdebase-3.5.10/ksplashml/themeengine/standard/Makefile.am	2005-09-10 01:25:50.000000000 -0700
+++ kdebase-3.5.10-new/ksplashml/themeengine/standard/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -11,7 +11,7 @@
 
 ksplashstandard_la_SOURCES = themestandardlib.cpp
 ksplashstandard_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) $(KDE_PLUGIN) -module
-ksplashstandard_la_LIBADD = $(LIB_KDEUI) ../libksplashthemes.la libthemestandard.la
+ksplashstandard_la_LIBADD = $(LIB_KDEUI) ../libksplashthemes.la libthemestandard.la -lkdefx
 METASOURCES = AUTO
 
 noinst_HEADERS = themestandard.h wndicon.h wndstatus.h
diff -Nurd kdebase-3.5.10/kstart/Makefile.am kdebase-3.5.10-new/kstart/Makefile.am
--- kdebase-3.5.10/kstart/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kstart/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,10 +6,13 @@
 
 #######	Files
 
-bin_PROGRAMS	= kstart
-kstart_SOURCES	= kstart.cpp
-kstart_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
-kstart_LDADD    = $(LIB_KDECORE)
+bin_PROGRAMS	= 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kstart.la
+
+kstart_la_SOURCES	= kstart.cpp
+kstart_la_LDFLAGS  = $(all_libraries) $(KDE_PLUGIN) -module
+kstart_la_LIBADD   = $(LIB_QT) $(LIB_KDECORE)
 METASOURCES =	kstart.moc 
 
 noinst_HEADERS = kstart.h version.h
diff -Nurd kdebase-3.5.10/kstart/kstart.cpp kdebase-3.5.10-new/kstart/kstart.cpp
--- kdebase-3.5.10/kstart/kstart.cpp	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kstart/kstart.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -283,7 +283,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char *argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char *argv[] )
 {
   // David, 05/03/2000
   KAboutData aboutData( "kstart", I18N_NOOP("KStart"), KSTART_VERSION,
diff -Nurd kdebase-3.5.10/ksysguard/gui/Makefile.am kdebase-3.5.10-new/ksysguard/gui/Makefile.am
--- kdebase-3.5.10/ksysguard/gui/Makefile.am	2005-09-10 01:26:15.000000000 -0700
+++ kdebase-3.5.10-new/ksysguard/gui/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -18,21 +18,23 @@
  
 ####### This part is very ksysguard specific
 # you can add here more. This one gets installed 
-bin_PROGRAMS = ksysguard kpm
+bin_PROGRAMS = kpm
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = ksysguard.la
 
 # Which sources should be compiled for ksysguard.
-ksysguard_SOURCES = \
+ksysguard_la_SOURCES = \
 	SensorBrowser.cc \
 	WorkSheet.cc \
 	WorkSheetSettings.cc \
 	Workspace.cc \
 	ksysguard.cc ksysguard.skel
 
-ksysguard_LDADD = \
+ksysguard_la_LIBADD = \
 	ksgrd/libksgrd.la \
 	SensorDisplayLib/libsensordisplays.la \
-	$(LIB_KDEUI) $(LIB_KIO) $(LIB_KDNSSD)
-ksysguard_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+	$(LIB_KDEUI) $(LIB_KIO) $(LIB_KDNSSD) -lDCOP
+ksysguard_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module
 
 kpm_SOURCES = kpm.c
 
diff -Nurd kdebase-3.5.10/ksysguard/gui/ksgrd/Makefile.am kdebase-3.5.10-new/ksysguard/gui/ksgrd/Makefile.am
--- kdebase-3.5.10/ksysguard/gui/ksgrd/Makefile.am	2005-09-10 01:26:15.000000000 -0700
+++ kdebase-3.5.10-new/ksysguard/gui/ksgrd/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 lib_LTLIBRARIES = libksgrd.la
 
 libksgrd_la_LDFLAGS = -no-undefined -version-info 3:0:2 $(all_libraries)
-libksgrd_la_LIBADD = $(LIB_KDEUI)
+libksgrd_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 # Which sources should be compiled for ksysguard.
 libksgrd_la_SOURCES = \
diff -Nurd kdebase-3.5.10/ksysguard/gui/ksysguard.cc kdebase-3.5.10-new/ksysguard/gui/ksysguard.cc
--- kdebase-3.5.10/ksysguard/gui/ksysguard.cc	2006-03-17 02:17:48.000000000 -0800
+++ kdebase-3.5.10-new/ksysguard/gui/ksysguard.cc	2010-05-13 05:26:41.000000000 -0700
@@ -520,7 +520,7 @@
 /*
  * Once upon a time...
  */
-int main( int argc, char** argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char** argv )
 {
   // initpipe is used to keep the parent process around till the child
   // has registered with dcop.
diff -Nurd kdebase-3.5.10/ksystraycmd/Makefile.am kdebase-3.5.10-new/ksystraycmd/Makefile.am
--- kdebase-3.5.10/ksystraycmd/Makefile.am	2005-09-10 01:26:16.000000000 -0700
+++ kdebase-3.5.10-new/ksystraycmd/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,16 +1,19 @@
 ####### Fiddle here
 
 INCLUDES = $(all_includes)
-LDADD    = $(LIB_KDEUI)
 
 #######	Files
 
-bin_PROGRAMS	= ksystraycmd
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = ksystraycmd.la
+
 METASOURCES	= ksystraycmd.moc
 noinst_HEADERS  = ksystraycmd.h
 
-ksystraycmd_SOURCES = ksystraycmd.cpp main.cpp
-ksystraycmd_LDFLAGS  = $(all_libraries) $(KDE_RPATH)
+ksystraycmd_la_SOURCES = ksystraycmd.cpp main.cpp
+ksystraycmd_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
+ksystraycmd_la_LIBADD  = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 
 messages:
 	$(XGETTEXT) $(ksystraycmd_SOURCES) -o $(podir)/ksystraycmd.pot
diff -Nurd kdebase-3.5.10/ksystraycmd/main.cpp kdebase-3.5.10-new/ksystraycmd/main.cpp
--- kdebase-3.5.10/ksystraycmd/main.cpp	2006-10-01 10:32:16.000000000 -0700
+++ kdebase-3.5.10-new/ksystraycmd/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -46,7 +46,7 @@
   KCmdLineLastOption
 };
 
-int main( int argc, char *argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char *argv[] )
 {
   KAboutData aboutData( "ksystraycmd", I18N_NOOP( "KSysTrayCmd" ),
 			"KSysTrayCmd 0.1",
diff -Nurd kdebase-3.5.10/ktip/Makefile.am kdebase-3.5.10-new/ktip/Makefile.am
--- kdebase-3.5.10/ktip/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/ktip/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -2,10 +2,13 @@
 
 SUBDIRS = pics
 
-bin_PROGRAMS = ktip
-ktip_SOURCES = ktipwindow.cpp
-ktip_LDADD = $(LIB_KDEUI)
-ktip_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = ktip.la
+
+ktip_la_SOURCES = ktipwindow.cpp
+ktip_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) -lDCOP $(LIB_KDEUI)
+ktip_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
 KDE_ICON = AUTO
diff -Nurd kdebase-3.5.10/ktip/ktipwindow.cpp kdebase-3.5.10-new/ktip/ktipwindow.cpp
--- kdebase-3.5.10/ktip/ktipwindow.cpp	2005-10-10 08:04:21.000000000 -0700
+++ kdebase-3.5.10-new/ktip/ktipwindow.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -31,7 +31,7 @@
 
 static const char description[] = I18N_NOOP("Useful tips");
 
-int main(int argc, char *argv[])
+extern "C" KDE_EXPORT int kdemain(int argc, char *argv[])
 {
 	KAboutData aboutData("ktip", I18N_NOOP("KTip"),
 				"0.3", description, KAboutData::License_GPL,
diff -Nurd kdebase-3.5.10/kwin/Makefile.am kdebase-3.5.10-new/kwin/Makefile.am
--- kdebase-3.5.10/kwin/Makefile.am	2005-09-10 01:26:03.000000000 -0700
+++ kdebase-3.5.10-new/kwin/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -17,7 +17,7 @@
 	manage.cpp notifications.cpp activation.cpp useractions.cpp \
 	geometry.cpp rules.cpp
 
-kwin_la_LIBADD = $(LIB_KDEUI) lib/libkdecorations.la
+kwin_la_LIBADD = $(LIB_KDEUI) lib/libkdecorations.la -lDCOP
 kwin_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 include_HEADERS = KWinInterface.h
diff -Nurd kdebase-3.5.10/kwin/clients/b2/Makefile.am kdebase-3.5.10-new/kwin/clients/b2/Makefile.am
--- kdebase-3.5.10/kwin/clients/b2/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/b2/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 kwin3_b2_la_SOURCES = b2client.cpp
 kwin3_b2_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 # kwin_b2_la_LDFLAGS = $(all_libraries) -avoid-version -module $(KDE_RPATH) $(KDE_MT_LDFLAGS)
-kwin3_b2_la_LIBADD  = ../../lib/libkdecorations.la
+kwin3_b2_la_LIBADD  = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 
 METASOURCES = AUTO
 noinst_HEADERS = b2client.h
diff -Nurd kdebase-3.5.10/kwin/clients/b2/config/Makefile.am kdebase-3.5.10-new/kwin/clients/b2/config/Makefile.am
--- kdebase-3.5.10/kwin/clients/b2/config/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/b2/config/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 kwin_b2_config_la_SOURCES = config.cpp
 kwin_b2_config_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin_b2_config_la_LIBADD = $(LIB_KDEUI)
+kwin_b2_config_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 noinst_HEADERS = config.h
diff -Nurd kdebase-3.5.10/kwin/clients/default/Makefile.am kdebase-3.5.10-new/kwin/clients/default/Makefile.am
--- kdebase-3.5.10/kwin/clients/default/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/default/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,7 +7,7 @@
 
 kwin3_default_la_SOURCES = kdedefault.cpp
 kwin3_default_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_default_la_LIBADD  = $(LIB_KDECORE) ../../lib/libkdecorations.la
+kwin3_default_la_LIBADD  = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 
 METASOURCES = AUTO
 noinst_HEADERS = kdedefault.h
diff -Nurd kdebase-3.5.10/kwin/clients/default/config/Makefile.am kdebase-3.5.10-new/kwin/clients/default/config/Makefile.am
--- kdebase-3.5.10/kwin/clients/default/config/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/default/config/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 kwin_default_config_la_SOURCES = config.cpp
 kwin_default_config_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin_default_config_la_LIBADD = $(LIB_KDEUI)
+kwin_default_config_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 noinst_HEADERS = config.h
diff -Nurd kdebase-3.5.10/kwin/clients/keramik/Makefile.am kdebase-3.5.10-new/kwin/clients/keramik/Makefile.am
--- kdebase-3.5.10/kwin/clients/keramik/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/keramik/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -15,7 +15,7 @@
 kwin3_keramik_la_SOURCES   = keramik.cpp
 kwin3_keramik_la_COMPILE_FIRST = tiles.h
 kwin3_keramik_la_LDFLAGS   = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_keramik_la_LIBADD    = $(LIB_KDEUI) ../../lib/libkdecorations.la
+kwin3_keramik_la_LIBADD    = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 #kwin3_keramik_la_LDFLAGS   = $(all_libraries) -avoid-version -module $(KDE_RPATH) $(KDE_MT_LDFLAGS)
 
 METASOURCES               = AUTO
diff -Nurd kdebase-3.5.10/kwin/clients/keramik/config/Makefile.am kdebase-3.5.10-new/kwin/clients/keramik/config/Makefile.am
--- kdebase-3.5.10/kwin/clients/keramik/config/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/keramik/config/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 kwin_keramik_config_la_SOURCES = config.cpp keramikconfig.ui
 kwin_keramik_config_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin_keramik_config_la_LIBADD  = $(LIB_KDEUI)
+kwin_keramik_config_la_LIBADD  = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES                    = AUTO
 noinst_HEADERS                 = config.h keramikconfig.h
diff -Nurd kdebase-3.5.10/kwin/clients/kwmtheme/Makefile.am kdebase-3.5.10-new/kwin/clients/kwmtheme/Makefile.am
--- kdebase-3.5.10/kwin/clients/kwmtheme/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/kwmtheme/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 
 kwin3_kwmtheme_la_SOURCES = kwmthemeclient.cpp
 kwin3_kwmtheme_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_kwmtheme_la_LIBADD  = -lkdecorations
+kwin3_kwmtheme_la_LIBADD  = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 
 METASOURCES = AUTO
 noinst_HEADERS = kwmthemeclient.h
diff -Nurd kdebase-3.5.10/kwin/clients/kwmtheme/cli_installer/Makefile.am kdebase-3.5.10-new/kwin/clients/kwmtheme/cli_installer/Makefile.am
--- kdebase-3.5.10/kwin/clients/kwmtheme/cli_installer/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/kwmtheme/cli_installer/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,15 +4,17 @@
 
 ####### This part is very kwmtheme specific
 # you can add here more. This one gets installed 
-bin_PROGRAMS = 	kwmtheme
+bin_PROGRAMS = 	
+lib_LTLIBRARIES = 
+kdeinit_LTLIBRARIES = kwmtheme.la
 
 # Which sources should be compiled for kwmtheme.
-kwmtheme_SOURCES = main.cpp 
+kwmtheme_la_SOURCES = main.cpp 
 
 # the library search path. 
-kwmtheme_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kwmtheme_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 # the libraries to link against. Be aware of the order. First the libraries,
 # that depend on the following ones.
-kwmtheme_LDADD   = $(LIB_KDECORE)
+kwmtheme_la_LIBADD   = $(LIB_KDECORE)
 
diff -Nurd kdebase-3.5.10/kwin/clients/kwmtheme/cli_installer/main.cpp kdebase-3.5.10-new/kwin/clients/kwmtheme/cli_installer/main.cpp
--- kdebase-3.5.10/kwin/clients/kwmtheme/cli_installer/main.cpp	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/kwmtheme/cli_installer/main.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -37,7 +37,7 @@
     copyOutput.close();
 }
 
-int main(int argc, char **argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char **argv)
 {
     KCmdLineArgs::init(argc, argv, "kwmtheme", description, "0.1");
     KCmdLineArgs::addCmdLineOptions( options );
diff -Nurd kdebase-3.5.10/kwin/clients/laptop/Makefile.am kdebase-3.5.10-new/kwin/clients/laptop/Makefile.am
--- kdebase-3.5.10/kwin/clients/laptop/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/laptop/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 
 kwin3_laptop_la_SOURCES = laptopclient.cpp
 kwin3_laptop_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module 
-kwin3_laptop_la_LIBADD  = ../../lib/libkdecorations.la
+kwin3_laptop_la_LIBADD  = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 
 METASOURCES = AUTO
 noinst_HEADERS = laptopclient.h
diff -Nurd kdebase-3.5.10/kwin/clients/modernsystem/Makefile.am kdebase-3.5.10-new/kwin/clients/modernsystem/Makefile.am
--- kdebase-3.5.10/kwin/clients/modernsystem/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/modernsystem/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,7 +6,7 @@
 kde_module_LTLIBRARIES = kwin3_modernsys.la
 
 kwin3_modernsys_la_SOURCES = modernsys.cpp
-kwin3_modernsys_la_LIBADD = ../../lib/libkdecorations.la
+kwin3_modernsys_la_LIBADD = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 kwin3_modernsys_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kwin/clients/modernsystem/config/Makefile.am kdebase-3.5.10-new/kwin/clients/modernsystem/config/Makefile.am
--- kdebase-3.5.10/kwin/clients/modernsystem/config/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/modernsystem/config/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 
 kwin_modernsys_config_la_SOURCES = config.cpp
 kwin_modernsys_config_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin_modernsys_config_la_LIBADD = $(LIB_KDEUI)
+kwin_modernsys_config_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 noinst_HEADERS = config.h
diff -Nurd kdebase-3.5.10/kwin/clients/plastik/Makefile.am kdebase-3.5.10-new/kwin/clients/plastik/Makefile.am
--- kdebase-3.5.10/kwin/clients/plastik/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/plastik/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -12,7 +12,7 @@
 kde_module_LTLIBRARIES = kwin3_plastik.la
 kwin3_plastik_la_SOURCES = plastik.cpp plastikclient.cpp plastikbutton.cpp misc.cpp
 kwin3_plastik_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_plastik_la_LIBADD = $(LIB_KDEUI) ../../lib/libkdecorations.la
+kwin3_plastik_la_LIBADD = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 kwin3_plastik_la_METASOURCES = AUTO
 
 DISTCLEANFILES = $(kwin3_plastik_la_METASOURCES)
diff -Nurd kdebase-3.5.10/kwin/clients/plastik/config/Makefile.am kdebase-3.5.10-new/kwin/clients/plastik/config/Makefile.am
--- kdebase-3.5.10/kwin/clients/plastik/config/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/plastik/config/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 kwin_plastik_config_la_SOURCES = config.cpp configdialog.ui
 kwin_plastik_config_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin_plastik_config_la_LIBADD  = $(LIB_KDEUI)
+kwin_plastik_config_la_LIBADD  = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES                  = AUTO
 noinst_HEADERS               = config.h
diff -Nurd kdebase-3.5.10/kwin/clients/quartz/Makefile.am kdebase-3.5.10-new/kwin/clients/quartz/Makefile.am
--- kdebase-3.5.10/kwin/clients/quartz/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/quartz/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -7,7 +7,7 @@
 
 kwin3_quartz_la_SOURCES = quartz.cpp
 kwin3_quartz_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_quartz_la_LIBADD  = $(LIB_KDEUI)  ../../lib/libkdecorations.la
+kwin3_quartz_la_LIBADD  = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 
 METASOURCES = AUTO
 noinst_HEADERS = quartz.h
diff -Nurd kdebase-3.5.10/kwin/clients/quartz/config/Makefile.am kdebase-3.5.10-new/kwin/clients/quartz/config/Makefile.am
--- kdebase-3.5.10/kwin/clients/quartz/config/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/quartz/config/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 kwin_quartz_config_la_SOURCES = config.cpp
 kwin_quartz_config_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin_quartz_config_la_LIBADD = $(LIB_KDEUI)
+kwin_quartz_config_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
 
 METASOURCES = AUTO
 noinst_HEADERS = config.h
diff -Nurd kdebase-3.5.10/kwin/clients/redmond/Makefile.am kdebase-3.5.10-new/kwin/clients/redmond/Makefile.am
--- kdebase-3.5.10/kwin/clients/redmond/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/redmond/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 
 kwin3_redmond_la_SOURCES = redmond.cpp
 kwin3_redmond_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_redmond_la_LIBADD = $(LIB_KDECORE) ../../lib/libkdecorations.la
+kwin3_redmond_la_LIBADD = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 
 METASOURCES = AUTO
 noinst_HEADERS = redmond.h
diff -Nurd kdebase-3.5.10/kwin/clients/test/Makefile.am kdebase-3.5.10-new/kwin/clients/test/Makefile.am
--- kdebase-3.5.10/kwin/clients/test/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/test/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -4,7 +4,7 @@
 
 kwin3_test_la_SOURCES   = test.cpp
 kwin3_test_la_LDFLAGS   = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_test_la_LIBADD    = $(LIB_KDEUI) ../../lib/libkdecorations.la
+kwin3_test_la_LIBADD    = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 #kwin_keramik_la_LDFLAGS   = $(all_libraries) -avoid-version -module $(KDE_RPATH) $(KDE_MT_LDFLAGS)
 
 METASOURCES               = AUTO
diff -Nurd kdebase-3.5.10/kwin/clients/web/Makefile.am kdebase-3.5.10-new/kwin/clients/web/Makefile.am
--- kdebase-3.5.10/kwin/clients/web/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/clients/web/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -6,7 +6,7 @@
 noinst_HEADERS            = Web.h WebButton.h
 
 kwin3_web_la_LDFLAGS      = $(all_libraries) $(KDE_PLUGIN) -module
-kwin3_web_la_LIBADD       = $(LIB_KDEUI) ../../lib/libkdecorations.la
+kwin3_web_la_LIBADD       = $(LIB_KDEUI) ../../lib/libkdecorations.la -lkdefx
 METASOURCES               = AUTO
 
 linkdir                   = $(kde_datadir)/kwin/
diff -Nurd kdebase-3.5.10/kwin/data/Makefile.am kdebase-3.5.10-new/kwin/data/Makefile.am
--- kdebase-3.5.10/kwin/data/Makefile.am	2007-05-14 00:55:48.000000000 -0700
+++ kdebase-3.5.10-new/kwin/data/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -2,11 +2,11 @@
 kconfdir = $(libdir)/kconf_update_bin
 
 kwin_update_window_settings_SOURCES = update_window_settings.cpp
-kwin_update_window_settings_LDADD   = $(LIB_KDECORE) $(KDE_RPATH)
+kwin_update_window_settings_LDADD   = $(LIB_QT) -lDCOP $(LIB_KDECORE) $(KDE_RPATH)
 kwin_update_window_settings_LDFLAGS = $(all_libraries)
 
 kwin_update_default_rules_SOURCES = update_default_rules.cpp
-kwin_update_default_rules_LDADD   = $(LIB_KDECORE) $(KDE_RPATH)
+kwin_update_default_rules_LDADD   = $(LIB_QT) -lDCOP $(LIB_KDECORE) $(KDE_RPATH)
 kwin_update_default_rules_LDFLAGS = $(all_libraries)
 
 INCLUDES = $(all_includes)
diff -Nurd kdebase-3.5.10/kwin/kcmkwin/kwindecoration/Makefile.am kdebase-3.5.10-new/kwin/kcmkwin/kwindecoration/Makefile.am
--- kdebase-3.5.10/kwin/kcmkwin/kwindecoration/Makefile.am	2005-09-10 01:25:56.000000000 -0700
+++ kdebase-3.5.10-new/kwin/kcmkwin/kwindecoration/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -8,7 +8,7 @@
 kcm_kwindecoration_la_LDFLAGS = \
   -module -avoid-version $(all_libraries) -no-undefined
 
-kcm_kwindecoration_la_LIBADD = $(LIB_KDEUI) ../../lib/libkdecorations.la
+kcm_kwindecoration_la_LIBADD = $(LIB_KDEUI) ../../lib/libkdecorations.la -lDCOP
 
 METASOURCES = AUTO
 
diff -Nurd kdebase-3.5.10/kwin/kcmkwin/kwinoptions/Makefile.am kdebase-3.5.10-new/kwin/kcmkwin/kwinoptions/Makefile.am
--- kdebase-3.5.10/kwin/kcmkwin/kwinoptions/Makefile.am	2005-09-10 01:26:02.000000000 -0700
+++ kdebase-3.5.10-new/kwin/kcmkwin/kwinoptions/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -5,7 +5,7 @@
 
 kcm_kwinoptions_la_SOURCES = windows.cpp mouse.cpp main.cpp
 kcm_kwinoptions_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_kwinoptions_la_LIBADD = $(LIB_KDEUI)
+kcm_kwinoptions_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 noinst_HEADERS = windows.h mouse.h 
 
diff -Nurd kdebase-3.5.10/kwin/kcmkwin/kwinrules/Makefile.am kdebase-3.5.10-new/kwin/kcmkwin/kwinrules/Makefile.am
--- kdebase-3.5.10/kwin/kcmkwin/kwinrules/Makefile.am	2006-05-22 11:13:01.000000000 -0700
+++ kdebase-3.5.10-new/kwin/kcmkwin/kwinrules/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -11,16 +11,16 @@
 libkwinrules_la_SOURCES = ruleswidget.cpp ruleslist.cpp kwinsrc.cpp detectwidget.cpp \
         ruleswidgetbase.ui ruleslistbase.ui detectwidgetbase.ui editshortcutbase.ui
 libkwinrules_la_LDFLAGS = $(all_libraries) -no-undefined
-libkwinrules_la_LIBADD = $(LIB_KDEUI)
+libkwinrules_la_LIBADD = $(LIB_KDEUI) $(LIB_KDECORE) $(LIB_QT)
 
 kcm_kwinrules_la_SOURCES = kcm.cpp 
 kcm_kwinrules_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kcm_kwinrules_la_LIBADD = libkwinrules.la 
+kcm_kwinrules_la_LIBADD = libkwinrules.la $(LIB_KDECORE) $(LIB_QT) -lDCOP
 kcm_kwinrules_la_COMPILE_FIRST = ruleslistbase.h ruleswidgetbase.h editshortcutbase.h
 
 kwin_rules_dialog_la_SOURCES = main.cpp 
 kwin_rules_dialog_la_LDFLAGS = -module -avoid-version $(all_libraries) -no-undefined
-kwin_rules_dialog_la_LIBADD = libkwinrules.la 
+kwin_rules_dialog_la_LIBADD = libkwinrules.la $(LIB_KDECORE) $(LIB_QT) -lDCOP
 kwin_rules_dialog_la_COMPILE_FIRST = ruleslistbase.h ruleswidgetbase.h editshortcutbase.h
 
 messages: rc.cpp
diff -Nurd kdebase-3.5.10/kwin/killer/Makefile.am kdebase-3.5.10-new/kwin/killer/Makefile.am
--- kdebase-3.5.10/kwin/killer/Makefile.am	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/killer/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,9 +1,11 @@
 INCLUDES = $(all_includes)
 
-bin_PROGRAMS = kwin_killer_helper
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = kwin_killer_helper.la
 
-kwin_killer_helper_SOURCES = killer.cpp
-kwin_killer_helper_LDADD = $(LIB_KDEUI)
-kwin_killer_helper_LDFLAGS = $(all_libraries) $(KDE_RPATH)
+kwin_killer_helper_la_SOURCES = killer.cpp
+kwin_killer_helper_la_LIBADD = $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE)
+kwin_killer_helper_la_LDFLAGS = $(all_libraries) $(KDE_PLUGIN) -module
 
 METASOURCES = AUTO
diff -Nurd kdebase-3.5.10/kwin/killer/killer.cpp kdebase-3.5.10-new/kwin/killer/killer.cpp
--- kdebase-3.5.10/kwin/killer/killer.cpp	2005-09-10 01:25:55.000000000 -0700
+++ kdebase-3.5.10-new/kwin/killer/killer.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -43,7 +43,7 @@
         KCmdLineLastOption
     };
 
-int main( int argc, char* argv[] )
+extern "C" KDE_EXPORT int kdemain( int argc, char* argv[] )
     {
     KLocale::setMainCatalogue( "kwin" ); // the messages are in kwin's .po file
     KCmdLineArgs::init( argc, argv, "kwin_killer_helper", I18N_NOOP( "KWin" ),
diff -Nurd kdebase-3.5.10/kwin/lib/Makefile.am kdebase-3.5.10-new/kwin/lib/Makefile.am
--- kdebase-3.5.10/kwin/lib/Makefile.am	2005-09-10 01:26:02.000000000 -0700
+++ kdebase-3.5.10-new/kwin/lib/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -3,7 +3,7 @@
 
 libkdecorations_la_SOURCES = kdecoration.cpp kdecoration_p.cpp kdecoration_plugins_p.cpp \
         kdecorationfactory.cpp kcommondecoration.cpp
-libkdecorations_la_LIBADD = $(LIB_KDECORE)
+libkdecorations_la_LIBADD = $(LIB_KDECORE) $(LIB_QT)
 libkdecorations_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -no-undefined
 
 # FRAME
diff -Nurd kdebase-3.5.10/kxkb/Makefile.am kdebase-3.5.10-new/kxkb/Makefile.am
--- kdebase-3.5.10/kxkb/Makefile.am	2006-03-17 02:17:41.000000000 -0800
+++ kdebase-3.5.10-new/kxkb/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -13,14 +13,14 @@
 kcm_keyboard_la_SOURCES = extension.cpp x11helper.cpp rules.cpp kxkbconfig.cpp pixmap.cpp \
 	kcmlayout.cpp kcmlayoutwidget.ui kcmmisc.cpp kcmmiscwidget.ui
 kcm_keyboard_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
-kcm_keyboard_la_LIBADD = -lxkbfile $(XTESTLIB) $(LIB_KIO)
+kcm_keyboard_la_LIBADD = -lxkbfile $(XTESTLIB) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO)
 
 #kxkb_la_includedir = .
 #kxkb_la_include_HEADERS = kxkb.h
 kxkb_la_SOURCES = extension.cpp x11helper.cpp rules.cpp kxkbconfig.cpp pixmap.cpp \
 	layoutmap.cpp kxkb.cpp kxkbtraywindow.cpp kxkb.skel
 kxkb_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kxkb_la_LIBADD = -lxkbfile -lX11 -lXext $(LIB_KDEUI)
+kxkb_la_LIBADD = -lxkbfile -lX11 -lXext $(LIB_KDEUI) $(LIB_QT) $(LIB_KDECORE) -lDCOP
 
 xdg_apps_DATA = keyboard.desktop keyboard_layout.desktop
 
diff -Nurd kdebase-3.5.10/libkonq/Makefile.am kdebase-3.5.10-new/libkonq/Makefile.am
--- kdebase-3.5.10/libkonq/Makefile.am	2005-10-10 08:04:21.000000000 -0700
+++ kdebase-3.5.10-new/libkonq/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -21,7 +21,7 @@
 
 lib_LTLIBRARIES = libkonq.la
 libkonq_la_LDFLAGS = $(all_libraries) -version-info 6:0:2 -no-undefined
-libkonq_la_LIBADD = $(LIB_KPARTS)
+libkonq_la_LIBADD = $(LIB_QT) -lDCOP $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KIO) $(LIB_KPARTS) $(LIBZ) -lkdefx
 
 libkonq_la_SOURCES = konq_popupmenu.cc knewmenu.cc \
    konq_xmlguiclient.cc\
@@ -60,7 +60,7 @@
 kde_module_LTLIBRARIES = $(ARTS_MODULE)
 konq_sound_la_SOURCES = konq_sound.cc
 konq_sound_la_LDFLAGS = $(all_libraries) -module $(KDE_PLUGIN)
-konq_sound_la_LIBADD = -lsoundserver_idl -lartskde
+konq_sound_la_LIBADD = -lsoundserver_idl -lartskde $(LIB_KDECORE) -lmcop $(LIB_QT)
 
 noinst_HEADERS = konq_sound.h
 
diff -Nurd kdebase-3.5.10/nsplugins/Makefile.am kdebase-3.5.10-new/nsplugins/Makefile.am
--- kdebase-3.5.10/nsplugins/Makefile.am	2007-10-08 02:51:24.000000000 -0700
+++ kdebase-3.5.10-new/nsplugins/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -11,16 +11,19 @@
 			NSPluginCallbackIface.skel
 
 libnsplugin_la_LDFLAGS = $(all_libraries) -avoid-version -module $(KDE_PLUGIN) -no-undefined
-libnsplugin_la_LIBADD  = -lkparts
+libnsplugin_la_LIBADD  = $(LIB_QT) -lDCOP $(LIB_KDECORE) $(LIB_KPARTS) $(LIB_KDEUI) $(LIB_KIO)
 
-bin_PROGRAMS = nspluginscan
-nspluginscan_SOURCES = pluginscan.cpp 
-nspluginscan_LDFLAGS =  $(KDE_RPATH) $(all_libraries) -export-dynamic
-nspluginscan_LDADD = $(LIB_KDEUI) $(LIB_KSYCOCA) -lXt libpluginpaths.la
+bin_PROGRAMS = 
+lib_LTLIBRARIES =
+kdeinit_LTLIBRARIES = nspluginscan.la
+
+nspluginscan_la_SOURCES = pluginscan.cpp
+nspluginscan_la_LDFLAGS =  $(KDE_PLUGIN) $(all_libraries) -export-dynamic -module
+nspluginscan_la_LIBADD = $(LIB_QT) -lDCOP $(LIB_KDECORE) $(LIB_KDEUI) $(LIB_KSYCOCA) -lXt libpluginpaths.la
 
 kcm_nsplugins_la_SOURCES = kcm_nsplugins.cpp 
 kcm_nsplugins_la_LDFLAGS = $(all_libraries) -module -avoid-version -no-undefined
-kcm_nsplugins_la_LIBADD = $(LIB_KDECORE) libpluginpaths.la
+kcm_nsplugins_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) libpluginpaths.la
 
 noinst_LTLIBRARIES = libpluginpaths.la
 libpluginpaths_la_SOURCES = plugin_paths.cpp
diff -Nurd kdebase-3.5.10/nsplugins/pluginscan.cpp kdebase-3.5.10-new/nsplugins/pluginscan.cpp
--- kdebase-3.5.10/nsplugins/pluginscan.cpp	2007-10-08 02:51:24.000000000 -0700
+++ kdebase-3.5.10-new/nsplugins/pluginscan.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -516,7 +516,7 @@
 };
 
 
-int main( int argc, char **argv )
+extern "C" KDE_EXPORT int kdemain( int argc, char **argv )
 {
     KAboutData aboutData( "nspluginscan", I18N_NOOP("nspluginscan"),
                           "0.3", "nspluginscan", KAboutData::License_GPL,
diff -Nurd kdebase-3.5.10/nsplugins/sdk/prcpucfg.h kdebase-3.5.10-new/nsplugins/sdk/prcpucfg.h
--- kdebase-3.5.10/nsplugins/sdk/prcpucfg.h	2008-02-13 01:40:38.000000000 -0800
+++ kdebase-3.5.10-new/nsplugins/sdk/prcpucfg.h	2010-05-13 05:26:41.000000000 -0700
@@ -48,7 +48,7 @@
 
 #define PR_AF_INET6 10  /* same as AF_INET6 */
 
-#ifdef __powerpc__
+#if defined(__powerpc__) || defined(__POWERPC__)
 
 #undef  IS_LITTLE_ENDIAN
 #define IS_BIG_ENDIAN    1
diff -Nurd kdebase-3.5.10/nsplugins/viewer/Makefile.am kdebase-3.5.10-new/nsplugins/viewer/Makefile.am
--- kdebase-3.5.10/nsplugins/viewer/Makefile.am	2008-02-13 01:40:38.000000000 -0800
+++ kdebase-3.5.10-new/nsplugins/viewer/Makefile.am	2010-05-13 05:26:41.000000000 -0700
@@ -1,11 +1,13 @@
 INCLUDES = -I$(top_srcdir)/nsplugins -I$(top_builddir)/nsplugins $(all_includes) `pkg-config --cflags glib-2.0`
 METASOURCES = AUTO
 
-bin_PROGRAMS = nspluginviewer 
+bin_PROGRAMS = 
+lib_LTLIBRARIES = 
+kdeinit_LTLIBRARIES = nspluginviewer.la
 
-nspluginviewer_SOURCES = NSPluginCallbackIface.stub NSPluginClassIface.skel \
+nspluginviewer_la_SOURCES = NSPluginCallbackIface.stub NSPluginClassIface.skel \
 	nsplugin.cpp viewer.cpp kxt.cpp qxteventloop.cpp glibevents.cpp
-nspluginviewer_LDFLAGS = $(all_libraries) $(KDE_RPATH) -export-dynamic `pkg-config --libs glib-2.0`
-nspluginviewer_LDADD = $(LIB_KIO) $(LIB_KPARTS) -lXt
+nspluginviewer_la_LDFLAGS = $(all_libraries) $(KDE_RPATH) -module -export-dynamic `pkg-config --libs glib-2.0`
+nspluginviewer_la_LIBADD = $(LIB_KIO) $(LIB_KPARTS) -lXt $(LIB_QT) $(LIB_KDECORE) -lDCOP -lglib-2.0 $(LIB_KDEUI)
 
 NSPluginCallbackIface_DIR = $(srcdir)/..
diff -Nurd kdebase-3.5.10/nsplugins/viewer/viewer.cpp kdebase-3.5.10-new/nsplugins/viewer/viewer.cpp
--- kdebase-3.5.10/nsplugins/viewer/viewer.cpp	2008-02-13 01:40:38.000000000 -0800
+++ kdebase-3.5.10-new/nsplugins/viewer/viewer.cpp	2010-05-13 05:26:41.000000000 -0700
@@ -22,6 +22,9 @@
 
 */
 
+#if defined(__APPLE__) && !defined(RLIMIT_AS) && defined(RLIMIT_RSS)
+#define RLIMIT_AS RLIMIT_RSS
+#endif
 
 #include <config.h>
 
@@ -214,7 +217,7 @@
 #endif
 
 
-int main(int argc, char** argv)
+extern "C" KDE_EXPORT int kdemain(int argc, char** argv)
 {
     // nspluginviewer is a helper app, it shouldn't do session management at all
    setenv( "SESSION_MANAGER", "", 1 );
diff -Nurd kdebase-3.5.10/startkde kdebase-3.5.10-new/startkde
--- kdebase-3.5.10/startkde	2008-08-19 12:56:42.000000000 -0700
+++ kdebase-3.5.10-new/startkde	2010-05-13 05:26:41.000000000 -0700
@@ -3,6 +3,11 @@
 #  DEFAULT KDE STARTUP SCRIPT ( KDE-3.5.10 )
 #
 
+source "@FINKPREFIX@/bin/init.sh"
+
+[ -x @FINKPREFIX@/bin/remap-bad-apple-keys.pl ] && @FINKPREFIX@/bin/remap-bad-apple-keys.pl
+
+
 # When the X server dies we get a HUP signal from xinit. We must ignore it
 # because we still need to do some cleanup.
 trap 'echo GOT SIGHUP' HUP
@@ -285,20 +290,23 @@
 
 echo 'startkde: Starting up...'  1>&2
 
-# run KPersonalizer before the session, if this is the first login
-if test "$kpersonalizerrc_general_firstlogin" = "true"; then
-    # start only dcopserver, don't start whole kdeinit (takes too long)
-    echo 'startkde: Running kpersonalizer...'  1>&2
-    dcopserver
-    kwin --lock &
-    kpersonalizer --before-session
-    # handle kpersonalizer restarts (language change)
-    while test $? -eq 1; do
-        kpersonalizer --r --before-session
-    done
-    dcopquit kwin
-    dcopserver_shutdown --wait
-fi
+# on osx we skip this, the defaults are sane and most people
+# do bad things like "mac os menus" which makes it worse
+
+## run KPersonalizer before the session, if this is the first login
+#if test "$kpersonalizerrc_general_firstlogin" = "true"; then
+#    # start only dcopserver, don't start whole kdeinit (takes too long)
+#    echo 'startkde: Running kpersonalizer...'  1>&2
+#    dcopserver
+#    kwin --lock &
+#    kpersonalizer --before-session
+#    # handle kpersonalizer restarts (language change)
+#    while test $? -eq 1; do
+#        kpersonalizer --r --before-session
+#    done
+#    dcopquit kwin
+#    dcopserver_shutdown --wait
+#fi
 
 if test -z "$dl"; then
   # the splashscreen and progress indicator
@@ -368,7 +376,33 @@
 # We only check for 255 which means that the ksmserver process could not be 
 # started, any problems thereafter, e.g. ksmserver failing to initialize, 
 # will remain undetected.
-test -n "$KDEWM" && KDEWM="--windowmanager $KDEWM"
+
+USE_PROXY=0
+if test -n "$KDEWM"; then
+  if test -z `expr "$KDEWM" : '\(.*quartz-wm.*\)'`; then
+    USE_PROXY=1
+  fi
+  KDEWM="--windowmanager $KDEWM"
+else
+  KDEWM="--windowmanager kwin"
+  USE_PROXY=1
+fi
+
+if test "$DISABLE_PROXY" = "1" || test "$DISABLE_PROXY" = "true"; then
+	USE_PROXY=0
+fi
+
+if test "$USE_PROXY" = "1"; then
+  if test -x /usr/X11R6/bin/quartz-wm; then
+    /usr/X11R6/bin/quartz-wm --only-proxy >/dev/null 2>&1 &
+  else
+    AUTOCUTSEL=`which autocutsel 2>/dev/null`
+    if test -n "$AUTOCUTSEL" && test -x "$AUTOCUTSEL"; then
+      $AUTOCUTSEL >/dev/null 2>&1 &
+    fi
+  fi
+fi
+
 kwrapper ksmserver $KDEWM 
 if test $? -eq 255; then
   # Startup error
