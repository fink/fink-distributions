# Initial Data
Package: openssh
Version: 5.1p1
Revision: 1
Maintainer: None <fink-devel@lists.sourceforge.net>
License: BSD

# Dependencies
Depends: daemonic (>= 20010902-1), libncurses5-shlibs, openssl098-shlibs (>= 0.9.8h-1)
Replaces: openssh-hpn
Conflicts: openssh-hpn
BuildDepends: libncurses5, openssl098-dev (>= 0.9.8h-1)

# Unpack Phase
CustomMirror: <<
	Primary: ftp://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/ 
	aus-AU: ftp://mirror.aarnet.edu.au/pub/OpenBSD/OpenSSH/portable/ 
	aus-AU: ftp://ftp.it.net.au/mirrors/OpenBSD/OpenSSH/portable/ 
	aus-AU: ftp://ftp.planetmirror.com/pub/OpenBSD/OpenSSH/portable/ 
	aus-AU: ftp://openbsd.wiretapped.net/pub/OpenBSD/OpenSSH/portable/ 
	eur-AT: ftp://gd.tuwien.ac.at/opsys/OpenBSD/OpenSSH/portable/ 
	eur-AT: ftp://playboy.wu-wien.ac.at/pub/OpenBSD/OpenSSH/portable/ 
	eur-BE: ftp://ftp.easynet.be/openssh/portable/ 
	eur-BE: ftp://openbsd.rug.ac.be/pub/OpenBSD/OpenSSH/portable/ 
	sam-BR: ftp://ftp.openbsd.org.br/pub/OpenBSD/OpenSSH/portable/ 
	nam-CA: ftp://ftp.ca.openbsd.org/pub/OpenBSD/OpenSSH/portable/ 
	asi-CN: ftp://ftp.shellhung.org/pub/OpenBSD/OpenSSH/portable/ 
	eur-CZ: ftp://ftp.openbsd.cz/pub/OpenBSD/OpenSSH/portable/ 
	eur-DK: ftp://sunsite.dk/mirrors/openssh/portable/ 
	eur-DK: ftp://ftp.jaquet.dk/pub/openSSH/portable/ 
	eur-FI: ftp://ftp.fi.debian.org/pub/OpenBSD/OpenSSH/portable/ 
	eur-FR: ftp://ftp.ac-creteil.fr/OpenBSD/OpenSSH/portable/ 
	eur-FR: ftp://ftp.fr.openbsd.org/pub/OpenBSD/OpenSSH/portable/ 
	eur-FR: ftp://ftp.bsdfr.org/pub/OpenBSD/OpenSSH/portable/ 
	eur-FR: ftp://ftp.club-internet.fr/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp.de.openbsd.org/pub/unix/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp.tu-clausthal.de/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp.freenet.de/pub/ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp-stud.fht-esslingen.de/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://pandemonium.tiscali.de/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp.taubenschlag.uni-frankfurt.de/pub/mirror/ftp.openssh.com/portable/ 
	eur-DE: ftp://openbsd.bay13.net/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp.leo.org/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp.uni-stuttgart.de/pub/OpenBSD/OpenSSH/portable/ 
	eur-DE: ftp://ftp.fh-wolfenbuettel.de/pub/os/openbsd/OpenSSH/portable/ 
	eur-GR: ftp://filoktitis.noc.uoa.gr/pub/OpenBSD/OpenSSH/portable/ 
	eur-GR: ftp://ftp.physics.auth.gr/pub/mirrors/OpenBSD/OpenBSD/OpenSSH/portable/ 
	eur-GR: ftp://ftp.duth.gr/pub/OpenBSD/OpenSSH/portable/ 
	eur-GR: ftp://hal.csd.auth.gr/mirrors/OpenSSH/portable/ 
	eur-HU: ftp://ftp.fsn.hu/pub/OpenBSD/OpenSSH/portable/ 
	eur-IE: ftp://ftp.esat.net/pub/OpenBSD/OpenSSH/portable/ 
	eur-IT: ftp://ftp.openbsd.it/pub/Unix/OpenBSD/OpenSSH/portable/ 
	asi-JP: ftp://ftp.netlab.is.tsukuba.ac.jp/pub/os/OpenBSD/OpenSSH/portable/ 
	asi-JP: ftp://ftp.iij.ad.jp/pub/OpenBSD/OpenSSH/portable/ 
	asi-JP: ftp://ftp.jp.openbsd.org/pub/OpenBSD/OpenSSH/portable/ 
	asi-JP ftp://ftp.kddlabs.co.jp/OpenBSD/OpenSSH/portable/ 
	eur-LT: ftp://ftp.openbsd.lt/pub/OpenBSD/OpenSSH/portable/ 
	nam-MX: ftp://mirrors.unam.mx/pub/openssh/portable/ 
	eur-NL: ftp://ftp.nl.uu.net/pub/OpenBSD/OpenSSH/portable/ 
	eur-NL: ftp://ftp.bit.nl/mirror/openssh/ 
	eur-NL: ftp://ftp.nluug.nl/pub/OpenBSD/OpenSSH/portable/ 
	eur-NL: ftp://mirror.widexs.nl/pub/OpenSSH/portable/ 
	eur-NO: ftp://ftp.inet.no/pub/OpenBSD/OpenSSH/portable/ 
	eur-NO: ftp://ftp.uninett.no/pub/OpenBSD/OpenSSH/portable/ 
	eur-PL: ftp://sunsite.icm.edu.pl/pub/OpenBSD/OpenSSH/portable/ 
	eur-PL: ftp://ftp.task.gda.pl/pub/OpenBSD/OpenSSH/portable/ 
	eur-PL: ftp://ftp.tpnet.pl/d2/ftp.openssh.com/pub/OpenBSD/OpenSSH/portable/ 
	eur-PT: ftp://ftp.eq.uc.pt/pub/software/unix/security/crypto/openssh/portable/ 
	eur-RO: ftp://ftp.physics.uvt.ro/pub/OpenBSD/OpenSSH/portable/ 
	eur-RU: ftp://ftp.gamma.ru/pub/OpenBSD/OpenSSH/portable/ 
	eur-RU: ftp://ftp.radio-msu.net/pub/OpenBSD/OpenSSH/portable/ 
	eur-ES: ftp://ftp.rediris.es/mirror/OpenBSD/OpenSSH/portable/ 
	eur-SE: ftp://ftp.stacken.kth.se/pub/OpenBSD/OpenSSH/portable/ 
	eur-SE: ftp://ftp.sunet.se/pub/OpenBSD/OpenSSH/portable/ 
	eur-SE: ftp://mirror.pudas.net/OpenBSD/OpenSSH/portable/ 
	eur-CH: ftp://ftp.solnet.ch/mirror/OpenBSD/OpenSSH/portable/ 
	eur-CH: ftp://sunsite.cnlab-switch.ch/pub/OpenBSD/OpenSSH/portable/ 
<<
Source: mirror:custom:openssh-%v.tar.gz
Source-MD5: 03f2d0c1b5ec60d4ac9997a146d2faec

# Patch Phase:
PatchScript: perl -pi -e 's,-g -O2,-Os,' configure

# Compile Phase:
ConfigureParams: <<
  --with-pid-dir=%p/var/run --sysconfdir=%p/etc/ssh --mandir=%p/share/man --libexecdir=%p/lib \
  --with-xauth=/usr/X11R6/bin/xauth --with-default-path=%p/bin:/usr/bin:/bin:%p/sbin:/usr/sbin:/sbin:/usr/X11R6/bin \
  --with-md5-passwords --with-pam --without-zlib-version-check --with-privsep-path=%p/var/empty --with-tcp-wrappers \
  --with-libedit --with-ssl-engine --with-kerberos5=/usr --with-md5-passwords --with-4in6
<<
CompileScript: <<
./configure %c
make
<<

# Install Phase:
InstallScript: make install DESTDIR=%d
DocFiles: README LICENCE CREDITS WARNING.RNG
ConfFiles: %p/etc/ssh/ssh_config %p/etc/ssh/sshd_config

# Build Phase:
DaemonicName: ssh
DaemonicFile: <<
<service>
<description>SSH secure login server</description>
<message>OpenSSH secure login server</message>

<daemon name="sshd">
<executable background="yes">%p/sbin/sshd</executable>
<!-- the daemon will background itself, but may take a while
     to start up to the point where it does so -->
<prerun>
if [ ! -f "%p/etc/ssh/ssh_host_key" ]; then
  %p/bin/ssh-keygen -t rsa1 -f %p/etc/ssh/ssh_host_key -N "" -C `hostname`
fi
if [ ! -f %p/etc/ssh/ssh_host_dsa_key ]; then
  %p/bin/ssh-keygen -t dsa -f %p/etc/ssh/ssh_host_dsa_key -N "" -C `hostname`
fi
if [ ! -f %p/etc/ssh/ssh_host_rsa_key ]; then
  %p/bin/ssh-keygen -t rsa -f %p/etc/ssh/ssh_host_rsa_key -N "" -C `hostname`
fi
</prerun>
<configfile>%p/etc/ssh/sshd_config</configfile>
<pidfile>%p/var/run/sshd.pid</pidfile>
</daemon>

</service>
<<
PostInstScript: <<
# update init script if necessary
daemonic install ssh
<<
PreRmScript: <<
# clean up
if [ $1 != "upgrade" ]; then
  daemonic remove ssh
fi
<<

# Additional Data:
Description: Secure shell (remote login) client and server
DescUsage: <<
If you have host keys in /etc and want to continue using them, copy
them to /sw/etc/ssh (or wherever you installed Fink).

To run the SSH server from this package, first make sure the system's
server is disabled (SSHSERVER=-NO- in /etc/hostconfig). Then, run
'daemonic enable ssh' as root. That will create a startup item that
starts sshd after the next reboot.

To disable the server, run 'daemonic disable ssh' as root. This will
not kill a running server at this time. If you don't know how to kill
the server yourself, reboot the machine to get rid of it.
<<
DescPackaging: <<
zlib version check is disabled until Apple's zlib is updated.

According to <http://www.kb.cert.org/vuls/id/238678>, OS X isn't
vulnerable to the first security bug in zlib 1.2.3; the security
problems in 1.2.2 didn't affect OS X either, BTW. The second
security problem fixed in 1.2.3
(http://www.kb.cert.org/vuls/id/680620) has unknown status
on Mac OS X and is only a denial of service issue.

Privilege separation info in README.privsep in the src directory

Mirror List: http://www.openssh.com/portable.html
<<
DescPort: <<
Previous versions by Christoph Pfisterer, Max Horn and Neil Tiffin.
<<
Homepage: http://www.openssh.com/portable.html
