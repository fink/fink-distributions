Index: admin/Makefile.common
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/admin/Makefile.common,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -b -u -r1.1.1.3 -r1.4
Index: admin/acinclude.m4.in
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/admin/acinclude.m4.in,v
retrieving revision 1.1.1.3
diff -u -b -u -r1.1.1.3 acinclude.m4.in
--- admin/acinclude.m4.in	14 Aug 2002 13:18:45 -0000	1.1.1.3
+++ admin/acinclude.m4.in	23 Aug 2002 02:38:54 -0000
@@ -699,13 +699,10 @@
      AC_CHECK_LIB(ipc, shmat, X_EXTRA_LIBS="$X_EXTRA_LIBS -lipc"))
    
    # darwin needs this to initialize the environment
-   AC_CHECK_HEADERS(crt_externs.h)
+   AC_CHECK_HEADERS([crt_externs.h sys/types.h])
    AC_CHECK_FUNC(_NSGetEnviron, [AC_DEFINE(HAVE_NSGETENVIRON, 1, [Define if your system needs _NSGetEnviron to set up the environment])])
  
-   # more headers that need to be explicitly included on darwin
-   AC_CHECK_HEADERS(sys/types.h stdint.h)
-
-   # darwin requires a poll emulation library
+   # darwin requires a poll.h emulation library
    AC_CHECK_LIB(poll, poll, LIB_POLL="-lpoll")
 
    # CoreAudio framework
@@ -736,6 +733,8 @@
    AC_SUBST(FRAMEWORK_COREAUDIO)
    LIBSOCKET="$X_EXTRA_LIBS"
    AC_SUBST(LIBSOCKET)
+   AC_SUBST(FRAMEWORK_COREAUDIO)
+   AC_SUBST(LIB_POLL)
    AC_SUBST(LIBRESOLV)
    AC_SUBST(X_EXTRA_LIBS)
    AC_CHECK_LIB(ucb, killpg, [LIBUCB="-lucb"]) dnl for Solaris2.4
@@ -905,7 +904,7 @@
 kde_ldflags_safe="$LDFLAGS"
 kde_libs_safe="$LIBS"
 
-LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS"
+LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS"
 LIBS="-lXext -lX11 $LIBSOCKET"
 
 AC_TRY_LINK([
@@ -947,9 +946,9 @@
 kde_save_LDFLAGS="$LDFLAGS"
 kde_save_CFLAGS="$CFLAGS"
 kde_save_LIBS="$LIBS"
-LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS"
+LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS"
 CFLAGS="$CFLAGS -I$x_includes"
-LIBS="-lXinerama -lXext"
+LIBS="-lXinerama -lXext -lX11"
 
 if test "x$no_xinerama" = "xno"; then
 
@@ -1846,15 +1845,29 @@
    AC_REQUIRE([K_PATH_X])
 
 if test $kde_qtver = 3; then
+   AC_SUBST(LIB_ARTSKDE, "-lartskde")
+   AC_SUBST(LIB_DCOP, "-lDCOP")
+   AC_SUBST(LIB_KAB, "-lkab")
+   AC_SUBST(LIB_KABC, "-lkabc")
    AC_SUBST(LIB_KDECORE, "-lkdecore")
+   AC_SUBST(LIB_KDED, "@PREFIX@/lib/kded.la")
+   AC_SUBST(LIB_KDEFX, "-lkdefx")
+   AC_SUBST(LIB_KDEPRINT, "-lkdeprint")
+   AC_SUBST(LIB_KDESASL, "-lkdesasl")
+   AC_SUBST(LIB_KDESU, "-lkdesu")
    AC_SUBST(LIB_KDEUI, "-lkdeui")
-   AC_SUBST(LIB_KIO, "-lkio")
-   AC_SUBST(LIB_SMB, "-lsmb")
-   AC_SUBST(LIB_KAB, "-lkab")
    AC_SUBST(LIB_KHTML, "-lkhtml")
-   AC_SUBST(LIB_KSPELL, "-lkspell")
+   AC_SUBST(LIB_KIO, "-lkio")
    AC_SUBST(LIB_KPARTS, "-lkparts")
-   AC_SUBST(LIB_KDEPRINT, "-lkdeprint")
+   AC_SUBST(LIB_KJAVA, "-lkjava")
+   AC_SUBST(LIB_KJS, "-lkjs")
+   AC_SUBST(LIB_KMID, "-lkmid")
+   AC_SUBST(LIB_KSCRIPT, "-lkscript")
+   AC_SUBST(LIB_KSPELL, "-lkspell")
+   AC_SUBST(LIB_KTEXTEDITOR, "-lktexteditor")
+   AC_SUBST(LIB_SHELLSCRIPT, "-lshellscript")
+   AC_SUBST(LIB_SMB, "-lsmb")
+   AC_SUBST(LIB_VCARD, "-lvcard")
 # these are for backward compatibility
    AC_SUBST(LIB_KSYCOCA, "-lkio")
    AC_SUBST(LIB_KFILE, "-lkio")
@@ -2544,10 +2557,10 @@
       if test $kde_use_debug_code = "full"; then
         CFLAGS="-g3 $CFLAGS"
       else
-        CFLAGS="-g -O2 $CFLAGS"
+        CFLAGS="-g -Os $CFLAGS"
       fi
     else
-      CFLAGS="-O2 $CFLAGS"
+      CFLAGS="-Os $CFLAGS"
     fi
   fi
 
@@ -2557,6 +2570,7 @@
 
 
   case "$host" in
+  *-*-darwin*) CFLAGS="-fno-common $CFLAGS";;
   *-*-sysv4.2uw*) CFLAGS="-D_UNIXWARE $CFLAGS";;
   *-*-sysv5uw7*) CFLAGS="-D_UNIXWARE7 $CFLAGS";;
   esac
@@ -2577,7 +2591,7 @@
         if test "$kde_use_debug_code" = "full"; then
           CXXFLAGS="-g3 $CXXFLAGS"
         else
-          CXXFLAGS="-g -O2 $CXXFLAGS"
+          CXXFLAGS="-g -Os $CXXFLAGS"
         fi
       fi
       KDE_CHECK_COMPILER_FLAG(fno-builtin,[CXXFLAGS="-fno-builtin $CXXFLAGS"])
@@ -2589,7 +2603,7 @@
       if test "$CXX" = "KCC"; then
         CXXFLAGS="+K3 $CXXFLAGS"
       else
-        CXXFLAGS="-O2 $CXXFLAGS"
+        CXXFLAGS="-Os $CXXFLAGS"
       fi  
     fi
   fi
@@ -3059,9 +3073,9 @@
     ac_save_ldflags="$LDFLAGS"
     ac_save_cflags="$CFLAGS"
     if test "x$kde_use_qt_emb" != "xyes"; then
-      LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm -lX11 -lXext $LIBZ $LIBSOCKET"
+      LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm -lX11 -lXext $LIBZ $LIBSOCKET"
     else
-      LDFLAGS="$LDFLAGS $X_LDFLAGS $USER_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm $LIBZ $LIBSOCKET"
+      LDFLAGS="$LDFLAGS $USER_LDFLAGS $X_LDFLAGS $LDFLAGS $XPM_LDFLAGS $all_libraries -lXpm $LIBZ $LIBSOCKET"
     fi
     CFLAGS="$CFLAGS $X_INCLUDES $USER_INCLUDES"
     test -n "$XPM_INCLUDE" && CFLAGS="-I$XPM_INCLUDE $CFLAGS"
@@ -4106,7 +4120,7 @@
 AC_DEFUN(KDE_CREATE_SUBDIRSLIST,
 [
 
-DO_NOT_COMPILE="$DO_NOT_COMPILE CVS debian bsd-port admin"
+DO_NOT_COMPILE="$DO_NOT_COMPILE CVS debian bsd-port admin kdm ksysguard kscd"
 
 if test ! -s $srcdir/subdirs; then
   dnl Note: Makefile.common creates subdirs, so this is just a fallback
@@ -4553,6 +4567,7 @@
       KDE_JAVA_PREFIX(/usr/lib/IBMJava2*)
       KDE_JAVA_PREFIX(/usr/lib/IBMJava*)
       KDE_JAVA_PREFIX(/opt/java*)
+      KDE_JAVA_PREFIX(/Library/Java/Home)
     
       kde_cv_path="NONE"
       kde_save_IFS=$IFS
@@ -4604,10 +4619,20 @@
 dnl At this point kde_java_bindir and kde_java_includedir are either set or "no"
 if test "x$kde_java_bindir" != "xno"; then
 
+  case $host_os in
+    darwin*)
+      dnl Look for libjvm.dylib
+      kde_java_libjvmdir=`find $kde_java_bindir/.. -name libjvm.dylib | sed 's,libjvm.dylib,,'|head -n 1`
+      kd_java_libhpidir=''
+      dnl Darwin doesn't have libhpi
+      ;;
+    *)
   dnl Look for libjvm.so
   kde_java_libjvmdir=`find $kde_java_bindir/.. -name libjvm.so | sed 's,libjvm.so,,'|head -n 1`
   dnl Look for libhpi.so and avoid green threads
   kde_java_libhpidir=`find $kde_java_bindir/.. -name libhpi.so | grep -v green | sed 's,libhpi.so,,' | tail -n 1`
+      ;;
+  esac
 
   dnl Now check everything's fine under there
   dnl the include dir is our flag for having the JDK
@@ -4635,17 +4660,29 @@
     JAVAC=
     jni_includes=
   fi
-
+  case $host_os in
+    darwin*)
+      if test ! -r "$kde_java_libjvmdir/libjvm.dylib"; then
+        AC_MSG_ERROR([libjvm.dylib not found under $kde_java_libjvmdir. Use --without-java.])
+      fi
+      dnl Darwin doesn't have libhpi, but it's not fatal
+      LIB_JVM="-framework JavaVM"
+      LIB_HPI=""
+      ;;
+    *)
   if test ! -r "$kde_java_libjvmdir/libjvm.so"; then
      AC_MSG_ERROR([libjvm.so not found under $kde_java_libjvmdir. Use --without-java.])
   fi 
+      LIB_JVM="-L$kde_java_libjvmdir -ljvm"
+      if test ! -r "$kde_java_libhpidir/libhpi.so"; then
+        AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
+      fi
+      LIB_HPI="-L$kde_java_libhpidir -lhpi"
+      ;;
+  esac
 
   if test ! -x "$kde_java_bindir/java"; then
       AC_MSG_ERROR([java not found under $kde_java_bindir. javac was found though! Use --with-java or --without-java.])
-  fi
-
-  if test ! -r "$kde_java_libhpidir/libhpi.so"; then
-    AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
   fi
 
   if test -n "$jni_includes"; then
Index: admin/detect-autoconf.sh
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/admin/detect-autoconf.sh,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -b -u -r1.1.1.1 -r1.2
--- admin/detect-autoconf.sh	10 Jul 2002 02:47:38 -0000	1.1.1.1
+++ admin/detect-autoconf.sh	15 Jul 2002 22:55:00 -0000	1.2
@@ -42,12 +42,12 @@
 checkAutomakeAclocal ()
 {
   if test -z "$UNSERMAKE"; then
-    if test -x "`$WHICH automake-1.5`" ; then
-      AUTOMAKE="`$WHICH automake-1.5`"
-      ACLOCAL="`$WHICH aclocal-1.5`"
-    elif test -x "`$WHICH automake-1.6`" ; then
+    if test -x "`$WHICH automake-1.6`" ; then
       AUTOMAKE="`$WHICH automake-1.6`"
       ACLOCAL="`$WHICH aclocal-1.6`"
+    elif test -x "`$WHICH automake-1.5`" ; then
+      AUTOMAKE="`$WHICH automake-1.5`"
+      ACLOCAL="`$WHICH aclocal-1.5`"
     fi
   else
      AUTOMAKE="$UNSERMAKE"
Index: admin/libtool.m4.in
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/admin/libtool.m4.in,v
retrieving revision 1.1.1.3
retrieving revision 1.6
diff -u -b -u -r1.1.1.3 -r1.6
--- admin/libtool.m4.in	14 Aug 2002 13:18:45 -0000	1.1.1.3
+++ admin/libtool.m4.in	14 Aug 2002 13:20:08 -0000	1.6
@@ -609,6 +609,12 @@
     lt_cv_sys_max_cmd_len=-1;
     ;;
 
+  darwin*)
+    # this should be enough... the length test freaks out some versions
+    # of OSX's `expr`
+    lt_cv_sys_max_cmd_len=16384;
+    ;;
+
   *)
     # If test is not a shell built-in, we'll probably end up computing a
     # maximum length that is only half of the actual maximum length, but
@@ -1901,16 +1907,7 @@
   ;;
 
 darwin* | rhapsody*)
-  lt_cv_deplibs_check_method='file_magic Mach-O dynamically linked shared library'
-  lt_cv_file_magic_cmd='/usr/bin/file -L'
-  case "$host_os" in
-  rhapsody* | darwin1.[[012]])
-    lt_cv_file_magic_test_file=`/System/Library/Frameworks/System.framework/System`
-    ;;
-  *) # Darwin 1.3 on
-    lt_cv_file_magic_test_file='/usr/lib/libSystem.dylib'
-    ;;
-  esac
+  lt_cv_deplibs_check_method='pass_all'
   ;;
 
 freebsd*)
@@ -2560,6 +2557,11 @@
 	;;
     esac
     ;;
+  darwin*)
+    shared_flag='-dynamiclib'
+    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs && $CC -dynamiclib -install_name $rpath/$soname $predep_objects ${lib}-master.o $deplibs $postdep_objects $compiler_flags -o $lib'
+    output_verbose_link_cmd='$CC -dynamiclib $CFLAGS -v conftest.$objext 2>&1 | egrep "\-L"'
+    ;;
   dgux*)
     case $cc_basename in
       ec++)
@@ -4750,7 +4752,9 @@
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
 	;;
       *) # Darwin 1.3 on
-	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+	#_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+        # testing with twolevel namespaces
+	_LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
 	;;
       esac
 
@@ -4758,7 +4762,7 @@
       #        cross-compilation, but unfortunately the echo tests do not
       #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
       #	       `"' quotes if we put them in here... so don't!
-      _LT_AC_TAGVAR(archive_cmds, $1)='$CC $(test .$module = .yes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags -install_name $rpath/$soname $verstring'
+      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs && $CC $(test .$module = .yes && echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $linker_flags $(test x$module != xyes && echo -install_name $rpath/$soname $verstring)'
       # We need to add '_' to the symbols in $export_symbols first
       #_LT_AC_TAGVAR(archive_expsym_cmds, $1)="$_LT_AC_TAGVAR(archive_cmds, $1)"' && strip -s $export_symbols'
       _LT_AC_TAGVAR(hardcode_direct, $1)=yes
Index: admin/ltconfig
===================================================================
RCS file: admin/ltconfig
diff -N admin/ltconfig
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ admin/ltconfig	25 Jun 2002 03:34:27 -0000	1.1.1.1
@@ -0,0 +1,4 @@
+#! /bin/sh
+# Written by <matz@kde.org> and placed into the public domain ;-)
+echo "This file shouldn't be called.  It exists solely for the purpose"
+echo "to make automake 1.4 cope with newer libtools."
Index: admin/ltmain.sh
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/admin/ltmain.sh,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -b -u -r1.1.1.2 -r1.4
--- admin/ltmain.sh	10 Jul 2002 02:47:39 -0000	1.1.1.2
+++ admin/ltmain.sh	13 Jul 2002 04:33:25 -0000	1.4
@@ -3321,7 +3321,23 @@
 	if test -n "$export_symbols" && test -n "$archive_expsym_cmds"; then
 	  eval cmds=\"$archive_expsym_cmds\"
 	else
+          if test "x$verstring" = "x0.0"; then
+                tmp_verstring=
+          else
+                tmp_verstring="$verstring"
+          fi
+ 	  save_deplibs="$deplibs"
+ 	  for conv in $convenience; do
+            tmp_deplibs=
+            for test_deplib in $deplibs; do
+              if test "$test_deplib" != "$conv"; then
+                tmp_deplibs="$tmp_deplibs $test_deplib"
+              fi
+            done
+            deplibs="$tmp_deplibs"
+ 	  done
 	  eval cmds=\"$archive_cmds\"
+ 	  deplibs="$save_deplibs"
 	fi
 
 	if len=`expr "X$cmds" : ".*"` &&
@@ -3419,7 +3435,12 @@
 	  if test -n "$export_symbols" && test -n "$archive_expsym_cmds"; then
 	    eval cmds=\"$archive_expsym_cmds\"
 	  else
+            save_deplibs="$deplibs"
+            for conv in $convenience; do
+              deplibs="${deplibs%$conv*} ${deplibs#*$conv}"
+            done
 	    eval cmds=\"$archive_cmds\"
+            deplibs="$save_deplibs"
 	  fi
 
 	  # Append the command to remove the reloadable object files
@@ -3632,6 +3653,14 @@
 	compile_deplibs=`$echo "X $compile_deplibs" | $Xsed -e 's/ -lc / -framework System /'`
 	finalize_deplibs=`$echo "X $finalize_deplibs" | $Xsed -e 's/ -lc / -framework System /'`
 	;;
+      esac
+
+      case $host in
+      *darwin*)
+        # Don't allow lazy linking, it breaks C++ global constructors
+        compile_command="$compile_command ${wl}-bind_at_load"
+        finalize_command="$finalize_command ${wl}-bind_at_load"
+        ;;
       esac
 
       compile_command="$compile_command $compile_deplibs"
Index: admin/missing
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/admin/missing,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -b -u -r1.1.1.2 -r1.3
--- admin/missing	10 Jul 2002 02:47:39 -0000	1.1.1.2
+++ admin/missing	10 Jul 2002 02:50:11 -0000	1.3
@@ -106,7 +106,7 @@
     exit 1
     ;;
 
-  aclocal)
+  aclocal*)
     echo 1>&2 "\
 WARNING: \`$1' is missing on your system.  You should only need it if
          you modified \`acinclude.m4' or \`${configure_ac}'.  You might want
@@ -143,7 +143,7 @@
     touch $touch_files
     ;;
 
-  automake)
+  automake*)
     echo 1>&2 "\
 WARNING: \`$1' is missing on your system.  You should only need it if
          you modified \`Makefile.am', \`acinclude.m4' or \`${configure_ac}'.
Index: configure.in.in
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/configure.in.in,v
retrieving revision 1.1.1.1
diff -u -b -u -r1.1.1.1 configure.in.in
--- configure.in.in	25 Jun 2002 03:24:54 -0000	1.1.1.1
+++ configure.in.in	23 Aug 2002 02:44:10 -0000
@@ -4,3 +4,4 @@
 AC_CHECK_HEADERS(fcntl.h sys/sysctl.h sys/param.h sys/time.h sys/types.h sys/user.h sys/vmmeter.h sys/resource.h vm/vmparam.h unistd.h)
 AC_CHECK_FUNCS(setenv unsetenv)
 CXXFLAGS="$CXXFLAGS -DQT_CLEAN_NAMESPACE  -DQT_NO_ASCII_CAST"
+DO_NOT_COMPILE="$DO_NOT_COMPILE klaptopdaemon"
Index: ark/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/ark/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -b -u -r1.1.1.2 -r1.3
--- ark/Makefile.am	25 Jun 2002 03:26:08 -0000	1.1.1.2
+++ ark/Makefile.am	25 Jun 2002 03:26:40 -0000	1.3
@@ -20,7 +20,7 @@
 libark_la_LDFLAGS = $(all_libraries) -version-info 1:0:0 -module $(LIB_KIO)
 
 # KParts
-libark_la_LIBADD   = $(LIB_KFILE) -lkparts
+libark_la_LIBADD   = $(LIB_KFILE) -lkparts $(LIB_KDEUI) $(LIB_QT) $(LIB_DCOP) $(LIB_KDECORE)
 
 # Which sources should be compiled for ark.
 ark_SOURCES    = dummy.cpp
Index: kcalc/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/kcalc/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -b -u -r1.1.1.2 -r1.3
--- kcalc/Makefile.am	10 Jul 2002 05:32:47 -0000	1.1.1.2
+++ kcalc/Makefile.am	10 Jul 2002 05:34:20 -0000	1.3
@@ -13,7 +13,7 @@
 
 INCLUDES= $(all_includes)
 kcalc_la_LDFLAGS = $(all_libraries) -module -avoid-version
-kcalc_la_LIBADD = $(LIB_KDEUI) -lm
+kcalc_la_LIBADD = $(LIB_KDEUI) -lm $(LIB_KDECORE) $(LIB_QT)
 
 kcalc_SOURCES = dummy.cpp
 kcalc_LDADD = kcalc.la
Index: kcalc/kcalc_core.cpp
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/kcalc/kcalc_core.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.3
diff -u -b -u -r1.1.1.3 -r1.3
--- kcalc/kcalc_core.cpp	14 Aug 2002 21:31:15 -0000	1.1.1.3
+++ kcalc/kcalc_core.cpp	14 Aug 2002 21:39:35 -0000	1.3
@@ -48,6 +48,13 @@
 
 #define UNUSED(x) ((void)(x))
 
+#if defined(__APPLE__) && __GNUC__ > 2
+/* FIXME: Jaguar's math.h does some weird isinf trickery
+   that breaks using the builtins... this should be made into
+   an aclocal.m4 macro */
+# undef HAVE_FUNC_ISINF
+#endif
+
 #ifndef HAVE_FUNC_ISINF
 	#ifdef HAVE_IEEEFP_H
 		#include <ieeefp.h>
Index: kcalc/kcalctype.h
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/kcalc/kcalctype.h,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -b -u -r1.1.1.1 -r1.2
--- kcalc/kcalctype.h	25 Jun 2002 03:24:54 -0000	1.1.1.1
+++ kcalc/kcalctype.h	31 Jul 2002 19:29:47 -0000	1.2
@@ -97,7 +97,11 @@
 	#define ATAN(X)		atan(X)
 	#define ATANH(X)	atanh(X)
 	#define EXP(X)		exp(X)
+# if defined(__APPLE__) && __GNUC__ > 2
+	#define POW(X,Y)	(double)pow((double)X,Y)
+# else
 	#define POW(X,Y)	pow(X,Y)
+# endif
 	#define LOG(X)		log(X)
 	#define LOG_TEN(X)	log10(X)
 	#define SQRT(X)		sqrt(X)
Index: kedit/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/kedit/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -b -u -r1.1.1.1 -r1.2
--- kedit/Makefile.am	25 Jun 2002 03:24:54 -0000	1.1.1.1
+++ kedit/Makefile.am	25 Jun 2002 03:25:51 -0000	1.2
@@ -12,7 +12,7 @@
 
 kedit_la_SOURCES = kedit.cpp ktextfiledlg.cpp\
 		mail.cpp  optiondialog.cpp 
-kedit_la_LIBADD = -lkdeprint -lkspell $(LIB_KFILE) $(LIB_KIO)
+kedit_la_LIBADD = -lkdeprint -lkspell $(LIB_KFILE) $(LIB_KIO) $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEUI)
 kedit_la_LDFLAGS = $(all_libraries) -module -avoid-version
 
 kedit_SOURCES = dummy.cpp
Index: khexedit/chartabledialog.cc
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/khexedit/chartabledialog.cc,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -b -u -r1.1.1.1 -r1.2
--- khexedit/chartabledialog.cc	25 Jun 2002 03:24:54 -0000	1.1.1.1
+++ khexedit/chartabledialog.cc	25 Jun 2002 03:25:51 -0000	1.2
@@ -19,6 +19,7 @@
  */
 
 #include <limits.h>
+#define MAXINT 2147483647
 
 #include <qlabel.h>
 #include <qheader.h>
Index: khexedit/dialog.cc
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/khexedit/dialog.cc,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -b -u -r1.1.1.3 -r1.4
--- khexedit/dialog.cc	14 Aug 2002 21:31:11 -0000	1.1.1.3
+++ khexedit/dialog.cc	14 Aug 2002 21:39:35 -0000	1.4
@@ -18,9 +18,11 @@
  *
  */
 
+#include <limits.h>
+#define MAXINT 2147483647
+
 #include <ctype.h>
 #include <iostream>
-#include <limits.h>
 
 #include <qbuttongroup.h> 
 #include <qfileinfo.h> 
Index: khexedit/exportdialog.cc
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/khexedit/exportdialog.cc,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -b -u -r1.1.1.2 -r1.3
--- khexedit/exportdialog.cc	10 Jul 2002 05:32:57 -0000	1.1.1.2
+++ khexedit/exportdialog.cc	10 Jul 2002 05:34:20 -0000	1.3
@@ -19,6 +19,8 @@
  */
 
 #include <limits.h>
+#define MAXINT 2147483647
+
 #include <qbuttongroup.h>
 #include <qlineedit.h> 
 
Index: khexedit/optiondialog.cc
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/khexedit/optiondialog.cc,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -b -u -r1.1.1.3 -r1.4
--- khexedit/optiondialog.cc	14 Aug 2002 21:31:14 -0000	1.1.1.3
+++ khexedit/optiondialog.cc	14 Aug 2002 21:39:35 -0000	1.4
@@ -19,6 +19,7 @@
  */
 
 #include <limits.h>
+#define MAXINT 2147483647
 
 #include <qvbox.h>
 #include <qvbuttongroup.h>
Index: khexedit/printerdialog.cc
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/khexedit/printerdialog.cc,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -b -u -r1.1.1.3 -r1.4
--- khexedit/printerdialog.cc	10 Jul 2002 05:33:02 -0000	1.1.1.3
+++ khexedit/printerdialog.cc	10 Jul 2002 05:34:20 -0000	1.4
@@ -19,6 +19,7 @@
  */
 
 #include <limits.h>
+#define MAXINT 2147483647
 
 #include <qbuttongroup.h>
 #include <qfileinfo.h> 
Index: klaptopdaemon/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -b -u -r1.1.1.2 -r1.4
--- klaptopdaemon/Makefile.am	14 Aug 2002 21:31:17 -0000	1.1.1.2
+++ klaptopdaemon/Makefile.am	19 Aug 2002 01:49:35 -0000	1.4
@@ -3,15 +3,15 @@
 bin_PROGRAMS = klaptopdaemon
 SUBDIRS = pics applnk
 
-klaptopdaemon_la_SOURCES = laptop_daemon.cpp kpcmcia.cpp kpcmciainfo.cpp daemondock.cpp notify.cpp portable.cpp acpi_config.cpp
+klaptopdaemon_la_SOURCES = laptop_daemon.cpp kpcmcia.cpp kpcmciainfo.cpp daemondock.cpp notify.cpp portable.cpp
 klaptopdaemon_la_LDFLAGS = $(all_libraries) -module -avoid-version
-klaptopdaemon_la_LIBADD   = $(LIB_KDEUI)
+klaptopdaemon_la_LIBADD   = $(LIB_KDEUI) $(LIB_QT) $(LIB_DCOP) $(LIB_KDECORE)
 
 klaptopdaemon_SOURCES = dummy.cpp
 klaptopdaemon_LDFLAGS = $(all_libraries)
 klaptopdaemon_LDADD = klaptopdaemon.la
 
-kcm_laptop_la_SOURCES = battery.cpp  main.cpp  pcmcia.cpp  power.cpp  warning.cpp portable.cpp acpi_config.cpp
+kcm_laptop_la_SOURCES = battery.cpp  main.cpp  pcmcia.cpp  power.cpp  warning.cpp portable.cpp
 
 kcm_laptop_la_LDFLAGS  = $(all_libraries) -module -avoid-version -no-undefined
 kcm_laptop_la_LIBADD = $(LIB_KFILE)
Index: klaptopdaemon/acpi_config.cpp
===================================================================
RCS file: klaptopdaemon/acpi_config.cpp
diff -N klaptopdaemon/acpi_config.cpp
--- klaptopdaemon/acpi_config.cpp	14 Aug 2002 21:31:17 -0000	1.1.1.1
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,181 +0,0 @@
-/*
- * battery.cpp
- *
- * Copyright (c) 2002 Paul Campbell <paul@taniwha.com>
- *
- * Requires the Qt widget libraries, available at no cost at
- * http://www.troll.no/
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-
-#include "acpi_config.h"
-#include <klocale.h>
-#include <qlayout.h>
-#include <qlabel.h>
-#include <stdio.h>
-#include <stdlib.h>
-
-
-acpi_config::acpi_config(QWidget *parent, KConfig *config, QVBoxLayout *layout)
-{
-	QHBoxLayout *l = new QHBoxLayout(parent);
-	saved_config = config;
-	QPushButton *button = new QPushButton(i18n("Setup ACPI ..."), parent);
-	l->addWidget(button);
-	l->addStretch(1);
-	connect(button, SIGNAL(pressed()), this, SLOT(acpi_config_start()));
-  	layout->addLayout(l);
-	config->setGroup("ACPIConfig");
-	acpi_sleep = config->readEntry("SleepText", "how to standby");
-	acpi_sleep_enabled = config->readBoolEntry("SleepEnabled", false);
-	acpi_suspend = config->readEntry("SuspendText", "how to suspend");
-	acpi_suspend_enabled = config->readBoolEntry("SuspendEnabled", false);
-	acpi_hibernate = config->readEntry("HibernateText", "how to hibernate");
-	acpi_hibernate_enabled = config->readBoolEntry("HibernateEnabled", false);
-}
-
-acpi_config::acpi_config(KConfig *config)
-{
-	saved_config = 0;
-	config->setGroup("ACPIConfig");
-	acpi_sleep = config->readEntry("SleepText", "how to standby");
-	acpi_sleep_enabled = config->readBoolEntry("SleepEnabled", false);
-	acpi_suspend = config->readEntry("SuspendText", "how to suspend");
-	acpi_suspend_enabled = config->readBoolEntry("SuspendEnabled", false);
-	acpi_hibernate = config->readEntry("HibernateText", "how to hibernate");
-	acpi_hibernate_enabled = config->readBoolEntry("HibernateEnabled", false);
-}
-
-acpi_config::~acpi_config()
-{
-}
-
-void
-acpi_config::do_command(QString &cmd)
-{
-	::system(cmd.latin1());
-}
-
-void
-acpi_config::acpi_config_start()
-{
-	if (saved_config == 0)
-		return;
-	acpi_dialog d(saved_config, acpi_sleep_enabled, acpi_sleep, 
-		acpi_suspend_enabled, acpi_suspend,
-		acpi_hibernate_enabled, acpi_hibernate);
-	if (d.exec()) 
-		d.Save(acpi_sleep_enabled, acpi_sleep,
-                	acpi_suspend_enabled, acpi_suspend,
-                	acpi_hibernate_enabled, acpi_hibernate);
-}
-
-acpi_dialog::acpi_dialog(KConfig *c, bool sleep_e, QString &sleep_t,
-		bool suspend_e, QString &suspend_t,
-		bool hibernate_e, QString &hibernate_t): KDialog(0, "", true)
-{
-	config = c;
-	config->setGroup("ACPIConfig");
-	changed = 0;
-	setCaption(i18n("Configure ACPI Interface"));
-    	QVBoxLayout *top_layout = new QVBoxLayout( this, KDialog::marginHint(),
-                                               KDialog::spacingHint() );
-
-	QLabel *warning = new QLabel( i18n("This panel allows you to use which commands your system uses for 'Standby' (temporary sleep), 'Suspend' (suspend-to-RAM) and 'Hibernate' (suspend-to-disk) since the Linux ACPI implentation is still a work in progress some or all of these commands may not work on your system, or even may cause it to crash or lose data. Please only enable the ones you are comfortable with"), this);
-	warning->setAlignment(Qt::WordBreak| Qt::AlignAuto | Qt::AlignVCenter);
-	warning->setMaximumWidth(300);
-	top_layout->addWidget( warning);
-	QGridLayout *grid = new QGridLayout( this, 3, 3, /* rows x cols */
-                                         KDialog::marginHint(),
-                                         KDialog::spacingHint() );
-
-	grid->addWidget( new QLabel( i18n("Standby:"), this), 0, 0);
-	sleep_enabled = new QCheckBox(this);
-	grid->addWidget(sleep_enabled, 0, 1);
-	sleep_edit = new KLineEdit(this);
-	sleep_edit->setText(sleep_t);
-	sleep_edit->setEnabled(sleep_e);
-	sleep_enabled->setChecked(sleep_e);
-	grid->addWidget(sleep_edit, 0, 2);
-	connect(sleep_enabled, SIGNAL(clicked()), this, SLOT(configChanged()));
-	connect(sleep_enabled, SIGNAL(toggled(bool)), sleep_edit, SLOT(setEnabled(bool)));
-	connect(sleep_edit, SIGNAL(textChanged(const QString&)), this, SLOT(configChanged()));
-
-	
-	grid->addWidget( new QLabel( i18n("Suspend:"), this), 1, 0);
-	suspend_enabled = new QCheckBox(this);
-	grid->addWidget(suspend_enabled, 1, 1);
-	suspend_edit = new KLineEdit(this);
-	suspend_edit->setText(suspend_t);
-	suspend_edit->setEnabled(suspend_e);
-	grid->addWidget(suspend_edit, 1, 2);
-	suspend_enabled->setChecked(suspend_e);
-	connect(suspend_enabled, SIGNAL(clicked()), this, SLOT(configChanged()));
-	connect(suspend_enabled, SIGNAL(toggled(bool)), suspend_edit, SLOT(setEnabled(bool)));
-	connect(suspend_edit, SIGNAL(textChanged(const QString&)), this, SLOT(configChanged()));
-	
-	grid->addWidget( new QLabel( i18n("Hibernate:"), this), 2, 0);
-	hibernate_enabled = new QCheckBox(this);
-	grid->addWidget(hibernate_enabled, 2, 1);
-	hibernate_edit = new KLineEdit(this);
-	hibernate_edit->setText(hibernate_t);
-	hibernate_edit->setEnabled(hibernate_e);
-	hibernate_enabled->setChecked(hibernate_e);
-	grid->addWidget(hibernate_edit, 2, 2);
-	connect(hibernate_enabled, SIGNAL(clicked()), this, SLOT(configChanged()));
-	connect(hibernate_enabled, SIGNAL(toggled(bool)), hibernate_edit, SLOT(setEnabled(bool)));
-	connect(hibernate_edit, SIGNAL(textChanged(const QString&)), this, SLOT(configChanged()));
-	top_layout->addLayout(grid);
-
-	QHBoxLayout *layout = new QHBoxLayout( this );
-	save_button = new QPushButton(i18n("&OK"), this);
-	layout->addWidget(save_button);
-	layout->addStretch(1);
-	cancel_button = new QPushButton(i18n("&Cancel"), this);
-	layout->addWidget(cancel_button);
-	connect(save_button, SIGNAL(clicked()), this, SLOT(accept()));
-	connect(cancel_button, SIGNAL(clicked()), this, SLOT(reject()));
-	top_layout->addLayout(layout);
-
-	setMinimumSize( 300, 50 );
-}
-
-void
-acpi_dialog::configChanged()
-{
-	changed = 1;
-}
-
-void
-acpi_dialog::Save(bool &sleep_e, QString &sleep_t,
-                  bool &suspend_e, QString &suspend_t,
-                  bool &hibernate_e, QString &hibernate_t)
-{
-	if (changed) {
-		config->setGroup("ACPIConfig");
-		config->writeEntry("SleepText", sleep_t = sleep_edit->text());
-		config->writeEntry("SleepEnabled", sleep_e = sleep_enabled->isChecked());
-		config->writeEntry("SuspendText", suspend_t = suspend_edit->text());
-		config->writeEntry("SuspendEnabled", suspend_e = suspend_enabled->isChecked());
-		config->writeEntry("HibernateText", hibernate_t = hibernate_edit->text());
-		config->writeEntry("HibernateEnabled", hibernate_e = hibernate_enabled->isChecked());
-		config->sync();
-	}
-}
-
-#include "acpi_config.moc"
-
Index: klaptopdaemon/acpi_config.h
===================================================================
RCS file: klaptopdaemon/acpi_config.h
diff -N klaptopdaemon/acpi_config.h
--- klaptopdaemon/acpi_config.h	14 Aug 2002 21:31:17 -0000	1.1.1.1
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,63 +0,0 @@
-
-#ifndef ACPI_PANEL_START_H
-#define ACPI_PANEL_START_H
-#include <qobject.h>
-#include <kconfig.h>
-#include <qvgroupbox.h>
-#include <qpushbutton.h>
-#include <qcheckbox.h>
-#include <klineedit.h>
-#include <kdialog.h>
-
-class acpi_config : public QObject {
-	Q_OBJECT
-public:
-	acpi_config(QWidget *parent, KConfig *config, QVBoxLayout *layout);
-	acpi_config(KConfig *config);
-	~acpi_config();
-	bool	has_sleep() { return acpi_sleep_enabled; }
-	bool	has_suspend() { return acpi_suspend_enabled; }
-	bool	has_hibernate() { return acpi_hibernate_enabled; }
-	void	do_sleep() { if (acpi_sleep_enabled) do_command(acpi_sleep); }
-	void	do_suspend() { if (acpi_suspend_enabled) do_command(acpi_suspend); }
-	void	do_hibernate() { if (acpi_hibernate_enabled) do_command(acpi_hibernate); }
-private slots:
-	void	acpi_config_start();
-private:
-	void	do_command(QString &cmd);
-	KConfig *saved_config;
-	QString acpi_sleep;
-	QString acpi_suspend;
-	QString acpi_hibernate;
-	bool acpi_sleep_enabled, acpi_suspend_enabled, acpi_hibernate_enabled;
-};
-
-class acpi_dialog: public KDialog {
-	Q_OBJECT
-public:
-	acpi_dialog(KConfig *config,bool sleep_e, QString &sleep_t,
-                bool suspend_e, QString &suspend_t,
-                bool hibernate_e, QString &hibernate_t);
-	void	Save(bool &sleep_e, QString &sleep_t,
-                	bool &suspend_e, QString &suspend_t,
-                	bool &hibernate_e, QString &hibernate_t);
-private slots:
-	void	configChanged();
-private:
-	bool		changed;
-	KConfig 	*config;
-
-	QCheckBox	*sleep_enabled;
-	KLineEdit	*sleep_edit;
-
-	QCheckBox	*suspend_enabled;
-	KLineEdit	*suspend_edit;
-
-	QCheckBox	*hibernate_enabled;
-	KLineEdit	*hibernate_edit;
-
-	QPushButton	*save_button;
-	QPushButton	*cancel_button;
-};
-
-#endif
Index: klaptopdaemon/battery.cpp
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/battery.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -b -u -r1.1.1.3 -r1.2
--- klaptopdaemon/battery.cpp	14 Aug 2002 21:31:17 -0000	1.1.1.3
+++ klaptopdaemon/battery.cpp	19 Aug 2002 01:49:35 -0000	1.2
@@ -103,7 +103,7 @@
 
       QLabel* explain = new QLabel( i18n("This panel controls whether the battery status\nmonitor appears in the dock and what it looks like."), this);
       top_layout->addWidget(explain, 0);
-      laptop_portable::extra_config(this, config, top_layout);
+
     }
     quitMenu = new QCheckBox( i18n("Include &quit menu"), this );
     top_layout->addWidget( quitMenu );
Index: klaptopdaemon/daemondock.cpp
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/daemondock.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -b -u -r1.1.1.3 -r1.2
--- klaptopdaemon/daemondock.cpp	14 Aug 2002 21:31:17 -0000	1.1.1.3
+++ klaptopdaemon/daemondock.cpp	19 Aug 2002 01:49:35 -0000	1.2
@@ -4,7 +4,7 @@
  *
  * This file contains the docked widget for the laptop battery monitor
  *
- * $Id: daemondock.cpp,v 1.30 2002/07/06 04:41:19 campbell Exp $
+ * $Id: daemondock.cpp,v 1.29 2002/04/10 09:04:42 campbell Exp $
  *
  *  This program is free software; you can redistribute it and/or modify
  *  it under the terms of the GNU General Public License as published by
@@ -312,7 +312,7 @@
 
 void laptop_dock::invokeSetup()
 {
-	::system("kcmshell laptop&");
+	::system("kcmshell battery&");
 }
 
 laptop_dock::~laptop_dock() {
Index: klaptopdaemon/main.cpp
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/main.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -b -u -r1.1.1.3 -r1.2
--- klaptopdaemon/main.cpp	14 Aug 2002 21:31:17 -0000	1.1.1.3
+++ klaptopdaemon/main.cpp	19 Aug 2002 01:49:35 -0000	1.2
@@ -24,10 +24,7 @@
 #include <kprocess.h>
 #include <kconfig.h>
 #include <kglobal.h>
-#include <qlayout.h>
-#include <qlayout.h>
 
-#include "main.h"
 #include "warning.h"
 #include "power.h"
 #include "battery.h"
@@ -80,83 +77,4 @@
       return;
     kapp->startServiceByDesktopName("klaptopdaemon");
   }
-
-  KCModule *create_laptop(QWidget *parent, const char *)
-  {
-	return new LaptopModule(parent, "kcmlaptop");
-  }
-
-  void init_laptop()
-  {
-	init_battery();
-  }
-}
-
-
-
-LaptopModule::LaptopModule(QWidget *parent, const char *)
-  : KCModule(parent, "kcmlaptop")
-{
-  QVBoxLayout *layout = new QVBoxLayout(this);
-  tab = new QTabWidget(this);
-  layout->addWidget(tab);
-
-  battery = new BatteryConfig(parent, "kcmlaptop");
-  tab->addTab(battery, i18n("&Battery"));
-  connect(battery, SIGNAL(changed(bool)), this, SLOT(moduleChanged(bool)));
-
-  power = new PowerConfig(parent, "kcmlaptop");
-  tab->addTab(power, i18n("&Power Control"));
-  connect(power, SIGNAL(changed(bool)), this, SLOT(moduleChanged(bool)));
-
-  warning = new WarningConfig(0, parent, "kcmlaptop");
-  tab->addTab(warning, i18n("Low Battery &Warning"));
-  connect(warning, SIGNAL(changed(bool)), this, SLOT(moduleChanged(bool)));
-
-  critical = new WarningConfig(1, parent, "kcmlaptop");
-  tab->addTab(critical, i18n("Low Battery &Critical"));
-  connect(critical, SIGNAL(changed(bool)), this, SLOT(moduleChanged(bool)));
-
 }
-
-void LaptopModule::load()
-{
-  battery->load();
-  warning->load();
-  critical->load();
-  power->load();
-}
-
-void LaptopModule::save()
-{
-  battery->save();
-  warning->save();
-  critical->save();
-  power->save();
-}
-
-
-void LaptopModule::defaults()
-{
-  power->defaults();
-  warning->defaults();
-  critical->defaults();
-  power->defaults();
-}
-
-QString LaptopModule::quickHelp() const
-{
-  return i18n("<h1>Battery Monitor</h1>This module allows you to monitor "
-        "your batteries. To make use of this module, you must have APM "
-        "or ACPI installed. (And, of course, you should have batteries in your "
-        "machine.)");
-}
-
-
-void LaptopModule::moduleChanged(bool state)
-{
-  emit changed(state);
-}
-
-
-#include "main.moc"
Index: klaptopdaemon/main.h
===================================================================
RCS file: klaptopdaemon/main.h
diff -N klaptopdaemon/main.h
--- klaptopdaemon/main.h	14 Aug 2002 21:31:17 -0000	1.1.1.1
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,72 +0,0 @@
-/*
- * main.h
- *
- * Copyright (c) 2002 Paul Campbell paul@taniwha.com
- *
- * Requires the Qt widget libraries, available at no cost at
- * http://www.troll.no/
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the GNU General Public License as published by
- *  the Free Software Foundation; either version 2 of the License, or
- *  (at your option) any later version.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  GNU General Public License for more details.
- *
- *  You should have received a copy of the GNU General Public License
- *  along with this program; if not, write to the Free Software
- *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
- */
-
-
-#ifndef __MAIN_H__
-#define __MAIN_H__
-
-
-#include <qtabwidget.h>
-
-
-#include <kcmodule.h>
-
-
-class WarningConfig;
-class BatteryConfig;
-class PowerConfig;
-
-class LaptopModule : public KCModule
-{
-  Q_OBJECT
-
-public:
-
-  LaptopModule(QWidget *parent, const char *name);
-
-  void load();
-  void save();
-  void defaults();
-  QString quickHelp() const;
-
-
-
-protected slots:
-
-  void moduleChanged(bool state);
-
-
-private:
-
-  QTabWidget   *tab;
-
-  WarningConfig 	*warning;
-  WarningConfig 	*critical;
-  BatteryConfig   	*battery;
-  PowerConfig  		*power;
-};
-
-
-#endif
-
-
Index: klaptopdaemon/portable.cpp
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/portable.cpp,v
retrieving revision 1.1.1.3
retrieving revision 1.4
diff -u -b -u -r1.1.1.3 -r1.4
--- klaptopdaemon/portable.cpp	14 Aug 2002 21:31:17 -0000	1.1.1.3
+++ klaptopdaemon/portable.cpp	19 Aug 2002 01:49:35 -0000	1.4
@@ -53,13 +53,6 @@
 #include <unistd.h>
 #include <sys/stat.h>
 #include <stdlib.h>
-#include <dirent.h>
-#include <qpushbutton.h>
-#include <qobject.h>
-#include "acpi_config.h"
-
-static acpi_config *panel_start=0;
-
 
 //
 //	here's the Linux specific laptop control panel stuff
@@ -108,21 +101,32 @@
 	return(0);
 }
 
-#define MAX_BATTERIES 4
-static int acpi_num_batteries = 0;
-static char acpi_batt_info0[NAME_MAX+50];
-static char acpi_batt_info1[NAME_MAX+50];
-static char acpi_batt_info2[NAME_MAX+50];
-static char acpi_batt_info3[NAME_MAX+50];
-static char acpi_batt_status0[NAME_MAX+50];
-static char acpi_batt_status1[NAME_MAX+50];
-static char acpi_batt_status2[NAME_MAX+50];
-static char acpi_batt_status3[NAME_MAX+50];
-static char *acpi_batt_info[MAX_BATTERIES] = {acpi_batt_info0, acpi_batt_info1, acpi_batt_info2, acpi_batt_info3};
-static char *acpi_batt_status[MAX_BATTERIES] = {acpi_batt_status0, acpi_batt_status1, acpi_batt_status2, acpi_batt_status3};
+static const char * const batt_info[] = {
+	"/proc/acpi/battery/0/info",
+	"/proc/acpi/battery/1/info",
+	"/proc/acpi/battery/2/info",
+	"/proc/acpi/battery/3/info",
+	"/proc/acpi/battery/BAT0/info",
+	"/proc/acpi/battery/BAT1/info",
+	"/proc/acpi/battery/BAT2/info",
+	"/proc/acpi/battery/BAT3/info",
+};
+
+static const char * const batt_status[] = {
+	"/proc/acpi/battery/0/status",
+	"/proc/acpi/battery/1/status",
+	"/proc/acpi/battery/2/status",
+	"/proc/acpi/battery/3/status",
+	"/proc/acpi/battery/BAT0/state",
+	"/proc/acpi/battery/BAT1/state",
+	"/proc/acpi/battery/BAT2/state",
+	"/proc/acpi/battery/BAT3/state",
+};
 
+#define ACPI_BATT_LOC ((int)(sizeof(batt_status)/sizeof(batt_status[0])))
 
 
+static unsigned char acpi_batt_ok[ACPI_BATT_LOC];
 static unsigned char acpi_ac_ok;
 
 static int
@@ -165,101 +169,34 @@
 //
 //		for the moment we prefer APM
 //
-
-static int
-acpi_ac_status()
-{
-	DIR *dfd;
-	struct dirent *dp;
-	FILE *f;
-	static char buff[NAME_MAX+50];
-	static bool inited=0;
-	static bool bad=0;
-	
-	if (inited) {
-		if (bad)
-			return(-1);
-		f = fopen(buff, "r");
-		goto readit;
-	}
-	inited = 1;
-
-	dfd = opendir("/proc/acpi/ac_adapter/");
-	if (dfd) {
-		for (;;) {
-			dp = readdir(dfd);
-			if (dp == 0)
-				break;
-			if (strcmp(dp->d_name, ".") == 0 ||
-		            strcmp(dp->d_name, "..") == 0)
-				continue;
-			strcpy(buff, "/proc/acpi/ac_adapter/");
-			strcat(buff, dp->d_name);
-			strcat(buff, "/status");
-			f = fopen(buff, "r");
-			if (!f) {
-				strcpy(buff, "/proc/acpi/ac_adapter/");
-				strcat(buff, dp->d_name);
-				strcat(buff, "/state");
-				f = fopen(buff, "r");
-			}
-			if (f)
-				break;
-		}
-		closedir(dfd);
-readit:
-		if (f) {
-			for (;;) {
-				char buff2[1024];
-				if (fgets(buff2, sizeof(buff), f) == NULL)
-					break;
-				if (strstr(buff2, "Status:") != NULL ||
-			    	    strstr(buff2, "state:") != NULL) {
-					if (strstr(buff2, "on-line") != NULL) {
-						fclose(f);
-						return(1);
-					}
-				}
-			}
-			fclose(f);
-			return(0);
-		}
-	}
-	bad=1;
-	return(-1);
-}
-
 static int
 acpi_read(apm_info *ap)
 {
+   	FILE	*f;
 	int	v, i;
 	int rate, part, total; 
 	int ret = 1;
 	char buff[1024];
 	static int ratecount=0;
 	static int ratetotal=0;
-	FILE *f;
 
 	part = 0;
 	total = 0;
 	rate = 0;
-	for (i = 0; i < acpi_num_batteries; i++) {
+	for (i = 0; i < ACPI_BATT_LOC; i++)
+	if (acpi_batt_ok[i]) {
 		int remaining = 0;
 		int caplow = 0;
 		int cap = 0;
 		int first=1;
 
-		if (acpi_batt_info[i][0]) {
-			f = fopen(acpi_batt_info[i], "r");
-		} else {
-			f = 0;
-		}
+		f = fopen(batt_info[i], "r");
 again:
 		if (f == NULL) {
-			if (!first || !acpi_batt_status[i][0])
+			if (!first)
 				continue;
 			first = 0;
-			f = fopen(acpi_batt_status[i], "r");
+			f = fopen(batt_status[i], "r");
 			goto again;
 		}
 		for (;;) {
@@ -285,9 +222,9 @@
 			} 
 		}
    		fclose(f);
-		if (first && acpi_batt_status[i][0]) {
+		if (first) {
 			first = 0;
-			f = fopen(acpi_batt_status[i], "r");
+			f = fopen(batt_status[i], "r");
 			goto again;
 		}
 		ret = 0;
@@ -314,8 +251,22 @@
 	ap->battery_time = -1;
 	ap->ac_line_status = 0;
 	ap->apm_flags = 0;
-	if (acpi_ac_status() == 1)
+	f = fopen("/proc/acpi/ac_adapter/0/status", "r");
+	if (!f) 
+		f = fopen("/proc/acpi/ac_adapter/AC/state", "r");
+	if (f) {
+		for (;;) {
+			if (fgets(buff, sizeof(buff), f) == NULL)
+				break;
+			if (strstr(buff, "Status:") != NULL ||
+			    strstr(buff, "state:") != NULL) {
+				if (strstr(buff, "on-line") != NULL) 
 		ap->ac_line_status |= 1;
+				break;
+			}
+		}
+		fclose(f);
+	}
 	return(ret);
 }
 
@@ -340,69 +291,29 @@
         return(val);
 }
 
-static int x_acpi_init = 0;
 static int
 has_acpi()
 {
-	int i;
-	bool ok;
-	DIR *dfd;
-	struct dirent *dp;
+	static int init = 0;
 	static int val;
+	int i;
 
-	if (x_acpi_init)
+	if (init)
 		return(val);
-	x_acpi_init = 1;
+	init = 1;
 	val = 0;
-	
-	if (acpi_ac_status() >= 0)
+	if (::access("/proc/acpi/ac_adapter/0/status", R_OK) == 0 ||
+	    ::access("/proc/acpi/ac_adapter/AC/state", R_OK) == 0)
 		acpi_ac_ok = 1;
-
-	dfd = opendir("/proc/acpi/battery");
-	if (!dfd)
-		return(val = 0);
-	i = 0;
-	acpi_num_batteries = 0;
-	for (dp = readdir(dfd);dp && i < MAX_BATTERIES;dp = readdir(dfd)) {
-		if (strcmp(dp->d_name, ".") == 0 ||
-		    strcmp(dp->d_name, "..") == 0)
-			continue;
-		strcpy(acpi_batt_status[i], "/proc/acpi/battery/");
-		strcat(acpi_batt_status[i], dp->d_name);
-		strcpy(acpi_batt_info[i], acpi_batt_status[i]);
-		ok = 0;
-		strcat(acpi_batt_status[i], "/state");
-		if (::access(acpi_batt_status[i], R_OK) != 0) {
-			strcpy(acpi_batt_status[i], acpi_batt_info[i]);
-			strcat(acpi_batt_status[i], "/status");
-			if (::access(acpi_batt_status[i], R_OK) == 0) {
-				ok = 1;
-			} else {
-				acpi_batt_status[i][0] = 0;
-			}
-		} else {
-			ok = 1;
-		}
-		strcat(acpi_batt_info[i], "/info");
-		if (::access(acpi_batt_info[i], R_OK) == 0) {
-			ok = 1;
-		} else {
-			acpi_batt_info[i][0] = 0;
-		}
-		if (ok) {
-			acpi_num_batteries++;
-			i++;
+	for (i = 0; i < ACPI_BATT_LOC; i++) {
+		if (::access(batt_status[i], R_OK) == 0 ||
+		    ::access(batt_info[i], R_OK) == 0) {
+			acpi_batt_ok[i] = 1;
 			val = 1;
 		}
 	}
-	closedir(dfd);
 	if (!acpi_ac_ok) 
 		val = 0;
-	if (val && panel_start == 0) {
-		KConfig *c = new KConfig("kcmlaptoprc");
-		panel_start = new acpi_config(c);
-		delete c;
-	}
 	return(val);
 }
  
@@ -413,20 +324,6 @@
 }
 
 //
-//	something changed maybe we need to check out environment again
-//
-void
-laptop_portable::power_management_restart()
-{
-	if (panel_start) {
-		delete panel_start;
-		panel_start = 0;
-	}
-	x_acpi_init = 0;
-	acpi_num_batteries = 0;
-}
-
-//
 //	returns 1 if we support power management
 //
 int laptop_portable::has_power_management()
@@ -451,9 +348,8 @@
 int laptop_portable::has_suspend()
 {
 	struct stat s;
-	if (::has_acpi()) {
-		return(panel_start && panel_start->has_suspend());
-	}
+	if (::has_acpi())
+		return(0);
         if (stat("/usr/bin/apm", &s) || !(getuid() == 0 || s.st_mode&S_ISUID)) 
 		return(0);
 	return(1);
@@ -466,7 +362,7 @@
 {
 	struct stat s;
 	if (::has_acpi())
-		return(panel_start && panel_start->has_sleep());
+		return(0);
         if (stat("/usr/bin/apm", &s) || !(getuid() == 0 || s.st_mode&S_ISUID)) 
 		return(0);
 	return(1);
@@ -481,8 +377,6 @@
 {
 	struct stat s;
 
-	if (::has_acpi())
-		return(panel_start && panel_start->has_hibernate());
 	hiber_type = 0;
         if (stat("/usr/local/bin/tpctl", &s) == 0 && (getuid() == 0 || s.st_mode&S_ISUID))  {
 		hiber_type = 1;
@@ -610,12 +504,7 @@
 //
 void laptop_portable::invoke_standby()
 {
-	if (::has_acpi()) {
-		if(panel_start)
-			panel_start->do_sleep();
-	} else {
 	 	::system("/usr/bin/apm --standby");    
-	}
 }
 
 //
@@ -623,12 +512,7 @@
 //
 void laptop_portable::invoke_suspend()
 {
-	if (::has_acpi()) {
-		if(panel_start)
-			panel_start->do_suspend();
-	} else {
 	 	::system("/usr/bin/apm --suspend");    
-	}
 }
 
 //
@@ -636,10 +520,6 @@
 //
 void laptop_portable::invoke_hibernation()
 {
-	if (::has_acpi()) {
-		if(panel_start)
-			panel_start->do_hibernate();
-	} else 
 	switch (hiber_type) {
 	case 1:
 	 	::system("/usr/local/bin/tpctl --hibernate");    
@@ -648,18 +528,6 @@
 	}
 }
 
-void
-laptop_portable::extra_config(QWidget *parent, KConfig *config, QVBoxLayout *layout)
-{
-	if (1|::has_acpi()) {
-printf("extra!\n");
-		if (panel_start)
-			delete panel_start;
-		panel_start = new acpi_config(parent, config, layout);
-		return;
-	}
-	
-}
 
 //
 //	return current battery state
@@ -769,14 +637,6 @@
 
 #include <iostream.h>
 
-//
-//	something changed maybe we need to check out environment again
-//
-void
-laptop_portable::power_management_restart()
-{
-}
-
 int
 laptop_portable::has_power_management()
 {
@@ -975,15 +835,6 @@
 	}
 }
 
-//
-//	adds extra widgets to the battery panel
-//
-void
-extra_config(QWidget *parent, KConfig *config, QVBoxLayout *layout)
-{
-}
-
-
 
 //
 //	return current battery state
@@ -1031,14 +882,6 @@
 // INSERT HERE
 
 //
-//	something changed maybe we need to check out environment again
-//
-void
-laptop_portable::power_management_restart()
-{
-}
-
-//
 //	returns 1 if we support power management
 //
 int
@@ -1132,14 +975,6 @@
 {
 }
 
-
-//
-//	adds extra widgets to the battery panel
-//
-void
-extra_config(QWidget *parent, KConfig *config, QVBoxLayout *layout)
-{
-}
 
 //
 //	return current battery state
Index: klaptopdaemon/portable.h
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/portable.h,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -b -u -r1.1.1.2 -r1.2
--- klaptopdaemon/portable.h	14 Aug 2002 21:31:16 -0000	1.1.1.2
+++ klaptopdaemon/portable.h	19 Aug 2002 01:49:35 -0000	1.2
@@ -1,6 +1,4 @@
 #include <qlabel.h>
-#include <kconfig.h>
-#include <qvgroupbox.h>
 
 #ifndef PORTABLE_H
 #define PORTABLE_H
@@ -13,7 +11,6 @@
 
 class laptop_portable {
 public:
-	static void power_management_restart();	// reset internal state
 	static int has_power_management();	// returns 1 if this computer has power management
 	static int has_battery_time();		// returns 1 if this give BIOS battery time info
 	static int has_suspend();		// returns 1 if this computer can perform a suspend
@@ -27,8 +24,6 @@
 	static void invoke_hibernation();
 	static struct power_result poll_battery_state();
 	static int poll_activity();
-	static void extra_config(QWidget *parent, KConfig *config, QVBoxLayout *layout);
-
 };
 
 #endif
Index: klaptopdaemon/version.h
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/version.h,v
retrieving revision 1.1.1.3
retrieving revision 1.2
diff -u -b -u -r1.1.1.3 -r1.2
--- klaptopdaemon/version.h	14 Aug 2002 21:31:17 -0000	1.1.1.3
+++ klaptopdaemon/version.h	19 Aug 2002 01:49:35 -0000	1.2
@@ -1 +1 @@
-#define LAPTOP_VERSION "1.3"
+#define LAPTOP_VERSION "1.2"
Index: klaptopdaemon/applnk/.directory
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/applnk/.directory,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -b -u -r1.1.1.2 -r1.2
--- klaptopdaemon/applnk/.directory	14 Aug 2002 21:31:18 -0000	1.1.1.2
+++ klaptopdaemon/applnk/.directory	19 Aug 2002 01:49:35 -0000	1.2
@@ -22,12 +22,14 @@
 Name[nb]=Brbar
 Name[nl]=Schootcomputer
 Name[nn]=Brbar
+Name[oc]=Portatil
 Name[pt]=Porttil
 Name[sl]=Prenosnik
 Name[sv]=Brbar dator
 Name[th]=
 Name[tr]=Dizst
 Name[uk]= ' ()
+Name[ven]=Khomupwutha pfarwa
 Name[xh]=Umphezulu osongiweyo
 Name[xx]=xx
 Name[zh_CN]=
Index: klaptopdaemon/applnk/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/applnk/Makefile.am,v
retrieving revision 1.1.1.2
retrieving revision 1.2
diff -u -b -u -r1.1.1.2 -r1.2
--- klaptopdaemon/applnk/Makefile.am	14 Aug 2002 21:31:18 -0000	1.1.1.2
+++ klaptopdaemon/applnk/Makefile.am	19 Aug 2002 01:49:35 -0000	1.2
@@ -1,5 +1,5 @@
-data_DATA = laptop.desktop
-datadir = $(kde_appsdir)/Settings/System/PowerControl
+data_DATA = battery.desktop bwarning.desktop cwarning.desktop  power.desktop 
+datadir = $(kde_appsdir)/Settings/PowerControl
 
 data2_DATA = pcmcia.desktop
 data2dir = $(kde_appsdir)/Settings/Information
Index: klaptopdaemon/applnk/battery.desktop
===================================================================
RCS file: klaptopdaemon/applnk/battery.desktop
diff -N klaptopdaemon/applnk/battery.desktop
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ klaptopdaemon/applnk/battery.desktop	19 Aug 2002 01:49:35 -0000	1.3
@@ -0,0 +1,124 @@
+[Desktop Entry]
+Encoding=UTF-8
+X-KDE-ModuleType=Library
+X-KDE-Library=laptop
+X-KDE-FactoryName=battery
+X-KDE-Init=battery
+Exec=kcmshell battery       
+Icon=laptop_battery
+MiniIcon=laptop_battery
+Type=Application
+DocPath=kcontrol/battery-monitor.html
+Comment=Battery Monitor
+Comment[af]=batery monitor
+Comment[ar]= 
+Comment[az]=Batareya zlyici
+Comment[be]= 
+Comment[bg]=  
+Comment[br]=Diskwel saviad an daspugner
+Comment[bs]=Stanje baterije
+Comment[ca]=Monitor de bateria
+Comment[cs]=Monitor bateri
+Comment[da]=Batteriovervgning
+Comment[de]=Batterieberwachung
+Comment[el]= 
+Comment[eo]=Bateristato
+Comment[es]=Monitor de batera
+Comment[et]=Aku monitooring
+Comment[eu]=Bateria Monitorizatzen du
+Comment[fi]=Paristonvalvonta
+Comment[fr]=Indicateur de batterie
+Comment[gl]=Monitor da Batera
+Comment[he]=   
+Comment[hr]=Stanje baterija
+Comment[hu]=Akkumultorfigyel
+Comment[id]=Monitor Baterai
+Comment[is]=Rafhlueftirlit
+Comment[it]=Mostra lo stato della batteria
+Comment[ja]=
+Comment[ko]=    
+Comment[lt]=Baterijos stebtojas
+Comment[lv]=Bateriju Monitors
+Comment[mk]=    
+Comment[mt]=Monitor tal-Batteriji
+Comment[nb]=Batteriovervker
+Comment[nl]=batterijbewaking
+Comment[nn]=Batteriovervaking
+Comment[oc]=Monitor de bateria
+Comment[pl]=Monitor baterii
+Comment[pt]=Monitor de bateria
+Comment[pt_BR]=Monitor de bateria
+Comment[ro]=Monitor de baterie
+Comment[ru]= 
+Comment[sk]=Monitor nabitia bateriek
+Comment[sl]=Nadzornik baterije
+Comment[sr]=Monitor popunjenosti baterija
+Comment[sv]=Batterimonitor
+Comment[ta]= 
+Comment[th]=
+Comment[tr]=Pil zleyici
+Comment[uk]= 
+Comment[ven]=Musedzi wa Mulilo
+Comment[vi]=Trnh theo di pin 
+Comment[xh]=Umphathi webhetri
+Comment[xx]=xx
+Comment[zh_CN]=
+Comment[zh_TW]=
+Comment[zu]=Umphathi webhetri
+Name=Battery Monitor
+Name[af]=batery monitor
+Name[ar]= 
+Name[az]=Batareya zlyici
+Name[be]= 
+Name[bg]=  
+Name[br]=Diskwel an daspugner
+Name[bs]=Stanje baterije
+Name[ca]=Monitor de bateria
+Name[cs]=Monitor bateri
+Name[da]=Batteriovervgning
+Name[de]=Batterieberwachung
+Name[el]= 
+Name[eo]=Bateristato
+Name[es]=Monitor de batera
+Name[et]=Aku monitooring
+Name[eu]=Bateria Monitorea
+Name[fi]=Paristonvalvonta
+Name[fr]=Indicateur de batterie
+Name[gl]=Monitor da Batera
+Name[he]= 
+Name[hr]=Stanje baterije
+Name[hu]=Az akkumultor szintjelzje
+Name[id]=Monitor Baterai
+Name[is]=Rafhlueftirlit
+Name[it]=Controllo batteria
+Name[ja]=
+Name[ko]=  
+Name[lt]=Baterijos stebtojas
+Name[lv]=Bateriju Monitors
+Name[mk]=  
+Name[mt]=Monitor tal-Batteriji
+Name[nb]=Batteriovervker
+Name[nl]=Batterijbewaking
+Name[nn]=Batteriovervaking
+Name[oc]=Monitor de bateria
+Name[pl]=Monitor baterii
+Name[pt]=Monitor de Bateria
+Name[pt_BR]=Monitor de bateria
+Name[ro]=Monitor de baterie
+Name[ru]= 
+Name[sk]=Monitor nabitia bateriek
+Name[sl]=Nadzornik baterije
+Name[sr]=Monitor baterija
+Name[sv]=Batterimonitor
+Name[ta]= 
+Name[th]=
+Name[tr]=Pil zleyici
+Name[uk]= 
+Name[ven]=Musedzi wa mulilo
+Name[vi]=Trnh theo di pin 
+Name[xh]=Umphathi webhetri
+Name[xx]=xx
+Name[zh_CN]=
+Name[zh_TW]=
+Name[zu]=Umphathi Webhetri
+Init=klaptopdaemon
Index: klaptopdaemon/applnk/bwarning.desktop
===================================================================
RCS file: klaptopdaemon/applnk/bwarning.desktop
diff -N klaptopdaemon/applnk/bwarning.desktop
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ klaptopdaemon/applnk/bwarning.desktop	19 Aug 2002 01:49:35 -0000	1.3
@@ -0,0 +1,110 @@
+[Desktop Entry]
+Encoding=UTF-8
+X-KDE-ModuleType=Library
+X-KDE-Library=laptop
+X-KDE-FactoryName=bwarning
+Exec=kcmshell bwarning
+Icon=laptop_battery
+MiniIcon=laptop_battery
+Type=Application
+DocPath=kcontrol/lowbatwarn.html
+Comment=Low Battery Warning
+Comment[af]=lae batery waarskuwing
+Comment[ar]=  
+Comment[az]=Zif Batareya Xbrdarl
+Comment[bg]=     
+Comment[br]=Kemenn eo izel an daspugner
+Comment[bs]=Upozorenje istroene baterije
+Comment[ca]=Avs de bateria baixa
+Comment[da]=Advarsel mod lavt batteri
+Comment[de]=Warnung bei nachlassender Batterie
+Comment[el]=    
+Comment[eo]=Avertilo por maplenigo de la baterio
+Comment[es]=Aviso de batera baja
+Comment[et]=Aku thjenemise hoiatus
+Comment[eu]=Bateria Gutxiko Oharpena
+Comment[fi]=Tyhjn pariston varoitus
+Comment[fr]=Batterie faible
+Comment[gl]=Aviso de Batera Baixa
+Comment[he]=     
+Comment[hr]=Baterija je skoro ispranjena
+Comment[hu]=alacsony tpfeszltsgre figyelmeztets
+Comment[id]=Peringatan Baterai Lemah
+Comment[is]=Lti eftir  rafhlunni
+Comment[ja]=
+Comment[ko]=  
+Comment[lt]=Perspjimas apie isieikvojusi baterij
+Comment[mk]=    
+Comment[mt]=Twissija ta' Batterija Baxxa
+Comment[nb]=Lite batteri-advarsel
+Comment[nl]=Waarschuwing laag batterijvermogen 
+Comment[oc]=Avis de bateria baixa
+Comment[pl]=Ostrzeenie o sabych bateriach
+Comment[pt_BR]=Aviso de bateria fraca
+Comment[ro]=Avertizare baterie descrcat
+Comment[ru]=   
+Comment[sk]=Pozor s vybit batrie
+Comment[sl]=Opozorilo o prazni bateriji
+Comment[sr]=Upozorenje na ispranjenost baterija
+Comment[sv]=Varning fr lg batteriniv
+Comment[ta]=  
+Comment[tr]=Zayf Pil Uyars
+Comment[uk]=    
+Comment[vi]=Cnh bo yu pin 
+Comment[xx]=xx
+Comment[zh_CN]=
+Name=Low Battery Warning
+Name[af]=lae batery waarskuwing
+Name[ar]=  
+Name[az]=Zif Batareya Xbrdarl
+Name[bg]=     
+Name[br]=Kemenn eo izel an daspugner
+Name[bs]=Upozorenje istroene baterije
+Name[ca]=Avs de bateria baixa
+Name[cs]=Varovn - vybit baterie
+Name[da]=Advarsel mod lavt batteri
+Name[de]=Batteriestand niedrig
+Name[el]=  
+Name[eo]=Bateriavertilo
+Name[es]=Aviso de batera baja
+Name[et]=Aku thjenemise hoiatus
+Name[eu]=Bateria Gutxiko Oharpena
+Name[fi]=Tyhjn pariston varoitus
+Name[fr]=Batterie faible
+Name[gl]=Aviso de Batera Baixa
+Name[he]=  
+Name[hr]=Baterija je skoro ispranjena
+Name[hu]=Alacsony tpfeszltsgre figyelmeztets
+Name[id]=Peringatan baterai lemah
+Name[is]=Rafhluavrun
+Name[it]=Avviso batteria scarica
+Name[ja]= 
+Name[ko]=   
+Name[lt]=spjimas apie isieikvojusi baterij
+Name[lv]=Tukas Baterijas - Brdinjums
+Name[mk]= 
+Name[mt]=Twissija ta' Batterija Baxxa
+Name[nb]=Lite batteri-advarsel
+Name[nl]=Waarschuwing laag batterijvermogen 
+Name[nn]=tvaring ved lgt batteriniv
+Name[oc]=Avis de bateria baixa
+Name[pl]=Ostrzeenie o sabych bateriach
+Name[pt]=Bateria Fraca
+Name[pt_BR]=Aviso de bateria fraca
+Name[ro]=Avertizare baterie descrcat
+Name[ru]= 
+Name[sk]=Pozor s vybit batrie
+Name[sl]=Opozorilo o prazni bateriji
+Name[sr]=Upozorenje na ispranjenost baterija
+Name[sv]=Varning fr lg batteriniv
+Name[ta]=  
+Name[th]=
+Name[tr]=Zayf Pil Uyars
+Name[uk]=   
+Name[ven]=Khaidzo ya mulilo mutuku
+Name[vi]=Cnh bo yu pin 
+Name[xh]=Isilumkiso sebhetri esezantsi
+Name[xx]=xx
+Name[zh_CN]=
+Name[zh_TW]=
+Name[zu]=Isexwayiso Sebethri Esezansi
Index: klaptopdaemon/applnk/cwarning.desktop
===================================================================
RCS file: klaptopdaemon/applnk/cwarning.desktop
diff -N klaptopdaemon/applnk/cwarning.desktop
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ klaptopdaemon/applnk/cwarning.desktop	19 Aug 2002 01:49:35 -0000	1.3
@@ -0,0 +1,110 @@
+[Desktop Entry]
+Encoding=UTF-8
+X-KDE-ModuleType=Library
+X-KDE-Library=laptop
+X-KDE-FactoryName=cwarning
+Exec=kcmshell cwarning
+Icon=laptop_battery
+MiniIcon=laptop_battery
+Type=Application
+DocPath=kcontrol/lowbatwarn.html
+Comment=Low Battery Critical
+Comment[af]=lae batery krities
+Comment[ar]=  
+Comment[az]=Batareya ox Zifdir
+Comment[bg]=     
+Comment[br]=Daspugner izel arvarus
+Comment[bs]=Kritino stanje baterije
+Comment[ca]=Bateria baixa en estat crtic
+Comment[da]=Kritisk lavt batteri
+Comment[de]=Kritischer Batteriestand
+Comment[el]=  
+Comment[eo]=Bateriao preska malplena
+Comment[es]=Aviso de batera muy baja
+Comment[et]=Kriitiline aku thjenemine
+Comment[eu]=Bateria Gutxiko Oharpena
+Comment[fi]=Tyhj paristo kriittinen
+Comment[fr]=Batterie presque vide
+Comment[gl]=Batera Baixa a nivel Crtico
+Comment[he]=       
+Comment[hr]=Baterija je blizu potpunog pranjenja
+Comment[hu]=kritikusan alacsony feszltsgre figyelmeztets
+Comment[id]=Teguran Baterai Lemah
+Comment[is]=Mjg lti eftir  rafhlunni
+Comment[ja]=
+Comment[ko]=    
+Comment[lt]=Kritikai isieikvojusi baterija
+Comment[mk]=    
+Comment[mt]=Kritiku! Batterija Baxxa
+Comment[nb]=Lite batteri kritisk
+Comment[nl]=Kritiek laag batterijvermogen
+Comment[oc]=Bateria baixa en estat critic
+Comment[pl]=Powiadomienie o bardzo sabych bateriach
+Comment[pt_BR]=Bateria criticamente fraca
+Comment[ro]=Baterie n stare critic
+Comment[ru]=  
+Comment[sk]=Slab batria - Kritick stav
+Comment[sl]=Kritino prazna baterija
+Comment[sr]=Ispranjenost baterija je kritina
+Comment[sv]=Batteriniv kritisk
+Comment[ta]=  
+Comment[tr]=Kritik Pil Zayfl
+Comment[uk]=  
+Comment[vi]=Pin yu nghim trng 
+Comment[xx]=xx
+Comment[zh_CN]=
+Name=Low Battery Critical
+Name[af]=lae batery krities
+Name[ar]=  
+Name[az]=Batareya ox Zifdir
+Name[bg]=    
+Name[br]=Daspugner izel arvarus
+Name[bs]=Kritino stanje baterije
+Name[ca]=Bateria baixa en estat crtic
+Name[cs]=Kritick stav bateri
+Name[da]=Kritisk lavt batteri
+Name[de]=Batteriestand kritisch
+Name[el]=  
+Name[eo]=Baterio preska malplena
+Name[es]=Aviso de batera muy baja
+Name[et]=Kriitiline aku thjenemine
+Name[eu]=Bateria Gutxiko Oharpena
+Name[fi]=Tyhj paristo kriittinen
+Name[fr]=Batterie presque vide
+Name[gl]=Batera Baixa a nivel Crtico
+Name[he]=  
+Name[hr]=Kritino stanje baterije
+Name[hu]=Kritikusan alacsony feszltsgre figyelmeztets
+Name[id]=Teguran Baterai Lemah
+Name[is]=Mjg lti eftir  rafhlunni
+Name[it]=Batteria molto scarica
+Name[ja]= 
+Name[ko]=    
+Name[lt]=Kritikai isieikvojusi baterija
+Name[lv]=Kritiski Tukas Baterijas
+Name[mk]= 
+Name[mt]=Kritiku! Batterija Baxxa
+Name[nb]=Lite batteri kritisk
+Name[nl]=Kritiek laag batterijvermogen
+Name[nn]=Kritisk lgt batteriniv
+Name[oc]=Bateria baixa en estat critic
+Name[pl]=Bardzo sabe baterie
+Name[pt]=Bateria em Estado Crtico
+Name[pt_BR]=Bateria muito fraca
+Name[ro]=Baterie n stare critic
+Name[ru]=  
+Name[sk]=Slab Batria Kritick stav
+Name[sl]=Baterija kritino prazna
+Name[sr]=Ispranjenost baterija je kritina
+Name[sv]=Batteriniv kritisk
+Name[ta]=  
+Name[th]=
+Name[tr]=Kritik Pil Zayfl
+Name[uk]=  
+Name[ven]=U nyadzisea ha mulilo mutuku
+Name[vi]=Pin yu nghim trng 
+Name[xh]=Ufunyano lwesiphene kwibhetri esezantsi
+Name[xx]=xx
+Name[zh_CN]=
+Name[zh_TW]=
+Name[zu]=Okubalulekile Kwebethri Ezezansi
Index: klaptopdaemon/applnk/klaptopdaemon.desktop
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/applnk/klaptopdaemon.desktop,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -b -u -r1.1.1.4 -r1.2
--- klaptopdaemon/applnk/klaptopdaemon.desktop	14 Aug 2002 21:31:18 -0000	1.1.1.4
+++ klaptopdaemon/applnk/klaptopdaemon.desktop	19 Aug 2002 01:49:35 -0000	1.2
@@ -9,6 +9,7 @@
 Comment[af]=batery monitor
 Comment[ar]= 
 Comment[az]=Batareya zlyici
+Comment[be]= 
 Comment[bg]=  
 Comment[br]=Diskwel saviad an daspugner
 Comment[bs]=Stanje baterije
@@ -37,8 +38,9 @@
 Comment[mk]=    
 Comment[mt]=Monitor tal-Batteriji
 Comment[nb]=Batteriovervker
-Comment[nl]=programma voor batterijbewaking
+Comment[nl]=batterijbewaking
 Comment[nn]=Batteriovervaking
+Comment[oc]=Monitor de bateria
 Comment[pl]=Monitor baterii
 Comment[pt]=Monitor de bateria
 Comment[pt_BR]=Monitor de bateria
@@ -49,9 +51,10 @@
 Comment[sr]=Monitor popunjenosti baterija
 Comment[sv]=Batterimonitor
 Comment[ta]= 
-Comment[th]=
+Comment[th]=
 Comment[tr]=Pil zleyici
 Comment[uk]= 
+Comment[ven]=Musedzi wa Mulilo
 Comment[vi]=Trnh theo di pin 
 Comment[xh]=Umphathi webhetri
 Comment[xx]=xx
@@ -62,6 +65,7 @@
 Name[af]=batery monitor
 Name[ar]= 
 Name[az]=Batareya zlyici
+Name[be]= 
 Name[bg]=  
 Name[br]=Diskwel an daspugner
 Name[bs]=Stanje baterije
@@ -92,6 +96,7 @@
 Name[nb]=Batteriovervker
 Name[nl]=Batterijbewaking
 Name[nn]=Batteriovervaking
+Name[oc]=Monitor de bateria
 Name[pl]=Monitor baterii
 Name[pt]=Monitor de Bateria
 Name[pt_BR]=Monitor de bateria
@@ -102,9 +107,10 @@
 Name[sr]=Monitor baterija
 Name[sv]=Batterimonitor
 Name[ta]= 
-Name[th]=
+Name[th]=
 Name[tr]=Pil zleyici
 Name[uk]= 
+Name[ven]=Musedzi wa mulilo
 Name[vi]=Trnh theo di pin 
 Name[xh]=Umphathi webhetri
 Name[xx]=xx
Index: klaptopdaemon/applnk/laptop.desktop
===================================================================
RCS file: klaptopdaemon/applnk/laptop.desktop
diff -N klaptopdaemon/applnk/laptop.desktop
--- klaptopdaemon/applnk/laptop.desktop	14 Aug 2002 21:31:18 -0000	1.1.1.1
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,46 +0,0 @@
-[Desktop Entry]
-Encoding=UTF-8
-X-KDE-ModuleType=Library
-X-KDE-Library=laptop
-X-KDE-FactoryName=laptop
-X-KDE-Init=laptop
-Exec=kcmshell laptop       
-Icon=laptop_battery
-MiniIcon=laptop_battery
-Type=Application
-DocPath=kcontrol/battery-monitor.html
-Comment=Laptop Battery
-Comment[af]=draagbare rekenaar batery
-Comment[bs]=Upozorenje istroene baterije
-Comment[cs]=Baterie notebooku
-Comment[da]=Laptop-batteri
-Comment[de]=Laptop-Batterie
-Comment[es]=Batera del porttil
-Comment[fi]=Kannettavan akku
-Comment[he]=  
-Comment[hu]=Hordozhat gpek energiaelltsa
-Comment[ja]=
-Comment[pt]=Bateria do Porttil
-Comment[pt_BR]=Bateria do Laptop
-Comment[sl]=Baterija prenosnika
-Comment[sv]=Batteri fr brbar dator
-Comment[th]=
-Comment[tr]=Dizst Pili
-Name=Laptop Battery
-Name[af]=draagbare rekenaar batery
-Name[bs]=Laptop baterija
-Name[cs]=Baterie notebooku
-Name[da]=Laptop-batteri
-Name[de]=Laptop-Batterie
-Name[es]=Batera del porttil
-Name[fi]=Kannettavan akku
-Name[he]=  
-Name[hu]=Laptop-akkumultor
-Name[ja]=
-Name[pt]=Bateria do Porttil
-Name[pt_BR]=Bateria do Laptop
-Name[sl]=Baterija prenosnika
-Name[sv]=Batteri fr brbar dator
-Name[th]=
-Name[tr]=Dizst Pili
-Init=klaptopdaemon
Index: klaptopdaemon/applnk/pcmcia.desktop
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/klaptopdaemon/applnk/pcmcia.desktop,v
retrieving revision 1.1.1.4
retrieving revision 1.2
diff -u -b -u -r1.1.1.4 -r1.2
--- klaptopdaemon/applnk/pcmcia.desktop	14 Aug 2002 21:31:18 -0000	1.1.1.4
+++ klaptopdaemon/applnk/pcmcia.desktop	19 Aug 2002 01:49:35 -0000	1.2
@@ -12,10 +12,10 @@
 Comment[af]=pcmcia status
 Comment[ar]=  PCMCIA
 Comment[az]=PCMCIA vziyyti
+Comment[be]= PCMCIA
 Comment[bg]=  PCMCIA
 Comment[br]=Saviad PCMCIA
 Comment[ca]=Estat de PCMCIA
-Comment[cs]=Stav PCMCIA
 Comment[da]=PCMCIA-status
 Comment[de]=PCMCIA-Status
 Comment[el]= PCMCIA
@@ -37,9 +37,9 @@
 Comment[mk]=PCMCIA 
 Comment[mt]=Stat PCMCIA
 Comment[nb]=PCMCIA-status
-Comment[nl]=Status van PCMCIA
+Comment[nl]=PCMCIA-status
+Comment[oc]=Estat de PCMCIA
 Comment[pl]=Status kart PCMCIA
-Comment[pt]=Estado do PCMCIA
 Comment[pt_BR]=Estado do PCMCIA
 Comment[ro]=Starea PCMCIA
 Comment[ru]= PCMCIA
@@ -48,7 +48,6 @@
 Comment[sr]=Status PCMCI-e
 Comment[sv]=PCMCIA-status
 Comment[ta]=PCMCIA 
-Comment[th]= PCMCIA
 Comment[tr]=PCMCIA durumu
 Comment[uk]= PCMCIA
 Comment[vi]=Trng thi PCMCIA 
Index: klaptopdaemon/applnk/power.desktop
===================================================================
RCS file: klaptopdaemon/applnk/power.desktop
diff -N klaptopdaemon/applnk/power.desktop
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ klaptopdaemon/applnk/power.desktop	19 Aug 2002 01:49:35 -0000	1.3
@@ -0,0 +1,110 @@
+[Desktop Entry]
+Encoding=UTF-8
+X-KDE-ModuleType=Library
+X-KDE-Library=laptop
+X-KDE-FactoryName=power
+Exec=kcmshell power
+Icon=laptop_battery
+MiniIcon=laptop_battery
+Type=Application
+DocPath=kcontrol/powerctrl.html
+Comment=Laptop Power Control
+Comment[af]=draagbare rekenaar elektrisiteit kontrole
+Comment[ar]=   
+Comment[az]=Dizst Gc darsi
+Comment[bg]=     Laptop 
+Comment[br]=Renadur ar gremm evit un urzhiataer hezoug
+Comment[bs]=Uteda energije laptopa
+Comment[ca]=Control d'alimentaci de porttil
+Comment[da]=Strmstyring for brbar
+Comment[de]=Energiekontrolle fr Laptops
+Comment[el]=  
+Comment[eo]=Elektroobservilo
+Comment[es]=Control de energa del porttil
+Comment[et]=Slearvuti voolutarbe jlgimine
+Comment[eu]=Eramangarriaren Energia Kontrola
+Comment[fi]=Kannettavan virranhallinta
+Comment[fr]=Ordinateur portable
+Comment[gl]=Control da Enerxa do Porttil
+Comment[he]=     
+Comment[hr]=Postavke tednje energije prijenosnog raunala
+Comment[hu]=a hordozhat gpek energiakezelse
+Comment[id]=Kontrol Power Laptop
+Comment[is]=Aflstillingar fartlvu
+Comment[ja]=
+Comment[ko]=  
+Comment[lt]=Laptop elektros energijos kontrol
+Comment[mk]=    
+Comment[mt]=Kontroll tal-Konsum tal-Laptop
+Comment[nb]=Strmkontroll for brbar
+Comment[nl]=energiebeheer voor schootcomputers
+Comment[oc]=Control d'alimentacion de portatil
+Comment[pl]=Sterowanie zasilaniem laptopw
+Comment[pt_BR]=Controle de energia em computadores a bateria
+Comment[ro]=Control energie laptop
+Comment[ru]=  
+Comment[sk]=Notebook - Sprva napjania
+Comment[sl]=Nadzor energije za prenosnike
+Comment[sr]=Laptop kontrola energije
+Comment[sv]=Strmfrsrjning fr brbara datorer
+Comment[ta]=   
+Comment[tr]=Dizst G Ynetimi
+Comment[uk]=  
+Comment[vi]=iu khin in cho my xch tay 
+Comment[xx]=xx
+Comment[zh_CN]=
+Name=Laptop Power Control
+Name[af]=draagbare rekenaar elektrisiteit kontrole
+Name[ar]= 
+Name[az]=Dizst Gc idarsi
+Name[bg]=     Laptop 
+Name[br]=Renadur gremm an hezoug
+Name[bs]=Uteda energije laptopa
+Name[ca]=Control d'alimentaci de porttil
+Name[cs]=Ovldn napjen laptopu
+Name[da]=Strmstyring for brbar
+Name[de]=Energiekontrolle fr Laptops
+Name[el]=  
+Name[eo]=Elektroobservilo por porteblaj komputiloj
+Name[es]=Control de energa del porttil
+Name[et]=Slearvuti voolutarve
+Name[eu]=Eramangarriaren Energia Kontrola
+Name[fi]=Kannettavan virranhallinta
+Name[fr]=Ordinateur portable
+Name[gl]=Control da Enerxa do Porttil
+Name[he]=   
+Name[hr]=Utede energije laptopa
+Name[hu]=A hordozhat gpek energiavezrlse
+Name[id]=Kontrol Power Laptop
+Name[is]=Aflstillingar fartlvu
+Name[it]=Controllo energia computer portatili
+Name[ja]=
+Name[ko]=  
+Name[lt]=Laptop elektros energijos kontrol
+Name[lv]=Laptopa Enerijas Kontrole
+Name[mk]=    
+Name[mt]=Kontroll tal-Konsum tal-Laptop
+Name[nb]=Strmkontroll for brbar
+Name[nl]=Energiebeheer voor laptops
+Name[nn]=Straumkontroll for brbare maskiner
+Name[oc]=Control d'alimentacion de portatil
+Name[pl]=Kontrola zasilania laptopw
+Name[pt]=Controlo de Alimentao
+Name[pt_BR]=Controle de energia
+Name[ro]=Control energie laptop
+Name[ru]=  
+Name[sk]=Notebook - Sprva napjania
+Name[sl]=Nadzor energije za prenosnike
+Name[sr]=Laptop kontrola enegije
+Name[sv]=Strmfrsrjning fr brbara datorer
+Name[ta]=   
+Name[th]=
+Name[tr]=Dizst G Denetimi
+Name[uk]=  
+Name[ven]=Tshilanguli tsha maanda tsha khomupwutha pfarwa
+Name[vi]=iu khin in cho my xch tay 
+Name[xh]=Ulawulo olunamandla lomphezulu obekwe komnye
+Name[xx]=xx
+Name[zh_CN]=
+Name[zh_TW]=
+Name[zu]=Uphathiso Lwamandla Ekhomputha elucezu
Index: ksim/library/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/ksim/library/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -b -u -r1.1.1.1 -r1.2
--- ksim/library/Makefile.am	10 Jul 2002 05:33:19 -0000	1.1.1.1
+++ ksim/library/Makefile.am	12 Jul 2002 23:23:29 -0000	1.2
@@ -4,9 +4,9 @@
                                         chart.cpp label.cpp \
                                         led.cpp progress.cpp \
                                         pluginglobal.cpp pluginloader.cpp \
-                                        pluginmodule.cpp
-
-libksimcore_la_LDFLAGS = $(all_libraries) -version-info 1:0
+                                        pluginmodule.cpp ../ksimconfig.cpp
+libksimcore_la_LIBADD = $(LIB_QT) $(LIB_KDECORE) $(LIB_KDEFX) $(LIB_KDEUI)
+libksimcore_la_LDFLAGS = $(all_libraries) -version-info 1:0 $(QT_LDFLAGS)
 
 libksimcore_la_HEADERS = common.h themeloader.h \
                                         chart.h led.h label.h \
Index: ksim/monitors/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/ksim/monitors/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -b -u -r1.1.1.1 -r1.2
--- ksim/monitors/Makefile.am	10 Jul 2002 05:33:19 -0000	1.1.1.1
+++ ksim/monitors/Makefile.am	12 Jul 2002 23:23:29 -0000	1.2
@@ -1 +1 @@
-SUBDIRS = filesystem net lm_sensors cpu disk
+SUBDIRS = filesystem net lm_sensors cpu
Index: ksim/monitors/cpu/ksimcpu.cpp
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/ksim/monitors/cpu/ksimcpu.cpp,v
retrieving revision 1.1.1.1
retrieving revision 1.3
diff -u -b -u -r1.1.1.1 -r1.3
--- ksim/monitors/cpu/ksimcpu.cpp	10 Jul 2002 05:33:19 -0000	1.1.1.1
+++ ksim/monitors/cpu/ksimcpu.cpp	1 Aug 2002 00:24:51 -0000	1.3
@@ -17,6 +17,9 @@
  *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
  */
 
+#include <sys/sysctl.h>
+#include <sys/dkstat.h>
+#include <rpcsvc/rstat.h>
 #include "ksimcpu.h"
 #include "ksimcpu.moc"
 
@@ -52,6 +55,22 @@
 #endif
 #endif
 
+#ifndef CP_USER
+#define CP_USER 0
+#endif
+
+#ifndef CP_NICE
+#define CP_NICE 1
+#endif
+
+#ifndef CP_SYS
+#define CP_SYS 2
+#endif
+
+#ifndef CP_IDLE
+#define CP_IDLE 4
+#endif
+
 #define CPU_NAME(cpu) "Cpu" + QString::number(cpu) + "_options"
 #define CPU_SPEED 1000
 
@@ -260,7 +279,7 @@
   }
 
   if (sysctl(oidCpuTime, oidCpuTimeLen,
-     cpuTime, &cpuTimeLen, 0, 0) < 0)
+     cpuTime, (long unsigned int)&cpuTimeLen, 0, 0) < 0)
     return;
 
   cpu.user = cpuTime[CP_USER];
Index: ksim/monitors/disk/ksimdisk.cpp
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/ksim/monitors/disk/ksimdisk.cpp,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -b -u -r1.1.1.2 -r1.3
--- ksim/monitors/disk/ksimdisk.cpp	14 Aug 2002 21:31:08 -0000	1.1.1.2
+++ ksim/monitors/disk/ksimdisk.cpp	14 Aug 2002 21:39:36 -0000	1.3
@@ -42,7 +42,6 @@
 
 #ifdef Q_OS_FREEBSD
 #include <sys/dkstat.h>
-#include <devstat.h>
 #include <stdlib.h>
 #endif
 
Index: ksim/monitors/net/Makefile.am
===================================================================
RCS file: /cvs/od/proj/KDE-Darwin/kdeutils/ksim/monitors/net/Makefile.am,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -b -u -r1.1.1.1 -r1.2
--- ksim/monitors/net/Makefile.am	10 Jul 2002 05:33:20 -0000	1.1.1.1
+++ ksim/monitors/net/Makefile.am	12 Jul 2002 23:23:29 -0000	1.2
@@ -2,7 +2,7 @@
 ksim_net_la_SOURCES = ksimnet.cpp netdialog.cpp netconfig.cpp
 
 ksim_net_la_LDFLAGS = $(all_libraries) -module -avoid-version
-ksim_net_la_LIBADD = ../../library/libksimcore.la
+ksim_net_la_LIBADD = ../../library/libksimcore.la $(LIB_KIO)
 
 EXTRA_DIST = Net.desktop
 
