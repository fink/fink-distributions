Package: osxfuse
Version: 2.5.6
Revision: 1
BuildDepends: <<
  autoconf2.6 | autoconf, automake1.13, gettext-tools, libiconv-dev, libtool2
<<
Depends: pkgconfig

Source: https://github.com/osxfuse/kext/tarball/636f95e
Source-MD5: 31f323b41d67514fd9df08442055fe26
SourceRename: %n-636f95e.tar.gz
SourceDirectory: %n-kext-636f95e

Source2: https://github.com/osxfuse/fuse/tarball/daab972
Source2-MD5: a86af883e49b6b77977528650f931312
Source2Rename: osxfuse-fuse-daab972.tar.gz

PatchScript: <<
sed -i.bak -e 's,/Library/Filesystems/,%p/lib/,' common/fuse_param.h
sed -i.bak -e 's,/usr/local,%p,' ../osxfuse-fuse-daab972/darwin_configure.sh
<<
CompileScript: <<
#!/bin/sh -ev

xcodebuild MACOSX_DEPLOYMENT_TARGET=10.7 SDKROOT=macosx10.7

cd ../osxfuse-fuse-daab972
COMPILER=com.apple.compilers.llvmgcc42 OSXFUSE_SRCROOT=%b DARWIN=1 ./darwin_configure.sh

#autoreconf -f -i -Wall,no-obsolete
#./configure CFLAGS='-arch x86_64 -mmacosx-version-min=10.7 -I%p/include -L%p/lib' LDFLAGS='-arch x86_64' --disable-dependency-tracking --prefix=%p
make
<<
InstallScript: <<
#!/bin/sh -ev

mkdir -p %i/lib
cp -R build/Release/osxfusefs.fs %i/lib/
mkdir %i/lib/osxfusefs.fs/Support
cd build/Release
cp -R osxfusefs.kext load_osxfusefs mount_osxfusefs %i/lib/osxfusefs.fs/Support/

cd ../../../osxfuse-fuse-daab972
make install DESTDIR=%d
ln -s libosxfuse_i64.dylib %i/lib/libosxfuse.dylib
<<
DocFiles: <<
../osxfuse-fuse-daab972/AUTHORS
../osxfuse-fuse-daab972/COPYING
../osxfuse-fuse-daab972/COPYING.LIB
../osxfuse-fuse-daab972/FAQ
../osxfuse-fuse-daab972/NEWS
../osxfuse-fuse-daab972/README
../osxfuse-fuse-daab972/README.NFS
../osxfuse-fuse-daab972/README.OSXFUSE
../osxfuse-fuse-daab972/doc/how-fuse-works
<<

PreRmScript: /sbin/kextunload -q -b com.github.osxfuse.filesystems.osxfusefs || true
PostInstScript: <<
chown -R root:wheel %p/lib/osxfusefs.fs/Support/osxfusefs.kext
# Non-root users can't load extensions outside of /System/Library/Extensions
chmod u+s %p/lib/osxfusefs.fs/Support/load_osxfusefs
<<

SplitOff: <<
  Package: osxfuse-shlibs
  Depends: osxfuse (= %v-%r)
  DocFiles: <<
  <<
  Files: <<
    lib/libosxfuse_i32.2.dylib
    lib/libosxfuse_i64.2.dylib
  <<
  Shlibs: <<
    %p/lib/libosxfuse_i32.2.dylib 10.0.0 osxfuse-shlibs (>= 2.5.6-1)
    %p/lib/libosxfuse_i64.2.dylib 10.0.0 osxfuse-shlibs (>= 2.5.6-1)
  <<
  Description: osxfuse shared libraries
  DescDetail: <<
    These are the shared libraries required by OSXFUSE applications.
  <<
<<

SplitOff2: <<
  Package: osxfuse-dev
  Depends: osxfuse-shlibs (= %v-%r)
  BuildDependsOnly: true
  Files: <<
    include
    lib/libosxfuse_i32.dylib lib/libosxfuse_i32.la
    lib/libosxfuse_i64.dylib lib/libosxfuse_i64.la
    lib/libosxfuse.dylib
    lib/pkgconfig
  <<
  Description: OSXFUSE (development resources)
  DescDetail: <<
    These are the header and library files required for building OSXFUSE filesystems.
  <<
<<


Description: File System in User Space (osxfuse)
DescDetail: <<
FUSE for OS X allows you to extend OS X's native file handling
capabilities via third-party file systems. OSXFUSE is a successor to
MacFUSE, which has been used as a software building block by dozens of
products, but is no longer being maintained.

These are the fuse header and library files required for building FUSE
filesystems.
<<
License: BSD
Homepage: http://osxfuse.github.io/
Maintainer: Brendan Cully <brendan@finkproject.org>
