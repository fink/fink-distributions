diff -ruN zsh-5.0.4/.cvsignore zsh-5.0.2/.cvsignore
--- zsh-5.0.4/.cvsignore	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/.cvsignore	2004-02-26 07:09:07.000000000 -0800
@@ -13,4 +13,3 @@
 stamp-h.in
 autom4te.cache
 *.swp
-.git
diff -ruN zsh-5.0.4/.editorconfig zsh-5.0.2/.editorconfig
--- zsh-5.0.4/.editorconfig	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/.editorconfig	2012-09-30 09:17:11.000000000 -0700
@@ -1,6 +1,4 @@
-# Top-most editorconfig file
-
-root = true
+root = true  # Top-most editorconfig file
 
 [*]
 end_of_line = lf
diff -ruN zsh-5.0.4/.gitignore zsh-5.0.2/.gitignore
--- zsh-5.0.4/.gitignore	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/.gitignore	2009-04-18 04:56:15.000000000 -0700
@@ -27,17 +27,6 @@
 
 Config/defs.mk
 
-CVS
-.#*
-
-Doc/help
-Doc/help.txt
-Doc/help/[_a-zA-Z0-9]*
-
-Doc/intro.a4.pdf
-Doc/intro.a4.ps
-Doc/intro.us.pdf
-Doc/intro.us.ps
 Doc/version.yo
 Doc/zsh*.1
 Doc/zsh.texi
diff -ruN zsh-5.0.4/ChangeLog zsh-5.0.2/ChangeLog
--- zsh-5.0.4/ChangeLog	2013-12-20 10:27:43.000000000 -0800
+++ zsh-5.0.2/ChangeLog	2012-12-21 11:35:07.000000000 -0800
@@ -1,1315 +1,3 @@
-2013-12-20  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: Config/version.mk, Etc/FAQ.yo, README: release 5.0.4.
-
-2013-12-18  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 32157: Doc/Zsh/params.yo, Src/Zle/zle_refresh.c, Src/init.c,
-	Src/params.c: make ZLE_RPROMPT_INDENT a special variable tied to
-	an internal C global, to avoid having the shell variable value
-	fetched on every keystroke and to make it available when testing
-	how to reposition the cursor after the right-prompt is output.
-	Fixes erasure in completion listing when ZLE_RPROMPT_INDENT=0.
-
-	* 32150: Completion/compaudit: Reference loop variable rather
-	than absolute path in executable ownership test
-
-2013-12-17  Phil Pennock  <pdpennock@users.sourceforge.net>
-
-	* 32143: INSTALL: Fix --enable-custom-patchlevel name in INSTALL
-
-2013-12-16  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* Jun Takimoto: 32137: Test/comptest: set pseudo-terminal speed to
-	prevent padding characters which confuse output parsing.
-
-2013-12-16  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 32136: Src/pattern.c, Src/zsh.h, Test/D02glob.ztst:
-	fix problem with +*, @*, !* when kshglob is set introduced
-	by pattern disable feature.
-
-	* unposted: NEWS: add ZLE_PROMPT_INDENT.
-
-	* Patrick Oscity + pws: 32114: Doc/Zsh/params.yo,
-	Src/Zle/zle_refresh.c, Src/Zle/zle_tricky.c: ZLE_RPROMPT_INDENT
-	allows you to make the right prompt flush if your terminal
-	supports it.
-
-2013-12-16  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* Jun Takimoto + Bart: 32131: Src/Modules/zpty.c: avoid infinite
-	loop reading pseudo-terminal on platforms that do not buffer pty
-	contents after child process exits
-
-2013-12-15  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* users/18219: Completion/Zsh/Type/_command_names: compadd -Q for
-	builtins, aliases, and reserved words to preserve special chars
-
-2013-12-14  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: increment version to 5.0.3-dev-0 to avoid confusion
-	with released 5.0.3.
-
-	* unposted: version 5.0.3, finally.
-
-2013-12-13  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* Martin Vaeth: 32105: Util/helpfiles: support all combinations of
-	man or nroff with colcrt or col.
-
-	* Aaron Peschel: 32103: Completion/Unix/Type/_hosts: parse
-	host:port format in ssh known_hosts files.
-
-2013-12-10  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 32099: Src/init.c: fix pointer declaration to avoid compile
-	time error when arithmetic on void * is not allowed.
-
-2013-12-09  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* users/18210: Doc/Zsh/builtins.yo: document print -D better.
-
-	* 32093: INSTALL: describe the dependency issues fixed
-	by the doc bundle.
-
-2013-12-09  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Jun T.: 32056: Completion/Unix/Command/_iconv: Handle
-	different versions of iconv.
-
-2013-12-06  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Daniel Shahaf: 32091: Src/exec.c, Test/E01options.ztst:
-	WARN_CREATE_GLOBAL false positive for assignment before
-	commands.
-
-2013-12-05  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Daniel Shahaf: 32089:
-	Functions/VCS_Info/Backends/VCS_INFO_detect_svn: tweak for
-	detecting Subversion repository.
-
-2013-12-02  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 32080 (plus unposted second instance of same):
-	Test/A05execution.ztst: suppress any error output from
-	nonessential "setopt MONITOR"
-
-2013-12-01  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: Config/version.mk: 5.0.2-test-3.
-
-2013-11-30  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* Hong Xu: 32069: Completion/Unix/Command/_git: completion for
-	"git submodule update --remote"
-
-2013-11-29  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 32066 (via 31985 Clemens Hammacher and 32064 Hong Xu):
-	Functions/VCS_Info/Backends/VCS_INFO_get_data_git,
-	Functions/VCS_Info/VCS_INFO_reposub: fix %r and %S in vcs_info
-	formats when a repository subdirectory is accessed via a symlink.
-
-2013-11-27  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 32061: Src/utils.c: Fix "use of uninitialized memory" in metafy
-
-2013-11-27  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* unposted, see 32054 and thread:
-	Completion/Unix/Command/_cdrdao, Completion/Unix/Command/_git,
-	Completion/Unix/Command/_growisofs, Etc/ChangeLog-3.0,
-	Etc/ChangeLog-3.1, LICENCE, Src/Modules/clone.c,
-	Src/Modules/example.c, Src/module.c: Rationalise character
-	encodings: shell functions are strictly ASCII for maximum
-	portability; other files needed for building and documentation
-	are ASCII or UTF-8; test files may use ISO-8859-X (we don't
-	require the Euro symbol) where needed to get single character
-	input with the top bit set.
-
-2013-11-25  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* unposted, see 32050, 32051: remove non-ASCII characters in
-	installed functions as this causes sed on MacOS problems.
-
-2013-11-25  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: Completion/Unix/Command/.distfiles,
-	Config/version.mk: update for 5.0.2-test-2.
-
-2013-11-25  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 32045 (as corrected by Martin Vaeth 32047): Config/defs.mk.in,
-	Doc/Makefile.in, configure.ac: use dependencies to determine
-	whether to rebuild helpfiles.
-
-2013-11-23  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 32031 plus missed _run_help: Completion/Zsh/Command/_run-help,
-	Config/defs.mk.in, Config/installfns.sh, Doc/Makefile.in,
-	Functions/Misc/run-help, Makefile.in: turn @runhelpdir@ in
-	installed functions into the actual installation path.
-
-2013-11-20  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 32030: revert 31995 as it caused (N) to fail on an empty
-	failed glob.  Add test for this case.
-
-2013-11-19  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 32023: Src/utils.c: better interrupt handling at RM_STAR_WAIT
-
-2013-11-18  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* unposted but see 32012: Doc/help/.cvsignore,
-	Doc/help/.distfiles: were created in the wrong place, so move.
-
-2013-11-18  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* Martin Vaeth: 32008: Completion/Zsh/Command/.distfiles
-	Completion/Zsh/Command/_run-help Doc/Makefile.in: follow-up to
-	31988 - complete "." and ":" for run-help, distribute _run-help,
-	clean up better during make
-
-	* Han Pingtian: 31995: Src/glob.c: glob	qualifiers cannot
-	follow an empty pattern, so a leading paren means grouping
-
-2013-11-17  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 32001: Src/subst.c: fix crash on empty arrays with array
-	intersection and disjunction.
-
-2013-11-15  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* Martin Vaeth: 31988: Doc/Makefile.in, Util/helpfiles: remove
-	LC_CTYPE heuristics, assure clean environment, force LANG=C
-
-2013-11-14  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Jun T.: 31984: Completion/Unix/Command/_df: new completion.
-
-	* 31983: Src/zsh.mdd: suppress warning from cmp that doesn't
-	indicate a problem when generating patchlevel header.
-
-	* 31982: Src/math.c, Test/C01arith.ztst: detection of floating
-	point constants had run rampant in users/17445.  Fix the original
-	problem another way.
-
-2013-11-13  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31977: Src/module.c: no error if autoloading a feature that
-	is already loaded in a consistent fashion.
-
-	* Jun T.: 31971: locale fix for helpfiles.
-
-	* Martin Vaeth: 31959: .gitignore, Doc/help/.cvsignore,
-	Doc/help/.distfiles: missed files.
-
-2013-11-12  Bart Schaefer  <schaefer@zsh.org>
-
-	* 31966: Util/helpfiles: skip introductory paragraphs processing
-	"man zshbuiltins" by assuming that all real command names start
-	with a lower case letter.  Check "ztcp" file as a guess that all
-	builtins were processed.
-
-2013-11-12  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Martin Vaeth: 31959: .gitignore,
-	Completion/Zsh/Command/_run-help, Doc/.cvsignore,
-	Doc/.distfiles, Doc/Makefile.in, Makefile.in,
-	StartupFiles/zshrc, Util/helpfiles, configure.ac: make help
-	files during installation.
-
-	* 31961: Src/Zle/zle.h, Src/Zle/zle_main.c,
-	Src/Zle/zle_thingy.c: rationalise fd watch to use structures.
-
-2013-11-08  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* unposted: fix ChangeLog to say 5.0.3 instead of 4.0.3.
-
-	* unposted: NEWS: refer to zle -Fw.
-
-	* 31940: Doc/Zsh/contrib.yo, Functions/Misc/zcalc: add -e option
-	to zcalc to use input from arguments to command.
-
-2013-11-07  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31937: Doc/Zsh/zle.yo, Src/Zle/zle_main.c,
-	Src/Zle/zle_thingy.c, Src/Zle/zle_utils.c, Src/math.c,
-	Test/C01arith.ztst: zle -Fw uses widget semantics for
-	file descriptor handler.
-
-2013-11-06  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: Completion/Debian/Command/.distfiles,
-	Completion/Unix/Type/.distfiles, Config/version.mk, Etc/FAQ.yo,
-	README, Src/pattern.c, Src/signals.c, Test/.distfiles: updates
-	for 5.0.2-test-1 in preparation for 5.0.3.  Updated files
-	in .distfiles and add mod_export declarations.
-
-2013-11-03  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Stefan Neudorf: 31936: Doc/Zsh/builtins.yo,
-	Src/Builtins/rlimits.awk, Src/Builtins/rlimits.c: rationalise
-	thread limits
-
-	* Stefan Neudorf: 31935: Doc/Zsh/builtins.yo,
-	Src/Builtins/rlimits.awk, Src/Builtins/rlimits.c: further
-	limit updates for 31930, 39134.
-
-2013-10-31  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Stefan Neudorf: 31930 / 31934: Doc/Zsh/builtins.yo,
-	Src/Builtins/rlimits.awk, Src/Builtins/rlimits.c, configure.ac,
-	Src/Builtins/rlimits.c:  New BSD limits; avoid clash with
-	ulimit -k.
-
-2013-10-29  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31929: Src/jobs.c: fix DPUTS3() test condition from 31906.
-
-2013-10-28  Bart Schaefer  <schaefer@zsh.org>
-
-	* unposted: NEWS: mention HISTORY_IGNORE
-
-2013-10-28  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31922: Src/Zle/zle_utils.c (zlecharasstring): missing
-	flip of bit five when Meta marker inserted.
-
-2013-10-27  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31912: Src/exec.c: in closemn(), distinguish closing for >&-
-	from closing for a real redirect.  Fixes knock-on multios bug
-	introduced by workers/20666 way back in 2005.
-
-	* unposted (cf. users/18063): Functions/Zle/keeper: clean up
-	some syntax nits, add working link to old Unix Review article
-
-	* 31919: Src/exec.c, Src/init.c: fix deadlock when a shell builtin
-	with a multio redirection is used on the left side of a pipeline,
-	by making sure stdin/out/err file descriptors are closed for the
-	multio copy process, which means not re-using those descriptors
-	after they are closed and marked FDT_UNUSED in fdtable[].  For
-	completeness, initialize their fdtable[] state to FDT_EXTERNAL.
-
-2013-10-27  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Jun T: 31909: Completion/Unix/Command/_cat: new completion.
-
-2013-10-26  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31906: Src/jobs.c, Test/A05execution.ztst: printjob() should not
-	reference oldjobtab for job numbers unless it is being called from
-	bin_fg().  Add a DPUTS check in case this goes horribly wrong.
-	printjob() also must not attempt to update pipestats when called
-	from bin_fg().  Finally, acquire_pgrp() cannot acquire the tty
-	group leader if the shell is not interactive, so avoid looping
-	infinitely in the attempt.  Update the $pipestatus stress test so
-	that it also exercises the oldjobtab repair.
-
-2013-10-26  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Jun T: 31902: rationalise gamma function in mathfunc for
-	consistency with various libraries and user expectations.
-
-2013-10-25  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31890 (with Mikael's fixes in 31891): NEWS: add descriptions
-	of new features since 5.0.2.
-
-2013-10-24  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31889: Test/D02glob.ztst: tests for disable -p.
-
-	* 31877: Src/pattern.c: fix behaviour of disable -p for
-	entities with parentheses.
-
-2013-10-24  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31885: Src/jobs.c: fix PIPEFAIL behavior when the last command
-	in a pipeline is executed within the current shell; add comments
-
-2013-10-24  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31888: Test/A05execution.ztst: add test of pipestatus
-	that was reliably failing before 31879.
-
-	* 31882: Src/Zle/compcore.c: better insulation of
-	completion widget excecution against job environment.
-
-	* 31884: Test/A05execution.ztst: eliminate variable output
-	from test due to vagaries of uniq implementation.
-
-2013-10-23  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31879: Src/jobs.c: improve $pipestatus behavior when the last
-	command in the pipeline is executed within the current shell
-
-	* unposted (cf. Frank Terbeck: 30047): Test/A05redirect.ztst:
-	stress test for $pipestatus handling
-
-2013-10-23  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31873: Doc/Zsh/builtins.yo: Document conventions for use of
-	command options with builtin commands.
-
-2013-10-21  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31869: Src/input.c: reduce WINCH-twaddling in shingetline()
-
-2013-10-21  √òystein Walle  <oystwa@gmail.com>
-
-	* 31861: Completion/Unix/Command/_git: _git: Add git-clean
-	-i/--interactive support
-
-	* 31863: Completion/Unix/Command/_git: _git: Add new arguments
-	introduced in Git v1.8.4
-
-	* 31862: Completion/Unix/Command/_git: _git: Add status.short and
-	status.branch
-
-	* 31866: Completion/Unix/Command/_git: _git: Reword --heads to
-	match new meaning
-
-	* 31864: Completion/Unix/Command/_git: _git: Add two sub-comamnds
-	introduced in v1.8.4
-
-	* 31865: Completion/Unix/Command/_git: _git: Make --batch(-check)
-	accept an argument
-
-2013-10-21  m0viefreak  <m0viefreak.cm@googlemail.com>
-
-	* 31856: Completion/Unix/Command/_git: _git: fix a few
-	"undocumented" options
-
-	* 31855: Completion/Unix/Command/_git: _git: revert: add
-	'-e,--edit'
-
-2013-10-21  √òystein Walle  <oystwa@gmail.com>
-
-	* 31858: Completion/Unix/Command/_git: _git: fix wrong default
-	value
-
-2013-10-21  m0viefreak  <m0viefreak.cm@googlemail.com>
-
-	* 31857: Completion/Unix/Command/_git: _git: Remove unsupported -q
-	option from diff options
-
-2013-10-21  √òystein Walle  <oystwa@gmail.com>
-
-	* 31853: Completion/Unix/Command/_git: _git: Add missing column.*
-	config variables
-
-	* 31854: Completion/Unix/Command/_git: _git: Make git-show accept
-	diff arguments
-
-	* 31859: Completion/Unix/Command/_git: _git: re-order the last two
-	git-blame arguments
-
-2013-10-19  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31851: Src/exec.c: execstring() should display string to
-	be executed with VERBOSE option.
-
-2013-10-19  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31849: Doc/Zsh/params.yo: note effect of KSH_ZERO_SUBSCRIPT
-	on the arrays of positional parameters e.g. ${argv[0]} vs. $0
-
-2013-10-18  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31846: Src/exec.c: fix NOEXEC option in execsimple().
-
-2013-10-18  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31840: Completion/Unix/Command/_make: "read" used wrong $IFS
-
-2013-10-17  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31836 (cf. 31823): Doc/Zsh/params.yo, Src/hist.c: add
-	HISTORY_IGNORE pattern to exclude matching lines in the
-	internal history from the HISTFILE at write time.
-
-	* 31832: Src/exec.c: make execrestore() more signal-safe.
-
-2013-10-17  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31830: Doc/Zsh/func.yo, README, Src/hist.c, Src/zsh.h:
-	If a zshaddhistory hook returns status 2, save the line on
-	the internal history but don't write it out.
-
-2013-10-16  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Users/18033: Doc/Zsh/builtins.yo, Doc/Zsh/jobs.yo,
-	Doc/Zsh/options.yo: try to document interaction between exit and
-	asynchronous jobs that don't look asynchronous.
-
-2013-10-16  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31827: Doc/Zsh/func.yo: options needed for example.  Only
-	works with INCAPPENDHISTORY or SHAREHISTORY.
-
-2013-10-15  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* unposted: Doc/Zsh/func.yo: trivial typo in zshaddhistory doc.
-
-2013-10-12  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31818: Completion/Unix/Command/_sh, Doc/Zsh/compsys.yo: to avoid
-	side effects, reposition the _arguments call in _sh for the zsh
-	special case.  Document the side effects so avoided, and clean up
-	the _arguments documentation a bit along the way.
-
-2013-10-11  Mikael Magnusson  <mikachu@gmail.com>
-
-	* 31805: Doc/Zsh/mod_parameter.yo, Src/Modules/parameter.c,
-	Src/Modules/parameter.mdd, Src/pattern.c, Test/V01zmodload.ztst:
-	Add $patchars and $dis_patchars to zsh/parameter module
-
-	* 31805: Completion/Zsh/Command/_disable,
-	Completion/Zsh/Command/_enable, Doc/Zsh/builtins.yo: Update
-	_enable and _disable for -p, fix related typo in docs
-
-	* 31806: Completion/Zsh/Command/_disable,
-	Completion/Zsh/Command/_enable, Workaround special characters
-	in alias and function names breaking _arguments syntax
-
-2013-10-11  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31815: Src/hist.c: more fallout from 31789: we need to save
-	using pushed history file before we pop.
-
-2013-10-10  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31810: Test/E02xtrace.ztst: tests for simple cases of XTRACE
-	output for conditions.
-
-	* 31809: Src/exec.c: make whitespace clear in trace output for
-	patterns.
-
-2013-10-08  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Eric Cook: 31801: Completion/Linux/Command/_btrfs: some
-	additional variables need to be local.
-
-2013-10-08  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31797: Src/hist.c: partly fix long-standing history expansion
-	bug in which in some circumstances a default history expansion
-	would occur even when there is neither an event nor a word
-	designator, which is contradictory to the documentation.
-	There are still some cases in which expansion is attempted
-	when it should not be, but in most of those cases the expansion
-	simply fails.
-
-2013-10-07  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31794: Src/hist.c: further refinement that SHAREHISTORY should
-	work as it always did because it's careful about file locking.
-
-	* 31793: Src/hist.c (hbegin): Modify 31789 so that the save
-	history here only happens for interactive editing.
-
-2013-10-06  Wayne Davison  <wayned@users.sourceforge.net>
-
-	* users/18024: Completion/Unix/Command/_rsync: add new options for
-	rsync 3.1.0.
-
-2013-10-06  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* users/18023: Doc/Zsh/options.yo, Src/jobs.c, Src/options.c,
-	Src/zsh.h, Test/E01options.ztst: add PIPEFAIL option and test.
-
-2013-10-05  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Hang Pingtian: 31789: Src/hist.c: add history for
-	INCAPPENDHISTORY later so history time works.
-
-2013-10-03  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31784: Src/Zle/computil.c: when deciding whether there is enough
-	horizontal space to show completion descriptions for each match in
-	a listing, treat the separator as part of the description rather
-	than as part of the match, and account for lines that have already
-	wrapped due to very long matches.
-
-	* 31781: Src/Zle/computil.c: "compdescribe -i" must clear the
-	completion list column padding width along with the rest of the
-	description state.  Cf. 31782.
-
-2013-09-26  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31772: Src/params.c: queue_signals() to prevent re-entry into
-	endparamscope().
-
-	* 31770: Src/hist.c: memmove() instead of memcpy() for overlapping
-	regions.
-
-2013-09-25  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31765: Src/Zle/zle_main.c: on entry to editor, if starting in
-	vi insert mode mark this as the start of an insertion (duh).
-
-2013-09-23  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31764 (with correction of sense of a test): Src/glob.c,
-	Src/pattern.c: use of array before initialisation wreaked havoc
-	in detecting glob qualifiers.
-
-2013-09-22  m0viefreak  <m0viefreak.cm@googlemail.com>
-
-	* 31754: Completion/Unix/Command/_git: _git: git rm: make git rm
-	--cached work as intended
-
-2013-09-22  √òystein Walle  <oystwa@gmail.com>
-
-	* 31752: Completion/Unix/Command/_git: _git: change completion
-	text for consistency
-
-2013-09-22  m0viefreak  <m0viefreak.cm@googlemail.com>
-
-	* 31753: Completion/Unix/Command/_git: _git: correct some
-	"undocumented" options
-
-2013-09-22  √òystein Walle  <oystwa@gmail.com>
-
-	* 31749: Completion/Unix/Command/_git: _git: fix some typos in
-	description texts
-
-	* 31751: Completion/Unix/Command/_git: _git: remove TODOs of
-	actually documented options
-
-2013-09-22  m0viefreak  <m0viefreak.cm@googlemail.com>
-
-	* 31746: Completion/Unix/Command/_git: _git: reword _git-config
-	TODO
-
-	* 31748: Completion/Unix/Command/_git: _git: support completing
-	remote branches without <remote>/ prefix
-
-2013-09-22  √òystein Walle  <oystwa@gmail.com>
-
-	* 31747: Completion/Unix/Command/_git: _git: completion updates to
-	match latest git v1.8.3 part 2
-
-	* 31750: Completion/Unix/Command/_git: _git: add new configuration
-	options to match latest git v1.8.3
-
-2013-09-22  m0viefreak  <m0viefreak.cm@googlemail.com>
-
-	* 31741: Completion/Unix/Command/_git: _git: fix a wrong variable
-	in __git_config_values
-
-	* 31743: Completion/Unix/Command/_git: _git: fix usage of ->int:
-	for some entries in _git-config
-
-	* 31744: Completion/Unix/Command/_git: _git: make git submodule
-	<cmd> completion work
-
-	* 31745: Completion/Unix/Command/_git: _git: correctly use
-	__git_guard_number in some cases
-
-	* 31755: Completion/Unix/Command/_git: _git: completion updates to
-	match latest git v1.8.3
-
-2013-09-21  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* unposted: Src/glob.c: improve an error message.
-
-2013-09-19  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31737: Src/Zle/computil.c (get_cadef): same fix as get_cvdef.
-
-2013-09-19  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Axel Beckert: 31735: Src/Zle/computil.c (get_cvdef):
-	off-by-one in obscure loop handling could cause crash in complex
-	completion.
-
-2013-09-14  Luka Perkov  <luka@openwrt.org>
-
-	* 31723: Completion/Unix/Command/_systemd: _systemd: add more
-	system commands
-
-	* 31726: Completion/Unix/Command/_git: _git: add few more
-	arguments for cherry-pick and revert
-
-2013-09-10  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31714: Completion/Zsh/Command/_cd: handle ".." properly when
-	$PWD or the path prefix traverses a symbolic link.
-
-2013-09-08  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31711: Doc/Zsh/contrib.yo, Functions/MIME/zsh-mime-handler:
-	add execute-never style for MIME handler for files on alien file
-	systems.
-
-2013-09-07  Luka Perkov  <luka@openwrt.org>
-
-	* 31708: Completion/Unix/Command/_git: _git: add --fixup and
-	--squash options to commit
-
-2013-09-06  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Luka Perkov: 31702: Completion/Unix/Command/_git:
-	check for presence of "-i" when checking for "--interactive".
-
-	* 31706: Src/builtin.c, Test/C02cond.ztst: standardise
-	handling of "test ! <x> <y> <z>".
-
-2013-09-04  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31696: Src/parse.c, Test/C02cond.ztst: in "test", no one
-	can hear if you shriek.  Treat exclamation marks as strings in
-	"! -a ..." and "! -o ...".
-
-2013-09-02  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31685: Doc/Zsh/mod_mapfile.yo: documentation of how to get
-	lines from a file is not correct.
-
-2013-08-29  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* users/17955: Doc/Zsh/contrib.yo,
-	Functions/MIME/zsh-mime-handler: "disown" style makes MIME
-	handlers put into background run without job control.
-
-	* based on 31641, 31642: Completion/Unix/Command/_make: support
-	a couple of different variants of make.
-
-2013-08-26  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31672: Src/Modules/zpty.c, Test/V08zpty.ztst: add test that
-	was failing and fix race when setting up pty.
-
-2013-08-25  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31665: Src/Modules/zpty.c, Test/V08zpty.ztst, Test/.distfiles:
-	zpty should attach terminal on slave.
-
-2013-08-17  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31637: Src/builtin.c: change of directory should not be retried
-	relative to the current directory when it has already failed along
-	some path that does not refer to the current directory.
-
-2013-08-11  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31650: Src/utils.c: use zlong for mailcheck parameters to
-	ensure sufficient range.
-
-2013-08-10  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31648: joe M: Src/utils.c: fix timing errors in mailcheck.
-
-2013-08-08  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Src/Zle/zle_tricky.c (inststrlen): 31644: the wrong length was
-	used when inserting multibyte characters from a string from
-	outside ZLE into the editing buffer.
-
-	* users/17908: Src/hist.c Src/Zle/zle_main.c Src/zsh.h: if
-	modifying history with ZLE active, keep the history line
-	recorded in ZLE in sync.
-
-2013-08-07  Phil Pennock  <pdpennock@users.sourceforge.net>
-
-	* 31634: Functions/Misc/run-help: run-help compat with alias to
-	noglob/nocorrect
-
-2013-08-05  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31631: configure.ac, Src/builtin.c: use cygwin_conv_path in
-	preference to cygwin_conv_to_posix_path if available.
-
-2013-08-04  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Yuusuke Yoshimoto: 31632: Completion/Unix/Type/_java_class:
-	suppress stderr from jar when completing classes.
-
-2013-08-02  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31611: Src/Zle/zle_tricky.c: attempt to fix crash in
-	"for in 1; do <[TAB] x".
-
-2013-08-01  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Thomas Klausner: 31625: Completion/X/Command/_mplayer: mplayer
-	supports .ts (transport stream) files.
-
-2013-07-29  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 17891: Src/builtin.c: fix error message for invalid file
-	descriptor in "print -u".
-
-2013-07-28  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Manuel Presnitz: 31592 (with minor changes of phrasing):
-	Doc/Zsh/builtins.yo, Doc/Zsh/expn.yo, Doc/Zsh/prompt.yo: improve
-	documentation for named directory handling.
-
-2013-07-25  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Jun T.: 31756: Completion/Unix/Command/_make: further make
-	completion improvements: tke care of mutually exclusive options;
-	add _description using $state_descr; add completions for
-	--debug=flag; fix typo (pointed out by Daniel Shahaf).
-
-	* 31574: Src/parse.c: alternative fix to 31545 if FD_CLOEXEC is
-	not available, removing dump records more consistently.
-
-2013-07-24  Richard Hartmann  <richih.mailinglist@gmail.com>
-
-	* 31571: Completion/Unix/Command/_vcsh: Update
-
-	* 31572: Completion/Debian/Command/_linda,
-	Completion/Debian/Command/.distfiles: Remove _linda
-
-2013-07-24  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Src/hist.c: 31570: with HIST_REDUCE_BLANKS don't truncate
-	the line after the last word if there's more non-white-space
-	text (probably a comment but we don't assume that).
-
-2013-07-22  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: Src/lex.c: correct previous commit: should call
-	hwend(), not ihwend().
-
-	* 31559: Src/lex.c: Fix problem with history lines for comments
-	that occur in the middle of an alias.
-
-	* Eric Cook: 31558: Completion/Command/Unix/_qemu: name of
-	binary has changed.
-
-2013-07-21  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31549: Src/exec,c, Src/zsh.h: replace ad-hoc subsh_close file
-	descriptor for pipes with new addfilelist() job-based mechanism.
-
-2013-07-20  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31545: Src/exec.c, Src/parse.c: if FD_CLOEXEC is available,
-	so mark dump file file descriptors, avoiding possible
-	multiple use of file descriptors.
-
-2013-07-19  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* c.f. 31531: Completion/Unix/Command/_imagemagick,
-	Completion/Unix/Command/_graphicsmagick: complete .xcf files.
-
-2013-07-19  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31536 (plus memory leak fixed, plus test code):
-	Src/jobs.c, Test/D03procsubst.ztst: fix hang in 31528 by
-	closing process substitution file descriptors when waiting
-	for job to finish.
-
-2013-07-17  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31528: Src/exec.c, Src/jobs.c, Src/zsh.h: use job table
-	to record file descriptors associated with process
-	substitution.
-
-	* Jun T: 31525: Completion/Unix/Command/_make: fix some option
-	handling.
-
-2013-07-12  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Nick Cross: 31512: Completion/Unix/Command/_make:
-	extra GNU options plus fix to makefile completion.
-
-2013-07-11  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* users/17856: Completion/Command/Unix/_make: rewrite to use
-	_arguments so as to make adding option handling easier.
-
-2013-07-03  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31503: Doc/Zsh/contrib.yo, Functions/Misc/zmv: split words
-	in program passed to zmv with -p and add -P for programs
-	that don't understand the "--" convention.
-
-2013-06-28  Clint Adams  <clint@zsh.org>
-
-	* 31500: Completion/Debian/Command/_dput: dput-ng completion
-	support from Sebastian Ramacher.
-
-	* 31499: Completion/Debian/Command/_dcut: dcut completion
-	from Sebastian Ramacher.
-
-	* 31498: Completion/Debian/Command/_dak: complete files for
-	subcommands that are not explicitly specified.
-
-2013-06-27  Mikael Magnusson  <mikachu@gmail.com>
-
-	* 31483: Call zrefresh() before unqueue()ing signals, was
-	moved in 31174.
-
-2013-06-18  Frank Terbeck  <ft@bewatermyfriend.org>
-
-	* 31485: Functions/VCS_Info/Backends/VCS_INFO_get_data_git:
-	vcs_info, git: Avoid error messages for `guilt' users
-
-2013-06-13  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31465: Completion/compinit, Src/glob.c, Src/pattern.c: fix
-	basic completion and globbing use of pattern disables.
-
-	* 31444: Doc/Zsh/builtins.yo, Doc/Zsh/options.yo,
-	Doc/zmacros.yo, Src/builtin.c, Src/exec.c, Src/options.c,
-	Src/pattern.c, Src/zsh.h: Basic (not fully functional) code for
-	enable/disable -p.
-
-2013-06-13  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31474: Makefile.in, Src/zsh.mdd: create patchlevel.h correctly
-	when running make in a separate build tree
-
-2013-06-10  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Hong Xu: 31462: .editorconfig: move comment to individual
-	line.
-
-	* Bruce Stephens (via Axel Beckert of Debian): 31459:
-	Doc/ztexi.yo: alignment of zsh info menu entry is wrong.
-
-2013-06-09  Barton E. Schaefer  <schaefer@zsh.org>
-
-	* 31466: .cvsignore, .gitignore: Cause git and cvs to ignore
-	one another.
-
-	* 31205: Completion/Base/Widget/_complete_help:  Do not display
-	"(eval)" as a tag context.
-
-2013-06-01  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31441: Src/glob.c, Src/pattern.c, Src/zsh.h: use an array
-	based on ZPC_* enum to decide which forms of pattern are enabled.
-
-2013-05-30  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31436: Doc/Zsh/expn.yo: KSH_GLOB syntax does not
-	support recursive directories.
-
-2013-05-29  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31433: Completion/Unix/Command/_gzip: zcat -f doesn't
-	need files with suffix .gz.
-
-	* 31422: Doc/Zsh/calsys.yo, Functions/Calendar/age: better
-	heuristic for timestamps in use of :file feature.
-
-2013-05-22  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31405: Doc/Zsh/options.yo: weasel words about
-	PRINT_EXIT_STATUS option.
-
-2013-05-21  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31419: Src/Modules/stat.c: Add time zone and year to
-	default time format with -s option to zstat.
-
-	* 31418: Doc/Zsh/calsys.yo, Functions/Calendar/age:
-	in "age" docs correct typo and note the feature that
-	you can supply a file as a timestamp on the command line.
-
-	* Stephane: 31417: Functions/Calendar/age: needs --
-	to protect againts files starting with -.
-
-2013-05-20  Barton Schaefer  <schaefer@zsh.org>
-
-	* 31416: Src/builtin.c: upon "read" of a short line, assign all
-	variables passed as arguments.
-
-2013-05-14  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* unposted: Completion/Unix/Command/_perforce: Improve
-	Perforce jobs completion to limit potentially huge output
-	using jobview by default; fix quoting of arguments passed on
-	to eval within _call_program.
-
-2013-05-10  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Richard Hartmann <richih.mailinglist@gmail.com>: 31389:
-	Completion/X/Command/_mplayer: add .ogv.
-
-	* Mihai Moldovan <ionic@ionic.de>: 31387: Src/zsh_system.h:
-	unused functions when compiling with clang.
-
-2013-05-05  Frank Terbeck  <ft@bewatermyfriend.org>
-
-	* unposted: Src/exec.c: Revert "31372: Do not block SIGWINCH for
-	child processes" as suggested by Bart.
-
-	* 31376: Src/exec.c: Make sure every execve() is prefixed by
-	winch_unblock()
-
-2013-05-05  Bart Schaefer  <schaefer@zsh.org>
-
-	* 31372: Src/exec.c: Do not block SIGWINCH for child processes
-
-2013-05-05  Kenyon Ralph  <kenyon@kenyonralph.com>
-
-	* 31371: Completion/Linux/Command/_brctl: _brctl: update brctl
-	subcommands
-
-2013-05-04  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31369: Completion/Base/Utility/_comp_locale: action if locale
-	command is not usable.
-
-2013-04-29  Bart Schaefer  <schaefer@zsh.org>
-
-	* 31361: Src/init.c: handle negative optno ("no" prefix used)
-	when storing options with parseopts_insert() for sticky contexts
-
-	* 31353: Src/math.c: fix handling of floating point in ternary
-
-	* 31350: Src/init.c, Src/input.c, Src/signals.h, Src/utils.c,
-	Src/Zle/zle_main.c: block SIGWINCH nearly all the time, except
-	when about to calculate prompts or do synchronous read, so
-	syscalls are not interrupted by window size changes.
-
-2013-04-29  Jun T  <takimoto-j@kba.biglobe.ne.jp>
-
-	* 31357: Completion/Unix/Command/_cp: add support for Mac OS X
-
-2013-04-29  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31356: Completion/Unix/Command/_subversion: typo noted by Bart.
-
-	* 31355: Completion/Base/Utility/.distfiles,
-	Completion/Base/Utility/_comp_locale,
-	Completion/Unix/Command/_subversion: _comp_locale tries to
-	sanitise locales but keep CTYPE; use this for subversion completion.
-
-2013-04-25  Ramkumar Ramachandra  <artagnon@gmail.com>
-
-	* 31288: Completion/Unix/Command/_git: _git: fix shortlog
-	completer
-
-2013-04-21  Ramkumar Ramachandra  <artagnon@gmail.com>
-
-	* 31286: Completion/Unix/Command/_git: _git: add a couple of
-	browsers
-
-	* 31289: Completion/Unix/Command/_git: _git: branch.*.pushremote,
-	remote.pushdefault
-
-2013-04-20  Torstein Hegge  <hegge@resisty.net>
-
-	* 31159: Completion/Unix/Command/_git: git: Pass prefix filter to
-	ls-files even if it matches no files
-
-2013-04-20  Jun T  <takimoto-j@kba.biglobe.ne.jp>
-
-	* 31281: Completion/Unix/Command/_du: _du: add support for Mac OS
-	X
-
-2013-04-20  Bart Schaefer  <schaefer@zsh.org>
-
-	* 31272: Src/Zle/compctl.c: avoid double free.
-
-2013-04-16  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* Daniel Friesel: 31265: Completion/Unix/Command/_devtodo:
-	improved option handling.
-
-2013-04-13  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: .gitignore: ignore PDF and PS versions of intro file.
-
-2013-04-12  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31263 (changed * to - for consistency with elsewhere):
-	Doc/Zsh/mod_curses.yo: suppress texinfo warning by adding item
-	arguments.
-
-	* 31261: Doc/Zsh/compsys.yo, Doc/ztexi.yo: updates needed
-	with latest texinfo.
-
-2013-04-10  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* users/17754: Src/builtin.c: failing to retie an array
-	and colon-separated scalar shouldn't be a fatal error.
-
-2013-04-09  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31246: Makefile.in, Src/zsh.mdd: make a separate patch level
-	header for releases.
-
-2013-04-08  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted: Completion/Unix/Command/.distfiles,
-	Completion/Unix/Command/.distfiles: remove mention of files no
-	longer there.
-
-2013-04-07  Bart Schaefer  <schaefer@zsh.org>
-
-	* 31234: Completion/Base/Widget/_complete_help: use an "always"
-	block instead of "trap" to clean up various function overrides
-
-2013-04-05  Frank Terbeck  <ft@bewatermyfriend.org>
-
-	* 31174: Src/Zle/zle_main.c: 31174: zle: Make sure state changes
-	are refreshed after init hook
-
-	* 31172: Src/Zle/zle_main.c: 31172: Let vared define custom init
-	and finish hooks
-
-	* 31175: Doc/Zsh/zle.yo: 31175: Add documentation for the new -i
-	and -f options of vared
-
-	* 31221: Completion/Unix/Command/_git: Handle zero defined aliases
-	better
-
-	* 31222: Functions/Zle/down-line-or-beginning-search,
-	Functions/Zle/up-line-or-beginning-search: Don't trigger
-	warn_create_global
-
-2013-04-04  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 31203: Completion/Unix/Command/.distfiles,
-	Completion/Unix/Command/_etags: new etags completion.
-
-2013-02-18  Aaron Schrab  <aaron@schrab.com>
-
-	* 07478c6b: Src/zsh.mdd: Generate patch level using `git describe`
-
-2013-04-02  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Jun T.: 31183: Src/Zle/zle_move.c: record old line rather than
-	history line in vi-goto-mark.
-
-2013-03-29  Mikael Magnusson  <mikachu@gmail.com>
-
-	* 31182: Completion/Unix/Command/_awk: Allow sticked arguments.
-
-2013-03-20  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Han Pingtian: 31167 (with tweak):
-	Completion/Unix/Command/_ssh: limit use of colons for detecting
-	a remote path.
-
-2013-03-19  Bart Schaefer  <schaefer@zsh.org>
-
-	* 31158: Src/pattern.c: following a wildcard with a repetition
-	produces a bad pattern error instead of an unbounded search
-
-2013-03-17  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31156: Completion/Zsh/Context/_math,
-	Completion/Zsh/Context/_zcalc_line, Completion/Zsh/Type/.distfile,
-	Completion/Zsh/Type/_math_params,
-	Completion/Zsh/Type/_module_math_func,
-	Completion/Zsh/Type/_user_math_func: improved math context
-	completion: functions.
-
-	* 31155: Doc/Zsh/contrib.yo, Functions/Misc/zcalc: minor
-        extra zcalc features and documentation.
-
-2013-03-15  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31154: Doc/Zsh/contrib.yo, Functions/Misc/zcalc: make zcalc
-	understand continuation lines using backslash.
-
-2013-03-14  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31151: Pavol Juhas: complete (C etc) tags better
-	when file system is not case sensitive.
-
-2013-03-13  Mikael Magnusson  <mikachu@gmail.com>
-
-	* unposted: Doc/Zsh/contrib.yo: Also adjust a mention of psvar
-	in the vcs info documentation.
-
-	* 31140: Src/math.c: when the math recursion limit is hit, make
-	sure to not leave *ep pointing nowhere, which caused a crash
-	sometimes. Also print the token that we refused to evaluate
-	because of the limit.
-
-2013-03-13  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* unposted, c.f. thread from 31144: Doc/Zsh/params.yo: all psvar
-	entries can be shown in prompts nowadays.
-
-2013-03-10  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31141: Src/exec.c, Test/A04redirect.ztst: NO_CLOBBER for {fd}
-	syntax should only apply if $fd is exactly an fd and nothing
-	else.
-
-2013-03-10  Mikael Magnusson  <mikachu@gmail.com>
-
-	* 30496: Src/prompt.c: Parse argument to %F and %K as prompt
-	sequences. This allows constructs like %F{%3v} to use $psvar[3]
-	for the color.
-
-	* 30490: Completion/Unix/Command/_java: Complete files for the
-	-keystore argument.
-
-	* 30639: Functions/VCS_Info/Backends/VCS_INFO_get_data_git:
-	Add support for showing the current action is cherry-pick (happens
-	when cherry-picking a range).
-
-	* 31136: Functions/VCS_Info/Backends/VCS_INFO_get_data_git:
-	just set parameters instead of passing over a pipe.
-
-2013-03-05  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* users/17666: Doc/Zsh/contrib.yo, Functions/Misc/zcalc: -f
-	option to zcalc sets FORCE_FLOAT.
-
-	* users/17665: Doc/Zsh/options.yo, Src/math.c, Src/options.c,
-	Src/zsh.h, Test/C01arith.ztst: add FORCE_FLOAT option.
-
-2013-02-27  Oliver Kiddle <opk@zsh.org>
-
-	* 31076: Completion/Linux/Command/_yast,
-	Completion/Unix/Type/_pids, Completion/Unix/Type/_pdf:
-	fix cases of more than one completion function for a command
-
-	* 31077: Completion/Unix/Command/_sort: update for new
-	options in GNU sort
-
-	* c.f. 31071: Completion/Unix/Type/_postscript,
-	Completion/Unix/Command/_psutils: remove duplicate _osc and
-	rename _ps to avoid name clash
-
-2013-02-22  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31061: Completion/Zsh/Command/_typeset: "functions" completion
-	takes account of options already on the command line.
-
-	* 31060: Src/builtin.c: "+" before a flag for "functions" or
-	"autoload" should suppress display of function body.
-
-2013-02-21  Oliver Kiddle <opk@zsh.org>
-
-	* 31058: Completion/Zsh/Command/_fc, Completion/Unix/Command/_cut,
-	Completion/Unix/Command/_sed, Completion/Unix/Command/_wget,
-	Completion/Unix/Command/_xmlsoft: add options from newer
-	versions of some commands to completion functions
-
-2013-02-19  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31055: Completion/compaudit: missing '$' in search of /proc
-	file system.
-
-2013-02-12  Oliver Kiddle <opk@zsh.org>
-
-	* 31041: Test/comptest, Test/X02zlevi.ztst: add support for
-	testing line editor widgets from the test suite
-
-	* unposted: Etc/zsh-development-guide: remove duplication in
-	git guidelines
-
-2013-02-09  Oliver Kiddle <opk@zsh.org>
-
-	* Morita Sho: 31038: Completion/Unix/Type/_terminals:
-	add location of terminfo entries on Debian
-
-	* 31037: Src/Zle/zle_move.c: return to previous position
-	with vi-goto-mark using `` or ''
-
-2013-02-07  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	*  Wieland Hoffmann: 31030: Completion/X/Command/_mplayer:
-	improve label for selected files.
-
-	*  Wieland Hoffmann: 31029: README: correct directory.
-
-	* Han Pingtian: 31027: Completion/Unix/Type/_files: remove
-	the -g's from the glob options.
-
-2013-02-03  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Eric P. Mangold: c.f. 31016
-	http://twistedmatrix.com/trac/browser/trunk/twisted/python/twisted-completion.zsh?format=txt:
-	completion for twisted using internally generated completion.
-
-2013-02-01  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 31015: Completion: compaudit: where we can find who owns the
-	zsh executable, allow the same owner to own completion files.
-
-2013-02-01  Mikael Magnusson  <mikachu@gmail.com>
-
-	* unposted: Fix _prove completer commit.
-
-2013-01-29  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* Jesper Nyg√•rds: 31012: Completion/Unix/Command/_gradle:
-	updates.
-
-	* Dmitry Roshchin: 31008: Completion/openSUSE/Command/_zypper,
-	Completion/openSUSE/Command/_osc: updates.
-
-2013-01-26  Bart Schaefer  <schaefer@zsh.org>
-
-	* 31000: Doc/Zsh/contrib.yo: fix typo in example.
-
-2013-01-24  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* users/17608: Doc/Zsh/contrib.yo,
-	Functions/Zle/modify-current-argument: use function to modify
-	current command line argument.
-
-2013-01-22  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 30993: Src/subst.c, Test/D04parameter.ztst: parameter
-	modifiers :wq operating on an empty string crashed the shell.
-	The shell isn't supposed to crash.
-
-2013-01-20  Oliver Kiddle <opk@zsh.org>
-
-	* 30987: Completion/X/Command/_xrandr: only call xrandr when
-	necessary and use _call_program
-
-2013-01-14  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 30960: Alexey Bezhan: Completion/Unix/Command/_django:
-	compatibility issue.
-
-2013-01-10  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 30958: Jeremy Mates: Completion/Unix/Command/_prove,
-	Completion/Unix/Command/.distfiles: new completion.
-
-2013-01-07  Bart Schaefer  <schaefer@zsh.org>
-
-	* unposted (see 30952): Src/builtin.c: tweak to 30949 to fix the
-	buffer pointer.
-
-2013-01-06  Bart Schaefer  <schaefer@zsh.org>
-
-	* 30949: Src/builtin.c: restore "read -q" behavior lost by 27188.
-
-2013-01-05  Peter Stephenson  <p.w.stephenson@ntlworld.com>
-
-	* 30946: Robert Kovacsics: Completion/X/Command/_xrandr: use
-	command to generate completions.
-
-2013-01-04  Peter Stephenson  <p.stephenson@samsung.com>
-
-	* 30941: Completion/bashcompinit: scalars giving status of bash
-	completion should be exported for external programmes.
-
-2013-01-03  Bart Schaefer  <schaefer@zsh.org>
-
-	* users/17524: Doc/Zsh/expn.yo: misc. parameter flag clarifications.
-
-2013-01-03  Peter Stephenson  <pws@csr.com>
-
-	* unposted: Config/version.mk: update version to 5.0.2-dev-0
-	to avoid clash with release.
-
 2012-12-21  Peter Stephenson  <p.w.stephenson@ntlworld.com>
 
 	* unposted: README, Config/version.mk, Etc/FAQ.yo: release
@@ -1721,3 +409,8 @@
 2012-07-21  Peter Stephenson  <p.w.stephenson@ntlworld.com>
 
 	* unposted: update for 5.0.0 release.
+
+*****************************************************
+* This is used by the shell to define $ZSH_PATCHLEVEL
+* $Revision: 1.5778 $
+*****************************************************
diff -ruN zsh-5.0.4/Completion/BSD/Command/_portaudit zsh-5.0.2/Completion/BSD/Command/_portaudit
--- zsh-5.0.4/Completion/BSD/Command/_portaudit	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/BSD/Command/_portaudit	2010-06-06 10:37:16.000000000 -0700
@@ -6,7 +6,7 @@
     '-d[print creation date of the database]' \
     '-F[fetch the current database]' \
     '-q[quiet mode]' \
-    '-V[show portaudit version number]' \
+    '-V[show portaudit version number]'†\
     '-v[verbose mode]' \
     '-X[download a fresh database from least days old]:days:' \
     '-f[check the packages listed in file]:file:_files' \
diff -ruN zsh-5.0.4/Completion/Base/Utility/.distfiles zsh-5.0.2/Completion/Base/Utility/.distfiles
--- zsh-5.0.4/Completion/Base/Utility/.distfiles	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Base/Utility/.distfiles	2012-12-16 10:45:26.000000000 -0800
@@ -1,25 +1,9 @@
 DISTFILES_SRC='
 .distfiles
-_alternative
-_arg_compile
-_arguments
-_cache_invalid
-_call_function
-_comp_locale
+_alternative      _call_program     _nothing          _sub_commands
+_arg_compile      _combination      _regex_arguments  _values
+_arguments        _set_command      _retrieve_cache   _guard
+_cache_invalid    _describe         _sep_parts        _pick_variant
+_call_function    _multi_parts      _store_cache      _regex_words
 _complete_help_generic
-_call_program
-_combination
-_set_command
-_describe
-_multi_parts
-_nothing
-_regex_arguments
-_retrieve_cache
-_sep_parts
-_store_cache
-_sub_commands
-_values
-_guard
-_pick_variant
-_regex_words
 '
diff -ruN zsh-5.0.4/Completion/Base/Utility/_comp_locale zsh-5.0.2/Completion/Base/Utility/_comp_locale
--- zsh-5.0.4/Completion/Base/Utility/_comp_locale	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Base/Utility/_comp_locale	1969-12-31 16:00:00.000000000 -0800
@@ -1,20 +0,0 @@
-#autoload
-
-# Arrange that LC_CTYPE retains the current setting so characters in
-# file names are handled properly, but other locales are set to C so
-# that the completion system can process output without surprises.
-
-# This exports new locale settings, so should only
-# be run in a subshell.  A typical use is in a $(...).
-
-local ctype
-
-if ctype=${${(f)"$(locale 2>/dev/null)"}:#^LC_CTYPE=*}; then
-    unset -m LC_\*
-    [[ -n $ctype ]] && eval export $ctype
-else
-    ctype=${LC_ALL:-${LC_CTYPE:-${LANG:-C}}}
-    unset -m LC_\*
-    export LC_CTYPE=$ctype
-fi
-export LANG=C
diff -ruN zsh-5.0.4/Completion/Base/Widget/_complete_help zsh-5.0.2/Completion/Base/Widget/_complete_help
--- zsh-5.0.4/Completion/Base/Widget/_complete_help	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Base/Widget/_complete_help	2007-06-19 13:04:11.000000000 -0700
@@ -6,41 +6,41 @@
   local _sort_tags=_help_sort_tags text i j k tmp
   typeset -A help_funcs help_tags help_sfuncs help_styles
 
-  {
-    compadd() { return 1 }
-    zstyle() {
-      local _f="${${(@)${(@)funcstack[2,(i)_(main_complete|complete|approximate|normal)]}:#_(dispatch|wanted|requested|all_labels|next_label)}% *}"
-  
-      [[ -z "$_f" ]] && _f="${${(@)funcstack[2,(i)_(main_complete|complete|approximate|normal)]}:#_(dispatch|wanted|requested|all_labels|next_label)}"
-  
-      if [[ "$help_sfuncs[$2]" != *${_f}* ||
-            "$help_styles[${2}${_f}]" != *${3}* ]]; then
-  
-        [[ "$help_sfuncs[$2]" != *${_f}* ]] && help_sfuncs[$2]+=$'\0'"${_f}"
-        local _t
-  
-        case "$1" in
-        -s) _t='[string] ';;
-        -a) _t='[array]  ';;
-        -h) _t='[assoc]  ';;
-        *)  _t='[boolean]';;
-        esac
-        help_styles[${2}${_f}]+=",${_t} ${3}:${_f}"
-      fi
-  
-      # No need to call the completers more than once with different match specs.
-  
-      if [[ "$3" = matcher-list ]]; then
-        set -A "$4" ''
-      else
-        builtin zstyle "$@"
-      fi
-    }
-
-    ${1:-_main_complete}
-  } always {
-    unfunction compadd zstyle
+  compadd() { return 1 }
+  zstyle() {
+    local _f="${${(@)${(@)funcstack[2,(i)_(main_complete|complete|approximate|normal)]}:#_(dispatch|wanted|requested|all_labels|next_label)}% *}"
+
+    [[ -z "$_f" ]] && _f="${${(@)funcstack[2,(i)_(main_complete|complete|approximate|normal)]}:#_(dispatch|wanted|requested|all_labels|next_label)}"
+
+    if [[ "$help_sfuncs[$2]" != *${_f}* ||
+          "$help_styles[${2}${_f}]" != *${3}* ]]; then
+
+      [[ "$help_sfuncs[$2]" != *${_f}* ]] && help_sfuncs[$2]+=$'\0'"${_f}"
+      local _t
+
+      case "$1" in
+      -s) _t='[string] ';;
+      -a) _t='[array]  ';;
+      -h) _t='[assoc]  ';;
+      *)  _t='[boolean]';;
+      esac
+      help_styles[${2}${_f}]+=",${_t} ${3}:${_f}"
+    fi
+
+    # No need to call the completers more than once with different match specs.
+
+    if [[ "$3" = matcher-list ]]; then
+      set -A "$4" ''
+    else
+      builtin zstyle "$@"
+    fi
   }
+  trap 'unfunction compadd zstyle' EXIT INT
+
+  ${1:-_main_complete}
+
+  unfunction compadd zstyle
+  trap - EXIT INT
 
   for i in "${(@ok)help_funcs}"; do
     text+=$'\n'"tags in context :completion:${i}:"
@@ -73,7 +73,7 @@
 }
 
 _help_sort_tags() {
-  local f="${${(@)${(@)funcstack[3,(i)_(main_complete|complete|approximate|normal)]}:#(_(dispatch|wanted|requested|all_labels|next_label)|\(eval\))}% *}"
+  local f="${${(@)${(@)funcstack[3,(i)_(main_complete|complete|approximate|normal)]}:#_(dispatch|wanted|requested|all_labels|next_label)}% *}"
 
   if [[ "$help_funcs[$curcontext]" != *${f}* ||
         "$help_tags[${curcontext}${f}]" != *(${(j:|:)~argv})* ]]; then
diff -ruN zsh-5.0.4/Completion/Base/Widget/_complete_tag zsh-5.0.2/Completion/Base/Widget/_complete_tag
--- zsh-5.0.4/Completion/Base/Widget/_complete_tag	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Base/Widget/_complete_tag	2001-04-02 04:14:57.000000000 -0700
@@ -32,11 +32,6 @@
   c_path=../$c_path
 done
 
-if [[ -f $c_path$c_Tagsfile && $c_path$c_Tagsfile -ef $c_path$c_tagsfile &&
-      "$(head -1 $c_path$c_tagsfile)" == '!_TAG_'* ]]; then
-        c_Tagsfile=
-fi
-
 if [[ -f $c_path$c_Tagsfile ]]; then
   # prefer the more comprehensive TAGS, which unfortunately is a
   # little harder to parse.
diff -ruN zsh-5.0.4/Completion/Debian/Command/.distfiles zsh-5.0.2/Completion/Debian/Command/.distfiles
--- zsh-5.0.4/Completion/Debian/Command/.distfiles	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Debian/Command/.distfiles	2010-12-16 12:22:01.000000000 -0800
@@ -14,7 +14,6 @@
 _dak
 _dchroot
 _dchroot-dsa
-_dcut
 _debchange
 _debdiff
 _debfoster
@@ -31,6 +30,7 @@
 _git-buildpackage
 _invoke-rc.d
 _lighttpd
+_linda
 _lintian
 _madison
 _make-kpkg
diff -ruN zsh-5.0.4/Completion/Debian/Command/_dak zsh-5.0.2/Completion/Debian/Command/_dak
--- zsh-5.0.4/Completion/Debian/Command/_dak	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Debian/Command/_dak	2012-02-10 11:33:40.000000000 -0800
@@ -238,10 +238,6 @@
     )
     ;;
 
-    (*)
-    _files
-    ;;
-
 esac
 
 _arguments -s "$args[@]" && ret=0
diff -ruN zsh-5.0.4/Completion/Debian/Command/_dcut zsh-5.0.2/Completion/Debian/Command/_dcut
--- zsh-5.0.4/Completion/Debian/Command/_dcut	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Debian/Command/_dcut	1969-12-31 16:00:00.000000000 -0800
@@ -1,160 +0,0 @@
-#compdef dcut
-
-# TODO: dcut supports two ways to be called:
-#  * dcut HOST COMMAND ...
-#  * dcut COMMAND ...
-# So ideally, if the first argument is completed, both commands and hosts should
-# be offered. If host is given, the second argument should be completed as
-# command and if not, it should be completed as command specific option.
-
-function _dput_hosts() {
-  local expl
-
-  if ( [[ ${+_dput_cfhosts} -eq 0 ]] || _cache_invalid dputhosts ) && ! _retrieve_cache dputhosts; then
-    local cmd
-    if _pick_variant dputng="usage: dput" dput -H ; then
-      cmd=(dirt hosts)
-    else
-      cmd=(dput -H)
-    fi
-     _dput_cfhosts=(${${(M)${(f)"$($cmd)"}:#*=>*}/ =>*/})
-    _store_cache dputhosts _dput_cfhosts
-  fi
-
-  _wanted dputhosts expl 'target host' compadd -a _dput_cfhosts
-}
-
-function _dcut_commands() {
-  local -a cmds
-  if _pick_variant dcutng="usage: dcut" dcut -v ; then
-    cmds=(
-      dm:'manage Debian Maintainer permissions'
-      break-the-archive:'break the archive'
-      reschedule:'reschedule a deferred upload'
-      cancel:'cancel a deferred upload'
-      rm:'remove a file from the upload queue'
-      upload:'upload a command file'
-    )
-  else
-    cmds=(
-      rm:'remove a file from the upload queue'
-      cancel:'cancel a deferred upload'
-      reschedule:'reschedule a deferred upload'
-    )
-  fi
-  _describe -t commands command cmds
-}
-
-function _dcut() {
-  local -a all_opts dcut_opts dcut_ng_opts
-  local state line context
-  local -A opt_args
-  local curcontext="${curcontext}"
-
-  all_opts=(
-    '(-c --config)'{-c,--config=}'[specify config file]:config file:_files'
-    '(-h --help)'{-h,--help}'[show help message and exit]'
-    '(-m --maintainer)'{-m,--maintainer=}'[use maintainer for upload field and GPG key selection]:maintainer address'
-    '(-k --keyid)'{-k,--keyid}'[use key id for signing]:keyid'
-    '(-O --output)'{-O,--output=}'[write command file to file instead of uploading]:output file:_files'
-    '(-P --passive)'{-P,--passive}'[use passive FTP for uploads]'
-    '(-v --version)'{-v,--version}'[show version information]'
-    ': :_dcut_commands'
-  )
-
-  dcut_opts=(
-    '(-d --debug)'{-d,--debug}'[debug mode]'
-    '(-s --simulate)'{-s,--simulate}'[simulate an upload only]'
-    '(-i --input)'{-i,--input=}'[create commands file to remove every file listed in the changes file]:changes file:_files -g"*.changes(-.)"'
-    '(-U --upload)'{-U,--upload=}'[upload commands file]:commands file:_files'
-    '(--host 1)'{--host=}'[upload to host if it is named like a command]:host:_dput_hosts'
-    '*:: :->dcut_command_arguments'
-  )
-
-  dcut_ng_opts=(
-    '*'{-d,--debug}'[enable debug messages, repeat twice to increase the verbosity level]'
-    '*'{-s,--simulate}'[simulate an upload only, repeat twice to increase level of simulation]'
-    '*:: :->dcut_ng_command_arguments'
-  )
-
-  if _pick_variant dcutng="usage: dcut" dcut -v ; then
-    _arguments -C \
-      "$all_opts[@]" "$dcut_ng_opts[@]" && return
-  else
-    _arguments -C \
-      "$all_opts[@]" "$dcut_opts[@]" && return
-  fi
-
-  case $state in
-  (dcut_command_arguments)
-    # arguments to dcut commands
-    local -a opts
-    case ${line[1]} in
-    (cancel)
-      # dcut cancel arguments
-      opts=(
-        '1::changes file:_files -g"*.changes(-.)"'
-      )
-      ;;
-    (reschedule)
-      # dcut reschedule arguments
-      opts=(
-        '1::changes file:_files -g"*.changes(-.)"'
-        '2::new delayed queue:(0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15)'
-      )
-      ;;
-    (rm)
-      # dcut rm arguments
-      opts=(
-        '--searchdirs[search in all directores for the given files]'
-        '1::file to be deleted:_files'
-      )
-      ;;
-    esac
-    _arguments "$opts[@]" && return
-    ;;
-  (dcut_ng_command_arguments)
-    # arguments to dput-ng's dcut commands
-    local -a opts
-    case ${line[1]} in
-    (cancel)
-      # dcut cancel arguments
-      opts=(
-        '(-f --filename)'{-f,--filename}'[.changes file name of the upload to be cancelled]:file name:_files -g"*.changes(-.)"'
-      )
-      ;;
-    (dm)
-      # dcut dm arguments
-      opts=(
-        '--uid[full name and address or GPG fingerprint of the Debian Maintainer]'
-        '*--allow[grant permission to upload a source package]:source package'
-        '*--deny[remove permission to upload a source pckage]:source package'
-      )
-      ;;
-    (reschedule)
-      # dcut reschedule arguments
-      opts=(
-        '(-f --filename)'{-f,--filename}'[.changes file name to be rescheduled]:file name:_files -g"*.changes(-.)"'
-        '(-d --days)'{-d,--days}'[new delayed queue]:days:(0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15)'
-      )
-      ;;
-    (rm)
-      # dcut rm arguments
-      opts=(
-        '*'{-f,--filename}'[file name to be removed]:file name:_files'
-        '--searchdirs[search in all directores for the given files]'
-      )
-      ;;
-    (upload)
-      # dcut upload arguments
-      opts=(
-        '-f --filename)'{-f,--filename}'[file to be uploaded]:file name:_files'
-      )
-      ;;
-    esac
-    _arguments "$opts[@]" && return
-    ;;
-  esac
-}
-
-_dcut "$@"
diff -ruN zsh-5.0.4/Completion/Debian/Command/_dput zsh-5.0.2/Completion/Debian/Command/_dput
--- zsh-5.0.4/Completion/Debian/Command/_dput	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Debian/Command/_dput	2009-12-13 13:33:12.000000000 -0800
@@ -1,57 +1,28 @@
 #compdef dput
 
 _dput() {
-  local -a all_opts dput_opts dput_ng_opts
-
-  all_opts=(
-    '(-c --config)'{-c,--config}'[specify config file]:config file:_files'
-    '(-h --help)'{-h,--help}'[show help message and exit]'
-    '(-f --force)'{-f,--force}'[force an upload]'
-    '(-P --passive)'{-P,--passive}'[use passive FTP for uploads]'
-    '(-U --no-upload-log)'{-U,--no-upload-log}'[do not write an .upload log after uploading]'
-    '(-D --dinstall)'{-D,--dinstall}'[run dinstall after upload]'
-    '(-e --delayed)'{-e,--delayed}'[number of days in delayed queue]:number of days:(0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15)'
-    '(-l --lintian)'{-l,--lintian}'[run lintian before upload]'
-    '(-o --check-only)'{-o,--check-only}'[check the package, do not upload]'
-    '(-u --unchecked)'{-u,--unchecked}'[do not check GPG signature on the changes file]'
-    '(-v --version)'{-v,--version}'[show version information]'
-    '1::host:_dput_hosts'
-    '*:changes file:_files -g "*.changes(-.)"'
-  )
-
-  dput_opts=(
-    '(-d --debug)'{-d,--debug}'[debug mode]'
-    '(-H --host-list)'{-H,--host-list}'[display host list]'
-    '(-s --simulate)'{-s,--simulate}'[simulate an upload only]'
-    '(-p --print)'{-p,--print}'[print configuration]'
-  )
-
-  dput_ng_opts=(
-    '*'{-d,--debug}'[enable debug messages, repeat twice to increase the verbosity level]'
-    '*'{-s,--simulate}'[simulate an upload only, repeat twice to increase level of simulation]'
-    '(-F --full-upload-log)'{-F,--full-upload-log}'[write more verbose .upload logs]'
-  )
-
-  if _pick_variant dputng="usage: dput" dput -H ; then
-    _arguments \
-      "$all_opts[@]" "$dput_ng_opts[@]"
-  else
-    _arguments \
-      "$all_opts[@]" "$dput_opts[@]"
-  fi
+_arguments \
+  '(-c --config)'{-c,--config}'[specify config file]:config file:_files' \
+  '(-d --debug)'{-d,--debug}'[debug mode]' \
+  '(-D --dinstall)'{-D,--dinstall}'[run dinstall after upload]' \
+  '(-e --delayed)'{-E,--delayed}'[number of days in delayed queue]:number of days:(0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15)' \
+  '(-f --force)'{-f,--force}'[force upload of already uploaded package]' \
+  '(-H --host-list)'{-H,--host-list}'[display host list]' \
+  '(-l --lintian)'{-l,--lintian}'[run lintian before upload]' \
+  '(-o --check-only)'{-o,--check-only}'[check the package, do not upload]' \
+  '(-p --print)'{-p,--print}'[print configuration]' \
+  '(-s --simulate)'{-s,--simulate}'[simulate an upload only]' \
+  '(-u --unchecked)'{-u,--unchecked}'[do not check GPG signature on the changes file]' \
+  '(-v --version)'{-v,--version}'[show version information]' \
+  '1::host:_dput_hosts' \
+  '*:changes file:_files -g "*.changes(-.)"'
 }
 
 _dput_hosts() {
   local expl
 
   if ( [[ ${+_dput_cfhosts} -eq 0 ]] || _cache_invalid dputhosts ) && ! _retrieve_cache dputhosts; then
-    local cmd
-    if _pick_variant dputng="usage: dput" dput -H ; then
-      cmd=(dirt hosts)
-    else
-      cmd=(dput -H)
-    fi
-     _dput_cfhosts=(${${(M)${(f)"$($cmd)"}:#*=>*}/ =>*/})
+    _dput_cfhosts=(${${(M)${(f)"$(dput -H)"}:#*=>*}/ =>*/})
     _store_cache dputhosts _dput_cfhosts
   fi
 
diff -ruN zsh-5.0.4/Completion/Debian/Command/_linda zsh-5.0.2/Completion/Debian/Command/_linda
--- zsh-5.0.4/Completion/Debian/Command/_linda	1969-12-31 16:00:00.000000000 -0800
+++ zsh-5.0.2/Completion/Debian/Command/_linda	2012-02-10 11:33:40.000000000 -0800
@@ -0,0 +1,26 @@
+#compdef linda
+
+_arguments \
+  '(-c --config)'{-c,--config=}':config file:_files' \
+  '(-C --checks)'{-C,--checks=}':check regexes:' \
+  '(-d --debug)*'{-d,--debug}'[debug]' \
+  '(-D --disable-local)*'{-D,--disable-local}'[disable registration of local checks]' \
+  '(-f --format)'{-f,--format=}':output format:(branden long lintian figlet)' \
+  '(-h --help)'{-h,--help}'[help]' \
+  '(-i --info)'{-i,--info}'[info]' \
+  '(-l --lab)'{-l,--lab=}':lab root:_files -/' \
+  '(-L --list-checks)'{-L,--list-checks=}':list checks:' \
+  '(-m --more-overrides)'{-m,--more-overrides=}':more overrides:' \
+  '(-n --no-cull)'{-n,--no-cull}'[do not delete lab after completion]' \
+  '(-o --show-overridden)'{-o,--show-overridden}'[display errors that are overridden]' \
+  '(-p --print-overrides)'{-p,--print-overrides}'[print parsed overrides]' \
+  '(-P --profiling)'{-P,--profiling}'[print profiling stats]' \
+  '(-q --quiet)'{-q,--quiet}'[quiet]' \
+  '(-s --show-tag)'{-s,--show-tag}'[print tag along with errors]' \
+  '(-S --seteuid)'{-S,--seteuid}'[do not seteuid to nobody]' \
+  '(-t --types)'{-t,--types=}':types string:_values -s , "types" Error Warning eXperimental Informational' \
+  '(-T --traceback)'{-T,--traceback}'[show a traceback from any exception]' \
+  '(-U --unpack)'{-U,--unpack}':unpack level:' \
+  '(-v --verbose)'{-v,--verbose}'[verbose]' \
+  '(-V --version)'{-V,--version}'[version]' \
+  ':package:_files -g "*.(changes|u#deb|dsc)(-.)"'
diff -ruN zsh-5.0.4/Completion/Linux/Command/_brctl zsh-5.0.2/Completion/Linux/Command/_brctl
--- zsh-5.0.4/Completion/Linux/Command/_brctl	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Linux/Command/_brctl	2005-08-08 01:02:40.000000000 -0700
@@ -10,12 +10,10 @@
     show:show\ all\ current\ bridge\ instances
     addif:add\ interface\ to\ bridge
     delif:remove\ interface\ from\ bridge
-    hairpin:toggle\ hairpin\ mode\ on\ a\ port
     showmacs:show\ a\ list\ of\ learned\ MAC\ addresses
     setageing:set\ MAC\ address\ ageing\ time
     setgcint:set\ grabage\ collection\ interval
     stp:control\ use\ of\ spanning\ tree\ protocol
-    showstp:show\ bridge\ stp\ info
     setbridgeprio:set\ bridge\ priority
     setfd:set\ bridge\ forward\ delay
     sethello:set\ bridge\ hello\ time
@@ -43,7 +41,7 @@
       setbridgeprio)
       	_message -e priority 'priority'
       ;;
-      setpathcost|setportprio|hairpin)
+      setpathcost|setportprio)
         _message -e ports 'port'
       ;;
       stp)
@@ -58,8 +56,6 @@
       _message -e cost 'cost'
     elif [[ $subcmd == setportprio ]]; then
       _message -e priority 'priority'
-    elif [[ $subcmd == hairpin ]]; then
-      _message -e onoff 'on|off'
     fi
   fi
 fi
diff -ruN zsh-5.0.4/Completion/Linux/Command/_btrfs zsh-5.0.2/Completion/Linux/Command/_btrfs
--- zsh-5.0.4/Completion/Linux/Command/_btrfs	2013-11-27 11:00:18.000000000 -0800
+++ zsh-5.0.2/Completion/Linux/Command/_btrfs	2012-11-20 15:08:17.000000000 -0800
@@ -1,7 +1,7 @@
 #compdef btrfs
 
 local curcontext="$curcontext" curstate state line expl grp cmd ret=1
-local -a groups args cmds_1 cmds_2 cmds_3 cmds_4 cmds_5 cmds_6
+local -a groups args
 
 groups=( subvolume filesystem device scrub balance inspect-internal help version )
 cmds_1=( create delete list snapshot get-default set-default find-new help )
diff -ruN zsh-5.0.4/Completion/Unix/Command/.distfiles zsh-5.0.2/Completion/Unix/Command/.distfiles
--- zsh-5.0.4/Completion/Unix/Command/.distfiles	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/.distfiles	2012-12-16 10:46:06.000000000 -0800
@@ -20,7 +20,6 @@
 _bzr
 _cal
 _calendar
-_cat
 _ccal
 _cdcd
 _cdrdao
@@ -44,7 +43,6 @@
 _dbus
 _dd
 _devtodo
-_df
 _dhclient
 _dict
 _diff
@@ -59,7 +57,6 @@
 _enscript
 _env
 _espeak
-_etags
 _fakeroot
 _feh
 _fetchmail
@@ -155,6 +152,7 @@
 _notmuch
 _npm
 _nslookup
+_osc
 _pack
 _patch
 _pax
@@ -175,7 +173,6 @@
 _postfix
 _prcs
 _printenv
-_prove
 _psutils
 _pump
 _pydoc
diff -ruN zsh-5.0.4/Completion/Unix/Command/_awk zsh-5.0.2/Completion/Unix/Command/_awk
--- zsh-5.0.4/Completion/Unix/Command/_awk	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_awk	2008-05-13 09:08:35.000000000 -0700
@@ -14,8 +14,8 @@
 # Fixing this is beyond my current _arguments expertise--help
 # appreciated.
 
-_arguments -S -s '-F+[define input field separator to be an extended regular expression]:extended regular expression:' \
-    '*-v+[assign values to variables]:assignment:' \
-    '(1)-f+[program file]:program file:_files' \
+_arguments -S -s '-F[define input field separator to be an extended regular expression]:extended regular expression:' \
+    '*-v[assign values to variables]:assignment:' \
+    '(1)-f[program file]:program file:_files' \
     '1:program text:' \
     '*:input files:_files'
diff -ruN zsh-5.0.4/Completion/Unix/Command/_cat zsh-5.0.2/Completion/Unix/Command/_cat
--- zsh-5.0.4/Completion/Unix/Command/_cat	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_cat	1969-12-31 16:00:00.000000000 -0800
@@ -1,43 +0,0 @@
-#compdef cat
-
-local -a args
-
-if _pick_variant gnu=GNU unix --version; then
-  args=(
-    '(-A --show-all)'{-A,--show-all}'[equivalent to -vET]'
-    '(-b --number-nonblank -n --number)'{-b,--number-nonblank}'[number nonempty output lines, overrides -n]'
-    '-e[equivalent to -vE]'
-    '(-E --show-ends)'{-E,--show-ends}'[display $ at end of each line]'
-    '(-n --number)'{-n,--number}'[number all output lines]'
-    '(-s --squeeze-blank)'{-s,--squeeze-blank}'[suppress repeated empty output lines]'
-    '-t[equivalent to -vT]'
-    '(-T --show-tabs)'{-T,--show-tabs}'[display TAB characters as ^I]'
-    '-u[ignored]'
-    '(-v --show-nonprinting)'{-v,--show-nonprinting}'[use ^ and M- notation, except for LFD and TAB]'
-    '(- : *)--help[display help and exit]'
-    '(- : *)--version[output version information and exit]'
-    '*:files:_files'
-  )
-
-elif [[ "$OSTYPE" == (freebsd|dragonfly|darwin)* ]]; then
-  args=(
-    '(-n)-b[number non-blank output lines]'
-    '(-v)-e[display $ at the end of each line (implies -v)]'
-    '-n[number all output lines]'
-    '-s[squeeze multiple blank lines into one]'
-    '(-v)-t[display tab as ^I (implies -v)]'
-    '-u[do not buffer output]'
-    '-v[display non-printing chars as ^X or M-a]'
-    '(-)*:files:_files'
-  )
-
-else
-  # POSIX reqires '-u', and most OSes may support '-n'
-  args=(
-    '-n[number all output lines]'
-    '-u[do not buffer output]'
-    '*:files:_files'
-  )
-fi
-
-_arguments -s -S : $args
diff -ruN zsh-5.0.4/Completion/Unix/Command/_cdrdao zsh-5.0.2/Completion/Unix/Command/_cdrdao
--- zsh-5.0.4/Completion/Unix/Command/_cdrdao	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_cdrdao	2012-02-10 11:33:42.000000000 -0800
@@ -277,7 +277,7 @@
 # Type completion {{{1
 
 __cdrdao-device () {
-  # Use cdrdao scanbus and also check what OS we're running under and provide
+  # Use cdrdao scanbus and also check what OS we‚Äôre running under and provide
   # additional stuff, like devices (/dev/sg0)
   local -a devices
 
diff -ruN zsh-5.0.4/Completion/Unix/Command/_cp zsh-5.0.2/Completion/Unix/Command/_cp
--- zsh-5.0.4/Completion/Unix/Command/_cp	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_cp	2010-02-02 12:37:01.000000000 -0800
@@ -1,62 +1,34 @@
 #compdef cp
 
-if _pick_variant gnu=GNU unix --version; then
-  _arguments -s -S \
-    '(-a --archive)'{-a,--archive}'[same as -dR --preserve=all]' \
-    '(-b --backup)-b[backup]' \
-    '(-b --backup)--backup=[backup]:method:(none off numbered t existing nil simple never)' \
-    '--copy-contents[copy contents of special files when recursive]' \
-    '-d[same as --no-dereference --preserve=links]' \
-    '(-f --force)'{-f,--force}'[remove and retry for destinations that cannot be opened]' \
-    '(-i --interactive)'{-i,--interactive}'[prompt before overwrite]' \
-    '-H[follow command-line symbolic links]' \
-    '(-l --link)'{-l,--link}'[link files instead of copying]' \
-    '(-L --dereference)'{-L,--dereference}'[always follow symbolic links]' \
-    '(-n --no-clobber)'{-n,--no-clobber}'[do not overwrite an existing file]' \
-    '(-P --no-dereference)'{-P,--no-dereference}'[never follow symbolic links]' \
-    '-p[same as --preserve=mode,ownership,timestamps]' \
-    '--preserve=[preserve specified attributes]:attributes to preserve:_values -s , mode timestamps ownership links context xattr all' \
-    '--no-preserve=[don'\''t preserve specified attributes]:attributes not to preserve:_values -s , mode timestamps ownership links context xattr all' \
-    '--parents[append source path to target directory]' \
-    '(-R -r --recursive)'{-R,-r,--recursive}'[copy directories recursively]' \
-    '--reflink=[control clone/CoW copies]:when to perform a lightweight copy:(always auto)' \
-    '--remove-destination[remove each existing destination file before attempting to open it]' \
-    '--sparse=[control creation of sparse files]:when to create sparse files:(auto always never)' \
-    '--strip-trailing-slashes[remove any trailing slashes from each source argument]' \
-    '(-s --symbolic-link)'{-s,--symbolic-link}'[make symbolic links instead of copies of non-directories]' \
-    '(-S --suffix)'{-S,--suffix=}'[override the usual backup suffix]:backup suffix:' \
-    '(-t --target-directory)'{-t,--target-directory=}'[copy all source arguments into target directory]:target directory:_files -/' \
-    '(-T --no-target-directory)'{-T,--no-target-directory}'[treat DEST as a normal file]' \
-    '(-u --update)'{-u,--update}'[copy only when source is newer than destination or destination is missing]' \
-    '(-v --verbose)'{-v,--verbose}'[explain what is being done]' \
-    '(-x --one-file-system)'{-x,--one-file-system}'[stay on this file system]' \
-    '--help' \
-    '--version' \
-    '*:file or directory:_files'
-
-elif [[ "$OSTYPE" == darwin* ]]; then
-  _arguments -s -S \
-    '-R[copy directories recursively]' \
-    '(-L -P)-H[with -R, follow symlinks on the command line]' \
-    '(-H -P)-L[with -R, follow all symlinks]' \
-    '(-H -L)-P[with -R, do not follow symlinks (default)]' \
-    '(-i -n)-f[force overwriting existing file]' \
-    '(-f -n)-i[confirm before overwriting existing file]' \
-    '(-f -i)-n[do not overwrite existing file]' \
-    '-a[same as -pRP]' \
-    '-p[preserve timestamps, mode, owner, flags, ACLs, and Extended Attributes]' \
-    '-v[show file names as they are copied]' \
-    '-X[do not copy Extended Attributes or resource forks]' \
-    '(-)*:file or directory:_files'
-
-else    # assume POSIX
-  _arguments -s -S \
-    '-R[copy directories recursively]' \
-    '(-L -P)-H[with -R, follow symlinks on the command line]' \
-    '(-H -P)-L[with -R, follow all symlinks]' \
-    '(-H -L)-P[do not follow symlinks]' \
-    '(-i)-f[force overwriting existing file]' \
-    '(-f)-i[confirm before overwriting existing file]' \
-    '-p[preserve timestamps, mode, and owner]' \
-    '(-)*:file or directory:_files'
-fi
+_arguments -s \
+  '(-a --archive)'{-a,--archive}'[same as -dpR]' \
+  '(-b --backup)-b[backup]' \
+  '(-b --backup)--backup=[backup]:method:(none off numbered t existing nil simple never)' \
+  '--copy-contents[copy contents of special files when recursive]' \
+  '-d[same as --no-dereference --preserve=links]' \
+  '(-f --force)'{-f,--force}'[remove and retry for destinations that cannot be opened]' \
+  '(-i --interactive)'{-i,--interactive}'[prompt before overwrite]' \
+  '-H[follow command-line symbolic links]' \
+  '(-l --link)'{-l,--link}'[link files instead of copying]' \
+  '(-L --dereference)'{-L,--dereference}'[always follow symbolic links]' \
+  '(-n --no-clobber)'{-n,--no-clobber}'[do not overwrite an existing file]' \
+  '(-P --no-dereference)'{-P,--no-dereference}'[never follow symbolic links]' \
+  '-p[same as --preserve=mode,ownership,timestamps]' \
+  '--preserve=[preserve specified attributes]:attributes to preserve:_values -s , mode timestamps ownership links context xattr all' \
+  '--no-preserve=[don'\''t preserve specified attributes]:attributes not to preserve:_values -s , mode timestamps ownership links context xattr all' \
+  '--parents[append source path to target directory]' \
+  '(-R -r --recursive)'{-R,-r,--recursive}'[copy directories recursively]' \
+  '--reflink=[control clone/CoW copies]:when to perform a lightweight copy:(always auto)' \
+  '--remove-destination[remove each existing destination file before attempting to open it]' \
+  '--sparse=[control creation of sparse files]:when to create sparse files:(auto always never)' \
+  '--strip-trailing-slashes[remove any trailing slashes from each source argument]' \
+  '(-s --symbolic-link)'{-s,--symbolic-link}'[make symbolic links instead of copies of non-directories]' \
+  '(-S --suffix)'{-S,--suffix=}'[override the usual backup suffix]:backup suffix:' \
+  '(-t --target-directory)'{-t,--target-directory=}'[copy all source arguments into target directory]:target directory:_files -/' \
+  '(-T --no-target-directory)'{-T,--no-target-directory}'[treat DEST as a normal file]' \
+  '(-u --update)'{-u,--update}'[copy only when source is newer than destination or destination is missing]' \
+  '(-v --verbose)'{-v,--verbose}'[explain what is being done]' \
+  '(-x --one-file-system)'{-x,--one-file-system}'[stay on this file system]' \
+  '--help' \
+  '--version' \
+  '*:file or directory:_files'
diff -ruN zsh-5.0.4/Completion/Unix/Command/_cut zsh-5.0.2/Completion/Unix/Command/_cut
--- zsh-5.0.4/Completion/Unix/Command/_cut	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_cut	2008-02-06 11:45:53.000000000 -0800
@@ -5,54 +5,54 @@
 if _pick_variant gnu="Free Soft" unix --version; then
   case $LANG in
     (de_DE.UTF-8)
-      _cut_args=(
-	bytes           "nur diese Bytes ausgeben"
-	characters      "nur diese Zeichen ausgeben"
-	delimiter       "Delimiter anstelle von Tabulator als Trenner benutzen"
-	fields          "nur diese Felder und alle Zeilen OHNE Trennzeichen ausgeben"
-	n               "(ignoriert)"
-	complement      $'das Komplement der Menge der gew\u00e4hlten Bytes, Zeichen oder Felder bilden'
-	only-delimited  "keine Zeilen ausgeben, die keinen Trenner enthalten"
-	output-delimiter "Zeichenkette als Ausgabetrennzeichen benutzen"
-	help            "diese Hilfe anzeigen und beenden"
-	version         "Versionsinformation anzeigen und beenden"
-      )
+       _cut_args=(
+             bytes           "nur diese Bytes ausgeben" 
+             characters      "nur diese Zeichen ausgeben" 
+             delimiter       "Delimiter anstelle von Tabulator als Trenner benutzen"
+             fields          "nur diese Felder und alle Zeilen OHNE Trennzeichen ausgeben"
+             n               "(ignoriert)"
+             complement      "das Komplement der Menge der gew$'\u00e4'hlten Bytes, Zeichen oder Felder bilden"
+             only-delimited  "keine Zeilen ausgeben, die keinen Trenner enthalten"
+             output-delimiter "Zeichenkette als Ausgabetrennzeichen benutzen"
+             help            "diese Hilfe anzeigen und beenden"
+             version         "Versionsinformation anzeigen und beenden"
+       )
     ;;
     (*)
-      _cut_args=(
-	bytes           "select only these bytes"
-	characters      "select only these characters"
-	delimiter       "use DELIM instead of TAB for field delimiter"
-	fields          "select only these fields and lines without the delimiter character"
-	n               "(ignored)"
-	complement      "complement the set of selected bytes, characters or fields"
-	only-delimited  "do not print lines not containing delimiters"
-	output-delimiter "use STRING as the output delimiter"
-	help            "display this help and exit"
-	version         "output version information and exit"
-      )
+       _cut_args=(
+             bytes           "select only these bytes"
+             characters      "select only these characters"
+             delimiter       "use DELIM instead of TAB for field delimiter"
+             fields          "select only these fields and lines without the delimiter character"
+             n               "(ignored)"
+             complement      "complement the set of selected bytes, characters or fields"
+             only-delimited  "do not print lines not containing delimiters"
+             output-delimiter "use STRING as the output delimiter"
+             help            "display this help and exit"
+             version         "output version information and exit"
+       )
     ;;
   esac
 
   _arguments \
-    '(--bytes -b)'{--bytes=,-b+}'['$_cut_args[bytes]']:list' \
-    '(--characters -c)'{--characters=,-c+}'['$_cut_args[characters]']:list' \
-    '(--delimiter -d)'{--delimiter=,-d+}'['$_cut_args[delimiter]']:delimiter' \
-    '(--fields -f)'{--fields=,-f+}'['$_cut_args[fields]']:list' \
-    '-n['$_cut_args[n]']' \
-    '--complement['$_cut_args[complement]']' \
-    '(--only-delimited -s)'{--only-delimited,-s}'['$_cut_args[only-delimited]']' \
-    '--output-delimiter=['$_cut_args[output-delimiter]']:delimiter' \
-    '(- *)--help['$_cut_args[help]']' \
-    '(- *)--version['$_cut_args[version]']' \
-    '*:file:_files'
+        '(--bytes -b)'{--bytes=,-b+}'['$_cut_args[bytes]']:list' \
+        '(--characters -c)'{--characters=,-c+}'['$_cut_args[characters]']:list' \
+        '(--delimiter -d)'{--delimiter=,-d+}'['$_cut_args[delimiter]']:delimeter' \
+        '(--fields -f)'{--fields=,-f+}'['$_cut_args[fields]']:list' \
+        '-n['$_cut_args[n]']' \
+        '--complement['$_cut_args[complement]']' \
+        '(--only-delimited -s)'{--only-delimited,-s}'['$_cut_args[only-delimited]']' \
+        '--output-delimiter=['$_cut_args[output-delimiter]']:delimeter' \
+        '--help['$_cut_args[help]']' \
+        '--version['$_cut_args[version]']' \
+        '*:file:_files'
 else
   _arguments \
     '-b[list specifies byte positions]:list:' \
     '-c[list specifies character positions]:list:' \
-    '-d[use alternate delimiter]:delimiter' \
+    '-d[use alternate delimeter]:delimeter:' \
     '-f[list specifies fields]:list:' \
     '-n[do not split multi-byte characters]' \
-    '-s[suppress lines with no delimiters]' \
+    '-s[suppress lines with no delimeters]' \
     '*:file:_files'
 fi
diff -ruN zsh-5.0.4/Completion/Unix/Command/_devtodo zsh-5.0.2/Completion/Unix/Command/_devtodo
--- zsh-5.0.4/Completion/Unix/Command/_devtodo	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_devtodo	2009-03-09 02:58:02.000000000 -0700
@@ -8,11 +8,9 @@
 typeset expl
 
 for ((i=2; i <= $#words; i++)) {
-	if [[ $words[$i] == '--database' ]]; then
+	if [[ $words[$i] == '--database' ]] {
 		todo_opts+=(--database ${~words[$((++i))]})
-	elif [[ $words[$i] == '--sort' ]]; then
-		todo_opts+=(--sort ${words[$((++i))]})
-	fi
+	}
 }
 
 priorities=(verylow low medium high veryhigh)
diff -ruN zsh-5.0.4/Completion/Unix/Command/_df zsh-5.0.2/Completion/Unix/Command/_df
--- zsh-5.0.4/Completion/Unix/Command/_df	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_df	1969-12-31 16:00:00.000000000 -0800
@@ -1,79 +0,0 @@
-#compdef df
-
-local context state state_descr line args spec
-local -A opt_args
-
-if _pick_variant gnu=GNU unix --version; then
-  args=(
-    '(-B --block-size -k)'{-B+,--block-size=}'[specify block size]:size (bytes)'
-    '(-B --block-size -k)-k[like --block-size=1K]'
-    '(-P --portability)'{-P,--portability}'[use the POSIX output format]'
-    '(-h --human-readable -H --si)'{-h,--human-readable}'[print sizes in human readable format]'
-    '(-h --human-readable -H --si)'{-H,--si}'[human readable fomat, but use powers of 1000 not 1024]'
-    '(-i --inodes)'{-i,--inodes}'[list inode information instead of block usage]'
-    '--total[produce a grand total]'
-    '(-T --print-type)'{-T,--print-type}'[print file system type]'
-    '(-a --all)'{-a,--all}'[include dummy file systems]'
-    '(-l --local)'{-l,--local}'[limit listing to local file systems]'
-    '*'{-t+,--type=}'[limit listing to file systems of specified type]:file system type:_file_systems'
-    '*'{-x+,--exclude-type=}'[exclude file systems of specified type]:file system type:_file_systems'
-    '(--no-sync)--sync[invoke sync before getting usage info]'
-    '(--sync)--no-sync[do not invoke sync before getting usage info (default)]'
-    '-v[(ignored)]'
-    '(- : *)--help[display help and exit]'
-    '(- : *)--version[output version information and exit]'
-    '*:files:_files'
-  )
-elif [[ "$OSTYPE" == (darwin|freebsd|dragonfly)* ]]; then
-  args=(
-    '(-b -g -H -h -k -m)-b[use 512-byte blocks (default)]'
-    '(-b -g -H -h -k -m)-g[use 1024^3-byte blocks]'
-    '(-b -g -H -h -k -m)-H[human-readable output (base 10)]'
-    '(-b -g -H -h -k -m)-h[human-readable output (base 2)]'
-    '(-b -g -H -h -k -m)-k[use 1024-byte blocks]'
-    '(-b -g -H -h -k -m)-m[use 1024*1024-byte blocks]'
-    '-P[POSIX compliant output]'
-    '-a[show all mount points]'
-    '-i[include inode usage statistics (default)]'
-    '-l[only display locally-mounted file systems]'
-    '-n[use previously obtained statistics]'
-    '*:files:_files'
-  )
-  spec='[only display file systems of specified types]:file system type:->fslist'
-  case "$OSTYPE" in
-    (darwin*)
-      args+=(
-        "-T+$spec"
-#       '-t[same as -T (obsolete)]:file system type:->fslist'
-      )
-      ;;
-    (freebsd*|dragonfly*)
-      args+=( "-t+$spec" '-T[include file system type]' )
-      ;;
-  esac
-else
-  # POSIX
-  args=(
-    '-k[use 1024-byte blocks]'
-    '-P[POSIX compliant output]'
-    '-t[include total allocated-space figures in the output]'
-    '*:files:_files'
-  )
-fi
-
-_arguments -s -S : $args && return 0
-
-case "$state" in
-  (fslist)
-    local -a fsys used pre disp expl
-    _file_systems -U -O fsys
-    pre=$IPREFIX
-    # offer 'no' only if at the beginning of the list
-    if ! compset -P '*,' && ! compset -P 'no'; then
-      disp=( 'no  -- exclude file system types in the list' )
-      _wanted list-prefix expl 'prefix to list' compadd -d disp 'no'
-    fi
-    used=( ${(s:,:)${${IPREFIX#$pre}#no}} )
-    _wanted fsys-types expl "$state_descr" compadd -qS , -F used -a fsys
-    ;;
-esac
diff -ruN zsh-5.0.4/Completion/Unix/Command/_django zsh-5.0.2/Completion/Unix/Command/_django
--- zsh-5.0.4/Completion/Unix/Command/_django	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_django	2010-01-04 12:44:00.000000000 -0800
@@ -59,7 +59,7 @@
     )
 
     for cmd in $(./manage.py --help 2>&1 >/dev/null | \
-        awk -v drop=1 '{ if (!drop) print substr($0, 3) } /^Available subcommands/ { drop=0 }')
+        awk -vdrop=1 '{ if (!drop) print substr($0, 3) } /^Available subcommands/ { drop=0 }')
     do
         if ! echo $subcommands | grep -qs "${cmd}:"
         then
diff -ruN zsh-5.0.4/Completion/Unix/Command/_du zsh-5.0.2/Completion/Unix/Command/_du
--- zsh-5.0.4/Completion/Unix/Command/_du	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_du	2011-01-06 11:29:43.000000000 -0800
@@ -47,24 +47,6 @@
 
   return ret
 
-elif [[ "$OSTYPE" == darwin* ]]; then
-  _arguments -s -A "-*" \
-    '(-H -L -P)-H[follow symlinks on the command line]' \
-    '(-H -L -P)-L[follow all symlinks]' \
-    '(-H -L -P)-P[do not follow symlinks (default)]' \
-    '*-I+[ignore files/directories matching specified mask]:mask' \
-    '(-a -s -d)-a[display entry also for files (not just directories) in file hierarchy]' \
-    '(-a -s -d)-d+[display entry for directories up to specified depth]:depth' \
-    '(-a -s -d)-s[display entry only for files/directories specified on the command line]' \
-    '(-h -k -m -g)-h[human readable output]' \
-    '(-h -k -m -g)-k[use block size of 1K-byte]' \
-    '(-h -k -m -g)-m[use block size of 1M-byte]' \
-    '(-h -k -m -g)-g[use block size of 1G-byte]' \
-    '-c[display grand total]' \
-    '-r[notify about unreadable files/directories]' \
-    '-x[exclude directories on different file systems]' \
-    '*:file:_files'
-
 else
   # based on $OSTYPE = solaris2.8
   local xdev='[skip directories on different filesystems]'
diff -ruN zsh-5.0.4/Completion/Unix/Command/_etags zsh-5.0.2/Completion/Unix/Command/_etags
--- zsh-5.0.4/Completion/Unix/Command/_etags	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_etags	1969-12-31 16:00:00.000000000 -0800
@@ -1,63 +0,0 @@
-#compdef etags
-
-integer ret=1
-local context state line expl
-typeset -A opt_args
-
-_arguments \
-  '(-a --append)'{-a,--append}'[append tag entries]' \
-  '--packages-only[only generate tags for Ada packages]' \
-  '--declarations[C etc.: tags for function declarations]' \
-  '(-D --no-defines)'{-D,--no-defines}'[No tags for preprocessor definitions]' \
-  {-i-,--include=}'[Tag file should include another]:tag file:_files' \
-  {-l-,--language=}'[Specify language]:language:->lang' \
-  '--no-globals[No tag entries for global variables]' \
-  '--no-members[No tag entries for structure members]' \
-  {-r-,--regex=}'[Specify regular expression]:regular expression:->regex' \
-  {-R,--no-regex}'[No regular expressions for tags]' \
-  '(-I --ignore-indentation)'{-I,--ignore-indentation}'[Closing brace in first col may not be start of func]' \
-  '(-o --output)'{-o-,--output=}'[Specify output file]:file:_files' \
-  '--parse-stdin=[Specify file name for stdin]:file name:_files' \
-  '(-V --version)'{-V,--version}'[Output version]' \
-  '(-h --help)'{-h,--help}'[Output help]' \
-  '*:file to tag:_files' \
-  && ret=0
-
-case $state in
-  (lang)
-  local -a langs
-  langs=(${${${${(f)"$(etags --help)"}:#^  [^[:blank:]]##[[:blank:]]##([[:alnum:].]*|)}#  }%%[[:blank:]]*})
-  _wanted languages expl language compadd -a langs && ret=0
-  ;;
-
-  (regex)
-  if compset -P @; then
-    _files && ret=0
-  elif [[ -n $PREFIX ]]; then
-    local sep=$PREFIX[1]
-    [[ $sep = [\\*?#] ]] && sep="\\$sep"
-    local -a match mbegin mend
-    if compset -P "$sep*$sep*$sep"; then
-      local mods=smi
-      mods=${mods//[${PREFIX}]}
-      if [[ -n $mods ]]; then
-	compset -P '*'
-	local -a modarr
-	[[ $mods = *i* ]] && modarr+=("i:ignore case")
-	[[ $mods = *m* ]] && modarr+=("m:allow multi-line matches")
-	[[ $mods = *s* ]] && modarr+=("s:multi-line, dot matches newline")
-	_describe -t modifiers modifier modarr && ret=0
-      fi
-    elif compset -P "$sep*$sep"; then
-      _message "tagname" && ret=0
-    else
-      compset -P "$sep"
-      _message "tag regexp" && ret=0
-    fi
-  else
-    _message "regexp separator or @ for file" && ret=0
-  fi
-  ;;
-esac
-
-return ret
diff -ruN zsh-5.0.4/Completion/Unix/Command/_git zsh-5.0.2/Completion/Unix/Command/_git
--- zsh-5.0.4/Completion/Unix/Command/_git	2013-12-01 10:17:37.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_git	2012-11-09 13:45:56.000000000 -0800
@@ -64,9 +64,8 @@
     '(-i --interactive : -)'{-i,--interactive}'[add contents interactively to index]' \
     '(-p --patch)'{-p,--patch}'[like -i but go directly into patch mode for specified files]' \
     '(-e --edit)'{-e,--edit}'[open diff against index in editor]' \
-    '(-A --all --no-ignore-removal -u --update --no-all --ignore-removal)'{-A,--all,--no-ignore-removal}'[add, modify, and remove index entries to match the working tree]' \
-    '(-A --all --no-ignore-removal -u --update --no-all --ignore-removal)'{--no-all,--ignore-removal}'[like "--all" but ignore removals]' \
-    '(-A --all --no-ignore-removal -u --update --no-all --ignore-removal)'{-u,--update}'[update the index just where it already has an entry matching <pathspec>]' \
+    '(-u --update -A --all)'{-u,--update}'[update only files git already knows about]' \
+    '(-A --all -u --update)'{-A,--all}'[act as both add . and add -u]' \
     '(-N --intent-to-add)'{-N,--intent-to-add}'[record only that path will be added later]' \
     '--refresh[do not add files, but refresh their stat() info in index]' \
     '--ignore-errors[continue adding if an error occurs]' \
@@ -105,7 +104,6 @@
   _arguments -S \
     '(-s --signoff)'{-s,--signoff}'[add Signed-off-by: line to the commit message]' \
     '(-k --keep)'{-k,--keep}'[pass -k to git mailinfo]' \
-    '--keep-non-patch[pass -b to git mailinfo]' \
     '(          --no-keep-cr)--keep-cr[pass --keep-cr to git mailsplit]' \
     '(--keep-cr             )--no-keep-cr[do not pass --keep-cr to git mailsplit]' \
     '(-c --scissors --no-scissors)'{-c,--scissors}'[strip everything before a scissors line]' \
@@ -279,13 +277,12 @@
 
 (( $+functions[_git-branch] )) ||
 _git-branch () {
-  declare l c m d e
+  declare l c m d
 
-  l='--color --no-color -r -a -v --verbose --abbrev --no-abbrev --list'
-  c='-l -f --force -t --track --no-track -u --set-upstream --set-upstream-to --unset-upstream --contains --merged --no-merged'
-  m='-m --move -M'
-  d='-d --delete -D'
-  e='--edit-description'
+  l='--color --no-color -r -a -v --verbose --abbrev --no-abbrev'
+  c='-l -f --force -t --track --no-track --set-upstream --contains --merged --no-merged'
+  m='-m -M'
+  d='-d -D'
 
   declare -a dependent_creation_args
   if (( words[(I)-r] == 0 )); then
@@ -315,33 +312,27 @@
   fi
 
   _arguments -w -S -s \
-    "($c $m $d $e --no-color :)--color=-[turn on branch coloring]:: :__git_color_whens" \
-    "($c $m $d $e : --color)--no-color[turn off branch coloring]" \
-    "($c $m $d $e --no-column)"'--column=[display tag listing in columns]:column.branch option:((always\:"always show in columns" never\:"never show in columns" auto\:"show in columns if the output is to the terminal" column\:"fill columns before rows (default)" row\:"fill rows before columns" plain\:"show in one column" dense\:"make unequal size columns to utilize more space" nodense\:"make equal size columns"))' \
-    "($c $m $d $e --column)"'--no-column[do not display in columns]' \
-    "($c $m $d $e )*--list[list only branches matching glob]:pattern" \
-    "($c $m    $e  -a)-r[list or delete only remote-tracking branches]" \
-    "($c $m $d $e: -r)-a[list both remote-tracking branches and local branches]" \
-    "($c $m $d $e : -v -vv --verbose)"{-v,-vv--verbose}'[show SHA1 and commit subject line for each head]' \
-    "($c $m $d $e :)--abbrev=[set minimum SHA1 display-length]: :__git_guard_number length" \
-    "($c $m $d $e :)--no-abbrev[do not abbreviate sha1s]" \
-    "($l $m $d $e)-l[create the branch's reflog]" \
-    "($l $m $d $e -f --force)"{-f,--force}"[force the creation of a new branch]" \
-    "($l $m $d $e -t --track)"{-t,--track}"[set up configuration so that pull merges from the start point]" \
-    "($l $m $d $e)--no-track[override the branch.autosetupmerge configuration variable]" \
-    "($l $m $d $e -u --set-upstream --set-upstream-to --unset-upstream)"{-u,--set-upstream-to=}"[set up configuration so that pull merges]:remote-branches:__git_remote_branch_names" \
-    "($l $m $d $e -u --set-upstream --set-upstream-to --unset-upstream)--unset-upstream[remove upstream configuration]" \
-    "($l $m $d $e)--contains=[only list branches which contain the specified commit]: :__git_committishs" \
-    "($l $m $d $e)--merged=[only list branches which are fully contained by HEAD]: :__git_committishs" \
-    "($l $m $d $e)--no-merged=[do not list branches which are fully contained by HEAD]: :__git_committishs" \
-    "($c $l $m $d)--edit-description[edit branch description]" \
+    "($c $m $d --no-color :)--color=-[turn on branch coloring]:: :__git_color_whens" \
+    "($c $m $d : --color)--no-color[turn off branch coloring]" \
+    "($c $m      -a)-r[list or delete only remote-tracking branches]" \
+    "($c $m $d : -r)-a[list both remote-tracking branches and local branches]" \
+    "($c $m $d : -v --verbose)"{-v,--verbose}'[show SHA1 and commit subject line for each head]' \
+    "($c $m $d :)--abbrev=[set minimum SHA1 display-length]: :__git_guard_number length" \
+    "($c $m $d :)--no-abbrev[do not abbreviate sha1s]" \
+    "($l $m $d)-l[create the branch's reflog]" \
+    "($l $m $d -f --force)"{-f,--force}"[force the creation of a new branch]" \
+    "($l $m $d -t --track)"{-t,--track}"[set up configuration so that pull merges from the start point]" \
+    "($l $m $d)--no-track[override the branch.autosetupmerge configuration variable]" \
+    "($l $m $d)--set-upstream[set up configuration so that pull merges]" \
+    "($l $m $d)--contains=[only list branches which contain the specified commit]: :__git_committishs" \
+    "($l $m $d)--merged=[only list branches which are fully contained by HEAD]: :__git_committishs" \
+    "($l $m $d)--no-merged=[do not list branches which are fully contained by HEAD]: :__git_committishs" \
     $dependent_creation_args \
-    "($l $c $d $m $e)"{-m,--move}"[rename a branch and the corresponding reflog]" \
-    "($l $c $d $m $e)-M[rename a branch even if the new branch-name already exists]" \
+    "($l $c $d -M)-m[rename a branch and the corresponding reflog]" \
+    "($l $c $d -m)-M[rename a branch even if the new branch-name already exists]" \
     $dependent_modification_args \
-    "($l $c $m $d $e)"{-d,--delete}"[delete a fully merged branch]" \
-    "($l $c $m $d $e)-D[delete a branch]" \
-    {-q,--quiet}"[be more quiet]" \
+    "($l $c $m -D)-d[delete a fully merged branch]" \
+    "($l $c $m -d)-D[delete a branch]" \
     $dependent_deletion_args
 }
 
@@ -399,23 +390,6 @@
   return ret
 }
 
-(( $+functions[_git-check-ignore] )) ||
-_git-check-ignore () {
-  _arguments \
-    '(-q --quiet)'{-q,--quiet}'[do not output anything, just set exit status]' \
-    '(-v --verbose)'{-v,--verbose}'[output details about the matching pattern (if any) for each pathname]' \
-    '--stdin[read file names from stdin instead of from the command-line]' \
-    '-z[make output format machine-parseable]' \
-    '(-n --non-matching)'{-n,--non-matching}'[show given paths which do not match any pattern]' \
-    '*:: :->file' && ret=0
-}
-
-(( $+functions[_git-check-mailmap] )) ||
-_git-check-mailmap () {
-  _arguments \
-    '--stdin[read contacts from stdin after those given on the command line]'
-}
-
 (( $+functions[_git-checkout] )) ||
 _git-checkout () {
   # TODO: __git_tree_ishs is just stupid.  It should be giving us a list of tags
@@ -440,7 +414,6 @@
     '(--patch)--no-track[override the branch.autosetupmerge configuration variable]' \
     $new_branch_reflog_opt \
     '(-b -B -t --track --patch)--orphan[create a new orphan branch based at given commit]: :__git_branch_names' \
-    '--ignore-skip-worktree-bits[ignores patterns and adds back any files in <paths>]' \
     '(-q --quiet -f --force -m --merge --conflict --patch)'{-m,--merge}'[3way merge current branch, working tree and new branch]' \
     '(-q --quiet -f --force -m --merge --patch)--conflict[same as --merge, using given merge style]:style:(merge diff3)' \
     '(-)'{-p,--patch}'[interactively select hunks in diff between given tree-ish and working tree]' \
@@ -449,35 +422,30 @@
 
   case $state in
     (branch-or-tree-ish-or-file)
-      # TODO: Something about *:: brings us here when we complete at "-".  I
+      # TODO: Something about *:: brings us here when we complete at ‚Äú-‚Äù.  I
       # guess that this makes sense in a way, as we might want to treat it as
-      # an argument, but I can't find anything in the documentation about this
+      # an argument, but I can‚Äôt find anything in the documentation about this
       # behavior.
       [[ $line[CURRENT] = -* ]] && return
       if (( CURRENT == 1 )) && [[ -z $opt_args[(I)--] ]]; then
         # TODO: Allow A...B
         local branch_arg='branches::__git_revisions' \
-              remote_branch_noprefix_arg='remote branches::__git_remote_branch_names_noprefix' \
               tree_ish_arg='tree-ishs::__git_tree_ishs' \
               file_arg='modified-files::__git_modified_files'
 
         if [[ -n ${opt_args[(I)-b|-B|--orphan]} ]]; then
-          remote_branch_noprefix_arg=
           tree_ish_arg=
           file_arg=
         elif [[ -n $opt_args[(I)--track] ]]; then
           branch_arg='remote-branches::__git_remote_branch_names'
-          remote_branch_noprefix_arg=
           tree_ish_arg=
           file_arg=
         elif [[ -n ${opt_args[(I)--ours|--theirs|-m|--conflict|--patch]} ]]; then
           branch_arg=
-          remote_branch_noprefix_arg=
         fi
 
         _alternative \
           $branch_arg \
-          $remote_branch_noprefix_arg \
           $tree_ish_arg \
           $file_arg && ret=0
       elif [[ -n ${opt_args[(I)-b|-B|-t|--track|--orphan]} ]]; then
@@ -496,18 +464,11 @@
 (( $+functions[_git-cherry-pick] )) ||
 _git-cherry-pick () {
   _arguments \
-    '(- :)--quit[end revert or cherry-pick sequence]' \
-    '(- :)--continue[resume revert or cherry-pick sequence]' \
-    '(- :)--abort[cancel revert or cherry-pick sequence]' \
-    '--allow-empty-message[allow replaying a commit with an empty message]' \
-    '--keep-redundant-commits[keep cherry-picked commits that will become empty]' \
     '(-e --edit --ff)'{-e,--edit}'[edit commit before committing the revert]' \
     '(--ff)-x[append information about what commit was cherry-picked]' \
     '(-m --mainline)'{-m,--mainline}'[specify mainline when cherry-picking a merge commit]:parent number' \
     '(-n --no-commit --ff)'{-n,--no-commit}'[do not make the actually commit]' \
     '(-s --signoff --ff)'{-s,--signoff}'[add Signed-off-by line at the end of the commit message]' \
-    '*'{-s,--strategy=}'[use given merge strategy]:merge strategy:__git_merge_strategies' \
-    '*'{-X,--strategy-option=}'[pass merge-strategy-specific option to merge strategy]' \
     '(-e --edit -x -n --no-commit -s --signoff)--ff[fast forward, if possible]' \
     ': :__git_revisions'
 }
@@ -525,7 +486,6 @@
   _arguments -w -C -S -s \
     '-d[also remove untracked directories]' \
     '(-f --force)'{-f,--force}'[required when clean.requireForce is true (default)]' \
-    '(-i --interactive)'{-i,--interactive}'[show what would be done and clean files interactively]' \
     '(-n --dry-run)'{-n,--dry-run}'[only show what would and what would not be removed]' \
     '(-q --quiet)'{-q,--quiet}'[only report errors]' \
     '*'{-e,--exclude=}'[skip files matching specified pattern]:pattern' \
@@ -583,8 +543,7 @@
   # TODO: Argument to -b should complete branch names in the repository being
   # cloned.
   _arguments -w -C -S -s \
-    '(-l --local --no-local)'{-l,--local}'[clone locally, hardlink refs and objects if possible]' \
-    '(-l --local --no-local)--no-local[override --local, as if file:/// URL was given]' \
+    '(-l --local)'{-l,--local}'[clone locally, hardlink refs and objects if possible]' \
     '--no-hardlinks[copy files instead of hardlinking when doing a local clone]' \
     '(-s --shared)'{-s,--shared}'[share the objects with the source repository (warning: see man page)]' \
     '--reference[reference repository]:repository:_directories' \
@@ -598,9 +557,7 @@
     '(-b --branch)'{-b,--branch}'[point HEAD to the given branch]: :__git_guard_branch-name' \
     '(-u --upload-pack)'{-u,--upload-pack=}'[specify path to git-upload-pack on remote side]:remote path' \
     '--template=[directory to use as a template for the object database]: :_directories' \
-    '*'{-c,--config}'[<key>=<value> set a configuration variable in the newly created repository]' \
     '--depth[create a shallow clone, given number of revisions deep]: :__git_guard_number depth' \
-    '--single-branch[clone only history leading up to the main branch or the one specified by -b]' \
     '--recursive[initialize all contained submodules]' \
     ': :->repository' \
     ': :_directories' && ret=0
@@ -618,18 +575,6 @@
   return ret
 }
 
-(( $+functions[_git-column] )) ||
-_git-column () {
-  _arguments -w -S -s \
-    '--command=[look up layout mode using config vars column.<name> and column.ui]' \
-    '--mode=[specify layout mode. See configuration variable column.ui for option syntax]' \
-    '--raw-mode=[same as --mode but take mode encoded as a number]' \
-    '--width=[specify the terminal width]' \
-    '--indent=[string to be printed at the beginning of each line]' \
-    '--nl[string to be printed at the end of each line, including newline character]' \
-    '--padding[the number of spaces between columns. One space by default]'
-}
-
 (( $+functions[_git-commit] )) ||
 _git-commit () {
   local amend_opt='--amend[amend the tip of the current branch]'
@@ -642,29 +587,25 @@
     reset_author_opt='(--author)--reset-author[make committer the author of the commit]'
   fi
 
-  # TODO: --interactive isn't explicitly listed in the documentation.
+  # TODO: --null is an undocumented alias.
+  # TODO: --interactive isn‚Äôt explicitly listed in the documentation.
   _arguments -w -S -s \
     '(-a --all --interactive -o --only -i --include *)'{-a,--all}'[stage all modified and deleted paths]' \
-    '--fixup=[construct a commit message for use with rebase --autosquash]:' \
-    '--squash=[construct a commit message for use with rebase --autosquash]:' \
     $reset_author_opt \
     '(        --porcelain --dry-run)--short[output dry run in short format]' \
     '(--short             --dry-run)--porcelain[output dry run in porcelain-ready format]' \
     '(--short --porcelain --dry-run -z --null)'{-z,--null}'[separate dry run entry output with NUL]' \
-    '--patch[use the interactive patch selection interface to chose which changes to commit]' \
     '(--reset-author)--author[override the author name used in the commit]:author name' \
     '--date=[override the author date used in the commit]:date' \
     '(-s --signoff)'{-s,--signoff}'[add Signed-off-by line at the end of the commit message]' \
     '(-n --no-verify)'{-n,--no-verify}'[do not look for suspicious lines the commit introduces]' \
     '--allow-empty[allow recording an empty commit]' \
     '--allow-empty-message[allow recording a commit with an empty message]' \
-    '--cleanup=[specify how the commit message should be cleaned up]:mode:((verbatim\:"do not change the commit message at all"
+    '--cleanup=[specify how the commit message should be cleaned up]:mode:((verbatim\:"don'\''t change the commit message at all"
                                                                             whitespace\:"remove leading and trailing whitespace lines"
                                                                             strip\:"remove both whitespace and commentary lines"
                                                                             default\:"act as '\''strip'\'' if the message is to be edited and as '\''whitespace'\'' otherwise"))' \
-    '(-e --edit --no-edit)'{-e,--edit}'[edit the commit message before committing]' \
-    '(-e --edit --no-edit)--no-edit[do not edit the commit message before committing]' \
-    '--no-post-rewrite[bypass the post-rewrite hook]' \
+    '(-e --edit)'{-e,--edit}'[edit the commit message before committing]' \
     '(-a --all --interactive -o --only -i --include)'{-i,--include}'[update the given files and commit the whole index]' \
     '(-a --all --interactive -o --only -i --include)'{-o,--only}'[commit only the given files]' \
     '(-u --untracked-files)'{-u-,--untracked-files=}'[show files in untracked directories]::mode:((no\:"show no untracked files"
@@ -675,7 +616,6 @@
     '--dry-run[only show list of paths that are to be commited or not, and any untracked]' \
     '(         --no-status)--status[include the output of git status in the commit message template]' \
     '(--status            )--no-status[do not include the output of git status in the commit message template]' \
-    '(-S --gpg-sign)'{-S-,--gpg-sign=}'[GPG-sign the commit]::key id' \
     '(-a --all --interactive -o --only -i --include *)--interactive[interactively update paths in the index file]' \
     '*: :__git_ignore_line_inside_arguments __git_changed_files' \
     - '(message)' \
@@ -701,7 +641,6 @@
     '(--abbrev)--long[always show full format, even for exact matches]' \
     '--match=[only consider tags matching glob pattern]:pattern' \
     '--always[show uniquely abbreviated commit object as fallback]' \
-    '--first-parent[follow only the first parent of merge commits]' \
     '*: :__git_committishs'
 }
 
@@ -849,18 +788,14 @@
     '(--thread            )--no-thread[do not thread messages]' \
     '--in-reply-to=[make the first mail a reply to the given message]:message id' \
     '--ignore-if-in-upstream[do not include a patch that matches a commit in the given range]' \
-    '(-v --reroll-count)'{-v,--reroll-count=}'[mark the series as the <n>-th iteration of the topic]: :__git_guard_number iteration' \
     '(-k --keep-subject)--subject-prefix=[use the given prefix instead of \[PATCH\]]:prefix' \
     '*--to=[add To: header to email headers]: :_email_addresses' \
     '*--cc=[add Cc: header to email headers]: :_email_addresses' \
-    '--from=[add From: header to email headers]: :_email_addresses' \
     '*--add-header=[add an arbitrary header to email headers]:header' \
     '--cover-letter[generate a cover letter template]' \
-    '--notes=[append notes for the commit after the three-dash line]:: :__git_notes_refs' \
     '(            --no-signature)--signature=[add a signature]:signature' \
     '(--signature               )--no-signature[do not add a signature]' \
     '--suffix=[use the given suffix for filenames]:filename suffix' \
-    '--quiet[suppress the output of the names of generated files]' \
     '--no-binary[do not output contents of changes in binary files, only note that they differ]' \
     '--root[treat the revision argument as a range]' \
     ': :->commit-or-commit-range' && ret=0
@@ -907,23 +842,19 @@
   _arguments -C -A '-*' \
     '(-O --open-files-in-pager --no-index)--cached[search blobs registered in index file instead of working tree]' \
     '(--cached)--no-index[search files in current directory, not just treacked files]' \
-    '(--exclude-standard)--no-exclude-standard[also search in ignored files]' \
-    '(--no-exclude-standard)--exclude-standard[exclude files standard ignore mechanisms]' \
-    '--untracked[search in untracked files]' \
     '(-a --text)'{-a,--text}'[process binary files as if they were text]' \
     '(-i --ignore-case)'{-i,--ignore-case}'[ignore case when matching]' \
     '-I[do not match pattern in binary files]' \
-    '--max-depth=[descend at most given levels of directories]: :__git_guard_number depth' \
+    '--max-depth=[descend at most given levels of directories]:__git_guard_number depth' \
     '(-w --word-regexp)'{-w,--word-regexp}'[match only whole words]' \
     '(-v --invert-match)'{-v,--invert-match}'[select non-matching lines]' \
     '(   -H)-h[supress output of filenames]' \
     '(-h   )-H[show filenames]' \
     '--full-name[output paths relative to the project top directory]' \
-    '(-E --extended-regexp -G --basic-regexp -P --perl-regexp -F --fixed-strings)'{-E,--extended-regexp}'[use POSIX extended regexes]' \
-    '(-E --extended-regexp -G --basic-regexp -P --perl-regexp -F --fixed-strings)'{-G,--basic-regexp}'[use POSIX basic regexes]' \
-    '(-E --extended-regexp -G --basic-regexp -P --perl-regexp -F --fixed-strings)'{-P,--perl-regexp}'[use perl-compatible regexes]' \
-    '(-E --extended-regexp -G --basic-regexp -P --perl-regexp -F --fixed-strings)'{-F,--fixed-strings}'[do not interpret pattern as a regex]' \
-    '(-n --line-number)'{-n,--line-number}'[prefix the line number to matching lines]' \
+    '(-E --extended-regexp -G --basic-regexp)'{-E,--extended-regexp}'[use POSIX extended regexes]' \
+    '(-E --extended-regexp -G --basic-regexp)'{-G,--basic-regexp}'[use POSIX basic regexes]' \
+    '(-F --fixed-strings)'{-F,--fixed-strings}'[do not interpret pattern as a regex]' \
+    '-n[prefix the line number to matching lines]' \
     '(-l --files-with-matches -L --files-without-match --name-only)'{-l,--files-with-matches,--name-only}'[show only names of matching files]' \
     '(-l --files-with-matches -L --files-without-match)'{-L,--files-without-match}'[show only names of non-matching files]' \
     '(--cached -O --open-files-in-pager)'{-O,--open-files-in-pager}'=-[open matching files in pager]::_path_commands' \
@@ -931,13 +862,10 @@
     '(-c --count)'{-c,--count}'[show number of matching lines in files]' \
     '(        --no-color)--color=-[color matches]:: :__git_color_whens' \
     '(--color           )---no-color[do not color matches]' \
-    '--break[prefix the line number to matching lines]' \
-    '--heading[show the filename above the matches]' \
-    '(-A --after-context)'{-A,--after-context=}'[show <num> trailing lines, and separate groups of matches]: :__git_guard_number lines' \
-    '(-B --before-context)'{-B,--before-context=}'[show <num> leading lines, and separate groups of matches]: :__git_guard_number lines' \
-    '(-A --after-context -B --before-context -C --context)'{-C,--context=}'[show <num> leading and trailing lines, and separate groups of matches]: :__git_guard_number lines' \
+    '-A[show trailing context]: :__git_guard_number lines' \
+    '-B[show leading context]: :__git_guard_number lines' \
+    '-C[show context]: :__git_guard_number lines' \
     '(-p --show-function)'{-p,--show-function}'[show preceding line containing function name of match]' \
-    '(-W --function-context)'{-W,--function-context}'[show whole function where a match was found]' \
     '(1)*-f[read patterns from given file]:pattern file:_files' \
     '(1)*-e[use the given pattern for matching]:pattern' \
     $pattern_operators \
@@ -946,7 +874,7 @@
     '*:: :->tree-or-file' && ret=0
 
   # TODO: If --cached, --no-index, -O, or --open-files-in-pager was given,
-  # don't complete treeishs.
+  # don‚Äôt complete treeishs.
   case $state in
     (tree-or-file)
       integer first_tree last_tree start end
@@ -1051,7 +979,6 @@
     '--bare[create a bare repository]' \
     '--template=[directory to use as a template for the object database]: :_directories' \
     '--shared=[share repository amongst several users]:: :__git_repository_permissions' \
-    '--separate-git-dir=[create git dir elsewhere and link it using the gitdir mechanism]:: :_directories' \
     ':: :_directories'
 }
 
@@ -1069,7 +996,6 @@
     $log_options \
     $revision_options \
     $diff_options \
-    '-L+[trace the evolution of a line range or regex within a file]:range' \
     '(-)--[start file arguments]' \
     '*:: :->commit-range-or-file' && ret=0
 
@@ -1113,7 +1039,6 @@
     '-m[set the commit message to be used for the merge commit]:merge message' \
     '(                    --no-rerere-autoupdate)--rerere-autoupdate[allow the rerere mechanism to update the index]' \
     '(--rerere-autoupdate                       )--no-rerere-autoupdate[do not allow the rerere mechanism to update the index]' \
-    '--abort[restore the original branch and abort the merge operation]' \
     '*: :__git_commits'
 }
 
@@ -1160,7 +1085,6 @@
         copy:'copy notes from one object to another'
         append:'append notes to a given object'
         edit:'edit notes for a given object'
-        merge:'merge the given notes ref into the current ref'
         show:'show notes for a given object'
         remove:'remove notes for a given object'
         prune:'remove all notes for non-existing/unreachable objects')
@@ -1176,7 +1100,7 @@
             ': :__git_commits' && ret=0
           ;;
         (add)
-          # TODO: Only complete commits that don't have notes already, unless
+          # TODO: Only complete commits that don‚Äôt have notes already, unless
           # -f or --force has been given.
           _arguments -w -S -s \
             '*'{-m,--message=}'[use given note message]:message' \
@@ -1195,15 +1119,6 @@
             ': :__git_commits' \
             ': :__git_commits' && ret=0
           ;;
-        (merge)
-          _arguments -w -S -s \
-            '(-s --strategy)--abort[abort an in-progress notes merge]' \
-            '(-s --strategy)--commit[finalize an in-progress notes merge]' \
-            {-q,--quiet}'[be quiet]' \
-            {-v,--verbose}'[be more verbose]' \
-            '(--abort --commit)'{-s,--strategy=}'[resolve conflicts using the given strategy]' \
-            ': :__git_notes_refs' && ret=0
-          ;;
         (append)
           _arguments -w -S -s \
             '*'{-m,--message=}'[use given note message]:message' \
@@ -1245,25 +1160,20 @@
   # later on to match the remote end.
   _arguments -w -S -s \
     '--all[push all refs under refs/heads/]' \
-    '--prune[remove remote branches that do not have a local counterpart]' \
     '--mirror[push all refs under refs/heads/ and refs/tags/ and delete non-existing refs]' \
     '(-n --dry-run)'{-n,--dry-run}'[do everything except actually send the updates]' \
     '--porcelain[produce machine-readable output]' \
     '--delete[delete all listed refs from the remote repository]' \
     '--tags[all tags under refs/tags are pushed]' \
-    '--follow-tags[also push missing annotated tags reachable from the pushed refs]' \
     '(--receive-pack --exec)'{--receive-pack=-,--exec=-}'[path to git-receive-pack on remote]:remote git-receive-pack:_files' \
     '(-f --force)'{-f,--force}'[allow refs that are not ancestors to be updated]' \
     '(:)--repo=[default repository to use]:repository:__git_any_repositories' \
-    '(-u --set-upstream-to)'{-u,--set-upstream-to}'[add upstream reference for each branch that is up to date or pushed]' \
+    '(-u --set-upstream)'{-u,--set-upstream}'[add upstream reference for each branch that is up to date or pushed]' \
     '(       --no-thin)--thin[try to minimize number of objects to be sent]' \
     '(--thin          )--no-thin[do not try to minimize number of objects to be sent]' \
     '(-q --quiet -v --verbose --progress)'{-q,--quiet}'[suppress all output]' \
     '(-q --quiet -v --verbose)'{-v,--verbose}'[output additional information]' \
     '(-q --quiet)--progress[output progress information]' \
-    '(--verify)--no-verify[bybass the pre-push hook]' \
-    '--recurse-submodules=[submodule handling]:submodule handling:((check\:"refuse pushing of supermodule if submodule commit cannot be found on the remote"
-                                                                    on-demand\:"push all changed submodules"))' \
     ':: :__git_any_repositories' \
     '*: :__git_ref_specs'
 }
@@ -1272,7 +1182,7 @@
 _git-rebase () {
   local -a autosquash_opts
 
-  if (( words[(I)-i|--interactive] )); then
+  if (( words[(I)--interactive] )); then
     autosquash_opts=(
       '(             --no-autosquash)--autosquash[check for auto-squash boundaries]'
       '(--autosquash                )--no-autosquash[do not check for auto-squash boundaries]')
@@ -1281,7 +1191,6 @@
   _arguments -A '-*' \
     '(- :)--continue[continue after resolving merge conflict]' \
     '(- :)--abort[abort current rebase]' \
-    '--keep-empty[keep empty commits in the result]' \
     '(- :)--skip[skip the current patch]' \
     '(-m --merge)'{-m,--merge}'[use merging strategies to rebase]' \
     '*'{-s,--strategy=}'[use given merge strategy]:merge strategy:__git_merge_strategies' \
@@ -1295,9 +1204,7 @@
     '(-i --interactive)--whitespace=-[detect a new or modified line that has whitespace errors]: :__git_apply_whitespace_strategies' \
     '(-i --interactive)--committer-date-is-author-date[use author date as committer date]' \
     '(-i --interactive --ignore-whitespace --whitespace --committer-date-is-author-date)'{-i,--interactive}'[make a list of commits to be rebased and open in $EDITOR]' \
-    '--edit-todo[edit interactive instruction sheet in an editor]' \
     '(-p --preserve-merges --interactive)'{-p,--preserve-merges}'[try to recreate merges instead of ignoring them]' \
-    {-x,--exec}'[with -i\: append "exec <cmd>" after each line]:command' \
     '(1)--root[rebase all reachable commits]' \
     $autosquash_opts \
     '--no-ff[cherry-pick all rebased commits with --interactive, otherwise synonymous to --force-rebase]' \
@@ -1339,12 +1246,9 @@
 (( $+functions[_git-revert] )) ||
 _git-revert () {
   _arguments -w -S -s \
-    '(- :)--quit[end revert or cherry-pick sequence]' \
-    '(- :)--continue[resume revert or cherry-pick sequence]' \
-    '(- :)--abort[cancel revert or cherry-pick sequence]' \
     '(-e --edit --no-edit)'{-e,--edit}'[edit the commit before committing the revert]' \
-    '(-e --edit --no-edit)--no-edit[do not edit the commit message before committing the revert]' \
     '(-m --mainline)'{-m+,--mainline=}'[pick which parent is mainline]:parent number' \
+    '(-e --edit)--no-edit[do not edit the commit message]' \
     '(-n --no-commit)'{-n,--no-commit}'[do not commit the reversion]' \
     '(-s --signoff)'{-s,--signoff}'[add Signed-off-by line at the end of the commit message]' \
     ': :__git_commits'
@@ -1366,7 +1270,11 @@
 
   case $state in
     (file)
-      __git_cached_files && ret=0
+      if [[ -n ${opt_args[(I)--cached]} ]]; then
+        __git_changed-in-index_files && ret=0
+      else
+        __git_cached_files && ret=0
+      fi
       ;;
   esac
 
@@ -1390,8 +1298,7 @@
     '(-e --email)'{-e,--email}'[show email addres of each author]' \
     '-w-[linewrap the output]:: :->wrap' \
     $revision_options \
-    '(-)--[start file arguments]' \
-    '*:: :->commit-range-or-file' && ret=0
+    '*: :__git_commits' && ret=0
 
   case $state in
     (wrap)
@@ -1407,30 +1314,6 @@
         __git_guard_number 'line width'
       fi
       ;;
-    (commit-range-or-file)
-      case $CURRENT in
-        (1)
-          if [[ -n ${opt_args[(I)--]} ]]; then
-            __git_cached_files && ret=0
-          else
-            _alternative \
-              'commit-ranges::__git_commit_ranges' \
-              'cached-files::__git_cached_files' && ret=0
-          fi
-          ;;
-        (*)
-          # TODO: Write a wrapper function that checks whether we have a
-          # committish range or comittish and calls __git_tree_files
-          # appropriately.
-          if __git_is_committish_range $line[1]; then
-            __git_tree_files ${PREFIX:-.} $(__git_committish_range_last $line[1]) && ret=0
-          elif __git_is_committish $line[1]; then
-            __git_tree_files ${PREFIX:-.} $line[1] && ret=0
-          else
-            __git_cached_files && ret=0
-          fi
-          ;;
-      esac
   esac
 
   return ret
@@ -1441,10 +1324,9 @@
   local curcontext=$curcontext state line ret=1
   typeset -A opt_args
 
-  local -a log_options revision_options diff_options
+  local -a log_options revision_options
   __git_setup_log_options
   __git_setup_revision_options
-  __git_setup_diff_options
 
   _arguments -w -C -s \
     $log_options \
@@ -1500,7 +1382,6 @@
             '(             --no-keep-index)--keep-index[all changes already added to the index are left intact]' \
             '(--keep-index                )--no-keep-index[all changes already added to the index are undone]' \
             '(-q --quiet)'{-q,--quiet}'[suppress all output]' \
-            '(-u --include-untracked)'{-u,--include-untracked}'[include untracked files]' \
             '::message' && ret=0
           ;;
         (list)
@@ -1568,10 +1449,7 @@
                                                                                      normal\:"show untracked files and directories" \
                                                                                      all\:"also show untracked files in untracked directories (default)"))' \
     '--ignore-submodules[ignore changes to submodules]:: :__git_ignore_submodules_whens' \
-    '--ignored[show ignored files as well]' \
     '(--porcelain)-z[use NUL termination on output]' \
-    '(--no-column)--column=-[display in columns]::column.status option:((always\:"always show in columns" never\:"never show in columns" auto\:"show in columns if the output is to the terminal" column\:"fill columns before rows (default)" row\:"fill rows before columns" plain\:"show in one column" dense\:"make unequal size columns to utilize more space" nodense\:"make equal size columns"))' \
-    '(--column)--no-column[do not display in columns]' \
     '*: :__git_ignore_line_inside_arguments _files'
 }
 
@@ -1580,7 +1458,7 @@
   local curcontext=$curcontext state line ret=1
   declare -A opt_args
 
-  _arguments -C \
+  _arguments -C -A '-*' \
     '(-q --quiet)'{-q,--quiet}'[suppress all output]' \
     ': :->command' \
     '*:: :->option-or-argument' && ret=0
@@ -1593,7 +1471,6 @@
         add:'add given repository as a submodule'
         status:'show the status of a submodule'
         init:'initialize a submodule'
-        deinit:'unregister a submodule'
         update:'update a submodule'
         summary:'show commit summary between given commit and working tree/index'
         foreach:'evaluate shell command in each checked-out submodule'
@@ -1612,7 +1489,6 @@
             '(-q --quiet)'{-q,--quiet}'[suppress all output]' \
             '(-b --branch)'{-b,--branch}'[branch of repository to add as submodule]' \
             '(-f --force)'{-f,--force}'[allow adding an otherwise ignored submodule path]' \
-            '--name[use given name instead of defaulting to its path]:name' \
             '--reference=[remote repository to clone]: :__git_any_repositories' \
             ': :__git_any_repositories' \
             ':: :_directories' && ret=0
@@ -1629,11 +1505,6 @@
             '(-q --quiet)'{-q,--quiet}'[suppress all output]' \
             '*: :__git_ignore_line_inside_arguments __git_submodules' && ret=0
           ;;
-        (deinit)
-          _arguments -S \
-            '(-f --force)'{-f,--force}'[remove submodule worktree even if local modifications are present]' \
-            '*: :__git_ignore_line_inside_arguments __git_submodules' && ret=0
-          ;;
         (update)
           # TODO: --init not properly documented.
           _arguments -S \
@@ -1643,8 +1514,6 @@
             '--rebase[rebase current branch onto commit recorded in superproject]' \
             '--reference=[remote repository to clone]: :__git_any_repositories' \
             '--recursive[traverse submodules recursively]' \
-            '--remote[use the status of the submodule''s remote-tracking branch]' \
-            '--force[discard local changes by checking out the current up-to-date version]' \
             '--init[initialize uninitialized submodules]' \
             '*: :__git_ignore_line_inside_arguments __git_submodules' && ret=0
           ;;
@@ -1678,7 +1547,6 @@
           ;;
         (sync)
           _arguments -S \
-            '--recursive[traverse submodules recursively]' \
             '(-q --quiet)'{-q,--quiet}'[suppress all output]' \
             '*: :__git_ignore_line_inside_arguments __git_submodules' && ret=0
           ;;
@@ -1704,11 +1572,10 @@
 
   _arguments -A '-*' \
     - creation \
-      '(   -s -u --local-user)-a[create an unsigned, annotated tag]' \
-      '(-a    -u --local-user)-s[create an signed and annotated tag]' \
-      '(-a -s)'{-u,--local-user}'[create a tag, annotated and signed with the given key]: :__git_gpg_secret_keys' \
+      '(   -s -u)-a[create an unsigned, annotated tag]' \
+      '(-a    -u)-s[create an signed and annotated tag]' \
+      '(-a -s   )-u[create a tag, annotated and signed with the given key]: :__git_gpg_secret_keys' \
       '-f[replace existing tag]' \
-      '--cleanup=[cleanup message]:mode:((verbatim\:"no cleanup" whitespace\:"remove leading and trailing whitespace" strip\:"remove leading and trailing whitespace and comments"))' \
       $message_opts \
       ': :__git_tags' \
       ':: :__git_commits' \
@@ -1718,10 +1585,7 @@
     - listing \
       '-n+[limit line output of annotation]: :__git_guard_number "limit"' \
       '-l[list tags matching pattern]' \
-      '(--no-column)--column=-[display tag listing in columns]::column.tag option:((always\:"always show in columns" never\:"never show in columns" auto\:"show in columns if the output is to the terminal" column\:"fill columns before rows (default)" row\:"fill rows before columns" plain\:"show in one column" dense\:"make unequal size columns to utilize more space" nodense\:"make equal size columns"))' \
-      '(--column)--no-column[do not display in columns]' \
       '--contains=[only list tags which contain the specified commit]: :__git_commits' \
-      '--points-at=[only list tags of the given object]: :__git_commits' \
       '::pattern' \
     - verification \
       '-v[verifies gpg signutare of tags]' \
@@ -1766,6 +1630,7 @@
     value_arg=': :->value'
   fi
 
+  # TODO --local is undocumented.
   _arguments -w -C -S -s \
     '(         --system --local -f --file)--global[use user-global config file]' \
     '(--global          --local -f --file)--system[use system-wide config file]' \
@@ -1792,47 +1657,26 @@
       '(2)--get-regexp[like "--get-all", but interpret "name" as a regular expression]' \
       '(2 3 --bool --int --bool-or-int --path -z --null)--get-colorbool[check if color should be used]: :->gettable-colorbool-option' \
       '(2 3 --bool --int --bool-or-int --path -z --null)--get-color[find color setting]: :->gettable-color-option' \
-      '(-e --edit --bool --int --bool-or-int --path -z --null)'{-e,--edit}'[open config file for editing]' \
-      '(--no-includes)'--includes'[respect "include.*" directives in config files when looking up values]' \
-      '(--includes)'--no-includes'[do not respect "include.*" directives]' && ret=0
+      '(-e --edit --bool --int --bool-or-int --path -z --null)'{-e,--edit}'[open config file for editing]' && ret=0
 
   # TODO: Most all _path_commands should be able to take arguments and so on.
   # How do we deal with that and how do we quote the whole argument to git
   # config?
-  # TODO: Add support for merge.*. (merge driver), diff.*. (diff driver), and filter.*. (filter driver) options
+  # TODO: Add merge.*.(name|driver|recursive) and diff.*.(command|funcname)
   # (see gitattributes(5)).
   # TODO: .path options should take absolute paths.
   declare -a git_options_static
   git_options_static=(
     advice.pushNonFastForward:'show advice when git push refuses non-fast-forward refs::->bool:true'
-    advice.pushUpdateRejected:'combined setting for advice.push*::->bool:true'
-    advice.pushNonFFCurrent:'show advice when git push fails due to a non-fast-forward update to the current branch::->bool:true'
-    advice.pushNonFFDefault:'show advice to set push.default to "upstream" or "current" after running git-push::->bool:true'
-    advice.pushNonFFMatching:'show advice when running git-push and pushed matching refs explicitly::->bool:true'
-    advice.pushAlreadyExists:'show advice when git-push rejects an update that does not qualify for fast-forwarding::->bool:true'
-    advice.pushFetchFirst:'show advice when git-push rejects an update that tries to overwrite a remote ref that points at unknown object::->bool:true'
-    advice.pushNeedsForce:'show advice when git-push rejects an update that tries to overwrite a remote ref that points a non-commitish::->bool:true'
     advice.statusHints:'show advice in output of git status::->bool:true'
-    advice.statusUoption:'show advice to consider using the "-u" option to git-status when it takes more than 2 seconds::->bool:true'
     advice.commitBeforeMerge:'show advice when git merge refuses to merge::->bool:true'
     advice.resolveConflict:'show advice when conflict prevents operation from being performed::->bool:true'
     advice.implicitIdentity:'show advice when identity is guessed from system settings::->bool:true'
     advice.detachedHead:'show advice when entering detached-HEAD state::->bool:true'
-    advice.amWorkDir:'show the location of the patch file when git-am fails to apply it::->bool:true'
     blame.blankboundary:'show blank SHA-1 for boundary commits::->bool:false'
     blame.showroot:'show root commits as normal commits::->bool:false'
     blame.date:'date format to use in output::__git_date_formats:iso'
-    'branch.*.description:branch description:branch description:->string'
-    cvsexportcommit.cvsdir:'the default location of the CVS checkout to use for the export:cvs export dir:_directories'
-    column.ui:'specify whether supported commands should output in columns.::->column:never'
-    column.branch:'specify whether to output branch listing in git branch in columns::->column:never'
-    column.clean:'specify the layout when listing items in git clean -i::->column:never'
-    column.status:'specify whether to output untracked files in git status in columns::->column:never'
-    column.tag:'specify whether to output tag listing in git tag in columns::->column:never'
     core.fileMode:'track changes to the executable bit of files::->bool:true'
-    core.attributesfile:'look into this file for attributes in addition to .gitattributes:additional attributes file:_files'
-    core.abbrev:'set the length object names are abbreviated to:length:->int:7'
-    core.commentchar:'comment character when using an editor::->string'
     core.ignoreCygwinFSTricks:'use Cygwin stat()/lstat()::->bool:true'
     core.ignorecase:'use workarounds for non-case-sensitive filesystems::->bool:false'
     core.trustctime:'trust inode change time::->bool:true'
@@ -1854,7 +1698,6 @@
     core.loosecompression:'level of compression to apply to non-pack files::->compression:1'
     core.packedGitWindowSize:'size of mappings of pack files:pack window size:->bytes'
     core.packedGitLimit:'maximum number of bytes to map from pack files:maximum pack file map size:->bytes'
-    core.precomposeunicode:'revert the unicode decomposition of filenames done by Mac OS::->bool:false'
     core.deltaBaseCacheLimit:'maximum size of cache for base objects:maximum base objects cache size:->bytes:16m'
     core.bigFileThreshold:'maximum size of files to compress:maximum compress size:->bytes:512m'
     core.excludesfile:'additional file to use for exclusion:excludes file:_files'
@@ -1865,17 +1708,9 @@
     core.fsyncobjectfiles:'fsync() when writing object files::->bool:false'
     core.preloadindex:'use parallel index preload for operations like git diff::->bool:false'
     core.createObject:'take steps to prevent overwriting existing objects::->core.createObject:link'
-    core.checkstat:'determine which stat fields to match between the index and work tree::->core.checkstat:default'
     core.notesRef:'show notes in given refs:refs:->string:refs/notes/commits'
     core.sparseCheckout:'use sparse checkout::->bool:false'
-    credential.helper:'external helper to be called when a username or password credential is needed::_path_commands'
-    credential.useHttpPath:'consider the "path" component of an http or https URL to be important::->bool:false'
-    credential.username:'If no username is set use this username by default:default username:->string'
-    'credential.*.helper:external helper to be called when a username or password credential is needed::_path_commands'
-    'credential.*.useHttpPath:consider the "path" component of an http or https URL to be important::->bool:false'
-    'credential.*.username:if no username is set use this username by default:default username:->string'
     add.ignore-errors:'ignore indexing errors when adding files::->bool:false'
-    add.ignoreErrors:'ignore indexing errors when adding files::->bool:false'
     am.keepcr:'keep CR characters when splitting mails::->bool:false'
     apply.ignorewhitespace:'ignore whitespace changes::->apply.ignorewhitespace:no'
     apply.whitespace:'default value for the --whitespace option::->apply.whitespace:error'
@@ -1884,7 +1719,6 @@
     'branch.*.remote:what remote git fetch and git push should fetch form/push to::__git_remotes'
     'branch.*.merge:default refspec to be marked for merging::__git_ref_specs'
     'branch.*.mergeoptions:default options for merging::->branch.mergeoptions'
-    'branch.*.pushremote:what remote git push should push to::__git_remotes'
     'branch.*.rebase:rebase on top of fetched branch::->bool:false'
     'browser.*.cmd:browser command to use:browser:_path_commands'
     'browser.*.path:path to use for the browser:absolute browser path:_files -g "*(*)"'
@@ -1893,7 +1727,6 @@
     color.branch.current:'color of the current branch::->color'
     color.branch.local:'color of a local branch::->color'
     color.branch.remote:'color of a remote branch::->color'
-    color.branch.upstream:'color of upstream branches::->color'
     color.branch.plain:'color of other branches::->color'
     color.diff:'color output of git diff::->color-bool'
     color.diff.plain:'color of context text::->color'
@@ -1925,7 +1758,6 @@
     color.pager:'feed colored output to pager::->bool:true'
     color.showbranch:'color output of git show-branch::->color-bool'
     color.status:'color output of git status::->color-bool'
-    color.status.branch:'color of the current branch::->color'
     color.status.header:'color of header text::->color'
     color.status.added:'color of added, but not yet committed, files::->color'
     color.status.updated:'color of updated, but not yet committed, files::->color'
@@ -1933,41 +1765,24 @@
     color.status.untracked:'color of files not currently being tracked::->color'
     color.status.nobranch:'color of no-branch warning::->color'
     color.ui:'color output of capable git commands::->color-bool'
-    commit.cleanup:'default --cleanup option::->commit.cleanup:default'
     commit.status:'include status information in commit message template::->bool:true'
     commit.template:'template file for commit messages:template:_files'
-    'diff.*.binary:make the diff driver treat files as binary::->bool:false'
-    'diff.*.cachetextconv:make the diff driver cache the text conversion outputs::->bool:false'
-    'diff.*.command:custom diff driver command::_path_commands'
-    'diff.*.textconv:command to generate the text-converted version of a file::_path_commands'
-    'diff.*.wordregex:regular expression that the diff driver should use to split words in a line:regular expression:->string'
-    'diff.*.xfuncname:regular expression that the diff driver should use to recognize the hunk header:regular expression:->string'
-    diff.algorithm:'default diff algorithm::->diff.algorithm:default'
     diff.autorefreshindex:'run git update-index --refresh before git diff::->bool:true'
-    diff.context:'default number of context lines::->int:3'
-    diff.dirstat:'comma separated list of --dirstat parameters specifying default behaviour:comma-separated list:->string:changes,noncumulative,3'
     diff.external:'command to generate diff with:diff command:_path_commands'
     diff.mnemonicprefix:'use mnemonic source and destination prefixes::->bool:false'
     diff.noprefix:'strip source and destination prefixes::->bool:false'
     diff.renameLimit:'number of files to consider when detecting copy/renames:rename limit:->int'
     diff.renames:'try to detect renames::->diff.renames:true'
     diff.ignoreSubmodules:'ignore submodules::->bool:false'
-    diff.statGraphWidth:'width of the graph part in --stat output:width:->int'
-    diff.submodule:'output format for submodule differences::->diff.submodule:short'
-    diff.suppressBlankEmpty:'inhibit printing space before empty output lines::->bool:false'
+    diff.suppressBlankEmpty:'inbihit printing space before empty output lines::->bool:false'
     diff.tool:'diff tool to use::__git_difftools'
     'difftool.*.cmd:command to invoke for the diff tool::_path_commands'
     'difftool.*.path:path to use for the diff tool:absolute diff tool path:_files -g "*(*)"'
     difftool.prompt:'prompt before each invocation of the diff tool::->bool:true'
-    diff.wordRegex:'regex used to determine what a word is when performing word-by-word diff:regular expression:->string'
+    diff.wordRegex:'regex used to determine what a word is when performing word-by-word diff:regex:->string'
     diff.guitool:'diff tool with gui to use::__git_difftools'
     fetch.unpackLimit:'maximum number of objects to unpack when fetching:unpack limit:->int'
-    fetch.recurseSubmodules:'recurse into submodules (as needed) when fetching::->fetch.recurseSubmodules:on-demand'
-    fetch.fsckObjects:'check all fetched objects::->bool:false'
-    'filter.*.clean:command which is used to convert the content of a worktree file to a blob upon checkin::_path_commands'
-    'filter.*.smudge:command which is used to convert the content of a blob object to a worktree file upon checkout::_path_commands'
     format.attach:'use multipart/mixed attachments::->bool:false'
-    format.coverLetter:'control whether to generate a cover-letter when format-patch is invoked::->bool:false'
     format.numbered:'use sequence numbers in patch subjects::->format.numbered:auto'
     format.headers:'additional email headers to include in email patches:headers:->string'
     format.to:'additional email recipients of patches::->string'
@@ -1980,7 +1795,7 @@
     format.signoff:'enable --signoff by default::->bool:false'
     'gc.*.reflogexpire:grace period for git reflog expire::->days:90'
     'gc.*.reflogexpireunreachable:grace period for git reflog expire for unreachable entries::->days:30'
-    gc.aggressiveWindow:'window size used in delta compression algorithm::->int:250'
+    gc.aggressiveWindow:'window size used in delta compression algorithm:->int:250'
     gc.auto:'minimum limit for packing loose objects with --auto::->int:6700'
     gc.autopacklimit:'minimum limit for packing packs with --auto::->int:50'
     gc.packrefs:'allow git gc to run git pack-refs::->gc.packrefs:true'
@@ -2007,9 +1822,8 @@
     'gitcvs.*.dbTableNamePrefix:database table name prefix:prefix:->string'
     gitcvs.usecrlfattr:'use end-of-line conversion attributes::->bool:false'
     gitcvs.allbinary:'treat all files from CVS as binary::->bool:false'
-    gpg.program:'use program instead of "gpg" found on $PATH when making or verifying a PGP signature::_path_commands'
-    gui.commitmsgwidth:'width of commit message window:width::->int:75'
-    gui.diffcontext:'number of context lines used in diff window:context::->int:5'
+    gui.commitmsgwidth:'width of commit message window:width:->int:75'
+    gui.diffcontext:'number of context lines used in diff window:context:->int:5'
     gui.encoding:'encoding to use for displaying file contents::->encoding'
     gui.matchtrackingbranch:'create branches that track remote branches::->bool:false'
     gui.newbranchtemplate:'suggested name for new branches:template:->string'
@@ -2019,16 +1833,6 @@
     gui.fastcopyblame:'try harder during blame detection::->bool:false'
     gui.copyblamethreshold:'threshold to use in blame location detection:threshold:->string'
     gui.blamehistoryctx:'specify radius of history context in days for selected commit::->days'
-    'guitool.*.argprompt:prompt for arguments:argument prompt:->string'
-    'guitool.*.cmd:shell command line to execute::_path_commands'
-    'guitool.*.confirm:show a confirmation dialog::->bool:false'
-    'guitool.*.needsfile:require that a diff is selected for command to be available::->bool:false'
-    'guitool.*.noconsole:suppress command output::->bool:false'
-    'guitool.*.norescan:skip rescanning for changes to the working directory::->bool:false'
-    'guitool.*.revprompt:request a single valid revision from the user, and set the "REVISION" environment variable::->string'
-    'guitool.*.prompt:prompt to display:prompt:->string'
-    'guitool.*.revunmerged:show only unmerged branches in revprompt::->bool:false'
-    'guitool.*.title:title of prompt dialog:prompt title:->string'
     guitool.cmd:'shell command line to execute::_path_commands'
     guitool.needsfile:'require that a diff is selected for command to be available::->bool:false'
     guitool.noconsole:'suppress command output::->bool:false'
@@ -2039,14 +1843,7 @@
     guitool.revunmerged:'show only unmerged branches in revprompt::->bool:false'
     guitool.title:'title of prompt dialog:prompt title:->string'
     guitool.prompt:'prompt to display:prompt:->string'
-    grep.extendedRegexp:'enable --extended-regexp option by default (ignored when grep.patternType is set)::->bool:false'
-    grep.lineNumber:'enable -n option by default::->bool:false'
-    grep.patternType:'default matching pattern type::->grep.patternType:default'
     help.browser:'browser used to display help in web format::__git_browsers'
-    http.cookiefile:'file containing cookie lines which should be used in the Git http session::_files'
-    help.htmlpath:'location of HTML help::->help.htmlpath'
-    http.lowSpeedLimit:'limit controlling when to abort an HTTP transfer:speed limit:->int'
-    http.lowSpeedTime:'limit controlling when to abort an HTTP transfer:time limit (seconds):->int'
     help.format:'default help format used by git help::->help.format'
     help.autocorrect:'execute corrected mistyped commands::->bool:false'
     http.proxy:'HTTP proxy to use:proxy:_urls'
@@ -2056,9 +1853,8 @@
     http.sslCertPasswordProtected:'prompt for a password for the SSL certificate::->bool:false'
     http.sslCAInfo:'file containing CA certificates to verify against for HTTPS:CA certificates file:_files'
     http.sslCAPath:'directory containing files with CA certificates to verify against for HTTPS:CA certificates directory:_directories'
-    http.sslTry:'attempt to use AUTH SSL/TLS and encrypted data transfers when connecting via regular FTP protocol::->bool:false'
-    http.maxRequests:'how many HTTP requests to launch in parallel:maximum number of requests::->int:5'
-    http.minSessions:'number of curl sessions to keep across requests:minimum number of sessions::->int:1'
+    http.maxRequests:'how many HTTP requests to launch in parallel:maximum number of requests:->int:5'
+    http.minSessions:'number of curl sessions to keep across requests:mininmum number of sessions:->int:1'
     http.postBuffer:'maximum size of buffer used by smart HTTP transport when POSTing:maximum POST buffer size:->bytes:1m'
     http.lowSpeedLimit:'lower limit for HTTP transfer-speed:low transfer-speed limit:->int'
     http.lowSpeedTime:'duration for http.lowSpeedLimit:time:->int'
@@ -2086,22 +1882,16 @@
     instaweb.modulepath:'module path for the Apache HTTP-daemon for instaweb:module directory:_directories'
     instaweb.port:'port to bind HTTP daemon to for instaweb::_ports'
     interactive.singlekey:'accept one-letter input without Enter::->bool:false'
-    log.abbrevCommit:'make git-log, git-show, and git-whatchanged assume --abbrev-commit::->bool:false'
     log.date:'default date-time mode::__git_date_formats'
     log.decorate:'type of ref names to show::__git_log_decorate_formats'
-    log.mailmap:'make git-log, git-show, and git-whatchanged assume --use-mailmap:->bool:false'
     log.showroot:'show initial commit as a diff against an empty tree::->bool:true'
     mailinfo.scissors:'remove everything in body before a scissors line::->bool:false'
-    mailmap.blob:'like mailmap.file, but consider the value as a reference to a blob in the repository:blob reference:->string'
     mailmap.file:'augmenting mailmap file:mailmap file:_files'
     man.viewer:'man viewer to use for help in man format::__git_man_viewers'
     'man.*.cmd:the command to invoke the specified man viewer:man command:_path_commands'
     'man.*.path:path to use for the man viewer:absolute man tool path:_files -g "*(*)"'
-    merge.branchdesc:'populate the log message with the branch description text as well::->bool:false'
     merge.conflictstyle:'style used for conflicted hunks::->merge.conflictstyle:merge'
-    merge.defaultToUpstream:'merge the upstream branches configured for the current branch by default::->bool:false'
-    merge.ff:'allow fast-forward merges::->merge.ff:true'
-    merge.log:'include summaries of merged commits in new merge commit messages::->bool:false'
+    merge.log:'include summaries of merged commits in new merge commit messsages::->bool:false'
     merge.renameLimit:'number of files to consider when detecting copy/renames during merge:limit:->int'
     merge.renormalize:'use canonical representation of files during merge::->bool:false'
     merge.stat:'print the diffstat between ORIG_HEAD and merge at end of merge::->bool:true'
@@ -2121,31 +1911,28 @@
     notes.rewrite.rebase:'copy notes from original to rewritten commit when running git rebase::->bool:true'
     notes.rewriteMode:'what to do when target commit already has a not when rewriting::->notes.rewriteMode'
     notes.rewriteRef:'refname to use when rewriting::->refname'
-    pack.window:'size of window:window size::->int:10'
-    pack.depth:'maximum delta depth:maximum delta depth::->int:50'
+    pack.window:'size of window:window size:->int:10'
+    pack.depth:'maximum delta depth:maximum delta depth:->int:50'
     pack.windowMemory:'window size limit:maximum window size:->bytes:0'
     pack.compression:'compression level::->compression:-1'
     pack.deltaCacheSize:'maximum amount of memory for caching deltas:maximum delta cache size:->bytes:256m'
-    pack.deltaCacheLimit:'maximum size of deltas:maximum delta size::->int:1000'
+    pack.deltaCacheLimit:'maximum size of deltas:maximum delta size:->int:1000'
     pack.threads:'number of threads to use for searching for best delta matches:number of threads:->int'
     pack.indexVersion:'default pack index version:index version:->string'
     pack.packSizeLimit:'maximum size of packs:maximum size of packs:->bytes'
     pull.octopus:'default merge strategy to use when pulling multiple branches::__git_merge_strategies'
-    pull.rebase:'rebase branches on top of the fetched branch, instead of merging::->bool:false'
     pull.twohead:'default merge strategy to use when pulling a single branch::__git_merge_strategies'
-    push.default:'action git push should take if no refspec is given::->push.default:matching'
+    push.default:'action git push should take if no refspec is given::->push.default'
     rebase.stat:'show a diffstat of what changed upstream since last rebase::->bool:false'
     rebase.autosquash:'autosquash by default::->bool:false'
     receive.autogc:'run git gc --auto after receiving data::->bool:true'
     receive.fsckObjects:'check all received objects::->bool:true'
-    receive.hiderefs:'string(s) receive-pack uses to decide which refs to omit from its initial advertisement:hidden refs:->string'
     receive.unpackLimit:'maximum number of objects received for unpacking into loose objects:unpack limit:->int'
     receive.denyDeletes:'deny a ref update that deletes a ref::->bool:false'
     receive.denyDeleteCurrent:'deny a ref update that deletes currently checked out branch::->bool:false'
     receive.denyCurrentBranch:'deny a ref update of currently checked out branch::->receive.denyCurrentBranch'
     receive.denyNonFastForwards:'deny a ref update that is not a fast-forward::->bool:false'
     receive.updateserverinfo:'run git update-server-info after receiving data::->bool:false'
-    'remote.pushdefault:URL of a remote repository to pushto::__git_any_repositories'
     'remote.*.url:URL of a remote repository::__git_any_repositories'
     'remote.*.pushurl:push URL of a remote repository::__git_any_repositories'
     'remote.*.proxy:URL of proxy to use for a remote repository::_urls'
@@ -2161,20 +1948,17 @@
     repack.usedeltabaseoffset:'use delta-base offsets::->bool:true'
     rerere.autoupdate:'update index after resolution::->bool:false'
     rerere.enabled:'record resolved conflicts::->bool'
-    sendemail.identity:'default identity::__git_sendemail_identities'
     sendemail.smtpencryption:'encryption method to use::->sendemail.smtpencryption'
     sendemail.aliasesfile:'file containing email aliases:email aliases file:_files'
     sendemail.aliasfiletype:'format of aliasesfile::->sendemail.aliasfiletype'
-    sendemail.annotate:'review and edit each patch you are about to send::->bool:false'
     sendemail.bcc:'value of Bcc\: header::_email_addresses'
     sendemail.cc:'value of Cc\: header::_email_addresses'
     sendemail.cccmd:'command to generate Cc\: header with:Cc\: command:_path_commands'
-    sendemail.toccmd:'command to generate To\: header with:To\: command:_path_commands'
     sendemail.chainreplyto:'send each email as a reply to the previous one::->bool:false'
     sendemail.confirm:'type of confirmation required before sending::->sendemail.confirm:auto'
     sendemail.envelopesender:'envelope sender to send emails as::_email_addresses'
     sendemail.from:'sender email address::_email_addresses'
-    sendemail.multiedit:'edit all files at once::->bool:true'
+    sendemail.multiedit:'edit all files at once::->bool:false'
     sendemail.signedoffbycc:'add Signed-off-by\: or Cc\: lines to Cc\: header::->bool:true'
     sendemail.smtppass:'password to use for SMTP-AUTH:password:->string'
     sendemail.suppresscc:'rules for suppressing Cc\:::->sendemail.suppresscc'
@@ -2182,18 +1966,15 @@
     sendemail.to:'value of To\: header::_email_addresses'
     sendemail.smtpdomain:'FQDN to use for HELO/EHLO commands to SMTP server:smtp domain:_domains'
     sendemail.smtpserver:'SMTP server to connect to:smtp host:_hosts'
-    sendemail.smtpserveroption:'specifies the outgoing SMTP server option to use:SMTP server option:->string'
     sendemail.smtpserverport:'port to connect to SMTP server on:smtp port:_ports'
     sendemail.smtpuser:'user to use for SMTP-AUTH:smtp user:_users'
     sendemail.thread:'set In-Reply-To\: and References\: headers::->bool:true'
     sendemail.validate:'perform sanity checks on patches::->bool:true'
     'sendemail.*.aliasesfile:file containing email aliases::_files'
     'sendemail.*.aliasfiletype:format of aliasesfile::->sendemail.aliasfiletype'
-    'sendemail.*.annotate:review and edit each patch you are about to send::bool->false'
     'sendemail.*.bcc:value of Bcc\: header::_email_addresses'
     'sendemail.*.cc:value of Cc\: header::_email_addresses'
     'sendemail.*.cccmd:command to generate Cc\: header with:Cc\: command:_path_commands'
-    'sendemail.*.tocmd:command to generate To\: header with:To\: command:_path_commands'
     'sendemail.*.chainreplyto:send each email as a reply to the previous one::->bool:false'
     'sendemail.*.confirm:type of confirmation required before sending::->sendemail.confirm:auto'
     'sendemail.*.envelopesender:envelope sender to send emails as::_email_addresses'
@@ -2206,21 +1987,15 @@
     'sendemail.*.to:value of To\: header::_email_addresses'
     'sendemail.*.smtpdomain:FQDN to use for HELO/EHLO commands to SMTP server:smtp domain:_domains'
     'sendemail.*.smtpserver:SMTP server to connect to:smtp host:_hosts'
-    'sendemail.*.smtpserveroption:specifies the outgoing SMTP server option to use:SMTP server option:->string'
     'sendemail.*.smtpserverport:port to connect to SMTP server on:smtp port:_ports'
     'sendemail.*.smtpuser:user to use for SMTP-AUTH:smtp user:_users'
     'sendemail.*.thread:set In-Reply-To\: and References\: headers::->bool:true'
     'sendemail.*.validate:perform sanity checks on patches::->bool:true'
     sendemail.assume8bitEncoding:'encoding to use for non-ASCII messages::__git_encodings'
-    sequence.editor:'text editor used by git rebase -i::_path_commands'
     showbranch.default:'default set of branches for git show-branch::->branch'
     status.relativePaths:'show paths relative to current directory::->bool:false'
     status.showUntrackedFiles:'show untracked files::->status.showUntrackedFiles:normal'
     status.submodulesummary:'include submodule summary::->bool:false'
-    status.branch:'show branch and tracking info in short format::->bool:false'
-    status.short:'use short format by default::->bool:false'
-    'submodule.*.branch:remote branch name for a submodule:branch name:->string'
-    'submodule.*.fetchRecurseSubmodules:fetch commits of submodules::->bool'
     'submodule.*.path:path within project:submodule directory:_directories -qS \:'
     'submodule.*.url:URL to update from::__git_any_repositories'
     'submodule.*.update:update strategy to use::->submodule.update'
@@ -2234,7 +2009,6 @@
     svn.followparent:'follow parent commit::->bool:true'
     svn.authorsFile:'default authors file:authors file:_files'
     svn.quiet:'produce less output::->bool:false'
-    'svn-remote.*.automkdirs:attempt to recreate empty directories that are in the Subversion repository::->bool:true'
     'svn-remote.*.noMetadata:disable git-svn-id: lines at end of commits::->bool:false'
     'svn-remote.*.useSvmProps:use remappings of URLs and UUIDs from mirrors::->bool:false'
     'svn-remote.*.useSvnsyncProps:use remappings of URLs and UUIDs for the svnsync command::->bool:false'
@@ -2243,17 +2017,10 @@
     'svn-remote.*.ignore-paths:regular expression of paths to not check out:regular expression:->string'
     'svn-remote.*.url:URL to connect to::_urls'
     'svn-remote.*.fetch:fetch specification::__git_ref_specs'
-    'svn-remote.*.pushurl:URL to push to::_urls'
     'svn-remote.*.branches:branch mappings:branch mapping:->string'
     'svn-remote.*.tags:tag mappings:tag mapping:->string'
-    'tar.*.command:specify a shell command through which the tar output generated by git archive should be piped::_path_commands'
-    'tar.*.remote:enable <format> for use by remote clients via git-upload-archive::->bool'
     tar.umask:'umask to apply::->umask'
-    transfer.unpackLimit:'default value for fetch.unpackLimit and receive.unpackLimit:unpack limit::->int:100'
-    transfer.fsckObjects:'check all objects::->bool:false'
-    transfer.hiderefs:'string(s) to decide which refs to omit from initial advertisements:hidden refs:->string'
-    uploadpack.hiderefs:'string(s) upload-pack uses to decide which refs to omit from its initial advertisement:hidden refs:->string'
-    uploadpack.allowtipsha1inwant:'allow upload-pack to accept a fetch request that asks for an object at the tip of a hidden ref::->bool:false'
+    transfer.unpackLimit:'default value for fetch.unpackLimit and receive.unpackLimit:unpack limit:->int:100'
     'url.*.insteadOf:string to start URLs with:prefix:->string'
     'url.*.pushInsteadOf:string to start URLs to push to with:prefix:->string'
     user.email:'email address used for commits::_email_addresses'
@@ -2294,13 +2061,10 @@
           'color.grep.:git-grep-specific color option'
           'color.interactive.:interaction-specific color option'
           'color.status.:git-status-specific color option'
-          'credential.*.:${${line[1]#credential.}%.*}-specific option'
-          'filter.*.:${${line[1]#filter.}%.*} driver option'
-          'diff.*.:${${line[1]#diff.}%.*} driver option'
           'difftool.*.:${${line[1]#difftool.}%.*}-specific option'
           'gc.*.:${${line[1]#gc.}%.*}-specific gc option'
           'gitcvs.*.:gitcvs ${${line[1]#gitcvs.}%.*}-specific option'
-          'guitool.*.:${${line[1]#guitool.}%.*}-specific option'
+          'guitool.*.:${${line[1]#gc.}%.*}-specific option'
           'man.*.:${${line[1]#man.}%.*}-specific man option'
           'merge.*.:${${line[1]#merge.}%.*}-specific merge option'
           'mergetool.*.:${${line[1]#mergetool.}%.*}-specific option'
@@ -2334,7 +2098,7 @@
         # TODO: Is it fine to use functions like this before _describe below,
         # or do we need a tag loop?
         # TODO: It would be nice to output _message -e TYPE label when the
-        # following functions don't generate any output in the case of
+        # following functions don‚Äôt generate any output in the case of
         # multi-level options.
         case $IPREFIX in
           (alias.)
@@ -2346,9 +2110,6 @@
           (browser.)
             __git_browsers -S . && ret=0
             ;;
-          (credential.)
-            _urls && ret=0
-            ;;
           (difftool.)
             __git_difftools -S . && ret=0
             ;;
@@ -2396,7 +2157,6 @@
         sections=(
           advice:'options controlling advice'
           core:'options controlling git core'
-          credential:'credential options'
           add:'git add options'
           alias:'command aliases'
           am:'git am options'
@@ -2405,14 +2165,12 @@
           browser:'browser options'
           clean:'git clean options'
           color:'color options'
-          column:'column options'
           commit:'git commit options'
           diff:'diff options'
           difftool:'difftools'
           fetch:'git fetch options'
           format:'format options'
           gc:'git gc options'
-          gpg:'gpg options'
           gitcvs:'git-cvs options'
           gui:'git gui options'
           guitool:'git gui tool options'
@@ -2446,7 +2204,6 @@
           submodule:'git submodule options'
           tar:'git tar-tree options'
           transfer:'options controlling transfers'
-          uploadpack:'git upload-pack options'
           url:'URL prefixes'
           user:'options controlling user identity'
           web:'web options'
@@ -2573,22 +2330,6 @@
                 always:"always $parts[2]" \
                 {auto,true,yes,on}:$parts[2] && ret=0
               ;;
-            (column)
-              __git_config_values -- "$current" "$parts[5]" \
-                always:'always show in columns' \
-                never:'never show in columns' \
-                auto:'show in columns if the output is to the terminal' \
-                column:'fill columns before rows (implies "always")' \
-                row:'fill rows before columns (implies "akways")' \
-                plain:'show in one column (implies "always")' && ret=0
-              ;;
-            (commit.cleanup)
-              __git_config_values -- "$current" "$parts[5]" \
-                strip:'remove both whitespace and commentary lines' \
-                whitespace:'remove leading and trailing whitespace lines' \
-                verbatim:'no not change the commit message at all' \
-                default:'act as '\''strip'\'' if the message is to be edited and as '\''whitespace'\'' otherwise' && ret=0
-              ;;
             (compression)
               __git_compression_levels && ret=0
               ;;
@@ -2596,11 +2337,6 @@
               __git_config_booleans "$current" "$parts[5]" "$parts[2]" \
                 input:'convert CRLFs on input only' && ret=0
               ;;
-            (core.checkstat)
-              __git_config_values -- "$current" "$parts[5]" \
-                default:'check all fields' \
-                minimal:'check fewer fields' && ret=0
-              ;;
             (core.createObject)
               __git_config_values -- "$current" "$parts[5]" \
                 rename:'rename source objects' \
@@ -2642,23 +2378,10 @@
                 __git_guard_number 'number of days'
               fi
               ;;
-            (diff.algorithm)
-              __git_config_values -- "$current" "$parts[5]" \
-                default:'basic greedy diff algorithm' \
-                myers:'basic greedy diff algorithm' \
-                minimal:'spend extra time to make sure the smallest possible diff is produced' \
-                patience:'generate diffs with patience algorithm' \
-                histogram:'generate diffs with histogram algorithm' && ret=0
-              ;;
             (diff.renames)
               __git_config_booleans "$current" "$parts[5]" "$parts[2]" \
                 {copies,copy}:'try to detect both renames and copies' && ret=0
               ;;
-            (diff.submodule)
-              __git_config_values -- "$current" "$parts[5]" \
-                short:'show pairs of commit name' \
-                log:'list commits like git submodule does' && ret=0
-              ;;
             (encoding)
               __git_encodings && ret=0
               ;;
@@ -2668,10 +2391,6 @@
                 crlf:'use CR+LF' \
                 native:'use line ending of platform' && ret=0
               ;;
-            (fetch.recurseSubmodules)
-              __git_config_booleans "$current" "$parts[5]" "$parts[2]" \
-                on-demand:'only when submodule reference in superproject is updated' && ret=0
-              ;;
             (format.numbered)
               __git_config_booleans "$current" "$parts[5]" "$parts[2]" \
                 auto:'use sequence numbers if more than one patch' && ret=0
@@ -2687,30 +2406,17 @@
               ;;
             (gitcvs.dbdriver)
               # TODO: Would be nice to only include those that are installed, but I
-              # couldn't figure out a good way of doing that when I wrote this code.
+              # couldn‚Äôt figure out a good way of doing that when I wrote this code.
               __git_config_values -t dbi-drivers -l 'DBI driver' -- "$current" "$part[5]" \
                 SQLite:'use the SQLite database driver' \
                 Pg:'use the Pg database driver' && ret=0
               ;;
-            (grep.patternType)
-              __git_config_values -- "$current" "$parts[5]" \
-                basic:'use --basic-regexp' \
-                default:'use default' \
-                extended:'use --extended-regexp' \
-                fixed:'use --fixed-strings' \
-                perl:'use --perl-regexp' && ret=0
-              ;;
             (help.format)
               __git_config_values -- "$current" "$parts[5]" \
                 man:'use man' \
                 info:'use info' \
                 {web,html}:'use HTML' && ret=0
               ;;
-            (help.htmlpath)
-              _alternative \
-                'path::_files -/' \
-                'url::_urls' && ret=0
-              ;;
             (imap.authMethod)
               __git_config_values -- "$current" "$parts[5]" \
                 CRAM-MD5:'use CRAM-MD5' && ret=0
@@ -2729,15 +2435,11 @@
                 merge:'use standard merge style' \
                 diff3:'use diff3 style' && ret=0
               ;;
-            (merge.ff)
-              __git_config_booleans "$current" "$parts[5]" "$parts[2]" \
-                only:'only allow fast-forward merges (equivalent to --ff-only)' && ret=0
-              ;;
             (merge.verbosity)
               __git_config_values -t verbosity-levels -l 'verbosity level' -- "$current" "$parts[5]" \
-                0:'only final error message if conflicts were detected' \
-                1:'conflicts' \
-                2:'conflicts and file changes' \
+                0:'only final error message if conflicts were detected'
+                1:'conflicts'
+                2:'conflicts and file changes'
                 5:'debugging information' && ret=0
               ;;
             (notes.rewriteMode)
@@ -2753,8 +2455,7 @@
               __git_config_values -- "$current" "$parts[5]" \
                 nothing:'do not push anything' \
                 matching:'push all matching branches' \
-                upstream:'push current branch to its upstream branch' \
-                simple:'like upstream, but only if local and remote names are the same' \
+                tracking:'push current branch to its upstream branch' \
                 current:'push current branch to branch of same name' && ret=0
               ;;
             (receive.denyCurrentBranch)
@@ -2812,7 +2513,7 @@
             (umask)
               _alternative \
                 'values:value:(user)' \
-                'umasks: :__git_guard_number umask' && ret=0
+                'umasks::__git_guard_number umask' && ret=0
               ;;
           esac
           ;;
@@ -2847,9 +2548,7 @@
     '-C-[detect copies as well as renames with given scope]: :__git_guard_number size' \
     '--export-marks=[dump internal marks table when complete]: :_files' \
     '--import-marks=[load marks before processing input]: :_files' \
-    '--import-marks-if-exists=[silently skip if files does not exist]: :_files' \
     '--fake-missing-tagger=[fake a tagger when tags lack them]' \
-    '--use-done-feature[start with a "feature done" stanza, and terminate with a "done" command]' \
     '--no-data[do not output blocb objects, instead referring to them via their SHA-1 hash]' \
     '--full-tree[output full tree for each commit]' \
     '*: :__git_commit_ranges'
@@ -2858,11 +2557,9 @@
 (( $+functions[_git-fast-import] )) ||
 _git-fast-import () {
   _arguments -S -A '-*' \
-    '--cat-blob-fd=-[write responses to cat-blob and ls queries to <fd> instead of stdout]:file descriptor' \
     '--date-format=-[type of dates used in input]:format:((raw\:"native Git format"
                                                            rfc2822\:"standard email format from RFC 2822"
                                                            now\:"use current time and timezone"' \
-    '--done[terminate with error if there is no "done" command at the end of the stream]' \
     '--force[force updating modified existing branches]' \
     '--max-pack-size=-[maximum size of each packfile]: :__git_guard_bytes' \
     '--big-file-threshold=-[maximum size of blob to create deltas for]: :__git_guard_bytes' \
@@ -2904,7 +2601,6 @@
   # TODO: Only complete files with merge conflicts.
   _arguments -S -A '-*' \
     '(-t --tool)'{-t,--tool=}'[merge resolution program to use]: :__git_mergetools' \
-    '--tool-help[print a list of merge tools that may be used with "--tool"]' \
     '(-y --no-prompt --prompt)'{-y,--no-prompt}'[do not prompt before invocation of merge resolution program]' \
     '(-y --no-prompt)--prompt[prompt before invocation of merge resolution program]' \
     '*:conflicted file:_files'
@@ -2972,7 +2668,7 @@
               '--expire-unreachable=-[prune entries older than given time and unreachable]: :__git_datetimes' \
               '--all[prune all refs]' \
               '--updateref[update ref with SHA-1 of top reflog entry after expiring or deleting]' \
-              '--rewrite[adjust reflog entries to ensure old SHA-1 points to new SHA-1 of previous entry after expiring or deleting]' \
+              '--rewrite[adjust reflog entries to ensure old SHA-1 points to new SHA-1 of previous entry after expring or deleting]' \
               '--verbose[output additional information]' && ret=0
             ;;
           (delete)
@@ -2980,12 +2676,12 @@
             _arguments -C -S \
               '(-n --dry-run)'{-n,--dry-run}'[undocumented]' \
               '--updateref[update ref with SHA-1 of top reflog entry after expiring or deleting]' \
-              '--rewrite[adjust reflog entries to ensure old SHA-1 points to new SHA-1 of previous entry after expiring or deleting]' \
+              '--rewrite[adjust reflog entries to ensure old SHA-1 points to new SHA-1 of previous entry after expring or deleting]' \
               '*:: :->reflog-entry' && ret=0
 
             case $state in
               (reflog-entry)
-                # TODO: __git_ignore_line doesn't work here for some reason.
+                # TODO: __git_ignore_line doesn‚Äôt work here for some reason.
                 __git_ignore_line __git_reflog_entries && ret=0
                 ;;
             esac
@@ -3004,9 +2700,10 @@
 
 (( $+functions[_git-relink] )) ||
 _git-relink () {
+  # TODO: --help is undocumented.
   _arguments \
     '--safe[stop if two objects with the same hash exist but have different sizes]' \
-    '(-)'{-h,--help}'[display usage information]' \
+    '--help[display help]' \
     ': :_directories' \
     ': :_directories' \
     '*: :_directories'
@@ -3159,33 +2856,31 @@
     '-l[show long rev]' \
     '-t[show raw timestamp]' \
     '-S[use revs from revs-file]:revs-file:_files' \
-    '--reverse[walk history forward instead of backward]' \
+    '--reverse[walk histor forward instead of backward]' \
     '(-p --porcelain)'{-p,--porcelain}'[show results designed for machine processing]' \
-    '--line-porcelain[show results designed for machine processing but show commit information for every line]' \
     '--incremental[show results incrementally for machine processing]' \
     '--contents[annotate against the given file if no rev is specified]: :_files' \
     '(-h --help)'{-h,--help}'[show help message]' \
     '-c[use same output format as git annotate]' \
     '--score-debug[output debugging information relating to -C and -M line movement]' \
-    '(-e --show-email)'{-e,--show-email}'[show the author email instead of the author name]' \
     '(-f --show-name)'{-f,--show-name}'[show the filename of the original commit]' \
     '(-n --show-number)'{-n,--show-number}'[show the line number in the original commit]' \
     '-s[suppress author name and timestamp]' \
     '-w[ignore whitespace when finding lines]' \
     $revision_options \
-    ':: :__git_revisions' \
-    ': :__git_cached_files' && ret=0
+    ': :__git_cached_files' \
+    ':: :__git_revisions' && ret=0
 
   case $state in
     (line-range)
       if compset -P '([[:digit:]]#|/[^/]#(\\?[^/]#)#/),'; then
         _alternative \
-          'line-numbers: :__git_guard_number "line number"' \
+          'line-numbers::__git_guard_number "line number"' \
           'regexes::_guard "(/[^/]#(\\?[^/]#)#(/|)|)" regex' \
           'offsets::_guard "([+-][[:digit:]]#|)" "line offset"' && ret=0
       else
         _alternative \
-          'line-numbers: :__git_guard_number "line number"' \
+          'line-numbers::__git_guard_number "line number"' \
           'regexes::_guard "(/[^/]#(\\?[^/]#)#(/|)|)" regex' && ret=0
       fi
       ;;
@@ -3208,22 +2903,17 @@
 (( $+functions[_git-count-objects] )) ||
 _git-count-objects () {
   _arguments \
-    '(-v --verbose)'{-v,--verbose}'[also report number of in-pack objects and objects that can be removed]' \
-    {-H,--human-readable}'[Print sizes in human readable format]'
+    '(-v --verbose)'{-v,--verbose}'[also report number of in-pack objects and objects that can be removed]'
 }
 
 (( $+functions[_git-difftool] )) ||
 _git-difftool () {
   # TODO: Is this fine, or do we need to modify the context or similar?
   _git-diff \
-    '--dir-diff[diff a whole tree by prepare a temporary copy]' \
     '(-y --no-prompt --prompt)'{-y,--no-prompt}'[do not prompt before invocation of diff tool]' \
     '(-y --no-prompt)--prompt[prompt before invocation of diff tool]' \
     '(-t --tool -x --extcmd)'{-t,--tool=-}'[merge resolution program to use]: :__git_difftools' \
     '(-t --tool -x --extcmd)'{-x,--extcmd=-}'[custom diff command to use]: :_path_commands' \
-    '--tool-help[print a list of diff tools that may be used with --tool]' \
-    '(--symlinks)--no-symlinks[make copies of instead of symlinks to the working tree]' \
-    '(---no-symlinks)--symlinks[make symlinks to instead of copies of the working tree]' \
     '(-g --gui)'{-g,--gui}'[use diff.guitool instead of diff.tool]'
 }
 
@@ -3232,8 +2922,6 @@
   # TODO: -v is undocumented.
   _arguments -w -S -s \
     '--unreachable[show objects that are unreferenced in the object database]' \
-    '(--dangling --no-dangling)--dangling[print dangling objects (default)]' \
-    '(--dangling --no-dangling)--no-dangling[do not print dangling objects]' \
     '--root[show root nodes]' \
     '--tags[show tags]' \
     '--cache[consider objects recorded in the index as head nodes for reachability traces]' \
@@ -3253,11 +2941,10 @@
 (( $+functions[_git-help] )) ||
 _git-help () {
   _arguments -w -S -s \
-    '(         -g --guides -i --info -m --man -w --web)'{-a,--all}'[show all available commands]' \
-    '(-a --all -g --guides           -m --man -w --web)'{-i,--info}'[show all available commands]' \
-    '(-a --all -g --guides -i --info          -w --web)'{-m,--man}'[show all available commands]' \
-    '(-a --all -g --guides -i --info -m --man         )'{-w,--web}'[show all available commands]' \
-    '(-g --guides)'{-g,--guides}'[prints a list of useful guides on the standard output]' \
+    '(         -i --info -m --man -w --web)'{-a,--all}'[show all available commands]' \
+    '(-a --all           -m --man -w --web)'{-i,--info}'[show all available commands]' \
+    '(-a --all -i --info          -w --web)'{-m,--man}'[show all available commands]' \
+    '(-a --all -i --info -m --man         )'{-w,--web}'[show all available commands]' \
     ': :_git_commands'
 }
 
@@ -3313,13 +3000,12 @@
 
   case $state in
     (command)
-      # TODO: This isn't optimal, as forget get confused.
+      # TODO: This isn‚Äôt optimal, as forget get confused.
       _values command \
         'clear[reset metadata used by rerere]' \
         'forget[resets metadata used by rerere for specific conflict]: :__git_cached_files' \
         'diff[output diffs for the current state of the resolution]' \
-        'status[print paths with conflicts whose merge resolution rerere will record]' \
-        'remaining[print paths with conflicts that have not been autoresolved by rerere]' \
+        'status[like diff, but only output filesames]' \
         'gc[prune old records of conflicted merges]' && ret=0
       ;;
   esac
@@ -3377,7 +3063,6 @@
       '(           --symbolic-full-name)--symbolic[output in a format as true to input as possible]' \
       '(--symbolic                     )--symbolic-full-name[same as --symbolic, but omit non-ref inputs]' \
       '--abbrev-ref=-[a non-ambiguous short name of object]::mode:(strict loose)' \
-      '--disambiguate=-[show every object whose name begins with the given prefix]:prefix' \
       '--all[show all refs found in refs/]' \
       '--branches=-[show branch refs found in refs/heads/]::shell glob pattern' \
       '--tags=-[show tag refs found in refs/tags/]::shell glob pattern' \
@@ -3393,7 +3078,6 @@
       '(--revs-only --no-revs --flags --no-flags --verify)--short=-[show only shorter unique name]:: :__git_guard_number length' \
       '(--since --after)'{--since=-,--after=-}'[show --max-age= parameter corresponding given date string]:datestring' \
       '(--until --before)'{--until=-,--before=-}'[show --min-age= parameter corresponding given date string]:datestring' \
-      '--resolve-git-dir[check if <path> is a valid repository or gitfile and print location]:git dir:_files -/' \
       '*: :__git_objects' && ret=0
   fi
 
@@ -3421,7 +3105,7 @@
       '(--no-name            )--sha1-name[name commits with unique prefix of object names]' \
       '--topics[show only commits that are NOT on the first branch given]' \
       '(        --no-color)--color[color status sign of commits]:: :__git_color_whens' \
-      '(--color           )--no-color[do not color status sign of commits]' \
+      '(--color           )--no-color[do not color statis sign of commits]' \
       '*: :__git_revisions' \
     - reflogs \
       '(-g --reflog)'{-g,--reflog=}'[show reflog entries for given ref]:: :->limit-and-base' \
@@ -3431,7 +3115,7 @@
     (limit-and-base)
       if compset -P '[[:digit:]]##,'; then
         _alternative \
-          'counts: :__git_guard_number count' \
+          'counts::__git_guard_number count' \
           'dates::__git_datetimes' && ret=0
       else
         __git_guard_number limit
@@ -3444,8 +3128,9 @@
 
 (( $+functions[_git-verify-tag] )) ||
 _git-verify-tag () {
+  # TODO: -v and --verbose are undocumented.
   _arguments -w -S -s \
-    '(-v --verbose)'{-v,--verbose}'[print the contents of the tag object before validating it]' \
+    '(-v --verbose)'{-v,--verbose}'[output additional information]' \
     '*: :__git_tags'
 }
 
@@ -3572,18 +3257,14 @@
     '--subject=[specify the initial subject of the email thread]:subject' \
     '--to=[specify the primary recipient of the emails]: :_email_addresses' \
     '--8bit-encoding=[encoding to use for non-ASCII messages]: :__git_encodings' \
-    '--compose-encoding=[encoding to use for compose messages]: :__git_encodings' \
     '--envelope-sender[specify the envelope sender used to send the emails]: :_email_addresses' \
     '--smtp-encryption=[specify encryption method to use]: :__git_sendemail_smtpencryption_values' \
     '--smtp-domain=[specify FQDN used in HELO/EHLO]: :_domains' \
     '--smtp-pass=[specify password to use for SMTP-AUTH]::password' \
     '--smtp-server=[specify SMTP server to connect to]:smtp server:_hosts' \
     '--smtp-server-port=[specify port to connect to SMTP server on]:smtp port:_ports' \
-    '--smtp-server-option=[specify the outgoing SMTP server option to use]:SMPT server option' \
     '--smtp-user=[specify user to use for SMTP-AUTH]:smtp user:_users' \
-    '--smtp-debug=[enable or disable debug output]:smtp debug:((0\:"disable" 1\:"enable"))' \
     '--cc-cmd=[specify command to generate Cc\: header with]:Cc\: command:_path_commands' \
-    '--to-cmd=[specify command to generate To\: header with]:To\: command:_path_commands' \
     '(                 --no-chain-reply-to)--chain-reply-to[send each email as a reply to previous one]' \
     '(--chain-reply-to                    )--no-chain-reply-to[send all emails after first as replies to first one]' \
     '--identity=[specify configuration identity]: :__git_sendemail_identities' \
@@ -3601,7 +3282,7 @@
     '--quiet[be less verbose]' \
     '(           --no-validate)--validate[perform sanity checks on patches]' \
     '(--validate              )--validate[do not perform sanity checks on patches]' \
-    '--force[send emails even if safety checks would prevent it]' \
+    '--force[send emails even if safetiy checks would prevent it]' \
     '*: :_files'
 }
 
@@ -3877,6 +3558,8 @@
     '--unidiff-zero[disable unified-diff-context check]' \
     '--apply[apply patches that would otherwise not be applied]' \
     '--no-add[ignore additions made by the patch]' \
+    '*--exclude=[skip files matching specified pattern]:pattern' \
+    '*--include=[include files matching specified pattern]:pattern' \
     '--inaccurate-eof[work around missing-new-line-at-EOF bugs]' \
     '(-v --verbose)'{-v,--verbose}'[display progress on stderr]' \
     '--recount[do not trust line counts in hunk headers]' \
@@ -4066,10 +3749,9 @@
 
 (( $+functions[_git-read-tree] )) ||
 _git-read-tree () {
-  local trivial_opt= aggressive_opt= dryrun_opt=
+  local trivial_opt= aggressive_opt=
 
   if (( words[(I)-m] )); then
-    dryrun_opt='--dry-run[report if a merge would fail without touching the index or the working tree]'
     trivial_opt='--trivial[restrict three-way merge to only happen if no file-level merging is required]'
     aggressive_opt='--aggressive[try harder to resolve merge conflicts]'
   fi
@@ -4093,14 +3775,12 @@
     '(-m         --prefix)--reset[perform a merge, not just a read, ignoring unmerged entries]' \
     '(-m --reset          2 3)--prefix=-[read the contents of specified tree-ish under specified directory]:prefix:_directories -r ""' \
     $ui_opts \
-    $dryrun_opt \
     '-v[display progress on standard error]' \
     $trivial_opt \
     $aggressive_opt \
     $exclude_per_directory_opt \
     '--index-output=[write index in the named file instead of $GIT_INDEX_FILE]: :_files' \
     '--no-sparse-checkout[display sparse checkout support]' \
-    '--empty[instead of reading tree object(s) into the index, just empty it]' \
     '1:first tree-ish to be read/merged:__git_tree_ishs' \
     '2::second tree-ish to be read/merged:__git_tree_ishs' \
     '3::third tree-ish to be read/merged:__git_tree_ishs'
@@ -4109,10 +3789,8 @@
 (( $+functions[_git-symbolic-ref] )) ||
 _git-symbolic-ref () {
   _arguments -w -S -s \
-    '(-d --delete)'{-d,--delete}'[delete symbolic ref]' \
     '(-q --quiet)'{-q,--quiet}'[do not issue error if specified name is not a symbolic ref]' \
-    '--short[shorten the ref name (eg. refs/heads/master -> master)]' \
-    '-m[update reflog for specified name with specified reason]:reason for update' \
+    '-m[update reflog for specified name with specied reason]:reason for update' \
     ':symbolic reference:__git_heads' \
     ':: :__git_references'
 }
@@ -4167,7 +3845,7 @@
 (( $+functions[_git-update-ref] )) ||
 _git-update-ref () {
   _arguments -w -S -s \
-    '-m[update reflog for specified name with specified reason]:reason for update' \
+    '-m[update reflog for specified name with specied reason]:reason for update' \
     '(:)-d[delete given reference after verifying its value]:symbolic reference:__git_revisions:old reference:__git_revisions' \
     '--no-deref[overwrite ref itself, not what it points to]' \
     ':symbolic reference:__git_revisions' \
@@ -4193,8 +3871,8 @@
     '(- 1)-e[exit with zero status if object exists]' \
     '(- 1)-p[pretty-print given object]' \
     '(- 1)--textconv[show content as transformed by a textconv filter]' \
-    '(- :)--batch=-[print SHA1, type, size and contents (or in <format>) of objects given on stdin]:format' \
-    '(- :)--batch-check=-[print SHA1, type and size (or in <format>) of objects given on stdin]:format' \
+    '(- :)--batch[print SHA1, type, size, and contents of each object provided on stdin]' \
+    '(- :)--batch-check[print SHA1, type, and size of each object provided on stdin]' \
     '(-):object type:(blob commit tag tree)' \
     ': :__git_objects'
 }
@@ -4216,9 +3894,9 @@
   local -a revision_options
   __git_setup_revision_options
 
-  # TODO: Description of -m doesn't match that for git-rev-list.  What's going
+  # TODO: Description of -m doesn‚Äôt match that for git-rev-list.  What‚Äôs going
   # on here?
-  # TODO: With --cached, shouldn't we only list files changed in index compared
+  # TODO: With --cached, shouldn‚Äôt we only list files changed in index compared
   # to given tree-ish?  This should be done for git-diff as well, in that case.
   _arguments -S \
     $revision_options \
@@ -4282,7 +3960,7 @@
 (( $+functions[_git-for-each-ref] )) ||
 _git-for-each-ref () {
   # TODO: Better completion for --format: should complete %(field) stuff, that
-  # is, %(refname), %(objecttype), %(objectsize), %(objectname) with optional '*'
+  # is, %(refname), %(objecttype), %(objectsize), %(objectname) with optional ‚Äò*‚Äô
   # in front.
   _arguments -w -S -s \
     '--count=[maximum number of refs to iterate over]: :__git_guard_number "maximum number of refs"' \
@@ -4337,8 +4015,6 @@
     '(-h --heads)'{-h,--heads}'[show only refs under refs/heads]' \
     '(-t --tags)'{-t,--tags}'[show only refs under refs/tags]' \
     '(-u --upload-pack)'{-u,--upload-pack=-}'[specify path to git-upload-pack on remote side]:remote path' \
-    '--exit-code[exit with status 2 when no matching refs are found in the remote repository]' \
-    '--get-url[expand the URL of the given repository taking into account any "url.<base>.insteadOf" config setting]' \
     ': :__git_any_repositories' \
     '*: :__git_references'
 }
@@ -4375,7 +4051,6 @@
   _arguments -w -S -s \
     '(-a --all)'{-a,--all}'[display all common ancestors]' \
     '--octopus[compute best common ancestors of all supplied commits]' \
-    '--is-ancestor[tell if A is ancestor of B (by exit status)]' \
     '(-)--independent[display minimal subset of supplied commits with same ancestors]' \
     ': :__git_commits' \
     '*: :__git_commits'
@@ -4417,7 +4092,7 @@
     '--timestamp[print raw commit timestamp]' \
     '(         --bisect-vars --bisect-all)--bisect[show only middlemost commit object]' \
     '(--bisect)--bisect-vars[same as --bisect, displaying shell-evalable code]' \
-    '(--bisect)--bisect-all[display all commit objects between included and excluded commits]' \
+    '(--bisect)--bisect-all[display all commit objects beteen included and excluded commits]' \
     '*:: :->commit-or-path' && ret=0
 
   case $state in
@@ -4447,7 +4122,7 @@
     - list \
       '(-h --head)'{-h,--head}'[show HEAD reference]' \
       '--tags[show only refs/tags]' \
-      '--heads[show only HEAD and refs under refs/heads]' \
+      '--heads[show only refs/heads]' \
       '(-d --dereference)'{-d,--dereference}'[dereference tags into object IDs as well]' \
       '(-s --hash)'{-s+,--hash=-}'[only show the SHA-1 hash, not the reference name]:: :__git_guard_number length' \
       '--verify[enable stricter reference checking]' \
@@ -4492,7 +4167,6 @@
   # TODO: --interpolated-path should complete %H, %CH, %IP, %P, and %D.
   _arguments -S \
     '--strict-paths[match paths exactly]' \
-    '--access-hook=-[allow an external tool to accept or decline service]:path:_directories' \
     '--base-path=-[remap all the path requests as relative to the given path]:path:_directories' \
     '--base-path-relaxed[allow lookup of base path witout prefix]' \
     '--interpolated-path=-[dynamically construct alternate paths]:path:_directories' \
@@ -4515,8 +4189,6 @@
     '--disable=-[disable site-wide service]: :__git_daemon_service' \
     '--allow-override[allow overriding site-wide service]: :__git_daemon_service' \
     '--forbid-override[forbid overriding site-wide service]: :__git_daemon_service' \
-    '(--no-informative-errors)--informative-errors[report more verbose errors to the client]' \
-    '(--informative-errors)--no-informative-errors[report all errors as "access denied" to the client]' \
     '*:repository:_directories'
 }
 
@@ -4594,7 +4266,7 @@
     '*: :__git_remote_references'
 }
 
-# NOTE: git-parse-remote isn't a user command.
+# NOTE: git-parse-remote isn‚Äôt a user command.
 
 (( $+functions[_git-receive-pack] )) ||
 _git-receive-pack () {
@@ -4683,9 +4355,7 @@
   fi
 
   _arguments -C \
-    {-a,--all}'[list all attributes that are associated with the specified paths]' \
     '--stdin[read file names from stdin instead of from command line]' \
-    '--cached[consider .gitattributes in the index only, ignoring the working tree.]' \
     $z_opt \
     '(-)--[interpret preceding arguments as attributes and following arguments as path names]' \
     '*:: :->attribute-or-file' && ret=0
@@ -4721,10 +4391,7 @@
 _git-check-ref-format () {
   _arguments \
     '-h[display usage information]' \
-    '(--no-allow-onelevel)--allow-onelevel[accept one-level refnames]' \
-    '(--allow-onelevel)--no-allow-onelevel[do not accept one-level refnames]' \
-    '--refspec-pattern[interpret <refname> as a reference name pattern for a refspec]' \
-    '--normalize[Normalize refname by removing leading slashes]' \
+    '--print[display canonicalized name of hypothetical reference of given name]' \
     '--branch[expand previous branch syntax]' \
     ': :__git_references'
 }
@@ -4774,13 +4441,12 @@
   _message 'no arguments allowed; accepts patch on standard input'
 }
 
-# NOTE: git-sh-setup isn't a user command.
+# NOTE: git-sh-setup isn‚Äôt a user command.
 
 (( $+functions[_git-stripspace] )) ||
 _git-stripspace () {
   _arguments \
-    '(-s --strip-comments)'{-s,--strip-comments}'[also strip lines starting with #]' \
-    '(-c --comment-lines)'{-c,--comment-lines}'[prepend comment character and blank to each line]'
+    '(-s --strip-comments)'{-s,--strip-comments}'[also strip lines starting with #]'
 }
 
 # INTERNAL GIT COMPLETION FUNCTIONS
@@ -4832,8 +4498,8 @@
 
 (( $+functions[__git_is_committish_range] )) ||
 __git_is_committish_range () {
-  # TODO: This isn't quite right.  We would like to do parts=${(~s:..(.|))},
-  # but that doesn't work.  (This would allow us to make sure that parts only
+  # TODO: This isn‚Äôt quite right.  We would like to do parts=${(~s:..(.|))},
+  # but that doesn‚Äôt work.  (This would allow us to make sure that parts only
   # contains two elements and then apply __git_is_committish on them.
   [[ $1 == *..(.|)* ]] &&
     __git_is_committish $(__git_committish_range_first $1) &&
@@ -4910,7 +4576,7 @@
     notes:'add or inspect object notes'
     pull:'fetch from and merge with another repository or local branch'
     push:'update remote refs along with associated objects'
-    rebase:'forward-port local commits to the updated upstream head'
+    rebase:'fasforward-port local commits to the updated upstream head'
     reset:'reset current HEAD to specified state'
     revert:'revert existing commits'
     rm:'remove files from the working tree and from the index'
@@ -4926,7 +4592,7 @@
     config:'get and set repository or global options'
     fast-export:'data exporter'
     fast-import:'import information into git directly'
-    filter-branch:'rewrite branches'
+    filter-branch:'rewrite branchers'
     mergetool:'run merge conflict resolution tools to resolve merge conflicts'
     pack-refs:'pack heads and tags for efficient repository access'
     prune:'prune all unreachable objects from the object database'
@@ -5026,8 +4692,6 @@
   local -a plumbing_internal_helper_commands
   plumbing_internal_helper_commands=(
     check-attr:'display gitattributes information'
-    check-ignore:'debug gitignore/exclude files'
-    check-mailmap:'show canonical names and email addresses of contacts'
     check-ref-format:'ensure that a reference name is well formed'
     fmt-merge-msg:'produce merge commit message'
     mailinfo:'extract patch and authorship from a single email message'
@@ -5093,13 +4757,7 @@
 
 (( $+functions[__git_extract_aliases] )) ||
 __git_extract_aliases () {
-  local -a tmp
-  tmp=(${${(0)"$(_call_program aliases "git config -z --get-regexp '^alias.'")"}#alias.})
-  if (( ${#tmp} > 0 )); then
-      aliases=(${^tmp/$'\n'/:alias for \'}\')
-  else
-      aliases=()
-  fi
+  aliases=(${^${${(0)"$(_call_program aliases "git config -z --get-regexp '^alias.'")"}#alias.}/$'\n'/:alias for \'}\')
 }
 
 (( $+functions[__git_date_formats] )) ||
@@ -5205,7 +4863,7 @@
 
   whens=(
     none:'submodule is dirty when it contains untracked or modified files'
-    untracked:'submodule is dirty when it contains untracked files'
+    untracked:'submodule is dirty when it contains untracket files'
     dirty:'ignore all changes to submodules, showing only changes to commits stored in superproject'
     all:'ignore all changes to submodules (default)')
 
@@ -5412,17 +5070,6 @@
   _wanted remote-branch-names expl 'remote branch name' compadd $* - $branch_names
 }
 
-(( $+functions[__git_remote_branch_names_noprefix] )) ||
-__git_remote_branch_names_noprefix () {
-  local expl
-  declare -a heads
-
-  branch_names=(${${${(f)"$(_call_program remote-branch-refs-noprefix git for-each-ref --format='"%(refname)"' refs/remotes 2>/dev/null)"}##*/}:#HEAD})
-  __git_command_successful $pipestatus || return 1
-
-  _wanted remote-branch-names-noprefix expl 'remote branch name' compadd $* - $branch_names
-}
-
 (( $+functions[__git_commits] )) ||
 __git_commits () {
   # TODO: deal with things that __git_heads and __git_tags has in common (i.e.,
@@ -5587,7 +5234,7 @@
 
   # TODO: depending on what options are on the command-line already, complete
   # only tags or heads
-  # TODO: perhaps caching is unnecessary.  usually won't contain that much data
+  # TODO: perhaps caching is unnecessary.  usually won‚Äôt contain that much data
   # TODO: perhaps provide alternative here for both heads and tags (and use
   # __git_heads and __git_tags)
   # TODO: instead of "./.", we should be looking in the repository specified as
@@ -5620,6 +5267,15 @@
   __git_references
 }
 
+(( $+functions[__git_note_references] )) ||
+__git_local_references () {
+  local references expl
+
+  references=(${${(M)${${(f)"$(_call_program references git ls-remote ./. 2>/dev/null)"}#*$'\t'}:#refs/notes/*}#refs/notes/})
+  __git_command_successful $pipestatus || return 1
+
+  _wanted references expl reference compadd - $references
+}
 (( $+functions[__git_notes_refs] )) ||
 __git_notes_refs () {
   local expl
@@ -5647,7 +5303,7 @@
 
   files=()
 
-  # Collapse "//" and "/./" into "/". Strip any remaining "/." and "/".
+  # Collapse ‚Äú//‚Äù and ‚Äú/./‚Äù into ‚Äú/‚Äù. Strip any remaining ‚Äú/.‚Äù and ‚Äú/‚Äù.
   for file in ${${${${${(0)1}//\/\///}//\/.\///}%/.}%/}; do
     integer i n
     (( n = $#file > $#prefix ? $#file : $#prefix ))
@@ -5683,7 +5339,7 @@
   # TODO: --directory should probably be added to $opts when --others is given.
 
   local pref=$gitcdup$gitprefix$PREFIX
-  files=(${(0)"$(_call_program files git ls-files -z --exclude-standard $opts -- ${pref:+$pref\\\*} 2>/dev/null)"})
+  files=(${(0)"$(_call_program files git ls-files -z --exclude-standard $opts -- ${pref:+$pref\*} 2>/dev/null)"})
   __git_command_successful $pipestatus || return
 
 #  _wanted $tag expl $description _files -g '{'${(j:,:)files}'}' $compadd_opts -
@@ -5903,29 +5559,19 @@
     '(- *)-h[display help]'
     '(           --no-decorate)--decorate=-[print out ref names of any commits that are shown]: :__git_log_decorate_formats'
     '(--decorate              )--no-decorate[do not print out ref names of any commits that are shown]'
-    '(          --no-follow)--follow[follow renames]'
-    '(--follow             )--no-follow[do not follow renames]'
     '--source[show which ref each commit is reached from]')
 }
 
 (( $+functions[__git_setup_diff_options] )) ||
 __git_setup_diff_options () {
-  local diff_types='(-p -u --patch -U --unified --raw --patch-with-raw --stat --numstat --shortstat --dirstat --dirstat-by-file --summary --patch-with-stat --name-only --name-status --cumulative -s --no-patch)'
+  local diff_types='(-p -u --patch -U --unified --raw --patch-with-raw --stat --numstat --shortstat --dirstat --dirstat-by-file --summary --patch-with-stat --name-only --name-status --cumulative)'
 
   diff_options=(
     $diff_types{-p,-u,--patch}'[generate diff in patch format]'
     $diff_types{-U,--unified=}'[generate diff with given lines of context]: :__git_guard_number lines'
     $diff_types'--raw[generate default raw diff output]'
     $diff_types'--patch-with-raw[generate patch but also keep the default raw diff output]'
-    $diff_types{-s,--no-patch}'[suppress diff output]'
-    '(--minimal --patience --histogram --diff-algorithm)--minimal[spend extra time to make sure the smallest possible diff is producedm]'
-    '(--minimal --patience --histogram --diff-algorithm)--patience[generate diffs with patience algorithm]'
-    '(--minimal --patience --histogram --diff-algorithm)--histogram[generate diffs with histogram algorithm]'
-    '(--minimal --patience --histogram --diff-algorithm)--diff-algorithm=[choose a diff algorithm]:diff algorithm:((default\:"basic greedy diff algorithm"
-                                                                                                                    myers\:"basic greedy diff algorithm"
-                                                                                                                    minimal\:"spend extra time to make sure the smallest possible diff is produced"
-                                                                                                                    patience\:"generate diffs with patience algorithm"
-                                                                                                                    histogram\:"generate diffs with histogram algorithm"))'
+    '--patience[generate diffs with patience algorithm]'
     $diff_types'--stat=-[generate diffstat instead of patch]:: :__git_guard_diff-stat-width'
     $diff_types'--numstat[generate more machine-friendly diffstat]'
     $diff_types'--shortstat[generate summary diffstat]'
@@ -5937,7 +5583,7 @@
     $diff_types'--name-only[show only names of changed files]'
     $diff_types'--name-status[show only names and status of changed files]'
     '--submodule=-[select output format for submodule differences]::format:((short\:"show pairs of commit names"
-                                                                            log\:"list commits like git submodule does"))'
+                                                                            log\:"list commits like git submodule does (default)"))'
     '(        --no-color --color-words)--color=-[show colored diff]:: :__git_color_whens'
     '(--color            --color-words)--no-color[turn off colored diff]'
     '--word-diff=-[show word diff]::mode:((color\:"highlight changed words using color"
@@ -5951,15 +5597,16 @@
     '--full-index[show full object name of pre- and post-image blob]'
     '(--full-index)--binary[in addition to --full-index, output binary diffs for git-apply]'
     '--abbrev=[set minimum SHA1 display-length]: :__git_guard_number length'
+    # TODO: --break-rewrites is undocumented.
     '(-B --break-rewrites)'{-B-,--break-rewrites=-}'[break complete rewrite changes into pairs of given size]:: :__git_guard_number size'
-    '(-M --find-renames)'{-M-,--find-renames=-}'[Detect renames with given scope]:: :__git_guard_number size'
-    '(-C --find-copies)'{-C-,--find-copies=-}'[detect copies as well as renames with given scope]:: :__git_guard_number size'
+    # TODO: --detect-renames is undocumented.
+    '(-M --detect-renames)'{-M-,--detect-renames=-}'[detect renames with given scope]:: :__git_guard_number size'
+    # TODO: --detect-copies is undocumented.
+    '(-C --detect-copies)'{-C-,--detect-copies=-}'[detect copies as well as renames with given scope]:: :__git_guard_number size'
     '--find-copies-harder[try harder to find copies]'
-    '(-D --irreversible-delete)'{-D,--irreversible-delete}'[omit the preimage for deletes]'
     '-l-[limit number of rename/copy targets to run]: :__git_guard_number'
     '--diff-filter=-[select certain kinds of files for diff]: :_guard "[ACDMRTUXB*]#" kinds'
-    '-S-[look for differences that add or remove the given string]:string'
-    '-G-[look for differences whose added or removed line matches the given regex]:pattern'
+    '-S-[look for differences that contain the given string]:string'
     '--pickaxe-all[when -S finds a change, show all changes in that changeset]'
     '--pickaxe-regex[treat argument of -S as regular expression]'
     '-O-[output patch in the order of glob-pattern lines in given file]: :_files'
@@ -5969,14 +5616,11 @@
     '--ignore-space-at-eol[ignore changes in whitespace at end of line]'
     '(-b --ignore-space-change -w --ignore-all-space)'{-b,--ignore-space-change}'[ignore changes in amount of white space]'
     '(-b --ignore-space-change -w --ignore-all-space)'{-w,--ignore-all-space}'[ignore white space when comparing lines]'
-    '--ignore-blank-lines[do not show hunks that add or remove blank lines]'
     '--inter-hunk-context=[combine hunks closer than n lines]:n'
     '--exit-code[report exit code 1 if differences, 0 otherwise]'
     '(--exit-code)--quiet[disable all output]'
     '(           --no-ext-diff)--ext-diff[allow external diff helper to be executed]'
     '(--ext-diff              )--no-ext-diff[disallow external diff helper to be executed]'
-    '(--textconv --no-textconv)--textconv[allow external text conversion filters to be run when comparing binary files]'
-    '(--textconv --no-textconv)--no-textconv[do not allow external text conversion filters to be run when comparing binary files]'
     '--ignore-submodules[ignore changes to submodules]:: :__git_ignore_submodules_whens'
     '(--no-prefix)--src-prefix=[use given prefix for source]:prefix'
     '(--no-prefix)--dst-prefix=[use given prefix for destination]:prefix'
@@ -5987,7 +5631,18 @@
     '(-0 -1 -2 -3 --base --ours --theirs -c --cc --no-index)'{-3,--theirs}'[diff against "their branch" version]'
     '(-0 -1 -2 -3 --base --ours --theirs -c --cc --no-index)-0[omit diff output for unmerged entries]'
     '(-0 -1 -2 -3 --base --ours --theirs -c --cc --no-index)'{-c,--cc}'[compare "our branch", "their branch" and working tree files]'
+    '-q[remain silent even on nonexisting files]'
 
+    # TODO: --cumulative is undocumented.
+    '--cumulative[undocumented]'
+    # TODO: --follow is undocumented.
+    '--follow[undocumented]'
+    # TODO: --textconv is undocumented.
+    '--textconv[undocumented]'
+    # TODO: --no-textconv is undocumented.
+    '--no-textconv[undocumented]'
+    # TODO: -G is undocumented.
+    '-G[undocumented]'
     # TODO: --output is undocumented.
     '--output[undocumented]:undocumented')
 }
@@ -6000,7 +5655,7 @@
   revision_options=(
     $diff_options
     # TODO: format pretty print format is a lot more advanced than this.
-    # TODO: You can't actually specify --format without a format.
+    # TODO: You can‚Äôt actually specify --format without a format.
     '(-v --header)'{--pretty=-,--format=-}'[pretty print commit messages]::format:((oneline\:"commit-ids and subject of messages"
                                                                                     short\:"few headers and only subject of messages"
                                                                                     medium\:"most parts of messages"
@@ -6009,15 +5664,13 @@
                                                                                     email\:"use email headers like From and Subject"
                                                                                     raw\:"the raw commits"
                                                                                     format\:"specify own format"))'
-    '(--abbrev-commit --no-abbrev-commit)--abbrev-commit[show only partial prefixes of commit object names]'
-    '(--abbrev-commit --no-abbrev-commit)--no-abbrev-commit[show the full 40-byte hexadecimal commit object name]'
-    '(--abbrev --no-abbrev)--abbrev=[set minimum SHA1 display-length (for use with --abbrev-commit)]: :__git_guard_number length'
-    '(--abbrev --no-abbrev)--no-abbrev[show the full 40-byte hexadecimal commit object name]'
+    '--abbrev-commit[show only partial prefixes of commit object names]'
     '--oneline[shorthand for --pretty=oneline --abbrev-commit]'
     '--encoding=-[output log messages in given encoding]:: :__git_encodings'
-    '(--no-notes --notes)--no-notes[do not show notes that annotate commit]'
-    '(--no-notes        )*--notes=[show notes that annotate commit, with optional ref argument show this notes ref instead of the default notes ref(s)]:: :__git_notes_refs'
-    '--show-signature[validate GPG signature of commit]'
+    '(--no-notes --show-notes --standard-notes --no-standard-notes)--no-notes[do not show notes that annotate commit]'
+    '(--no-notes --show-notes --standard-notes --no-standard-notes)--show-notes[do not show notes that annotate commit]:: :__git_note_references'
+    '(--no-notes --show-notes --standard-notes --no-standard-notes)--no-standard-notes[enable populating notes ref list from core.notesRef and notes.displayRef]'
+    '(--no-notes --show-notes --standard-notes --no-standard-notes)--no-standard-notes[disable populating notes ref list from core.notesRef and notes.displayRef]'
     '(                --date)--relative-date[show dates relative to current time]'
     '(--relative-date       )--date=-[format of date output]: :__git_date_formats'
     '--parents[display parents of commit]'
@@ -6041,10 +5694,6 @@
     '--remove-empty[stop when given path disappears from tree]'
     '--merges[display only merge commits]'
     '--no-merges[do not display commits with more than one parent]'
-    '(--min-parents --no-min-parents)--min-parents=-[show only commits having at least <n> commits]: :__git_guard_number "minimum number of parents"'
-    '(--min-parents --no-min-parents)--no-min-parents[reset limit]'
-    '(--max-parents --no-max-parents)--max-parents=-[show only commits having at most <n> commits]: :__git_guard_number "maximum number of parents"'
-    '(--max-parents --no-max-parents)--no-max-parents[reset limit]'
     '--first-parent[follow only first parent from merge commits]'
     '*--not[reverses meaning of ^ prefix for revisions that follow]'
     '--all[show all commits from refs]'
@@ -6053,8 +5702,8 @@
     '--remotes=[-show all commits from refs/remotes]::pattern'
     '--glob=[show all commits from refs matching glob]:pattern'
     '--stdin[read commit objects from standard input]'
+    '--cherry-pick[omit any same-change commits]'
     '(-g --walk-reflogs --reverse)'{-g,--walk-reflogs}'[walk reflog entries from most recent to oldest]'
-    '--grep-reflog=[limit commits to ones whose reflog message matches the given pattern (with -g, --walk-reflogs)]:pattern'
     '--merge[after a failed merge, show refs that touch files having a conflict]'
     '--boundary[output uninteresting commits at boundary]'
     '--simplify-by-decoration[show only commits that are referenced by a ref]'
@@ -6063,28 +5712,28 @@
     '(--full-history --dense          --simplify-merges --ancestry-path)--sparse[when paths are given, display only commits that changes any of them]'
     '(--full-history --dense --sparse                   --ancestry-path)--simplify-merges[milder version of --full-history]'
     '(--full-history --dense --sparse --simplify-merges                )--ancestry-path[only display commits that exists directly on ancestry chains]'
-    '(             --date-order --author-date-order)--topo-order[display commits in topological order]'
-    '(--topo-order              --author-date-order)--date-order[display commits in date order]'
-    '(--topo-order --date-order                    )--author-date-order[display commits in auhor date order]'
+    '(             --date-order)--topo-order[display commits in topological order]'
+    '(--topo-order             )--date-order[display commits in date order]'
     '(-g --walk-reflogs)--reverse[display commits in reverse order]'
     '(          --objects-edge)--objects[display object ids of objects referenced by listed commits]'
     '(--objects               )--objects-edge[display object ids of objects referenced by listed and excluded commits]'
     '(          --do-walk)--no-walk[only display given revs, do not traverse their ancestors]'
     '(--no-walk          )--do-walk[only display given revs, traversing their ancestors]'
-    '(              --cherry-pick)--cherry-mark[like --cherry-pick but mark equivalent commits instead of omitting them]'
-    '(--cherry-pick              )--cherry-pick[omit any commit that introduces the same change as another commit on "the other side" of a symmetric range]'
-    '(            --right-only)--left-only[list only commits on the left side of a symmetric range]'
-    '(--left-only             )--right-only[list only commits on the right side of a symmetric range]'
-    '(--left-only --right-only --cherry-pick --cherry-mark)--cherry[synonym for --right-only --cherry-mark --no-merges]'
-    '(-c --cc            )--full-diff[show full commit diffs when using log -p, not only those affecting the given path]'
-    '--log-size[print log message size in bytes before the message]'
-    '--use-mailmap[use mailmap file to map author and committer names and email]'
 
+    # TODO: --reflog is undocumented.
     '--reflog[show all commits from reflogs]'
+    # TODO: --default is undocumented.
     '--default[use argument as default revision]:default revision:__git_revisions'
+    # TODO: --full-diff is undocumented.
+    '(-c --cc            )--full-diff[undocumented]'
+    # TODO: --abrev is undocumented.
+    '--abbrev=[set minimum SHA1 display-length]: :__git_guard_number length'
+    # TODO: --no-abbrev is undocumented.
+    '--no-abbrev[undocumented]'
     # TODO: --early-output is undocumented.
     '--early-output=-[undocumented]::undocumented'
-    )
+    # TODO: --log-size is undocumented.
+    '--log-size[undocumented]')
 
   if (( words[(I)--objects(|-edge)] )); then
     revision_options+=('--unpacked[print object IDs not in packs]')
@@ -6096,8 +5745,6 @@
   merge_options=(
     '(         --no-commit)--commit[perform the merge and commit the result]'
     '(--commit            )--no-commit[perform the merge but do not commit the result]'
-    '(         --no-edit)--edit[open an editor to change the commit message]'
-    '(--edit            )--no-edit[do not open an editor to change the commit message]'
     '(     --no-ff)--ff[do not generate a merge commit if the merge resolved as a fast-forward]'
     '(--ff        )--no-ff[generate a merge commit even if the merge resolved as a fast-forward]'
     '(      --no-log)--log[fill in one-line descriptions of the commits being merged in the log message]'
@@ -6109,8 +5756,6 @@
     '--ff-only[refuse to merge unless HEAD is up to date or merge can be resolved as a fast-forward]'
     '*'{-s,--strategy=}'[use given merge strategy]:merge strategy:__git_merge_strategies'
     '*'{-X,--strategy-option=}'[pass merge-strategy-specific option to merge strategy]'
-    '(--verify-signatures)--no-verify-signatures[verify the commits being merged or abort]'
-    '(--no-verify-signatures)--verify-signatures[do not verify the commits being merged]'
     '(-q --quiet -v --verbose)'{-q,--quiet}'[suppress all output]'
     '(-q --quiet -v --verbose)'{-v,--verbose}'[output additional information]')
 }
@@ -6121,7 +5766,6 @@
     '(: *)--all[fetch all remotes]'
     '(-a --append)'{-a,--append}'[append ref names and object names of fetched refs to "$GIT_DIR/FETCH_HEAD"]'
     '--depth=[deepen the history of a shallow repository by the given number of commits]: :__git_guard_number depth'
-    '--unshallow[convert a shallow clone to a complete one]'
     '--dry-run[show what would be done, without making any changes]'
     '(-f --force)'{-f,--force}'[allow refs that are not ancestors to be updated]'
     '(-k --keep)'{-k,--keep}'[keep downloaded pack]'
@@ -6130,13 +5774,6 @@
     '(--no-tags -t --tags)'{-t,--tags}'[fetch remote tags]'
     '(-u --update-head-ok)'{-u,--update-head-ok}'[allow updates of current branch head]'
     '--upload-pack=[specify path to git-upload-pack on remote side]:remote path'
-    '(--no-recurse-submodules --recurse-submodules)--recurse-submodules=-[specify when to fetch commits of submodules]::recursive fetching mode:((no\:"disable recursion"
-                                                                                                                                                yes\:"always recurse"
-                                                                                                                                                on-demand\:"only when submodule reference in superproject is updated"))'
-    '(--no-recurse-submodules --recurse-submodules)--no-recurse-submodules[disable recursive fetching of submodules]'
-    '(--no-recurse-submodules)--recurse-submodules-default=-[provide internal temporary non-negative value for "--recurse-submodules"]::recursive fetching mode:((yes\:"always recurse"
-                                                                                                                                                                 on-demand\:"only when submodule reference in superproject is updated"))'
-    '--submodule-prefix=-[prepend <path> to paths printed in informative messages]:submodule prefix path:_files -/'
     '(-q --quiet -v --verbose --progress)'{-q,--quiet}'[suppress all output]'
     '(-q --quiet -v --verbose)'{-v,--verbose}'[output additional information]'
     '(-q --quiet)--progress[output progress information]')
@@ -6150,10 +5787,7 @@
     '-C-[ensure at least N lines of context match before and after each change]: :_guard  "[[\:digit\:]]#" "number of lines of context"'
     '--reject[apply hunks that apply and leave rejected hunks in .rej files]'
     '(--ignore-space-change --ignore-whitespace)'{--ignore-space-change,--ignore-whitespace}'[ignore changes in whitespace in context lines]'
-    '--directory=[root to prepend to all filenames]:root:_directories'
-    '*--exclude=[skip files matching specified pattern]:pattern'
-    '*--include=[include files matching specified pattern]:pattern'
-    )
+    '--directory=[root to prepend to all filenames]:root:_directories')
 }
 
 # Git Config Helpers
@@ -6193,14 +5827,14 @@
 # -l can be used to specify a label to use (default: boolean).
 #
 # The first argument is the current value, so that the description of the
-# current value can be suffixed with " (current)".
+# current value can be suffixed with ‚Äú (current)‚Äù.
 #
 # The second argument is the default value, so that the description of the
-# default value can be suffixed with " (default)".
+# default value can be suffixed with ‚Äú (default)‚Äù.
 #
 # The third argument is the description to use for the true and false values.
 #
-# The rest of the arguments can be used to provide additional "boolean" values
+# The rest of the arguments can be used to provide additional ‚Äúboolean‚Äù values
 # that should be included.  They should be of the form that _describe expects.
 (( $+functions[__git_config_booleans] )) ||
 __git_config_booleans () {
@@ -6226,10 +5860,10 @@
 # -l can be used to specify a label to use (default: value).
 #
 # The first argument is the current value, so that the description of the
-# current value can be suffixed with " (current)".
+# current value can be suffixed with ‚Äú (current)‚Äù.
 #
 # The second argument is the default value, so that the description of the
-# default value can be suffixed with " (default)".
+# default value can be suffixed with ‚Äú (default)‚Äù.
 #
 # The rest of the arguments are values of the form VALUE:DESCRIPTION to be
 # passed to _describe.
@@ -6245,7 +5879,7 @@
   default=$2
   shift 2
   values=($*)
-  [[ -n $current ]] && values[(r)$(__git_pattern_escape $current):*]+=' (current)'
+  [[ -n $current ]] && values[(r)$(__git_pattern_escape $default):*]+=' (current)'
   values[(r)$(__git_pattern_escape $default):*]+=' (default)'
 
   _describe -t ${opts[-t]:-values} ${opts[-l]:-value} values
@@ -6262,8 +5896,6 @@
   builtinbrowsers=(
     firefox
     iceweasel
-    google-chrome
-    chromium
     konquerer
     w3m
     links
@@ -6407,10 +6039,9 @@
     author:'avoid including patch author' \
     self:'avoid including sender' \
     cc:'avoid including anyone mentioned in Cc lines except for self' \
-    bodycc:'avoid including anyone mentioned in Cc lines in patch body except for self' \
-    sob:'avoid including anyone mentioned in Signed-off-by lines except for self' \
+    bodycc:'avoid including anyone mentiond in Cc lines in patch body except for self' \
+    sob:'avoid including anyone mentiond in Signed-off-by lines except for self' \
     cccmd:'avoid running --cc-cmd' \
-    tocmd:'avoid running --to-cmd' \
     body:'equivalent to sob + bodycc' \
     all:'avoid all auto Cc values'
 }
@@ -6433,12 +6064,12 @@
   _describe -t attributes attribute attributes $*
 }
 
-# Now, for the main drive...
+# Now, for the main driver‚Ä¶
 _git() {
   if (( CURRENT > 2 )); then
     local -a aliases
     local -A git_aliases
-    # TODO: Should use -z here, but I couldn't get it to work.
+    # TODO: Should use -z here, but I couldn‚Äôt get it to work.
     aliases=(${(f)${${${(f)"$(_call_program aliases git config --get-regexp '\^alias\.')"}#alias.}/ /$'\n'}/(#e)/$'\n'})
     (( $#aliases % 2 == 0 )) && git_aliases=($aliases)
 
@@ -6471,17 +6102,13 @@
       '(- :)--help[display help message]' \
       '-c[pass configuration parameter to command]:parameter' \
       '--exec-path=-[path containing core git-programs]:: :_directories' \
-      '(: -)--man-path[print the manpath for the man pages for this version of Git and exit]' \
-      '(: -)--info-path[print the path where the info files are installed and exit]' \
-      '(: -)--html-path[display path to HTML documentation and exit]' \
+      '--html-path[display path to HTML documentation and exit]' \
       '(-p --paginate)'{-p,--paginate}'[pipe output into $PAGER]' \
       '--no-pager[do not pipe git output into a pager]' \
       '--git-dir=-[path to repository]: :_directories' \
       '--work-tree=-[path to working tree]: :_directories' \
-      '--namespace=-[set the Git namespace]: :_directories' \
       '--bare[use $PWD as repository]' \
       '--no-replace-objects[do not use replacement refs to replace git objects]' \
-      '--literal-pathspecs[treat pathspecs literally, rather than as glob patterns]' \
       '(-): :->command' \
       '(-)*:: :->option-or-argument' && return
 
diff -ruN zsh-5.0.4/Completion/Unix/Command/_gradle zsh-5.0.2/Completion/Unix/Command/_gradle
--- zsh-5.0.4/Completion/Unix/Command/_gradle	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_gradle	2012-03-25 07:50:45.000000000 -0700
@@ -24,7 +24,7 @@
 zstyle -T ":completion:*:*:$service:*" gradle-inspect || gradle_inspect=no
 
 _arguments -C \
-    '(-)'{-\?,-h,--help}'[Shows a help message.]' \
+    '(-)'{-\?,-h,--help}'[Shows this help message.]' \
     {-a,--no-rebuild}'[Do not rebuild project dependencies.]' \
     {-b,--build-file}'[Specifies the build file.]:build file:_files -g "*.gradle(-.)"' \
     {-C,--cache}'[Specifies how compiled build scripts should be cached.]:cache policy:(on rebuild)' \
@@ -45,17 +45,12 @@
     '--offline[The build should operate without accessing network resources.]' \
     \*{-P+,--project-prop}'[Set project property for the build script (e.g. -Pmyprop=myvalue).]:project property (prop=val):' \
     {-p,--project-dir}'[Specifies the start directory for Gradle.]:start directory:_directories' \
-    '--parallel[Build projects in parallel. Gradle will attempt to determine the optimal number of executor threads to use.]' \
-    '--parallel-threads[Build projects in parallel, using the specified number of executor threads.]' \
     '--profile[Profiles build execution time and generates a report in the <build_dir>/reports/profile directory.]' \
     '--project-cache-dir[Specifies the project-specific cache directory.]:cache directory:_directories' \
     '(-d --debug -i --info)'{-q,--quiet}'[Log errors only.]' \
-    '--recompile-scripts[Force build script recompiling.]' \
-    '--refresh[Refresh the state of resources of the type(s) specified.]:refresh policy:(dependencies)' \
-    '--refresh-dependencies[Refresh the state of dependencies.]' \
-    '--rerun-tasks[Ignore previously cached task results.]' \
-    '(-S --full-stacktrace)'{-s,--stacktrace}'[Print out the stacktrace for all exceptions.]' \
+    "--refresh[Refresh the state of resources of the type(s) specified.]:refresh policy:(dependencies)" \
     '(-s --stacktrace)'{-S,--full-stacktrace}'[Print out the full (very verbose) stacktrace for all exceptions.]' \
+    '(-S --full-stacktrace)'{-s,--stacktrace}'[Print out the stacktrace for all exceptions.]' \
     '(-)--stop[Stops the Gradle daemon if it is running.]' \
     {-u,--no-search-upward}"[Don't search in parent folders for a settings.gradle file.]" \
     '(-)'{-v,--version}'[Print version info.]' \
@@ -63,7 +58,7 @@
     '*:task:->task' \
     && ret=0
 
-if [[ $words[CURRENT] != -* ]]; then
+if [[ -n $state ]]; then
     if [[ $gradle_inspect == yes ]]; then
         # If a build file is specified after '-b' or '--build-file', use this file. Otherwise,
         # default is the file 'build.gradle' in the current directory.
@@ -107,8 +102,7 @@
         fi
     else
         _describe 'built-in tasks' '(
-            "dependencies:Displays all dependencies declared in root project."
-            "dependencyInsight:Displays the insight into a specific dependency in root project."
+            "dependencies:Displays the dependencies of root project."
             "help:Displays a help message."
             "projects:Displays the sub-projects of root project."
             "properties:Displays the properties of root project."
diff -ruN zsh-5.0.4/Completion/Unix/Command/_graphicsmagick zsh-5.0.2/Completion/Unix/Command/_graphicsmagick
--- zsh-5.0.4/Completion/Unix/Command/_graphicsmagick	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_graphicsmagick	2010-01-22 23:16:47.000000000 -0800
@@ -3,7 +3,7 @@
 local state line expl formats curcontext="$curcontext"
 typeset -A opt_args
 
-formats=jpg:jpeg:tiff:miff:ras:bmp:cgm:dcx:ps:eps:fig:fits:fpx:gif:mpeg:pbm:pgm:ppm:pcd:pcl:pdf:pcx:png:rad:rgb:rgba:rle:sgi:html:shtml:tga:ttf:uil:xcf:xwd:xbm:xpm:yuv
+formats=jpg:jpeg:tiff:miff:ras:bmp:cgm:dcx:ps:eps:fig:fits:fpx:gif:mpeg:pbm:pgm:ppm:pcd:pcl:pdf:pcx:png:rad:rgb:rgba:rle:sgi:html:shtml:tga:ttf:uil:xwd:xbm:xpm:yuv
 
 if (( $# )); then
   _files "$@" -g "*.(#i)(${~formats//:/|})(-.)"
diff -ruN zsh-5.0.4/Completion/Unix/Command/_growisofs zsh-5.0.2/Completion/Unix/Command/_growisofs
--- zsh-5.0.4/Completion/Unix/Command/_growisofs	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_growisofs	2011-05-24 13:39:33.000000000 -0700
@@ -139,8 +139,8 @@
         [[ $words[CURRENT-1] == -([HLP]|-(help|version)) ]]) ||
        [[ -d $words[CURRENT-1] ]]; then
     # TODO: all $words[index_of_find,CURRENT-1] must be -d.
-    # But we can perhaps assume that the user hasn't gone back and changed an
-    # argument without thinking about it carefully...otherwise, all previous
+    # But we can perhaps assume that the user hasn‚Äôt gone back and changed an
+    # argument without thinking about it carefully‚Ä¶otherwise, all previous
     # words of interest will have passed the -d test.
     _arguments \
       $find_paths \
diff -ruN zsh-5.0.4/Completion/Unix/Command/_gzip zsh-5.0.2/Completion/Unix/Command/_gzip
--- zsh-5.0.4/Completion/Unix/Command/_gzip	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_gzip	2004-01-21 05:53:29.000000000 -0800
@@ -82,11 +82,7 @@
       _files "$expl[@]" -g '^*.(([tT]|)[gG]|)[zZ](-.)' && return
     else
       _description files expl 'compressed file'
-      if (( $+opt_args[-f] )); then
-	_files "$expl[@]" && return
-      else
-	_files "$expl[@]" -g '*.(([tT]|)[gG]|)[zZ](-.)' && return
-      fi
+      _files "$expl[@]" -g '*.(([tT]|)[gG]|)[zZ](-.)' && return
     fi
   fi
   ;;
diff -ruN zsh-5.0.4/Completion/Unix/Command/_iconv zsh-5.0.2/Completion/Unix/Command/_iconv
--- zsh-5.0.4/Completion/Unix/Command/_iconv	2013-12-09 13:19:29.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_iconv	2012-11-15 13:02:00.000000000 -0800
@@ -1,58 +1,37 @@
 #compdef iconv
 
 local expl curcontext="$curcontext" state line ret=1
+local LOCPATH="${LOCPATH:-/usr/lib/nls/loc}"
+local -U codeset
 
-if _pick_variant libiconv='GNU*libiconv' glibc='(GNU*libc|EGLIBC)' unix --version; then
-  local -a args
-  local exargs="-l --list -? --help --usage --version -V"
-
-  args=(
-    "(-f --from-code $exargs)"{-f+,--from-code=}'[specify code set of input file]:code set:->from_codeset'
-    "(-t --to-code $exargs)"{-t+,--to-code=}'[specify code set for output]:code set:->to_codeset'
-    '(- 1 -l --list)'{-l,--list}'[list all character code sets]'
-    "($exargs)-c[omit invalid characters from output]"
-    "(-s --silent --verbose $exargs)"{-s,--silent}'[suppress warnings]'
-    '(-)'{-\?,--help}'[display help information]'
-    '(-)--usage[display a short usage message]'
-    '(-)'{-V,--version}'[print program version]'
-    '1:input file:_files' 
-  )
-
-  case $_cmd_variant[$service] in
-    (libiconv)
-      args=( ${(R)args:#(|\*)(|\(*\))-[V\?]*} )  # remove -V and -?
-      args+=(
-       '--byte-subst=[format for unconvertible bytes]:format string:'
-       '--widechar-subst=[format for unconvertible wide chars]:format string:'
-       '--unicode-subst=[format for unconvertible Unicode chars]:format string:'
-      )
-      ;;
-    (glibc)
-      args+=( 
-        "(-o --output $exargs)"{-o+,--output=}'[specify output file]:output file:_files'
-        "(-s --silent $exargs)--verbose[print progress information]"
-      )
-      ;;
-  esac
-
-  _arguments -C -S -s : $args && return 0
-
-  if [[ $state = *_codeset ]]; then
-    # suffix is meaningfull only for output encoding
-    if [[ $state = to_codeset ]] && compset -P '*[^/]/'; then
-      _wanted suffix expl suffix compadd "$@" /TRANSLIT /IGNORE && ret=0
+if _pick_variant gnu='(GNU|EGLIBC)' unix --version; then
+
+  local exargs="--list -? --help --usage --version -V"
+  _arguments -C -S -s \
+    "(-f --from-code $exargs)"{-f+,--from-code=}'[specify code set of input file]:code set:->codeset' \
+    "(-t --to-code $exargs)"{-t+,--to-code=}'[specify code set for output]:code set:->codeset' \
+    '(- 1 -l --list)'{-l,--list}'[list all character code sets]' \
+    "($exargs)-c[omit invalid characters from output]" \
+    "(-o --output $exargs)"{-o+,--output=}'[specify output file]:output file:_files' \
+    "(-s --silent --verbose $exargs)"{-s,--silent}'[suppress warnings]' \
+    "(-s --silent $exargs)--verbose[print progress information]" \
+    '(-)'{-\?,--help}'[display help information]' \
+    '(-)--usage[display a short usage message]' \
+    '(-)'{-V,--version}'[print program version]' \
+    '1:input file:_files' && return 0
+
+  if [[ $state = codeset ]]; then
+    if compset -P '*[^/]/'; then
+      _wanted option expl option compadd "$@" /TRANSLIT && ret=0
     else
       _wanted codesets expl 'code set' compadd "$@" \
-        -M 'm:{a-zA-Z}={A-Za-z} r:|-=* r:|=*' \
-        ${$(_call_program codesets iconv --list)%//} && ret=0
+	  -M 'm:{a-zA-Z}={A-Za-z} r:|-=* r:|=*' \
+	  ${${${(f)"$(_call_program codesets iconv --list)"}## #}%//} && ret=0
     fi
   fi
 
   return ret
-
 else
-  local LOCPATH="${LOCPATH:-/usr/lib/nls/loc}"
-  local -U codeset
 
   _arguments -C \
     '-f[specify code set of input file]:code set:->codeset' \
diff -ruN zsh-5.0.4/Completion/Unix/Command/_imagemagick zsh-5.0.2/Completion/Unix/Command/_imagemagick
--- zsh-5.0.4/Completion/Unix/Command/_imagemagick	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_imagemagick	2006-02-19 13:20:43.000000000 -0800
@@ -11,7 +11,7 @@
 #
 # and certainly many other things...
 
-formats=jpg:jpeg:tiff:miff:ras:bmp:cgm:dcx:ps:eps:fig:fits:fpx:gif:mpeg:pbm:pgm:ppm:pcd:pcl:pdf:pcx:png:rad:rgb:rgba:rle:sgi:html:shtml:tga:ttf:uil:xcf:xwd:xbm:xpm:yuv
+formats=jpg:jpeg:tiff:miff:ras:bmp:cgm:dcx:ps:eps:fig:fits:fpx:gif:mpeg:pbm:pgm:ppm:pcd:pcl:pdf:pcx:png:rad:rgb:rgba:rle:sgi:html:shtml:tga:ttf:uil:xwd:xbm:xpm:yuv
 
 if (( $# )); then
   _files "$@" -g "*.(#i)(${~formats//:/|})(-.)"
diff -ruN zsh-5.0.4/Completion/Unix/Command/_java zsh-5.0.2/Completion/Unix/Command/_java
--- zsh-5.0.4/Completion/Unix/Command/_java	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_java	2005-06-08 05:45:35.000000000 -0700
@@ -229,7 +229,7 @@
       '-keypass[password for private key]:password for private key:' \
       '-validity[valid days]:number of days:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - import \
@@ -240,7 +240,7 @@
       '-noprompt[disable interaction with the user]' \
       '-trustcacerts[use cacerts]' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - selfcert \
@@ -251,14 +251,14 @@
       '-validity[valid days]:number of days:' \
       '-keypass[password for private key]:password for private key:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - identitydb \
       '-identitydb[command to read identity database]' \
       '-file[specify identity database file]:identity database file:_files' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - certreq \
@@ -268,7 +268,7 @@
       '-file[specify certificate signing request file]:certificate signing request file:_files' \
       '-keypass[password for private key]:password for private key:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - export \
@@ -277,14 +277,14 @@
       '-file[specify certificate file]:certificate file:_files' \
       '-rfc[make certificate format printable as RFC 1421]' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - list \
       '-list[command to print keystore entry]' \
       '-alias[alias]:alias:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '(-rfc)-v[make certificate format human-readable]' \
       '(-v)-rfc[make certificate format printable as RFC 1421]' \
@@ -299,14 +299,14 @@
       '-keypass[password for private key]:password for private key:' \
       '-new[password for private key of new entry]:password for private key of new entry:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - storepasswd \
       '-storepasswd[command to change password for keystore]' \
       '-new[new password]:new password:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - keypasswd \
@@ -315,14 +315,14 @@
       '-keypass[old password for private key]:old password for private key:' \
       '-new[nwe password for private key]:new password for private key:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - delete \
       '-delete[command to delete entry]' \
       '-alias[alias]:alias:' \
       '-storetype[keystore type]:store type:' \
-      '-keystore[keystore location]:keystore location:_files' \
+      '-keystore[keystore location]:keystore location:' \
       '-storepass[password for keystore]:password:' \
       '-v[verbose mode]' \
     - help \
@@ -331,7 +331,7 @@
 
 jarsigner)
   _arguments \
-    '-keystore[keystore location]:keystore location:_files' \
+    '-keystore[specify URL for keystore location]:URL for keystore location:' \
     '-storetype[specify keystore type]:store type:' \
     '-storepass[specify password for keystore]:password:' \
     '-keypass[specify password for private key]:password:' \
diff -ruN zsh-5.0.4/Completion/Unix/Command/_make zsh-5.0.2/Completion/Unix/Command/_make
--- zsh-5.0.4/Completion/Unix/Command/_make	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_make	2011-05-27 12:19:28.000000000 -0700
@@ -1,4 +1,4 @@
-#compdef make gmake pmake dmake freebsd-make bmake
+#compdef make gmake pmake dmake
 
 # TODO: Based on targets given on the command line, show only variables that
 # are used in those targets and their dependencies.
@@ -59,7 +59,7 @@
 }
 
 _make-parseMakefile () {
-  local input var val target dep TAB=$'\t' dir=$1 tmp IFS=
+  local input var val target dep TAB=$'\t' dir=$1 tmp
 
   while read input
   do
@@ -148,9 +148,7 @@
 _make() {
 
   local prev="$words[CURRENT-1]" file expl tmp is_gnu dir incl match
-  local context state state_descr line
-  local -a option_specs
-  local -A TARGETS VARIABLES opt_args
+  local -A TARGETS VARIABLES
   local ret=1
 
   _pick_variant -r is_gnu gnu=GNU unix -v -f
@@ -158,77 +156,21 @@
   if [[ $is_gnu == gnu ]]
   then
     incl="(-|)include"
-    option_specs=(
-      '(-B --always-make)'{-B,--always-make}'[unconditionally make all targets]'
-      '*'{-C,--directory=}'[change directory first]:change to directory:->dir'
-      '-d[print lots of debug information]'
-      '--debug=-[print various types of debug information]:debug options:->debug'
-      '(-e --environment-overrides)'{-e,--environment-overrides}'[environment variables override makefiles]'
-      '--eval=-[evaluate STRING as a makefile statement]:STRING'
-      '(-f --file --makefile)'{-f,--file=,--makefile=}'[read FILE as a makefile]:makefile:->file'
-      '(- *)'{-h,--help}'[print help message and exit]'
-      '(-i --ignore-errors)'{-i,--ignore-errors}'[ignore errors from recipes]'
-      '*'{-I,--include-dir=}'[search DIRECTORY for included makefiles]:search path for included makefile:->dir'
-      '(-j --jobs)'{-j,--jobs=}'[allow N jobs at once; infinite jobs with no arg]:number of jobs'
-      '(-k --keep-going)'{-k,--keep-going}"[keep going when some targets can't be made]"
-      '(-l --load-average --max-load)'{-l,--load-average=,--max-load}"[don't start multiple jobs unless load is below N]:load"
-      '(-L --check-symlik-times)'{-L,--check-symlink-times}'[use the latest mtime between symlinks and target]'
-      '(-n --just-print --dry-run --recon)'{-n,--just-print,--dry-run,--recon}"[don't actually run any recipe; just print them]"
-      '*'{-o,--old-file=,--assume-old=}"[consider FILE to be very old and don't remake it]:file not to remake:->file"
-      '(-p --print-data-base)'{-p,--print-data-base}'[print makes internal database]'
-      '(-q --question)'{-q,--question}'[run no recipe; exit status says if up to date]'
-      '(-r --no-builtin-rules)'{-r,--no-builtin-rules}'[disable the built-in implicit rules]'
-      '(-R --no-builtin-variables)'{-R,--no-builtin-variables}'[disable the built-in variable settings]'
-      '(-s --silent --quiet)'{-s,--silent,--quiet}"[don't echo recipes]"
-      '(-S --no-keep-going --stop)'{-S,--no-keep-going,--stop}'[turns off -k]'
-      '(-t --touch)'{-t,--touch}'[touch targets instead of remaking them]'
-      '(- *)'{-v,--version}'[print the version number of make and exit]'
-      '(-w --print-directory)'{-w,--print-directory}'[print the current directory]'
-      '--no-print-directory[turn off -w, even if it was turned on implicitly]'
-      '*'{-W,--what-if=,--new-file=,--assume-new=}'[consider FILE to be infinitely new]:file to treat as modified:->file'
-      '--warn-undefined-variables[warn when an undefined variable is referenced]'
-      '--warn-undefined-functions[warn when an undefined user function is called]'
-    )
   else
-    # Basic make options only.
     incl=.include
-    option_specs=(
-      '-C[change directory first]:directory:->dir'
-      '-I[include directory for makefiles]:directory:->dir'
-      '-f[specify makefile]:makefile:->file'
-      '-o[specify file not to remake]:file not to remake:->file'
-      '-W[pretend file was modified]:file to treat as modified:->file'
-    )
   fi
 
-  _arguments -s $option_specs \
-    '*:make target:->target' && ret=0
-
-  case $state in
-    (dir)
-    _description directories expl "$state_descr"
-    _files "$expl[@]" -W ${(q)$(_make-findBasedir ${words[1,CURRENT-1]})} -/ && ret=0
-    ;;
-
-    (file)
-    _description files expl "$state_descr"
-    _files "$expl[@]" -W ${(q)$(_make-findBasedir $words)} && ret=0
-    ;;
-
-    (debug)
-    _values -s , 'debug options' \
-      '(b v i j m)a[all debugging output]' \
-      'b[basic debugging output]' \
-      '(b)v[one level above basic]' \
-      '(b)i[describe implicit rule searches (implies b)]' \
-      'j[show details on invocation of subcommands]' \
-      'm[enable debugging while remaking makefiles]' && ret=0
-    ;;
-
-    (target)
-    file=${(v)opt_args[(I)(-f|--file|--makefile)]}
-    if [[ -n $file ]]
+  if [[ "$prev" == -[CI] ]]
+  then
+    _files -W ${(q)$(_make-findBasedir ${words[1,CURRENT-1]})} -/ && ret=0
+  elif [[ "$prev" == -[foW] ]]
+  then
+    _files -W ${(q)$(_make-findBasedir $words)} && ret=0
+  else
+    file="$words[(I)-f]"
+    if (( file ))
     then
+      file=${~words[file+1]}
       [[ $file == [^/]* ]] && file=${(q)$(_make-findBasedir $words)}/$file
       [[ -r $file ]] || file=
     else
@@ -280,7 +222,7 @@
           compadd -S '=' -- ${(k)VARIABLES} && ret=0
       done
     fi
-  esac
+  fi
 
   return ret
 }
diff -ruN zsh-5.0.4/Completion/Unix/Command/_osc zsh-5.0.2/Completion/Unix/Command/_osc
--- zsh-5.0.4/Completion/Unix/Command/_osc	1969-12-31 16:00:00.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_osc	2012-02-05 11:22:57.000000000 -0800
@@ -0,0 +1,149 @@
+#compdef osc
+#
+# Copyright (C) 2009,2010 Holger Macht <holger@homac.de>
+#
+# This file is released under the GPLv2.
+#
+# Based on the zsh guide from http://zsh.dotsrc.org/Guide/zshguide06.html
+#
+# Toggle verbose completions: zstyle ':completion:*:osc:*' verbose no
+#                             zstyle ':completion:*:osc-subcommand:*' verbose no
+# 
+# Use the variables $ZSH_OSC_BUILD_TARGETS_EXTRA and $ZSH_OSC_PROJECTS_EXTRA to
+# extend the list of possible completions in your ~/.zshrc like that:
+#  export OSC_PROJECTS_EXTRA="Base:System Base:shells"
+#
+# version 0.2
+#
+
+OSC_BUILD_TARGETS="openSUSE_11.2 openSUSE_11.3 openSUSE_11.4 openSUSE_12.1 openSUSE_Tumbleweed openSUSE_Factory SLE_11_SP1"
+OSC_PROJECTS="openSUSE:Factory openSUSE:Tumbleweed openSUSE:12.1 openSUSE:11.4 openSUSE:11.2 openSUSE:11.3"
+
+# user defined variables $OSC_BUILD_TARGETS_EXTRA and
+# $OSC_PROJECTS_EXTRA can add to the project/build target list
+OSC_BUILD_TARGETS="$OSC_BUILD_TARGETS $ZSH_OSC_BUILD_TARGETS_EXTRA"
+OSC_PROJECTS="$OSC_PROJECTS $ZSH_OSC_PROJECTS_EXTRA"
+
+# Main dispatcher
+
+_osc() {
+    if (( CURRENT > 2 )) && [[ ${words[2]} != "help" ]]; then
+        # Remember the subcommand name
+	local cmd=${words[2]}
+        # Set the context for the subcommand.
+	curcontext="${curcontext%:*:*}:osc-subcommand"
+        # Narrow the range of words we are looking at to exclude `osc'
+	(( CURRENT-- ))
+	shift words
+        # Run the completion for the subcommand
+	if [ "$cmd" = "submitreq" -o "$cmd" = "sr" ]; then
+	    _osc_cmd_submitreq
+	elif [ "$cmd" = "getbinaries" ]; then
+	    _osc_cmd_getbinaries
+	elif [ "$cmd" = "checkout" -o "$cmd" = "co" -o "$cmd" = "branch" ]; then
+	    _osc_cmd_checkout
+	elif [ "$cmd" = "buildlog" -o "$cmd" = "buildinfo" -o "$cmd" = "bl" ]; then
+	    _osc_cmd_buildlog
+	else
+	    _osc_cmd_do $cmd
+	fi
+    else
+	local hline
+	local -a cmdlist
+	local tag=0
+	_call_program help-commands osc help | while read -A hline; do
+	    # start parsing with "commands:"
+	    [[ $hline[1] = "commands:" ]] && tag=1
+	    # stop parsing at the line starting with "For"
+	    [[ $hline[1] = "For" ]] && tag=0
+	    [[ $tag = 0 ]] && continue
+	    # all commands have to start with lower case letters
+	    [[ $hline[1] =~ ^[A-Z] ]] && continue
+	    (( ${#hline} < 2 )) && continue
+
+    	    # ${hline[1]%,} truncates the last ','
+	    cmdlist=($cmdlist "${hline[1]%,}:${hline[2,-1]}")
+	done
+	_describe -t osc-commands 'osc command' cmdlist
+    fi
+}
+
+_osc_cmd_getbinaries() {
+    _arguments \
+	'1:PROJECT:( `echo $OSC_PROJECTS` )' \
+	'2:PACKAGE:(PACKAGE)' \
+	'3:REPOSITORY:( `echo $OSC_BUILD_TARGETS` )' \
+	'4:ARCHITECTURE:(i586 x86_64)'
+}
+
+_osc_cmd_checkout() {
+    _arguments \
+	'1:PROJECT:( `echo $OSC_PROJECTS` )' \
+	'2:PACKAGE:(PACKAGE)'
+}
+
+_osc_cmd_buildlog() {
+    _arguments \
+	'1:REPOSITORY:( `echo $OSC_BUILD_TARGETS` )' \
+	'2:ARCHITECTURE:(i586 x86_64)'
+}
+
+_osc_cmd_submitreq() {
+    local hline
+    local -a cmdlist
+    local tag=0
+    _call_program help-commands osc help $cmd | while read -A hline; do
+        # start parsing from "usage:"
+	[[ $hline[1] = "usage:" ]] && tag=1
+	[[ $tag = 0 ]] && continue
+
+	if [[ $hline[1] =~ ^osc ]]; then
+	    shift hline; shift hline
+	elif ! [[ $hline[1] =~ ^- ]]; then
+            # Option has to start with a '-' or 'osc submitrequest'
+	    continue
+	fi
+
+	(( ${#hline} < 2 )) && continue
+
+	cmdlist=($cmdlist "${hline[1]%,}:${hline[2,-1]}")
+
+    done
+    
+    _describe -t osc-commands 'osc command' cmdlist
+}
+
+
+_osc_cmd_do() {
+    local hline
+    local -a cmdlist
+    local tag=0
+    
+    # only start completion if theres some '-' on the line
+    if ! [ "$words[2]" = "-" ]; then
+	_complete
+	return
+    fi
+
+    _call_program help-commands osc help $cmd | while read -A hline; do
+	# start parsing from "Options:"
+	[[ $hline[1] = "Options:" ]] && tag=1
+	[[ $tag = 0 ]] && continue
+	# Option has to start with a '-'
+	[[ $hline[1] =~ ^- ]] || continue
+	(( ${#hline} < 2 )) && continue
+
+	cmdlist=($cmdlist "${hline[1]%,}:${hline[2,-1]}")
+    done
+
+    if [ -n "$cmdlist" ]; then
+	_describe -t osc-commands 'osc command' cmdlist
+    else
+	_complete
+    fi
+}
+
+# Code to make sure _osc is run when we load it
+_osc "$@"
+
+
diff -ruN zsh-5.0.4/Completion/Unix/Command/_perforce zsh-5.0.2/Completion/Unix/Command/_perforce
--- zsh-5.0.4/Completion/Unix/Command/_perforce	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_perforce	2012-12-15 10:25:11.000000000 -0800
@@ -1401,18 +1401,16 @@
   if [[ $argv[-2] = -e ]]; then
     ajobview=(-e "${(q)argv[-1]}")
     argv=("${(@)argv[1,-3]}")
-  elif zstyle -s ":completion:${curcontext}:jobs" jobview jobview; then
-    ajobview=(-e "'$jobview'")
-  elif [[ -n $PREFIX ]]; then
-    # Extra quotes for the benefit of _call_program which does an "eval".
-    ajobview=(-e "'job=$PREFIX\\*$SUFFIX'")
+  else
+    zstyle -s ":completion:${curcontext}:jobs" jobview jobview &&
+    ajobview=(-e $jobview)
   fi
   if [[ ${NUMERIC:-0} -lt 0 && -z $compstate[insert] ]]; then
   # Not inserting (i.e. just listing) and given a negative
   # prefix argument.  Instead of listing possible completions,
   # show the full description for the job which is on the line at
   # the moment.
-    _message -r "$(_perforce_call_p4 jobs jobs -e \"'Job=\$PREFIX\$SUFFIX'\" -l 2>/dev/null)"
+    _message -r "$(_perforce_call_p4 jobs jobs -e \"Job=\$PREFIX\$SUFFIX\" -l 2>/dev/null)"
     return 0
   elif [[ ${NUMERIC:-0} -gt 0 ]]; then
     max=$NUMERIC
diff -ruN zsh-5.0.4/Completion/Unix/Command/_prove zsh-5.0.2/Completion/Unix/Command/_prove
--- zsh-5.0.4/Completion/Unix/Command/_prove	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_prove	1969-12-31 16:00:00.000000000 -0800
@@ -1,51 +0,0 @@
-#compdef prove
-#
-# prove(1) of TAP::Harness v3.25. Consider also:
-#
-# zstyle ':completion:*:*:prove:*' file-patterns '*.t:test\ files *(-/):directories'
-
-_arguments \
-  '(- *)'{-h,--help}'[display help and exit]' \
-  '(- *)'{-H,--man}'[display longer help and exit]' \
-  '(- *)--version[display version and exit]' \
-  '(--quiet -q -Q --QUIET)'{-v,--verbose}'[print all test lines]' \
-  {-l,--lib}'[add lib to path]' \
-  {-b,--blib}'[add blib to path]' \
-  '(--reverse)'{-s,--shuffle}'[run tests in random order]' \
-  '(--nocolor)'{-c,--color}'[colored test output]' \
-  '(--color -c)--nocolor[do not color test output]' \
-  '(--nocount)--count[show x/y test count when not verbose]' \
-  '(--count)--nocount[disable x/y test count]' \
-  {-D,--dry}'[dry run]' \
-  '--ext=[set extension for tests]:extension:' \
-  {-f,--failures}'[show failed tests]' \
-  {-o,--comments}'[show comments]' \
-  '--ignore-exit[ignore exit status from test scripts]' \
-  {-m,--merge}'[merge STDERR with STDOUT]' \
-  {-r,--recurse}'[recurse into directories]' \
-  '(-s --shuffle)--reverse[run tests in reverse order]' \
-  '(-v --verbose)'{-q,--quiet}'[suppress some test output]' \
-  '(-v --verbose)'{-Q,--QUIET}'[only print summary results]' \
-  {-p,--parse}'[show full list of TAP parse errors]' \
-  '--directives[only show results for which TODO or SKIP set]' \
-  '--timer[print elapsed time]' \
-  '--trap[trap ctrl-c and print summary on interrupt]' \
-  '--normalize[normalize TAP output in verbose mode]' \
-  '-T[enable tainting checks]' \
-  '-t[enable tainting warnings]' \
-  '-W[enable fatal warnings]' \
-  '-w[enable warnings]' \
-  '--norc[do not process .proverc]' \
-  '*-I=[library paths to include]:libdir:_directories' \
-  '*-P=[load plugin]:plugin:' \
-  '*-M=[load a module]:module:_perl_m_opt' \
-  {-e,--exec}'[interpreter to run the tests]:program: _command_names '{-e,--exec}':*::program arguments: _normal' \
-  '--harness=[define test harness]:harness:' \
-  '--formatter=[result formatter]:formatter:' \
-  '--source=[load or configure a SourceHandler]:source:' \
-  {-a,--archive}'[store output in archive file]:file:_files' \
-  {-j,--jobs}'[run N jobs in parallel]:jobs:' \
-  '*--state=[control persistent state]:state:' \
-  '--rc=[custom rcfile]:file:_files' \
-  '*:file or directory:_files' \
-  && return 0
diff -ruN zsh-5.0.4/Completion/Unix/Command/_psutils zsh-5.0.2/Completion/Unix/Command/_psutils
--- zsh-5.0.4/Completion/Unix/Command/_psutils	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_psutils	2001-04-02 05:00:48.000000000 -0700
@@ -13,16 +13,16 @@
     ':lower left y:' \
     ':upper right x:' \
     ':upper right y:' \
-    ':input file:_postscript' \
-    ':output file:_postscript'
+    ':input file:_ps' \
+    ':output file:_ps'
   ;;
 psbook)
   _arguments \
     '-q[quiet mode]' \
     '-v[print version]' \
     '-s-[signature size]:signature size:' \
-    ':input file:_postscript' \
-    ':output file:_postscript'
+    ':input file:_ps' \
+    ':output file:_ps'
   ;;
 psnup)
   _arguments \
@@ -47,8 +47,8 @@
     '(-2 -4    -n)-8[8 logical pages on a sheet]' \
     '(-2 -4 -8   )-n[n-up]:pages on a sheet:' \
     '-t-[layout tolerance]:layout tolerance:' \
-    ':input file:_postscript' \
-    ':output file:_postscript'
+    ':input file:_ps' \
+    ':output file:_ps'
   ;;
 psresize)
   _arguments \
@@ -60,8 +60,8 @@
     '(-P)-W-[input page width]:input paper width:' \
     '(-P)-H-[input page height]:input paper height:' \
     '(-W -H)-P-[input page paper]:input paper paper:(a3 a4 a5 b5 letter legal 10x14)' \
-    ':input file:_postscript' \
-    ':output file:_postscript'
+    ':input file:_ps' \
+    ':output file:_ps'
   ;;
 psselect)
   _arguments \
@@ -71,8 +71,8 @@
     '-o[select odd pages]' \
     '-r[reverse order]' \
     '-p-[pages]:pages:' \
-    ':input file:_postscript' \
-    ':output file:_postscript'
+    ':input file:_ps' \
+    ':output file:_ps'
   ;;
 pstops)
   _arguments \
@@ -84,28 +84,28 @@
     '(-p)-h-[page height]:paper height:' \
     '(-w -h)-p-[page size]:paper size:(a3 a4 a5 b5 letter legal 10x14)' \
     ':[modulo\:][-]pageno[L][R][U][@scale][(xoff,yoff)][+|,]...:' \
-    ':input file:_postscript' \
-    ':output file:_postscript'
+    ':input file:_ps' \
+    ':output file:_ps'
   ;;
 extractres)
   _arguments \
     '-m[merge]' \
-    ':input file:_postscript'
+    ':input file:_ps'
   ;;
 fixmacps)
   _arguments \
     '-d[directory]:directory:_files -/' \
     '-n[name]:name:' \
-    ':input file:_postscript'
+    ':input file:_ps'
   ;;
 psmerge)
   _arguments \
-    '-o-[output file]:output file:_postscript' \
+    '-o-[output file]:output file:_ps' \
     '-t[thorough]' \
-    '*:input file:_postscript'
+    '*:input file:_ps'
   ;;
 fixdlsrps|fixfmps|fixpsditps|fixpspps|fixscribeps|fixtpps|fixwfwps|fixwpps|fixwwps|includeres)
-  _postscript
+  _ps
   ;;
 getafm)
   _arguments \
diff -ruN zsh-5.0.4/Completion/Unix/Command/_qemu zsh-5.0.2/Completion/Unix/Command/_qemu
--- zsh-5.0.4/Completion/Unix/Command/_qemu	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_qemu	2007-02-25 11:18:15.000000000 -0800
@@ -1,8 +1,8 @@
-#compdef -P qemu(|-system-*)
+#compdef qemu
 
 _qemu_log_items () {
   local -a opts hline
-  $service -d \? | while read -A hline; do
+  qemu -d \? | while read -A hline; do
     [[ $hline[1] = Log ]] && continue
     opts=($opts "${hline[1]}[${hline[2,-1]}]")
   done
@@ -11,7 +11,7 @@
 
 local _qemu_machines
 
-_qemu_machines=(${${${(f)"$($service -M \?)"}[2,-1]}%% *})
+_qemu_machines=(${${${(f)"$(qemu -M \?)"}[2,-1]}%% *})
 
 _arguments \
   '-'{fda,fdb,hda,hdb,hdc,hdd,cdrom}':disk image:_files' \
diff -ruN zsh-5.0.4/Completion/Unix/Command/_rsync zsh-5.0.2/Completion/Unix/Command/_rsync
--- zsh-5.0.4/Completion/Unix/Command/_rsync	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_rsync	2011-12-10 09:23:15.000000000 -0800
@@ -74,7 +74,7 @@
   _arguments -s \
     '*'{-v,--verbose}'[increase verbosity]' \
     {--no-v,--no-verbose}'[turn off --verbose]' \
-    '--bwlimit=[limit I/O bandwidth]:KBytes (etc.) per second' \
+    '--bwlimit=[limit I/O bandwidth]:KBytes per second' \
     '--port=[specify alternate port number]:port:(873)' \
     '--address=[bind to the specified address]:bind address:_bind_addresses' \
     '(-T --temp-dir)'{-T,--temp-dir=}'[create temporary files in specified directory]:directory:_directories' \
@@ -137,7 +137,6 @@
     '(-t --times)'{-t,--times}'[preserve times]' \
     {--no-t,--no-times}'[turn off --times]' \
     '(-O --omit-dir-times)'{-O,--omit-dir-times}'[omit directories when preserving times]' \
-    '(-J --omit-link-times)'{-J,--omit-link-times}'[omit symlinks when preserving times]' \
     '--chmod[change destination permissions]:mods' \
     '(-S --sparse)'{-S,--sparse}'[handle sparse files efficiently]' \
     '(-n --dry-run)'{-n,--dry-run}'[show what would have been transferred]' \
@@ -211,16 +210,6 @@
     '(--only-write-batch)--write-batch=[write a batched update to the specified file]:file:_files' \
     '(--write-batch)--only-write-batch=[like --write-batch but w/o updating destination]:file:_files' \
     '--protocol=[force an older protocol version to be used]:number' \
-    '--info=[fine-grained informational verbosity]:comma-separated list' \
-    '--debug=[fine-grained debug verbosity]:comma-separated list' \
-    '--munge-links[munge symlinks to make them safer, but unusable]' \
-    '--ignore-missing-args[ignore missing source args without error]' \
-    '--delete-missing-args[delete missing source args from destination]' \
-    '(--usermap --chown)--usermap=[custom username mapping]:comma-separated mappings' \
-    '(--groupmap --chown)--groupmap=[custom groupname mapping]:comma-separated mappings' \
-    '(--usermap --groupmap --chown)--chown=[simple username/groupname mapping]:user and/or group' \
-    '*'{-M=,--remote-option=}'[send option to the remote side only]:option string' \
-    '--preallocate[preallocate the full length of new files]' \
     '--iconv=[request charset conversion of filenames]:number' \
     '--read-batch=[read a batched update from the specified file]:file:_files'
 }
diff -ruN zsh-5.0.4/Completion/Unix/Command/_sed zsh-5.0.2/Completion/Unix/Command/_sed
--- zsh-5.0.4/Completion/Unix/Command/_sed	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_sed	2008-01-19 11:22:20.000000000 -0800
@@ -12,10 +12,8 @@
 
 if _pick_variant gnu=GNU unix --version; then
   args+=(
-    '--follow-symlinks[follow symlinks when processing in place]'
     '(-i --in-place)'{-i-,--in-place=-}'[edit files in place]::suffix for backup'
     '(-l --line-length)'{-l,--line-length=-}'[specify line-wrap length for the l command]'
-    '(-r)--posix[disable GNU extensions]'
     '(-r --regexp-extended)'{-r,--regexp-extended}'[use extended regular expressions]'
     '(-s --separate)'{-s,--separate}'[consider files separately instead of as a combined stream]'
     '(-u --unbuffered)'{-u,--unbuffered}'[disable data buffering]'
diff -ruN zsh-5.0.4/Completion/Unix/Command/_sh zsh-5.0.2/Completion/Unix/Command/_sh
--- zsh-5.0.4/Completion/Unix/Command/_sh	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_sh	2011-05-27 12:19:28.000000000 -0700
@@ -5,7 +5,10 @@
   if [[ ${words[CURRENT-1]} == -o ]]; then
     _options
     # no other possibilities
-    return
+    return 0
+  fi
+  if _arguments -S -s -- '*:'; then
+    return 0
   fi
 fi
 
@@ -22,9 +25,3 @@
   fi
   _default
 fi
-
-local ret=$?
-
-[[ $service == zsh ]] && _arguments -S -s -- '*:' && ret=0
-
-return ret
diff -ruN zsh-5.0.4/Completion/Unix/Command/_sort zsh-5.0.2/Completion/Unix/Command/_sort
--- zsh-5.0.4/Completion/Unix/Command/_sort	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_sort	2008-05-13 09:08:35.000000000 -0700
@@ -1,37 +1,31 @@
 #compdef sort
 
-local ordering='(-d --dictionary-order -g --general-numeric-sort -M --month-sort -h --human-numeric-sort -n --numeric-sort --sort -V --version-sort --help --version)'
+# zsh completions for GNU sort version 5.97
+# limitation: --key does not work exactly right
+local arguments
 
-_arguments -s -S \
-  '(-b --ignore-leading-blanks)'{-b,--ignore-leading-blanks}'[ignore leading blanks]' \
-  "$ordering"{-d,--dictionary-order}'[consider only blanks and alphanumeric characters]' \
-  '(-f --ignore-case)'{-f,--ignore-case}'[fold lower case to upper case characters]' \
-  "$ordering"{-g,--general-numeric-sort}'[compare according to general numeric value]' \
-  '(-i --ignore-nonprinting)'{-i,--ignore-nonprinting}'[consider only printable characters]' \
-  "$ordering"{-M,--month-sort}"[compare (unknown) < 'JAN' < ... < 'DEC']" \
-  "$ordering"{-h,--human-numeric-sort}'[compare human readable numbers (e.g., 2K 1G)]' \
-  "$ordering"{-n,--numeric-sort}'[compare according to string numerical value]' \
-  "$ordering"{-R,--random-sort}'[sort by random hash of keys]' \
-  '--random-source=[get random bytes from file]:file:_files' \
-  '(-r --reverse)'{-r,--reverse}'[reverse the result of comparisons]' \
-  "$ordering--sort=[sort according to ordering]:ordering:(general-numeric human-numeric month numeric random version)" \
-  "$ordering"{-V,--version-sort}'[sort version numbers]' \
-  '--batch-size=[maximum inputs to merge]:number' \
-  '(-c --check -C)'{-c,-C}'[check whether input is sorted; do not sort]' \
-  '(-c --check -C)--check=-[check whether input is sorted; do not sort]::bad line handling:(diagnose-first silent quiet)' \
-  '--compress-program=[specify program to compress temporary files with]:program:(gzip bzip2 lzop xz)' \
-  '--debug[annotate the of the line used to sort]' \
-  '--files0-from=[read input files from file]:file:_files' \
-  '(-k --key)'{-k+,--key=}'[start a key at POS1, end it as POS2 (origin 1)]:key' \
-  '(-m --merge)'{-m,--merge}'[merge already sorted files; do not sort]' \
-  '(-o --output)'{-o+,--output=}'[write result to file instead of standard output]:output file:_files' \
-  '(-s --stable)'{-s,--stable}'[preserve original order of lines with the same key]' \
-  '(-S --buffer-size)'{-S+,--buffer-size=}'[specify size for main memory buffer]:size' \
-  '(-t --field-separator)'{-t+,--field-separator=}'[specify field separator instead of non-blank to blank transition]:separator' \
-  \*{-T+,--temporary-directory=}'[specify directory for temporary files]:directory:_directories' \
-  '(-u --unique)'{-u,--unique}'[with -c, check for strict ordering; without -c, output only the first of an equal run]' \
-  '--parallel=[set number of sorts run concurrently]:number' \
-  '(-z --zero-terminated)'{-z,--zero-terminated}'[end lines with 0 byte, not newline]' \
-  '(- *)--help[display help and exit]' \
-  '(- *)--version[output version information and exit]' \
-  '*:file:_files'
+arguments=(
+    '(-b --ignore-leading-blanks)'{-b,--ignore-leading-blanks}'[ignore leading blanks]'
+    '(-d --dictionary-order)'{-d,--dictionary-order}'[consider only blanks and alphanumeric characters]'
+    '(-f --ignore-case)'{-f,--ignore-case}'[fold lower case to upper case characters]'
+    '(-g --general-numeric-sort)'{-g,--general-numeric-sort}'[compare according to general numeric value]'
+    '(-i --ignore-nonprinting)'{-i,--ignore-nonprinting}'[consider only printable characters]'
+    '(-M --month-sort)'{-M,--month-sort}"[compare (unknown) < 'JAN' < ... < 'DEC']"
+    '(-n --numeric-sort)'{-n,--numeric-sort}'[compare according to string numerical value]'
+    '(-r --reverse)'{-r,--reverse}'[reverse the result of comparisons]'
+    '(-c --check)'{-c,--check}'[check whether input is sorted; do not sort]'
+    '(-k --key)'{-k+,--key=}'[start a key at POS1, end it as POS2 (origin 1)]:key:'
+    '(-m --merge)'{-m,--merge}'[merge already sorted files; do not sort]'
+    '(-o --output)'{-o+,--output=}'[write result to FILE instead of standard output]:filename:_files'
+    '(-s --stable)'{-s+,--stable=}'[stabilize sort by disabling last-resort comparison]'
+    '(-S --buffer-size)'{-S+,--buffer-size=}'[use SIZE for main memory buffer]:size:'
+    '(-t --field-separator)'{-t+,--field-separator=}'[use SEP instead of non-blank to blank transition]:separator:'
+    '(-T --temporary-directory)'{-T+,--temporary-directory=}'[use DIR for temporaries, not $TMPDIR or /tmp; multiple options specify multiple directories]:directory'
+    '(-u --unique)'{-u,--unique}'[with -c, check for strict ordering; without -c, output only the first of an equal run]'
+    '(-z --zero-terminated)'{-z,--zero-terminated}'[end lines with 0 byte, not newline]'
+    --help'[display help and exit]'
+    --version'[output version information and exit]'
+    '*:filename:_files'
+    )
+
+_arguments -s $arguments
diff -ruN zsh-5.0.4/Completion/Unix/Command/_ssh zsh-5.0.2/Completion/Unix/Command/_ssh
--- zsh-5.0.4/Completion/Unix/Command/_ssh	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_ssh	2012-05-22 01:56:22.000000000 -0700
@@ -519,7 +519,7 @@
       fi
       ;;
     file)
-      if compset -P '[^./][^/]#:'; then
+      if compset -P '*:'; then
         _remote_files -- ssh ${(kv)~opt_args[(I)-[FP1246]]/-P/-p} && ret=0
       elif compset -P '*@'; then
         suf=( -S '' )
diff -ruN zsh-5.0.4/Completion/Unix/Command/_subversion zsh-5.0.2/Completion/Unix/Command/_subversion
--- zsh-5.0.4/Completion/Unix/Command/_subversion	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_subversion	2012-02-10 11:33:42.000000000 -0800
@@ -20,7 +20,7 @@
     typeset -gHA _svn_cmds
     if _cache_invalid svn-cmds || ! _retrieve_cache svn-cmds; then
       _svn_cmds=(
-	${=${(f)${${"$(_comp_locale; _call_program commands svn help)"#l#*Available subcommands:}%%Subversion is a tool*}}/(#s)[[:space:]]#(#b)([a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
+	${=${(f)${${"$(LC_ALL=C _call_program commands svn help)"#l#*Available subcommands:}%%Subversion is a tool*}}/(#s)[[:space:]]#(#b)([a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
       )
       _store_cache svn-cmds _svn_cmds
     fi
@@ -41,14 +41,14 @@
 	if _cache_invalid svn-${cmd}-usage || \
 	    ! _retrieve_cache svn-${cmd}-usage;
 	then
-	  usage=${${(M)${(f)"$(_comp_locale; _call_program options svn help $cmd)"}:#usage:*}#usage:*$cmd] }
+	  usage=${${(M)${(f)"$(LC_ALL=C _call_program options svn help $cmd)"}:#usage:*}#usage:*$cmd] }
 	  _store_cache svn-${cmd}-usage usage
 	fi
 	if _cache_invalid svn-${cmd}-usage || \
 	    ! _retrieve_cache svn-${cmd}-args;
 	then
 	  args=(
-	    ${=${${${(M)${(f)"$(_comp_locale; _call_program options svn help $cmd)"#(*Valid options:|(#e))}:#* :*}%% #:*}/ (arg|ARG)/:arg:}/(#b)(-##)([[:alpha:]]##) \[--([a-z-]##)\](:arg:)#/(--$match[3])$match[1]$match[2]$match[4] ($match[1]$match[2])--$match[3]$match[4]}
+	    ${=${${${(M)${(f)"$(LC_ALL=C _call_program options svn help $cmd)"#(*Valid options:|(#e))}:#* :*}%% #:*}/ (arg|ARG)/:arg:}/(#b)(-##)([[:alpha:]]##) \[--([a-z-]##)\](:arg:)#/(--$match[3])$match[1]$match[2]$match[4] ($match[1]$match[2])--$match[3]$match[4]}
 	  )
           while (( idx=$args[(I)*--c(l|hangelist):arg:] )); do
             args[(I)*--c(l|hangelist):arg:]=( \*{--cl,--changelist}':change list:_svn_changelists' )
@@ -157,7 +157,7 @@
   if [[ -n $state ]] && (( ! $+_svnadmin_cmds )); then
     typeset -gHA _svnadmin_cmds
     _svnadmin_cmds=(
-      ${=${(f)${${"$(_comp_locale; _call_program commands svnadmin help)"#l#*Available subcommands:}}}/(#s)[[:space:]]#(#b)([-a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
+      ${=${(f)${${"$(LC_ALL=C _call_program commands svnadmin help)"#l#*Available subcommands:}}}/(#s)[[:space:]]#(#b)([-a-z]##)[[:space:]]#(\([a-z, ?]##\))#/$match[1] :$match[1]${match[2]:+:${${match[2]//[(),]}// /:}}:}
     )
   fi
 
@@ -172,9 +172,9 @@
       if (( $#cmd )); then
         curcontext="${curcontext%:*:*}:svnadmin-${cmd}:"
 
-        usage=${${(M)${(f)"$(_comp_locale; _call_program options svnadmin help $cmd)"}:#$cmd: usage:*}#$cmd: usage: svnadmin $cmd }
+        usage=${${(M)${(f)"$(LC_ALL=C _call_program options svnadmin help $cmd)"}:#$cmd: usage:*}#$cmd: usage: svnadmin $cmd }
         args=(
-          ${=${${${(M)${(f)"$(_comp_locale; _call_program options svnadmin help $cmd)"#(*Valid options:|(#e))}:#* :*}%% #:*}/ (arg|ARG)/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}
+          ${=${${${(M)${(f)"$(LC_ALL=C _call_program options svnadmin help $cmd)"#(*Valid options:|(#e))}:#* :*}%% #:*}/ (arg|ARG)/:arg:}/(#b)-([[:alpha:]]) \[--([a-z-]##)\](:arg:)#/(--$match[2])-$match[1]$match[3] (-$match[1])--$match[2]$match[3]}
         )
         if [[ $usage == *REPOS_PATH* ]]; then
           args+=( ":path:_files -/" )
@@ -319,7 +319,7 @@
 _svn_changelists() {
   local cls
 
-  cls=( ${${${(M)${(f)"$(_comp_locale; _call_program changelists svn status 2>/dev/null)"}:#--- Changelist*}%??}##*\'} )
+  cls=( ${${${(M)${(f)"$(LC_ALL=C _call_program changelists svn status 2>/dev/null)"}:#--- Changelist*}%??}##*\'} )
   compadd "$@" -a cls && return 0
 }
 
diff -ruN zsh-5.0.4/Completion/Unix/Command/_systemd zsh-5.0.2/Completion/Unix/Command/_systemd
--- zsh-5.0.4/Completion/Unix/Command/_systemd	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_systemd	2012-10-25 01:50:50.000000000 -0700
@@ -1,6 +1,6 @@
 #compdef systemctl systemd-loginctl
 
-# Copyright (c) 2011 Foudil Bre'tel <foudil.newbie+zshsystemctl@gmail.com>
+# Copyright (c) 2011 Foudil BrÈtel <foudil.newbie+zshsystemctl@gmail.com>
 #
 # This file is released under the GPLv3.
 #
@@ -121,14 +121,11 @@
     "rescue:Enter system rescue mode"
     "emergency:Enter system emergency mode"
     "halt:Shut down and halt the system"
+    "suspend:Suspend the system"
     "poweroff:Shut down and power-off the system"
     "reboot:Shut down and reboot the system"
     "kexec:Shut down and reboot the system with kexec"
     "exit:Ask for user instance termination"
-    "switch-root:Change to a different root file system"
-    "suspend:Suspend the system"
-    "hibernate:Hibernate the system"
-    "hibernate-sleep:Hibernate and suspend the system"
   )
 
   if (( CURRENT == 1 )); then
@@ -334,13 +331,6 @@
 
 (( $+functions[_systemctl_link] )) || _systemctl_link() { _files }
 
-(( $+functions[_systemctl_switch-root] )) || _systemctl_switch-root()
-{
-  if (( CURRENT == 2 )); then
-    _directories
-  fi
-}
-
 # no systemctl completion for:
 #    [STANDALONE]='daemon-reexec daemon-reload default dot dump
 #                  emergency exit halt kexec list-jobs list-units
diff -ruN zsh-5.0.4/Completion/Unix/Command/_twisted zsh-5.0.2/Completion/Unix/Command/_twisted
--- zsh-5.0.4/Completion/Unix/Command/_twisted	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_twisted	2007-11-20 11:49:26.000000000 -0800
@@ -1,33 +1,86 @@
-#compdef twistd trial conch cftp tapconvert ckeygen lore pyhtmlizer tap2deb tkconch manhole tap2rpm
+#compdef trial conch mktap cftp tapconvert twistd ckeygen lore pyhtmlizer websetroot tap2deb tkmktap tkconch manhole tap2rpm
+
+# Copyright (c) 2005 Eric Mangold
+# Maintainer: Eric Mangold <teratorn@twistedmatrix.com>
+
+# This file is meant to be in your zsh function path. i.e. in one of those
+# directories listed in your $fpath variable.
 #
-# This is the ZSH completion file for Twisted commands. It calls the current
-# command-line with the special "--_shell-completion" option which is handled
-# by twisted.python.usage. t.p.usage then generates zsh code on stdout to
-# handle the completions for this particular command-line.
+# e.g. /usr/local/share/zsh/site-functions/
 #
-# 3rd parties that wish to provide zsh completion for commands that
-# use t.p.usage may copy this file and change the first line to reference
-# the name(s) of their command(s).
+# It is responsible for passing completion control to the correct
+# completion function for the version of Twisted that is
+# currently in use.
 #
-# This file is included in the official Zsh distribution as
-# Completion/Unix/Command/_twisted
+# Goals:
+#
+# We want to detect any changes to PYTHONPATH since the last time we ran.
+# That way we can re-locate the completion functions so that we are sure
+# to be completing for the right version of Twisted.
+
+local dir old_fpath python_code run shebang
+
+function debug () {
+    echo $@ >> /tmp/twisted_stub_debug
+}
+
+#debug "START _twisted_stub"
+
+function load_twisted_completions() {
+    [[ -z $commands[twistd] ]] && echo 'ERROR: test command "twistd" not found in path' && return 1
+    shebang=$(head -1 $commands[twistd])
+    [[ $shebang != \#\!* ]] && echo 'ERROR: invalid shebang line for test script "twistd"' && return 1
+    PYTHON=$shebang[3,-1] # strip #! off the shebang
+    PYTHON=${PYTHON# *} # remove any spaces between #! and command
 
-# redirect stderr to /dev/null otherwise deprecation warnings may get puked all
-# over the user's terminal if completing options for a deprecated command.
-# Redirect stderr to a file to debug errors.
-local cmd output
-cmd=("$words[@]" --_shell-completion zsh:$CURRENT)
-output=$("$cmd[@]" 2>/dev/null)
-
-if [[ $output == "#compdef "* ]]; then
-    # Looks like we got a valid completion function - so eval it to produce
-    # the completion matches.
-    eval $output
+    #debug PYTHON $PYTHON:q
+    python_code='
+import twisted, os.path
+dir = os.path.dirname(twisted.__file__)
+print os.path.join(dir, "python", "zsh")
+'
+    dir=$(${=PYTHON} -c "$python_code")
+    #debug "Trying to load twisted functions from $dir:q"
+    if [[ -r $dir/_twistd ]]; then
+        old_fpath=($fpath)
+        fpath=( $dir $fpath )
+        autoload +X _trial _conch _mktap _cftp _tapconvert _twistd _ckeygen
+        autoload +X _lore _pyhtmlizer _websetroot _tap2deb _tkmktap _tkconch
+        autoload +X _manhole _tap2rpm
+        fpath=($old_fpath)
+    else
+        echo 'ERROR: Cannot find twisted completion function files in $dir:q'
+        return 1
+    fi
+}
+
+function twisted_run () {
+    # run completion function for current command
+    # the :t modifier strips off any leading pathname components
+    eval _$words[1]:t
+}
+
+function twisted_save_load_run () {
+    # save PYTHONPATH, load twisted completions, and run the completion
+    # function for the current command
+    load_twisted_completions && twisted_run && PYTHONPATH_last=$PYTHONPATH
+}
+
+
+if [[ -n $PYTHONPATH_last ]]; then
+    #debug "PYTHONPATH_last is set to $PYTHONPATH_last"
+    #check if it's the same as the last time we ran
+    if [[ $PYTHONPATH == $PYTHONPATH_last ]]; then
+        #debug "PYTHONPATH == PYTHONPATH_last"
+        # it's the same, which means we've already loaded completion
+        # functions and nothing has changed.
+        twisted_run
+    else
+        twisted_save_load_run
+    fi
 else
-    echo "\nCompletion error running command:" ${(qqq)cmd}
-    echo -n "If output below is unhelpful you may need to edit this file and "
-    echo    "redirect stderr to a file."
-    echo "Expected completion function, but instead got:" 
-    echo $output
-    return 1
+    twisted_save_load_run
 fi
+
+#debug "END _twisted_stub"
+#
diff -ruN zsh-5.0.4/Completion/Unix/Command/_vcsh zsh-5.0.2/Completion/Unix/Command/_vcsh
--- zsh-5.0.4/Completion/Unix/Command/_vcsh	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_vcsh	2012-01-15 10:06:04.000000000 -0800
@@ -1,135 +1,18 @@
 #compdef vcsh
 
-function __vcsh_repositories () {
-	local expl
-	local -a repos
-	repos=( ${(f)"$(command vcsh list)"} )
-	_describe -t repos 'repositories' repos
-}
-
-function __vcsh_not_implemented_yet () {
-	_message "Subcommand completion '${1#*-}': not implemented yet"
-}
-
-function _vcsh-clone () {
-	__vcsh_not_implemented_yet "$0" #TODO
-}
-
-function _vcsh-delete () {
-	(( CURRENT == 2 )) && __vcsh_repositories
-}
-
-function _vcsh-enter () {
-	(( CURRENT == 2 )) && __vcsh_repositories
-}
-
-function _vcsh-help () {
-	_nothing
-}
-
-function _vcsh-init () {
-	_nothing
-}
-
-function _vcsh-list () {
-	_nothing
-}
-
-function _vcsh-list-tracked () {
-	_nothing
-}
-
-function _vcsh-list-tracked-by () {
-	(( CURRENT == 2 )) && __vcsh_repositories
-}
-
-function _vcsh-pull () {
-	_nothing
-}
-
-function _vcsh-push () {
-	_nothing
-}
-
-function _vcsh-rename () {
-	(( CURRENT == 2 )) && __vcsh_repositories
-	(( CURRENT == 3 )) && _message "new repository name"
-	(( CURRENT > 3 )) && _nothing
-}
-
-function _vcsh-run () {
-	(( CURRENT == 2 )) && __vcsh_repositories
-	if (( CURRENT >= 3 )); then
-		words=( "${(@)words[3,-1]}" )
-		(( CURRENT -= 2 ))
-		_complete
-	fi
-}
-
-function _vcsh-upgrade () {
-	(( CURRENT == 2 )) && __vcsh_repositories
-}
-
-function _vcsh-version () {
-	_nothing
-}
-
-function _vcsh-which () {
-	_files
-}
-
-function _vcsh-write-gitignore () {
-	(( CURRENT == 2 )) && __vcsh_repositories
-}
-
-function _vcsh () {
-	local curcontext="${curcontext}"
-	local state vcshcommand
-	local -a args subcommands
-
-	subcommands=(
-		"clone:clone an existing repository"
-		"delete:delete an existing repository"
-		"enter:enter repository; spawn new <\$SHELL>"
-		"help:display help"
-		"init:initialize an empty repository"
-		"list:list all local vcsh repositories"
-		"list-tracked:list all files tracked by vcsh"
-		"list-tracked-by:list files tracked by a repository"
-		"pull:pull from all vcsh remotes"
-		"rename:rename a repository"
-		"run:run command with <\$GIT_DIR> and <\$GIT_WORK_TREE> set"
-		"upgrade:upgrade repository to currently recommended settings"
-		"version:print version information"
-		"which:find <substring> in name of any tracked file"
-		"write-gitignore:write .gitignore.d/<repo> via git ls-files"
-	)
-
-	args=(
-		'-c[source <file> prior to other configuration files]:config files:_path_files'
-		'-d[enable debug mode]'
-		'-v[enable verbose mode]'
-		'*:: :->subcommand_or_options_or_repo'
-	)
-
-	_arguments -C ${args} && return
-
-	if [[ ${state} == "subcommand_or_options_or_repo" ]]; then
-		if (( CURRENT == 1 )); then
-			_describe -t subcommands 'vcsh sub-commands' subcommands
-			__vcsh_repositories
-		else
-			vcshcommand="${words[1]}"
-			if ! (( ${+functions[_vcsh-$vcshcommand]} )); then
-				# There is no handler function, so this is probably the name
-				# of a repository. Act accordingly.
-				_dispatch git git
-			else
-				curcontext="${curcontext%:*:*}:vcsh-${vcshcommand}:"
-				_call_function ret _vcsh-${vcshcommand}
-			fi
-		fi
-	fi
-}
-
-_vcsh "$@"
+_arguments \
+	':subcommand:((
+		clone\:"clone from repo"
+		help\:"display help"
+		delete\:"delete repo"
+		enter\:"Enter repo; spawn new \$SHELL"
+		init\:"init & clone from repo"
+		list\:"list all repos"
+		list-tracked\:"list all files tracked by vcsh"
+		list-tracked-by\:"list files tracked by a repo"
+		rename\:"rename repo"
+		run\:"run command on repo"
+		setup\:"set up repo with recommended settings"
+		write-gitignore\:"write .gitignore.d/foo via git ls-files"
+		\<REPO\>\:"Run git command directly"
+	))'
diff -ruN zsh-5.0.4/Completion/Unix/Command/_wget zsh-5.0.2/Completion/Unix/Command/_wget
--- zsh-5.0.4/Completion/Unix/Command/_wget	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_wget	2012-06-15 14:21:27.000000000 -0700
@@ -17,14 +17,13 @@
   '(--input-file -i)'{--input-file=,-i+}'[specify input file]:file containing URLs:_files' \
   '(--force-html -F)'{--force-html,-F}'[treat input file as html]' \
   '(--base -B)'{--base=,-B+}'[prepend URL to relative links]:base URL:_urls' \
-  '--config=[specify config file]:config file:_files' \
   '(--tries -t)'{--tries=,-t+}'[set number of retries]:number of retries' \
   '--retry-connrefused[retry even if connection is refused]' \
   '(--output-document -O)'{--output-document=,-O+}'[specify file to write documents to]:output file:_files' \
   '(--continue -c)'{--continue,-c}'[continue getting an existing file]'  \
+  '--content-disposition[honor the Content-Disposition header when choosing local file names]'  \
   '--progress=[set progress gauge type]:gauge type:->gauge' \
   '(--timestamping -N)'{--timestamping,-N}'[retrieve only files newer than existing]' \
-  "--no-use-server-timestamps[don't set the local file's timestamp by the one on the server]" \
   '(--server-response -S)'{--server-response,-S}'[print server response]' \
   "--spider[don't download anything]" \
   '(--timeout -T)'{--timeout=,-T+}'[set all timeout values]:timeout (seconds)' \
@@ -41,16 +40,11 @@
   '--limit-rate=[specify limit to download rate]:download rate limit' \
   '--no-dns-cache[disable caching DNS lookups]' \
   '--restrict-file-names=[restrict chars in file names to ones OS allows]:OS:->restrict' \
-  '--ignore-case[ignore case when matching files/directories]' \
   '(-4 --inet4-only -6 --inet6-only)'{-4,--inet4-only}'[connect only to IPv4 addresses]' \
   '(-4 --inet4-only -6 --inet6-only)'{-6,--inet6-only}'[connect only to IPv6 addresses]' \
   '--prefer-family[connect first to addresses of specified family]:address family:(IPv6 IPv4 none)' \
   '(--http-user --ftp-user)--user[set both ftp and http user]:user' \
   '(--http-password --ftp-password)--password[set both ftp and http password]:password' \
-  '--no-iri[turn off IRI support]' \
-  '--local-encoding=[specify local encoding for IRIs]:encoding' \
-  '--remote-encoding=[specify default remote encoding]:encoding' \
-  '--unlink[remove file before clobber]' \
   '(--force-directories -x)'{--force-directories,-x}'[force creation of directories]' \
   '--protocol-directories[use protocol name in directories]' \
   '(--directory-prefix -P)'{--directory-prefix=,-P+}'[specify prefix to save files to]:prefix:_files -/' \
@@ -58,8 +52,7 @@
   '(--user)--http-user=:user' \
   '(--password)--http-password=:password' \
   '--no-cache[disallow server-cached data]' \
-  '--default-page=[specify default page name, normally index.html]' \
-  '(--adjust-extension -E)'{--adjust-extension,-E}'[save all HTML/CSS documents with proper extensions]' \
+  '(--html-extension -E)'{--html-extension,-E}'[save all HTML documents with a .html extension]' \
   "--ignore-length[ignore \`Content-Length' header field]" \
   '*--header=:string' \
   '--proxy-user=:user' \
@@ -68,14 +61,12 @@
   '--save-headers[save http headers]' \
   '(--user-agent -U)'{--user-agent=,-U+}'[specify user agent to identify as]:user-agent' \
   '--no-http-keep-alive[disable HTTP keep-alive]' \
-  '--no-cookies[turn cookies off]' \
+  '--no-cookies=[turn cookies off]' \
   '--load-cookies=[specify file to load cookies from]:cookie file:_files' \
   '--save-cookies=[specify file to save cookies to]:cookie file:_files' \
   '--keep-session-cookies[load and save session cookies]' \
   '--post-data=[use the POST method with specified data]:data to send' \
   '--post-file=[use the POST method; sending contents of a file]:file:_files' \
-  '--content-disposition[honor the Content-Disposition header when choosing local file names]'  \
-  "--auth-no-challenge[send basic HTTP authentication without first waiting for server's challenge]" \
   '--secure-protocol=[choose secure protocol]:protocol:(SSLv2 SSLv3 TLSv1)' \
   "--no-check-certificate=[don't check the server certificate]" \
   '--certificate=[specify client certificate]:client certificate file:_files' \
@@ -98,7 +89,7 @@
   '--delete-after' \
   '(--convert-links -k)'{--convert-links,-k}'[convert links to be relative]' \
   '(--backup-converted -K)'{--backup-converted,-K}'[backup files before conversion]' \
-  '(--mirror -m -r -N -l)'{--mirror,-m}'[mirror (-r -N -l inf --no-remove-listing)]' \
+  '(--mirror -m -r -N -l)'{--mirror,-m}'[mirror (-r -N -l inf -nr)]' \
   '(--page-requisites -p)'{--page-requisites,-p}'[get all images needed to display page]' \
   '--strict-comments[turn on strict (SGML) handling of HTML comments]' \
   '(--accept -A)'{--accept=,-A+}'[specify accepted extensions]:extensions' \
@@ -111,10 +102,9 @@
   '(--span-hosts -H)'{--span-hosts,-H}'[span hosts]' \
   '(--relative -L)'{--relative,-L}'[follow relative links only]' \
   '(--include-directories -I)'{--include-directories=,-I+}'[include directories]:allowed directories' \
-  '--trust-server-names' \
   '(--exclude-directories -X)'{--exclude-directories=,-X+}'[exclude directories]:excluded directories' \
-  '(-np --no-parent)'{-np,--no-parent}"[don't ascend to parent directory]" \
   '--no-host-lookup' \
+  '--no-parent' \
   '--no-verbose' \
   '--no-clobber' \
   '--no-directories' \
diff -ruN zsh-5.0.4/Completion/Unix/Command/_xmlsoft zsh-5.0.2/Completion/Unix/Command/_xmlsoft
--- zsh-5.0.4/Completion/Unix/Command/_xmlsoft	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Command/_xmlsoft	2012-06-15 14:21:27.000000000 -0700
@@ -66,14 +66,13 @@
       '--recover[output what was parsable on broken XML documents]' \
       '--huge[remove any internal arbitrary parser limits]' \
       '--noent[substitute entity references by their value]' \
-      '--noenc[ignore any encoding specified inside the document]' \
       "(--output -o)--noout[don't output the result tree]" \
       '--path[provide a set of paths for resources]:paths:_files -/' \
       '--load-trace[print trace of all external entites loaded]' \
       '--nonet[refuse to fetch DTDs or entities over network]' \
-      '--nocompact[do not generate compact text nodes]' \
       '--htmlout[output results as HTML]' \
       '--nowrap[do not put HTML doc wrapper]' \
+      '--nocompact[do not generate compact text nodes]' \
       '--valid[validate the document in addition to std well-formed check]' \
       '(--dtdvalid --relaxng --schema)--postvalid[do a posteriori validation, i.e after parsing]' \
       '(--postvalid --relaxng --schema --dtdvalidfpi)--dtdvalid[do a posteriori validation against a given DTD]:DTD:_webbrowser' \
@@ -85,28 +84,27 @@
       '--compress[turn on gzip compression of output]' \
       '--html[use the HTML parser]' \
       '--xmlout[use the XML serializer when using --html]' \
-      '--nodefdtd[do not default HTML doctype]' \
       '--push[use the push mode of the parser]' \
       '--memory[parse from memory]' \
-      '--maxmem[limit memory allocation]:bytes' \
+      '--maxmem[imits memory allocation]:bytes' \
       '--nowarning[do not emit warnings from parser/validator]' \
       '--noblanks[drop (ignorable?) blanks spaces]' \
       '--nocdata[replace cdata section with text nodes]' \
       '--format[reformat/reindent the input]' \
       '--encode[output in the given encoding]:encoding:(${encoding[@]})' \
       '--dropdtd[remove the DOCTYPE of the input docs]' \
-      "--pretty[pretty-print in a particular style]:style:((0\:don't\ pretty\ print 1\:reformat 2\:add\ whitespace))" \
       '--c14n[save in W3C canonical format]' \
       '--c14n11[save in W3C canonical format v1.1 (with comments)]' \
       '--exc-c14n[save in W3C exclusive canonical format]' \
       '--nsclean[remove redundant namespace declarations]' \
+      '--testIO[test user I/O support]' \
       '(--nocatalogs)--catalogs[use SGML catalogs]' \
       '(--catalogs)--nocatalogs[deactivate all catalogs]' \
       '--auto[generate a small doc on the fly]' \
       '(--noxincludenode)--xinclude[do XInclude processing]' \
       '(--xinclude)--noxincludenode[do XInclude processing but do not generate XInclude nodes]' \
-      '--nofixup-base-uris[do not fixup xml:base uris]' \
       '--loaddtd[fetch external DTD]' \
+      '--nofixup-base-uris[do not fixup xml:base uris]' \
       '--dtdattr[loaddtd + populate the tree with inherited attributes]' \
       '--stream[use the streaming interface to process very large files]' \
       '--walker[create a reader and walk though the resulting doc]' \
@@ -118,7 +116,7 @@
       '--sax1[use the old SAX1 interfaces for processing]' \
       '--sax[do not build a tree but work just at the SAX level]' \
       '--oldxml10[use XML-1.0 parsing rules before the 5th edition]' \
-      '(--noout)--xpath[evaluate the XPath expression, implies --noout]:XPath expression' \
+      '--xpath[evaluate the XPath expression, inply --noout]:XPath expression:' \
       '*:XML file:_webbrowser' && return
   ;;
   *XML_CATALOG_FILES*)
@@ -127,7 +125,7 @@
       _urls
       return
     fi
-
+    
     compset -S ':*'
     _alternative \
       'files:catalog file:_files' \
@@ -136,3 +134,5 @@
 esac
 
 return 1
+
+
diff -ruN zsh-5.0.4/Completion/Unix/Type/.distfiles zsh-5.0.2/Completion/Unix/Type/.distfiles
--- zsh-5.0.4/Completion/Unix/Type/.distfiles	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Type/.distfiles	2012-12-16 10:45:53.000000000 -0800
@@ -34,8 +34,8 @@
 _perl_modules
 _pids
 _ports
-_postscript
 _printers
+_ps
 _ps1234
 _pspdf
 _remote_files
diff -ruN zsh-5.0.4/Completion/Unix/Type/_files zsh-5.0.2/Completion/Unix/Type/_files
--- zsh-5.0.4/Completion/Unix/Type/_files	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Type/_files	2012-08-21 11:08:54.000000000 -0700
@@ -8,7 +8,7 @@
 
 type="${(@j::M)${(@)tmp#-}#?}"
 if (( $tmp[(I)-g*] )); then
-  glob="${${${(@)${(@M)tmp:#-g*}#-g}##[[:blank:]]#}%%[[:blank:]]#}"
+  glob="${${${${(@M)tmp:#-g*}#-g}##[[:blank:]]#}%%[[:blank:]]#}"
   [[ "$glob" = *[^\\][[:blank:]]* ]] &&
       glob="{${glob//(#b)([^\\])[[:blank:]]##/${match[1]},}}"
 
diff -ruN zsh-5.0.4/Completion/Unix/Type/_hosts zsh-5.0.2/Completion/Unix/Type/_hosts
--- zsh-5.0.4/Completion/Unix/Type/_hosts	2013-12-14 11:46:11.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Type/_hosts	2010-03-04 13:02:46.000000000 -0800
@@ -41,20 +41,9 @@
 
     for khostfile in $khostfiles; do
       if [[ -r $khostfile ]]; then
-        khosts=(${(s/,/j/,/u)${(f)"$(<$khostfile)"}%%[ |#]*})
-
-        # known_hosts syntax supports the host being in the form [hostname]:port
-        # The filter below extracts the hostname from lines using this format.
-        khosts=($(for host ($khosts); do
-          if [[ $host =~ "\[(.*)\]:\d*" ]]; then
-            echo $match
-          else
-            echo $host
-          fi
-        done))
-
+        khosts=(${${(s:,:)${(j:,:)${(u)${(f)"$(<$khostfile)"}%%[ |#]*}}}:#*[\[\]]*})
         if [[ -z $useip ]]; then
-          khosts=(${${khosts:#(#s)[0-9]##.[0-9]##.[0-9]##.[0-9]##(#e)}:#(#s)[0-9a-f:]##(#e)})
+	  khosts=(${${${khosts:#(#s)[0-9]##.[0-9]##.[0-9]##.[0-9]##(#e)}:#(#s)[0-9a-f:]##(#e)}:#*[\[\]]*})
         fi
         _cache_hosts+=($khosts)
       fi
diff -ruN zsh-5.0.4/Completion/Unix/Type/_java_class zsh-5.0.2/Completion/Unix/Type/_java_class
--- zsh-5.0.4/Completion/Unix/Type/_java_class	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Type/_java_class	2010-11-07 09:15:17.000000000 -0800
@@ -15,7 +15,7 @@
 for i in "${(s.:.)classpath}"; do
   [[ -z $i ]] && i=.
   if [[ -f $i ]] && [[ "$i" == *.(jar|zip|war|ear) ]]; then
-    c+=( ${${${(M)$(_call_program jar_classes jar -tf $i 2>/dev/null)##*.class}%%.class}:gs#/#.#} )
+    c+=( ${${${(M)$(_call_program jar_classes jar -tf $i)##*.class}%%.class}:gs#/#.#} )
   elif [[ -d $i ]]; then
     c+=( $i/**/*.class(.:r:s/.class//:s#$i/##:gs#/#.#) )
   fi
diff -ruN zsh-5.0.4/Completion/Unix/Type/_postscript zsh-5.0.2/Completion/Unix/Type/_postscript
--- zsh-5.0.4/Completion/Unix/Type/_postscript	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Type/_postscript	1969-12-31 16:00:00.000000000 -0800
@@ -1,14 +0,0 @@
-#compdef ps2epsi ps2pdf psmulti pswrap ps2pdf12 ps2pdf13 ps2pdf14 ps2pdfwr ps2ps
-
-local expl ext=''
-
-# ghostscript:
-#  ps2epsi ps2pdf ps2pdf12 ps2pdf13 ps2pdf14 ps2pdfwr ps2ps
-
-if [[ "$1" == '-z' ]]; then
-  ext='(|.bz2|.gz|.Z)'
-  shift
-fi
-
-_description files expl 'PostScript file'
-_files "$@" "$expl[@]" -g "*.(#i)(ps|eps)$ext(-.)"
diff -ruN zsh-5.0.4/Completion/Unix/Type/_ps zsh-5.0.2/Completion/Unix/Type/_ps
--- zsh-5.0.4/Completion/Unix/Type/_ps	1969-12-31 16:00:00.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Type/_ps	2009-01-05 11:25:41.000000000 -0800
@@ -0,0 +1,14 @@
+#compdef ps2epsi ps2pdf psmulti pswrap ps2pdf12 ps2pdf13 ps2pdf14 ps2pdfwr ps2ps
+
+local expl ext=''
+
+# ghostscript:
+#  ps2epsi ps2pdf ps2pdf12 ps2pdf13 ps2pdf14 ps2pdfwr ps2ps
+
+if [[ "$1" == '-z' ]]; then
+  ext='(|.bz2|.gz|.Z)'
+  shift
+fi
+
+_description files expl 'PostScript file'
+_files "$@" "$expl[@]" -g "*.(#i)(ps|eps)$ext(-.)"
diff -ruN zsh-5.0.4/Completion/Unix/Type/_terminals zsh-5.0.2/Completion/Unix/Type/_terminals
--- zsh-5.0.4/Completion/Unix/Type/_terminals	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Unix/Type/_terminals	2002-03-13 01:28:05.000000000 -0800
@@ -2,7 +2,7 @@
 
 local desc expl
 
-desc=( $TERMINFO ~/.terminfo $TERMINFO_DIRS /usr/{,share/}{,lib/}terminfo /{etc,lib}/terminfo )
+desc=( $TERMINFO ~/.terminfo $TERMINFO_DIRS /usr/{,share/}{,lib/}terminfo )
 
 _wanted terminals expl 'terminal name' \
     compadd "$@" - $desc/*/*(N:t)
diff -ruN zsh-5.0.4/Completion/X/Command/_mplayer zsh-5.0.2/Completion/X/Command/_mplayer
--- zsh-5.0.4/Completion/X/Command/_mplayer	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/X/Command/_mplayer	2012-01-29 10:27:45.000000000 -0800
@@ -114,8 +114,8 @@
   mfiles)
     _tags files urls
     while _tags; do
-      _requested files expl 'media file' _files -g \
-         "*.(#i)(asf|asx|avi|flac|flv|m1v|m2p|m2v|m4v|mjpg|mka|mkv|mov|mp3|mp4|mpe|mpeg|mpg|ogg|ogm|ogv|qt|rm|ts|vob|wav|webm|wma|wmv)(-.)" && ret=0
+      _requested files expl 'video file' _files -g \
+         "*.(#i)(asf|asx|avi|flac|flv|m1v|m2p|m2v|m4v|mjpg|mka|mkv|mov|mp3|mp4|mpe|mpeg|mpg|ogg|ogm|qt|rm|vob|wav|webm|wma|wmv)(-.)" && ret=0
       if _requested urls; then
         while _next_label urls expl URL; do
           _urls "$expl[@]" && ret=0
diff -ruN zsh-5.0.4/Completion/X/Command/_xrandr zsh-5.0.2/Completion/X/Command/_xrandr
--- zsh-5.0.4/Completion/X/Command/_xrandr	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/X/Command/_xrandr	2011-01-08 12:24:47.000000000 -0800
@@ -1,9 +1,13 @@
 #compdef xrandr
-
-local curcontext="$curcontext" state line expl
+local context state line
 typeset -A opt_args
+local outputs modes expl
+
+# User configurable. TODO -- styles?
+outputs=(LVDS1 TV1 VGA1)
+modes=(1280x800 1024x768 800x600 640x480)
 
-_arguments -C \
+_arguments \
   '(-d -display)'{-d,-display}':X display:_x_display' \
   '-help[display help]' \
   '(-o --orientation)'{-o,--orientation}':rotation:(normal inverted left right 0 1 2 3)' \
@@ -21,18 +25,18 @@
   '--fb:size:' \
   '--fbmm:size:' \
   '--dpi:dpi:' \
-  "*--output:output to reconfigure:->outputs" \
+  "*--output:output to reconfigure:($outputs)" \
   '*--auto' \
-  "*--mode:mode:->modes" \
+  "*--mode:mode:($modes)" \
   '*--preferred' \
   '*--pos:position:' \
   '*--reflect:axes:(normal x y xy)' \
   '*--rotate:rotation:(normal inverted left right)' \
-  "*--left-of:relative position to:->outputs" \
-  "*--right-of:relative position to:->outputs" \
-  "*--above:relative position to:->outputs" \
-  "*--below:relative position to:->outputs" \
-  "*--same-as:relative position to:->outputs" \
+  "*--left-of:relative position to:($outputs)" \
+  "*--right-of:relative position to:($outputs)" \
+  "*--above:relative position to:($outputs)" \
+  "*--below:relative position to:($outputs)" \
+  "*--same-as:relative position to:($outputs)" \
   '*--set:property:(Backlight scaling\ mode):value:->value' \
   '*--scale:output scaling:' \
   '*--transform:transformation matrix:' \
@@ -44,25 +48,15 @@
   '--noprimary' \
   '*--newmode:name: :clock MHz: :hdisp: :hsync-start: :hsync-end: :htotal: :vdisp: :vsync-start: :vsync-end: :vtotal:' \
   '*--rmmode:Mode name:' \
-  "*--addmode:output:->outputs:name" \
-  "*--delmode:output:->outputs:name" \
+  "*--addmode:output:($outputs):name:" \
+  "*--delmode:output:($outputs):name:" \
   && return 0
 
-case $state in
-  value)
+if [[ $state == value ]]; then
     case $words[CURRENT-1] in
-      (scaling* mode)
-	_description value expl "output property 'scaling mode'"
-	compadd "$@" "$expl[@]" None Full Center Full\ aspect && return 0
-      ;;
+	(scaling* mode)
+	    _description value expl "output property 'scaling mode'"
+	    compadd "$@" "$expl[@]" None Full Center Full\ aspect && return 0
+	    ;;
     esac
-  ;;
-  outputs)
-    _wanted outputs expl output compadd \
-        ${(uo)${(M)${(f)"$(_call_program outputs xrandr)"}:#* connected*}%% *} && return 0
-  ;;
-  modes)
-    _wanted modes expl mode compadd \
-        ${(Mun)$(_call_program modes xrandr):#[0-9]##x[0-9]##} && return 0
-  ;;
-esac
+fi
diff -ruN zsh-5.0.4/Completion/Zsh/Command/.distfiles zsh-5.0.2/Completion/Zsh/Command/.distfiles
--- zsh-5.0.4/Completion/Zsh/Command/.distfiles	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Command/.distfiles	2011-08-18 11:17:02.000000000 -0700
@@ -22,7 +22,6 @@
 _print
 _prompt
 _read
-_run-help
 _sched
 _set
 _setopt
diff -ruN zsh-5.0.4/Completion/Zsh/Command/_cd zsh-5.0.2/Completion/Zsh/Command/_cd
--- zsh-5.0.4/Completion/Zsh/Command/_cd	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Command/_cd	2010-06-06 10:37:17.000000000 -0700
@@ -51,18 +51,6 @@
     _directory_stack && ret=0
   fi
 
-  local -a tmpWpath
-  if [[ $PREFIX = (|*/)../* ]]; then
-    local tmpprefix
-    # Use cd in a subshell to properly [not] resolve symlinks
-    tmpprefix=$(cd ${PREFIX%/*} >&/dev/null && print $PWD)
-    if [[ -n $tmpprefix ]]; then
-      tmpWpath=(-W $tmpprefix)
-      IPREFIX=${IPREFIX}${PREFIX%/*}/
-      PREFIX=${PREFIX##*/}
-    fi
-  fi
-
   if [[ $PREFIX != (\~|/|./|../)* ]]; then
     local tmpcdpath alt
 
@@ -100,7 +88,7 @@
     # already handled by _command_names (see _autocd)
 
     [[ CURRENT -ne 1 || ( -z "$path[(r).]" && $PREFIX != */* ) ]] &&
-        alt=( "${cdpath+local-}directories:${cdpath+local }directory:_path_files $tmpWpath -/" "$alt[@]" )
+        alt=( "${cdpath+local-}directories:${cdpath+local }directory:_path_files -/" "$alt[@]" )
 
     if [[ CURRENT -eq argstart && noopts -eq 0 && $PREFIX = -* ]] &&
       zstyle -t ":completion:${curcontext}:options" complete-options; then
@@ -112,7 +100,7 @@
     return ret
   fi
   [[ CURRENT -ne 1 ]] && _wanted directories expl directory \
-      _path_files $tmpWpath -/ && ret=0
+      _path_files -/ && ret=0
 
   return ret
 fi
diff -ruN zsh-5.0.4/Completion/Zsh/Command/_disable zsh-5.0.2/Completion/Zsh/Command/_disable
--- zsh-5.0.4/Completion/Zsh/Command/_disable	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Command/_disable	2005-06-07 23:20:41.000000000 -0700
@@ -1,16 +1,9 @@
 #compdef disable
 
-local -a ali_arr sali_arr func_arr
-
-ali_arr=(${(k)aliases} ${(k)galiases})
-sali_arr=(${(k)saliases})
-func_arr=(${(k)functions})
-
 _arguments -C -s -A "-*" -S \
-  "(-f -r -s -p)-a[act on regular or global aliases]:*:regular or global aliases:compadd -k ali_arr" \
-  "(-a -r -s -p)-f[act on functions]:*:functions:compadd -k func_arr" \
-  "(-a -f -s -p)-r[act on reserved words]:*:reserved-words:compadd -k reswords" \
-  "(-a -f -r -p)-s[act on suffix aliases]:*:suffix aliases:compadd -k sali_arr" \
-  "(-a -f -r -s)-p[act on pattern characters]:*:pattern characters:compadd -k patchars" \
+  "(-f -r -s)-a[act on regular or global aliases]:*:regular or global aliases:(${(k)aliases} ${(k)galiases})" \
+  "(-a -r -s)-f[act on functions]:*:functions:(${(k)functions})" \
+  "(-a -f -s)-r[act on reserved words]:*:reserved-words:compadd -k reswords" \
+  "(-a -f -r)-s[act on suffix aliases]:*:suffix aliases:(${(k)saliases})" \
   '-m[treat arguments as patterns]' \
   "*:builtin command:(${(k)builtins})"
diff -ruN zsh-5.0.4/Completion/Zsh/Command/_enable zsh-5.0.2/Completion/Zsh/Command/_enable
--- zsh-5.0.4/Completion/Zsh/Command/_enable	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Command/_enable	2004-06-18 10:49:21.000000000 -0700
@@ -1,16 +1,8 @@
 #compdef enable
 
-local -a ali_arr sali_arr func_arr
-
-ali_arr=(${(k)dis_aliases} ${(k)dis_galiases})
-sali_arr=(${(k)dis_saliases})
-func_arr=(${(k)dis_functions})
-
 _arguments -C -s -A "-*" -S \
-  "(-f -r -s -p)-a[act on regular or global aliases]:*:aliases:compadd -k ali_arr" \
-  "(-a -r -s -p)-f[act on functions]:*:functions:compadd -k func_arr" \
-  "(-a -f -s -p)-r[act on reserved words]:*:reserved-words:compadd -k dis_reswords" \
-  "(-a -f -r -p)-s[act on suffix aliases]:*:suffix aliases:compadd -k sali_arr" \
-  "(-a -f -r -s)-p[act on pattern characters]:*:pattern characters:compadd -k dis_patchars" \
+  "(-f -r)-a[act on aliases]:*:aliases:(${(k)dis_aliases})" \
+  "(-a -r)-f[act on functions]:*:functions:(${(k)dis_functions})" \
+  "(-a -f)-r[act on reserved words]:*:reserved-words:compadd -k dis_reswords" \
   '-m[treat arguments as patterns]' \
   "*:builtin command:(${(k)dis_builtins})"
diff -ruN zsh-5.0.4/Completion/Zsh/Command/_fc zsh-5.0.2/Completion/Zsh/Command/_fc
--- zsh-5.0.4/Completion/Zsh/Command/_fc	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Command/_fc	2001-04-11 14:47:18.000000000 -0700
@@ -3,21 +3,17 @@
 local fc_common fc_hist fc_r
 
 fc_common=(
-  '(-A -R -W -I -p -P)-r[reverse order of the commands]'
-  '(-A -R -W -I -e -p -P)-n[suppress line numbers]'
-  '(-A -R -W -I -p -P)*::commands:_command_names -e' )
+  '(-A -R -W -I)-r[reverse order of the commands]'
+  '(-A -R -W -I -e)-n[suppress line numbers]'
+  '(-A -R -W -I)*::commands:_command_names -e' )
 
 fc_hist=(
-  '(-A -R -W -I -p -p)-m[treat first argument as a pattern]'
-  '(-A -R -W -I -e -f -E -i -t -p -P)-d[print time-stamps]'
-  '(-A -R -W -I -e -d -E -i -t -p -P)-f[mm/dd/yyyy format time-stamps]'
-  '(-A -R -W -I -e -d -f -i -t -p -P)-E[dd.mm.yyyy format time-stamps]'
-  '(-A -R -W -I -e -d -f -E -t -p -P)-i[yyyy-mm-dd format time-stamps]'
-  '(-A -R -W -I -e -d -f -E -i -p -P)-t[print time-stamps in specified format]:date format'
-  '(-A -R -W -I -e -p -P)-D[print elapsed times]'
-  '(- *)-p[push current history to stack]:history file:_files:history size: :saved history size'
-  '(- *)-P[pop history from stack]'
-)
+  '(-A -R -W -I)-m[treat first argument as a pattern]'
+  '(-A -R -W -I -e -f -E -i)-d[print time-stamps]'
+  '(-A -R -W -I -e -d -E -i)-f[mm/dd/yyyy format time-stamps]'
+  '(-A -R -W -I -e -d -f -i)-E[dd.mm.yyyy format time-stamps]'
+  '(-A -R -W -I -e -d -f -E)-i[yyyy-mm-dd format time-stamps]'
+  '(-A -R -W -I -e)-D[print elapsed times]' )
 
 fc_r='(-A -R -W -I -e)-l[list resulting commands on stdout]'
 
@@ -30,11 +26,11 @@
   ;;
   *)
   _arguments -s -S \
-    '(-A -R -W -I -l -n -d -f -E -i -D -p -P)-e[specify editor to invoke]:editor to invoke:_command_names -e' \
-    '(-l -m -e -r -n -d -f -E -i -D -A -W -p -P *)-R[read history from file]:history file:_files' \
-    '(-l -m -e -r -n -d -f -E -i -D -R -W -p -P *)-A[append history to file]:history file:_files' \
-    '(-l -m -e -r -n -d -f -E -i -D -R -A -p -P *)-W[write history to file]:history file:_files' \
-    '(-l -m -e -r -n -d -f -E -i -D -A -W -p -P *)-I[read/write new events only]:history file:_files' \
+    '(-A -R -W -I -l -n -d -f -E -i -D)-e[specify editor to invoke]:editor to invoke:_command_names -e' \
+    '(-l -m -e -r -n -d -f -E -i -D -A -W *)-R[read history from file]:history file:_files' \
+    '(-l -m -e -r -n -d -f -E -i -D -R -W *)-A[append history to file]:history file:_files' \
+    '(-l -m -e -r -n -d -f -E -i -D -R -A *)-W[write history to file]:history file:_files' \
+    '(-l -m -e -r -n -d -f -E -i -D -A -W *)-I[read/write new events only]:history file:_files' \
     "$fc_common[@]" "$fc_hist[@]" "$fc_r" && return 0
   ;;
 esac
diff -ruN zsh-5.0.4/Completion/Zsh/Command/_run-help zsh-5.0.2/Completion/Zsh/Command/_run-help
--- zsh-5.0.4/Completion/Zsh/Command/_run-help	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Command/_run-help	1969-12-31 16:00:00.000000000 -0800
@@ -1,7 +0,0 @@
-#compdef run-help
-local d expl
-local HELPDIR=${HELPDIR:-@runhelpdir@}
-[[ -d $HELPDIR ]] && {
-	d=($HELPDIR/*(:t))
-	(($#d)) && d+=('.' ':') && _wanted commands expl 'command' compadd -a d
-} || _man
diff -ruN zsh-5.0.4/Completion/Zsh/Command/_typeset zsh-5.0.2/Completion/Zsh/Command/_typeset
--- zsh-5.0.4/Completion/Zsh/Command/_typeset	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Command/_typeset	2012-04-21 14:01:29.000000000 -0700
@@ -12,9 +12,7 @@
   F "($fopts -A -E -L -R -T -U -Z -a -i -m)-F[floating point, use fixed point decimal on output]"
   L "($fopts -A -E -F -i)-L+[left justify and remove leading blanks from value]:width"
   R "($fopts -A -E -F -i)-R+[right justify and fill with leading blanks]:width"
-  T "($fopts -A -E -F -a -g -h -i -l -m -t)-T[tie scalar to array or trace function]"
-  Tf "($popts -t)-T[trace execution of this function only]"
-  Tp "($fopts -A -E -F -a -g -h -i -l -m -t)-T[tie scalar to array]"
+  T "($fopts -A -E -F -a -g -h -i -l -m -t)-T[tie scalar to array]"
   U '(-A -E -F -i)-U[keep array values unique and suppress alias expansion for functions]'
   Uf '-U[suppress alias expansion for functions]'
   Up '(-E -F -i)-+U[keep array values unique]'
@@ -51,7 +49,7 @@
   ;;
   float) use="EFHghlprtux";;
   functions)
-    use="UkmTtuz"
+    use="Ukmtuz"
     func=f
   ;;
   integer)
@@ -66,12 +64,6 @@
 [[ -z "${words[(r)-*[aA]*]}" ]] || func=p
 [[ -z "${words[(r)-*f*]}" ]] || func=f
 
-# This function uses whacky features of _arguments which means we
-# need to look for options to the command beforehand.
-local onopts offopts
-onopts=${(j..)${${words[1,CURRENT-1]:#^-*}##-}}
-offopts=${(j..)${${words[1,CURRENT-1]:#^+*}##+}}
-
 for ((i=1;i<=$#use;++i)); do
   args+=( ${allargs[${use[$i]}${${(s::)use[$i]}[(r)[Uut]]:+$func}]} )
 done
@@ -89,22 +81,6 @@
       funckeys=(${(k)functions})
       args=(${args:|funckeys})
       _wanted functions expl 'shell function' compadd -a args
-    elif [[ -n $onopts$offopts ]]; then
-      if [[ -n $offopts ]]; then
-	args=(${(f)"$(functions +$offopts)"})
-      else
-	args=(${(k)functions})
-      fi
-      if [[ -n $onopts ]]; then
-	local -a funckeys
-	funckeys=(${(f)"$(functions +$onopts)"})
-	args=(${args:|funckeys})
-      fi
-      if zstyle -t ":completion:${curcontext}:functions" prefix-needed &&
-	[[ $PREFIX != [_.]* ]]; then
-	args=(${args:#_*})
-      fi
-      _wanted functions expl 'shell functions' compadd -a args
     else
       _functions
     fi
diff -ruN zsh-5.0.4/Completion/Zsh/Context/_math zsh-5.0.2/Completion/Zsh/Context/_math
--- zsh-5.0.4/Completion/Zsh/Context/_math	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Context/_math	2001-04-02 04:23:46.000000000 -0700
@@ -9,6 +9,4 @@
   SUFFIX="${SUFFIX%%[^a-zA-Z0-9_]*}"
 fi
 
-_alternative 'math-parameters:math parameter: _math_params' \
-    'user-math-functions:user math function: _user_math_func' \
-    'module-math-functions:math function from zsh/mathfunc: _module_math_func'
+_parameters -g '(integer|float)*' || _parameters
diff -ruN zsh-5.0.4/Completion/Zsh/Context/_zcalc_line zsh-5.0.2/Completion/Zsh/Context/_zcalc_line
--- zsh-5.0.4/Completion/Zsh/Context/_zcalc_line	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Context/_zcalc_line	2008-06-13 07:27:37.000000000 -0700
@@ -13,7 +13,7 @@
     "eng:engineering (power of 1000) output format"
     "raw:raw output format"
     "local:make variables local"
-    "function:define math function (also \:func or \:f)"
+    "function:define math function"
   )
   cmds=("\:"${^cmds})
   _describe -t command-escapes "command escapes" cmds -Q
diff -ruN zsh-5.0.4/Completion/Zsh/Type/.distfiles zsh-5.0.2/Completion/Zsh/Type/.distfiles
--- zsh-5.0.4/Completion/Zsh/Type/.distfiles	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Type/.distfiles	2008-11-11 12:33:45.000000000 -0800
@@ -15,13 +15,10 @@
 _jobs_bg
 _jobs_fg
 _limits
-_math_params
-_module_math_func
 _options
 _options_set
 _options_unset
 _parameters
 _suffix_alias_files
-_user_math_func
 _vars
 '
diff -ruN zsh-5.0.4/Completion/Zsh/Type/_command_names zsh-5.0.2/Completion/Zsh/Type/_command_names
--- zsh-5.0.4/Completion/Zsh/Type/_command_names	2013-12-16 13:31:58.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Type/_command_names	2011-03-15 12:21:02.000000000 -0700
@@ -27,11 +27,11 @@
   [[ "$1" = - ]] && shift
 
   defs=( "$defs[@]"
-    'builtins:builtin command:compadd -Qk builtins'
+    'builtins:builtin command:compadd -k builtins'
     "functions:shell function:compadd -k 'functions$ffilt'"
-    'aliases:alias:compadd -Qk aliases'
+    'aliases:alias:compadd -k aliases'
     'suffix-aliases:suffix alias:_suffix_alias_files'
-    'reserved-words:reserved word:compadd -Qk reswords'
+    'reserved-words:reserved word:compadd -k reswords'
     'jobs:: _jobs -t'
     'parameters:: _parameters -g "^*readonly*" -qS= -r "\n\t\- =["'
   )
diff -ruN zsh-5.0.4/Completion/Zsh/Type/_math_params zsh-5.0.2/Completion/Zsh/Type/_math_params
--- zsh-5.0.4/Completion/Zsh/Type/_math_params	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Type/_math_params	1969-12-31 16:00:00.000000000 -0800
@@ -1,3 +0,0 @@
-#autoload
-
-_parameters -g '(integer|float)*' || _parameters
diff -ruN zsh-5.0.4/Completion/Zsh/Type/_module_math_func zsh-5.0.2/Completion/Zsh/Type/_module_math_func
--- zsh-5.0.4/Completion/Zsh/Type/_module_math_func	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Type/_module_math_func	1969-12-31 16:00:00.000000000 -0800
@@ -1,9 +0,0 @@
-#autoload
-
-local expl
-local -a funcs
-
-funcs=(${${${(f)"$(zmodload -Fl zsh/mathfunc 2>/dev/null)"}:#^+f:*}##+f:})
-
-_wanted module-math-functions expl 'math function from zsh/mathfunc' \
-    compadd -S '(' "$@" -a funcs
diff -ruN zsh-5.0.4/Completion/Zsh/Type/_user_math_func zsh-5.0.2/Completion/Zsh/Type/_user_math_func
--- zsh-5.0.4/Completion/Zsh/Type/_user_math_func	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/Zsh/Type/_user_math_func	1969-12-31 16:00:00.000000000 -0800
@@ -1,9 +0,0 @@
-#autoload
-
-local expl
-local -a funcs
-
-funcs=(${${${(f)"$(functions -M)"}##functions -M }%% *})
-
-_wanted user-math-functions expl 'user math function' \
-    compadd -S '(' "$@" -a funcs
diff -ruN zsh-5.0.4/Completion/bashcompinit zsh-5.0.2/Completion/bashcompinit
--- zsh-5.0.4/Completion/bashcompinit	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/bashcompinit	2012-01-29 10:15:47.000000000 -0800
@@ -3,9 +3,9 @@
 _bash_complete() {
   local ret=1
   local -a suf matches
-  local -x COMP_POINT COMP_CWORD
+  local COMP_POINT COMP_CWORD
   local -a COMP_WORDS COMPREPLY BASH_VERSINFO
-  local -x COMP_LINE="$words"
+  local COMP_LINE="$words"
   local -A savejobstates savejobtexts
 
   (( COMP_POINT = 1 + ${#${(j. .)words[1,CURRENT]}} + $#QIPREFIX + $#IPREFIX + $#PREFIX ))
diff -ruN zsh-5.0.4/Completion/compaudit zsh-5.0.2/Completion/compaudit
--- zsh-5.0.4/Completion/compaudit	2013-12-19 11:35:10.000000000 -0800
+++ zsh-5.0.2/Completion/compaudit	2011-09-18 10:40:51.000000000 -0700
@@ -82,45 +82,18 @@
 
 [[ $_i_fail == use ]] && return 0
 
-# We will always allow files to be owned by root and the owner of the
-# present process.
-local _i_owners="u0u${EUID}"
-
-# Places we will look for a link to the executable
-local -a _i_exes
-_i_exes=(
-    /proc/$$/exe
-    /proc/$$/object/a.out
-    )
-local _i_exe
-
-# If we can find out who owns the executable, we will allow files to
-# be owned by that user, too.  The argument is that if you don't trust
-# the owner of the executable, it's way too late to worry about it now...
-for _i_exe in $_i_exes; do
-  if [[ -e $_i_exe ]] ;then
-    if zmodload -F zsh/stat b:zstat 2>/dev/null; then
-      local -A _i_stathash
-      if zstat -H _i_stathash $_i_exe &&
-	[[ $_i_stathash[uid] -ne 0 ]]; then
-	_i_owners+="u${_i_stathash[uid]}"
-      fi
-    fi
-    break
-  fi
-done
-
 # We search for:
-# - world/group-writable directories in fpath not owned by $_i_owners
+# - world/group-writable directories in fpath not owned by root and the user
 # - parent-directories of directories in fpath that are world/group-writable
-#   and not owned by $_i_owners (that would allow someone to put a
+#   and not owned by root and the user (that would allow someone to put a
 #   digest file for one of the directories into the parent directory)
-# - digest files for one of the directories in fpath not owned by $_i_owners
-# - and for files in directories from fpath not owned by $_i_owners
+# - digest files for one of the directories in fpath not owned by root and
+#   the user
+# - and for files in directories from fpath not owned by root and the user
 #   (including zwc files)
 
-_i_wdirs=( ${^fpath}(N-f:g+w:,-f:o+w:,-^${_i_owners})
-           ${^fpath:h}(N-f:g+w:,-f:o+w:,-^${_i_owners}) )
+_i_wdirs=( ${^fpath}(N-f:g+w:,-f:o+w:,-^u0u${EUID})
+           ${^fpath:h}(N-f:g+w:,-f:o+w:,-^u0u${EUID}) )
 
 # RedHat Linux "per-user groups" check.  This is tricky, because it's very
 # difficult to tell whether the sysadmin has put someone else into your
@@ -138,7 +111,7 @@
 
   if [[ $GROUP == $LOGNAME && ( -z $GROUPMEM || $GROUPMEM == $LOGNAME ) ]]
   then
-    _i_wdirs=( ${^_i_wdirs}(N-f:g+w:^g:${GROUP}:,-f:o+w:,-^${_i_owners}) )
+    _i_wdirs=( ${^_i_wdirs}(N-f:g+w:^g:${GROUP}:,-f:o+w:,-^u0u${EUID}) )
   fi
 fi
 
@@ -149,8 +122,8 @@
   _i_wdirs=( ${_i_wdirs:#/usr/local/*} ${^_i_ulwdirs}(Nf:g+ws:^g:staff:,f:o+w:,^u0) )
 fi
 
-_i_wdirs=( $_i_wdirs ${^fpath}.zwc^([^_]*|*~)(N-^${_i_owners}) )
-_i_wfiles=( ${^fpath}/^([^_]*|*~)(N-^${_i_owners}) )
+_i_wdirs=( $_i_wdirs ${^fpath}.zwc^([^_]*|*~)(N-^u0u${EUID}) )
+_i_wfiles=( ${^fpath}/^([^_]*|*~)(N-^u0u${EUID}) )
 
 case "${#_i_wdirs}:${#_i_wfiles}" in
 (0:0) _i_q= ;;
diff -ruN zsh-5.0.4/Completion/compinit zsh-5.0.2/Completion/compinit
--- zsh-5.0.4/Completion/compinit	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/compinit	2012-07-21 11:32:25.000000000 -0700
@@ -163,9 +163,8 @@
 
 typeset -g _comp_setup='local -A _comp_caller_options;
              _comp_caller_options=(${(kv)options[@]});
-             setopt localoptions localtraps localpatterns ${_comp_options[@]};
+             setopt localoptions localtraps ${_comp_options[@]};
              local IFS=$'\'\ \\t\\r\\n\\0\''
-             enable -p \| \~ \( \? \* \[ \< \^ \#
              exec </dev/null;
              trap - ZERR
              local -a reply
diff -ruN zsh-5.0.4/Completion/openSUSE/Command/_osc zsh-5.0.2/Completion/openSUSE/Command/_osc
--- zsh-5.0.4/Completion/openSUSE/Command/_osc	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/openSUSE/Command/_osc	2012-02-05 11:22:58.000000000 -0800
@@ -16,8 +16,8 @@
 # version 0.2
 #
 
-OSC_BUILD_TARGETS="openSUSE_12.1 openSUSE_12.2 openSUSE_12.3 openSUSE_Tumbleweed openSUSE_Factory SLE_11_SP2"
-OSC_PROJECTS="openSUSE:Factory openSUSE:Tumbleweed openSUSE:12.3 openSUSE:12.2 openSUSE:12.1"
+OSC_BUILD_TARGETS="openSUSE_11.2 openSUSE_11.3 openSUSE_11.4 openSUSE_12.1 openSUSE_Tumbleweed openSUSE_Factory SLE_11_SP1"
+OSC_PROJECTS="openSUSE:Factory openSUSE:Tumbleweed openSUSE:12.1 openSUSE:11.4 openSUSE:11.2 openSUSE:11.3"
 
 # user defined variables $OSC_BUILD_TARGETS_EXTRA and
 # $OSC_PROJECTS_EXTRA can add to the project/build target list
diff -ruN zsh-5.0.4/Completion/openSUSE/Command/_zypper zsh-5.0.2/Completion/openSUSE/Command/_zypper
--- zsh-5.0.4/Completion/openSUSE/Command/_zypper	2013-11-27 11:00:19.000000000 -0800
+++ zsh-5.0.2/Completion/openSUSE/Command/_zypper	2011-05-20 12:13:17.000000000 -0700
@@ -28,10 +28,11 @@
 	local hline
 	local -a cmdlist
 	local tag=0
-	_call_program help-commands LANG=C zypper help | sed -e ':a;N;$!ba;s/\n\t\t\t\t/ /g' | while read -A hline; do
+	_call_program help-commands zypper help | while read -A hline; do
 	    # start parsing with "Global Options:"
 	    [[ $hline =~ "^Global Options:" ]] && tag=1
 	    [[ $tag = 0 ]] && continue
+	    [[ $hline[1] =~ ^\t\t\t\t ]] && continue
 	    # all commands have to start with lower case letters
 	    [[ $hline[1] =~ ^[A-Z] ]] && continue
 	    (( ${#hline} < 2 )) && continue
@@ -50,7 +51,7 @@
     local hline
     local -a cmdlist
     local tag=0
-    _call_program help-commands LANG=C zypper help $cmd | while read -A hline; do
+    _call_program help-commands zypper help $cmd | while read -A hline; do
 	# start parsing from "Options:"
 	[[ $hline =~ "^Command options:" ]] && tag=1
 	[[ $tag = 0 ]] && continue
diff -ruN zsh-5.0.4/Config/defs.mk.in zsh-5.0.2/Config/defs.mk.in
--- zsh-5.0.4/Config/defs.mk.in	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Config/defs.mk.in	2011-04-19 13:08:21.000000000 -0700
@@ -51,8 +51,6 @@
 scriptdir       = @scriptdir@
 sitescriptdir   = @sitescriptdir@
 htmldir         = @htmldir@
-runhelpdir      = @runhelpdir@
-runhelp         = @runhelp@
 
 # compilation
 CC              = @CC@
diff -ruN zsh-5.0.4/Config/installfns.sh zsh-5.0.2/Config/installfns.sh
--- zsh-5.0.4/Config/installfns.sh	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Config/installfns.sh	2010-02-02 12:19:57.000000000 -0800
@@ -10,8 +10,6 @@
 
 allfuncs="`cd $sdir_top; echo ${allfuncs}`"
 
-test -d installfnsdir || mkdir installfnsdir
-
 # We now have a list of files, but we need to use `test -f' to check
 # (1) the glob got expanded (2) we are not looking at directories.
 for file in $allfuncs; do
@@ -46,22 +44,8 @@
         ;;
       esac
     fi
-    basename=`basename $file`
-    ok=0
-    if test -d $instdir || /bin/sh $sdir_top/mkinstalldirs $instdir; then
-      if sed "s|@runhelpdir@|$runhelpdir|" <$sdir_top/$file \
-        >installfnsdir/$basename; then
-	if $INSTALL_DATA installfnsdir/$basename $instdir; then
-	  ok=1
-	fi
-      fi
-    fi
-    case $ok in
-      0)
-      rm -rf installfnsdir
-      exit 1
-      ;;
-    esac
+    test -d $instdir || /bin/sh $sdir_top/mkinstalldirs $instdir || exit 1
+    $INSTALL_DATA $sdir_top/$file $instdir || exit 1
     read line < $sdir_top/$file
     case "$line" in
       '#!'*)
@@ -70,5 +54,3 @@
     esac
   fi
 done
-
-rm -rf installfnsdir
diff -ruN zsh-5.0.4/Config/version.mk zsh-5.0.2/Config/version.mk
--- zsh-5.0.4/Config/version.mk	2013-12-20 10:21:12.000000000 -0800
+++ zsh-5.0.2/Config/version.mk	2012-12-21 11:31:16.000000000 -0800
@@ -27,5 +27,5 @@
 # This must also serve as a shell script, so do not add spaces around the
 # `=' signs.
 
-VERSION=5.0.4
-VERSION_DATE='December 20, 2013'
+VERSION=5.0.2
+VERSION_DATE='December 21, 2012'
diff -ruN zsh-5.0.4/Doc/.cvsignore zsh-5.0.2/Doc/.cvsignore
--- zsh-5.0.4/Doc/.cvsignore	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/.cvsignore	2009-04-18 04:56:17.000000000 -0700
@@ -1,5 +1,4 @@
 Makefile
-help.txt
 version.yo
 zsh*.1
 zsh.texi
diff -ruN zsh-5.0.4/Doc/.distfiles zsh-5.0.2/Doc/.distfiles
--- zsh-5.0.4/Doc/.distfiles	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/.distfiles	2012-07-25 14:10:01.000000000 -0700
@@ -11,7 +11,6 @@
     zshcompctl.1 zshcompsys.1 zshcompwid.1 zshexpn.1
     zshmisc.1 zshmodules.1 zshoptions.1 zshparam.1 zshroadmap.1
     zshzle.1 zshall.1 zshzftpsys.1 zshcontrib.1 zshtcpsys.1
-    help.txt
 '
 
 DISTFILES_DOC='
diff -ruN zsh-5.0.4/Doc/Makefile.in zsh-5.0.2/Doc/Makefile.in
--- zsh-5.0.4/Doc/Makefile.in	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Makefile.in	2012-08-13 12:35:53.000000000 -0700
@@ -34,7 +34,6 @@
 sdir            = @srcdir@
 sdir_top        = @top_srcdir@
 INSTALL         = @INSTALL@
-LN_S            = @LN_S@
 
 @DEFS_MK@
 
@@ -83,7 +82,7 @@
 
 # ========== DEPENDENCIES FOR BUILDING ==========
 
-all: man $(runhelp) texi ../META-FAQ
+all: man texi ../META-FAQ
 .PHONY: all
 
 everything: all dvi html pdf info
@@ -184,15 +183,6 @@
 man: $(MAN)
 .PHONY: man
 
-runhelp: help.txt
-.PHONY: runhelp
-
-help.txt: zshbuiltins.1
-	@-rm -f $(sdir)/help.txt $(sdir)/help/*
-	perl $(sdir_top)/Util/helpfiles \
-	    $(sdir)/zshbuiltins.1 $(sdir)/help $(sdir)/help.txt \
-	    || { rm -f $(sdir)/help.txt $(sdir)/help/*; false; }
-
 $(MAN): zmacros.yo zman.yo
 
 zsh.1 zshall.1: Zsh/intro.yo Zsh/metafaq.yo Zsh/invoke.yo Zsh/files.yo \
@@ -295,12 +285,12 @@
 
 # ========== DEPENDENCIES FOR INSTALLING ==========
 
-# install just installs the manual and runhelp pages
-install: install.man install.runhelp
+# install just installs the manual pages
+install: install.man
 .PHONY: install
 
-# uninstall just uninstalls the manual and runhelp pages
-uninstall: uninstall.man uninstall.runhelp
+# uninstall just unistalls the manual pages
+uninstall: uninstall.man
 .PHONY: uninstall
 
 # install man pages, creating install directory if necessary
@@ -312,18 +302,6 @@
 	done
 .PHONY: install.man
 
-# install runhelp pages, creating install directory if necessary
-install.runhelp: $(runhelp)
-	if test x"$(runhelpdir)" != x""; then \
-	    ${SHELL} $(sdir_top)/mkinstalldirs $(DESTDIR)$(runhelpdir); \
-	    $(INSTALL_DATA) $(sdir)/help/* $(DESTDIR)$(runhelpdir); \
-	    while read from to; do \
-	        rm -f $(DESTDIR)$(runhelpdir)/$$to || : ; \
-	        $(LN_S) $$from $(DESTDIR)$(runhelpdir)/$$to; \
-	    done < $(sdir)/help.txt; \
-	fi
-.PHONY: install.runhelp
-
 # install info pages, creating install directory if necessary
 install.info: texi
 	${SHELL} $(sdir_top)/mkinstalldirs $(DESTDIR)$(infodir)
@@ -356,11 +334,6 @@
 	done
 .PHONY: uninstall.man
 
-# uninstall runhelp pages
-uninstall.runhelp:
-	test x"$(runhelpdir)" = x"" || rm -rf -- $(DESTDIR)$(runhelpdir)
-.PHONY: uninstall.runhelp
-
 # uninstall info pages
 uninstall.info:
 	rm -f $(DESTDIR)$(infodir)/$(tzsh).info
@@ -396,7 +369,6 @@
 realclean-here: distclean-here
 	cd $(sdir) && rm -f Zsh/modlist.yo Zsh/modmenu.yo Zsh/manmodmenu.yo
 	cd $(sdir) && rm -f version.yo ../META-FAQ zsh.texi $(MAN)
-	cd $(sdir) && rm -f help.txt help/*
 .PHONY: realclean-here
 
 @CLEAN_MK@
diff -ruN zsh-5.0.4/Doc/Zsh/builtins.yo zsh-5.0.2/Doc/Zsh/builtins.yo
--- zsh-5.0.4/Doc/Zsh/builtins.yo	2013-12-09 13:20:25.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/builtins.yo	2012-11-09 13:45:59.000000000 -0800
@@ -28,40 +28,6 @@
 ifnzman(noderef(Zle Builtins)).
 )\
 )\
-
-Some shell builtin commands take options as described in individual
-entries; these are often referred to in the list below as `tt(flags)' to
-avoid confusion with shell options, which may also have an effect on the
-behaviour of builtin commands.  In this introductory section,
-`tt(option)' always has the meaning of an option to a command that should
-be familiar to most command line users.
-
-Typically, options are single letters preceded by a hyphen (tt(-)).
-Options that take an argument accept it either immediately following the
-option letter or after white space, for example `tt(print -C3 *)' or
-`tt(print -C 3 *)' are equivalent.  Arguments to options are not the
-same as arguments to the command; the documentation indicates which is
-which.  Options that do not take an argument may be combined in a single
-word, for example `tt(print -ca *)' and `tt(print -c -a *)' are
-equivalent.
-
-Some shell builtin commands also take options that begin with `tt(+)'
-instead of `tt(-)'.  The list below makes clear which commands these
-are.
-
-Options (together with their individual arguments, if any) must appear
-in a group before any non-option arguments; once the first non-option
-argument has been found, option processing is terminated.
-
-All builtin commands other than precommand modifiers, even those that
-have no options, can be given the argument `tt(--)' to terminate option
-processing.  This indicates that the following words are non-option
-arguments, but is otherwise ignored.  This is useful in cases where
-arguments to the command may begin with `tt(-)'.  For historical
-reasons, most builtin commands also recognize a single `tt(-)' in a
-separate word for this purpose; note that this is less standard and
-use of `tt(--) is recommended.
-
 startitem()
 prefix(-)
 findex(.)
@@ -102,7 +68,7 @@
 define a global alias; global aliases are expanded even if they do not
 occur in command position.
 
-If the tt(-s) flag is present, define a suffix alias: if the command
+If the tt(-s) flags is present, define a suffix alias: if the command
 word on a command line is in the form `var(text)tt(.)var(name)', where
 var(text) is any non-empty string, it is replaced by the text
 `var(value) var(text)tt(.)var(name)'.  Note that var(name) is treated as
@@ -311,9 +277,7 @@
 clear the directory stack.
 )
 item(tt(-l))(
-print directory names in full instead of using of using tt(~) expressions (\
-ifzman(see em(Dynamic) and em(Static named directories) in zmanref(zshexpn))\
-ifnzman(noderef(Filename Expansion))).
+print directory names in full instead of using of using tt(~) expressions.
 )
 item(tt(-p))(
 print directory entries one per line.
@@ -327,8 +291,8 @@
 findex(disable)
 cindex(disabling commands)
 cindex(commands, disabling)
-item(tt(disable) [ tt(-afmprs) ] var(name) ...)(
-Temporarily disable the var(name)d hash table elements or patterns.  The default
+item(tt(disable) [ tt(-afmrs) ] var(name) ...)(
+Temporarily disable the var(name)d hash table elements.  The default
 is to disable builtin commands.  This allows you to use an external
 command with the same name as a builtin command.  The tt(-a) option
 causes tt(disable) to act on regular or global aliases.  The tt(-s)
@@ -341,80 +305,6 @@
 table elements from the corresponding hash table matching these patterns
 are disabled.  Disabled objects can be enabled with the tt(enable)
 command.
-
-With the option tt(-p), var(name) ... refer to elements of the
-shell's pattern syntax as described in noderef(Filename Generation).
-Certain elements can be disabled separately, as given below.
-
-Note that patterns
-not allowed by the current settings for the options tt(EXTENDED_GLOB),
-tt(KSH_GLOB) and tt(SH_GLOB) are never enabled, regardless of the
-setting here.  For example, if tt(EXTENDED_GLOB) is not active,
-the pattern tt(^) is ineffective even if `tt(disable -p "^")' has
-not been issued.  The list below indicates any option settings
-that restrict the use of the pattern.  It should be noted that
-setting tt(SH_GLOB) has a wider effect then merely disabling patterns
-as certain expressions, in particular those involving parentheses,
-are parsed differently.
-
-The following patterns may be disabled; all
-the strings need quoting on the command line to prevent them from
-being interpreted immediately as patterns and the patterns are
-shown below in single quotes as a reminder.
-startitem()
-item(tt('?'))(
-The pattern character tt(?) wherever it occurs, including when preceding
-a parenthesis with tt(KSH_GLOB).
-)
-item(tt('*'))(
-The pattern character tt(*) wherever it occurs, including recursive
-globbing and when preceding a parenthesis with tt(KSH_GLOB).
-)
-item('LSQUARE()')(
-Character classes.
-)
-item(tt('<') (tt(NO_SH_GLOB)))(
-Numeric ranges.
-)
-item(tt('|') (tt(NO_SH_GLOB)))(
-Alternation in grouped patterns, case statements, or KSH_GLOB
-parenthesised expressions.
-)
-item(tt('LPAR()') (tt(NO_SH_GLOB)))(
-Grouping using single parentheses.  Disabling this does not disable the
-use of parentheses for tt(KSH_GLOB) where they are introduced by a
-special character, nor for glob qualifiers (use `tt(setopt
-NO_BARE_GLOB_QUAL)' to disable glob qualifiers that use parentheses
-only).
-)
-item(tt('~') (tt(EXTENDED_GLOB)))(
-Exclusion in the form var(A)tt(~)var(B).
-)
-item(tt('^') (tt(EXTENDED_GLOB)))(
-Exclusion in the form var(A)tt(^)var(B).
-)
-item(tt('#') (tt(EXTENDED_GLOB)))(
-The pattern character tt(#) wherever it occurs, both for
-repetition of a previous pattern and for indicating globbing flags.
-)
-item(tt('?LPAR()') (tt(KSH_GLOB)))(
-The grouping form tt(?LPAR())var(...)tt(RPAR()).  Note this is also
-disabled if tt('?') is disabled.
-)
-item(tt('*LPAR()') (tt(KSH_GLOB)))(
-The grouping form tt(*LPAR())var(...)tt(RPAR()).  Note this is also
-disabled if tt('*') is disabled.
-)
-item(tt('PLUS()LPAR()') (tt(KSH_GLOB)))(
-The grouping form tt(PLUS()LPAR())var(...)tt(RPAR()).
-)
-item(tt('!LPAR()') (tt(KSH_GLOB)))(
-The grouping form tt(!LPAR())var(...)tt(RPAR()).
-)
-item(tt('@LPAR()') (tt(KSH_GLOB)))(
-The grouping form tt(@LPAR())var(...)tt(RPAR()).
-)
-enditem()
 )
 findex(disown)
 cindex(jobs, disowning)
@@ -486,9 +376,7 @@
 ifnzman(\
 noderef(Compatibility)
 )\
-.  In addition to setting shell options, the command also restores
-the pristine state of pattern enables, as if all patterns had been
-enabled using tt(enable -p).
+.
 
 If the tt(emulate) command occurs inside a function that has been
 marked for execution tracing with tt(functions -t) then the tt(xtrace)
@@ -502,11 +390,9 @@
 mode, except for certain options describing the interactive
 environment; otherwise, only those options likely to cause portability
 problems in scripts and functions are altered.  If the tt(-L) switch is given,
-the options tt(LOCAL_OPTIONS), tt(LOCAL_PATTERNS) and tt(LOCAL_TRAPS)
-will be set as
-well, causing the effects of the tt(emulate) command and any tt(setopt),
-tt(disable -p) or tt(enable -p), and tt(trap) commands to be local to
-the immediately surrounding shell
+the options tt(LOCAL_OPTIONS) and tt(LOCAL_TRAPS) will be set as
+well, causing the effects of the tt(emulate) command and any tt(setopt) and
+tt(trap) commands to be local to the immediately surrounding shell
 function, if any; normally these options are turned off in all emulation
 modes except tt(ksh). The tt(-L) switch is mutually exclusive with the
 use of tt(-c) in var(flags).
@@ -528,8 +414,7 @@
 within the evaluated expression:  the emulation mode is associated
 thereafter with the function so that whenever the function is executed
 the emulation (respecting the tt(-R) switch, if present) and all
-options are set (and pattern disables cleared)
-before entry to the function, and the state is restored after exit.
+options are set before entry to the function, and restored after exit.
 If the function is called when the sticky emulation is already in
 effect, either within an `tt(emulate) var(shell) tt(-c)' expression or
 within another function with the same sticky emulation, entry and exit
@@ -586,7 +471,7 @@
 findex(enable)
 cindex(enabling commands)
 cindex(commands, enabling)
-item(tt(enable) [ tt(-afmprs) ] var(name) ...)(
+item(tt(enable) [ tt(-afmrs) ] var(name) ...)(
 Enable the var(name)d hash table elements, presumably disabled
 earlier with tt(disable).  The default is to enable builtin commands.
 The tt(-a) option causes tt(enable) to act on regular or global aliases.
@@ -598,13 +483,6 @@
 (should be quoted) and all hash table elements from the corresponding
 hash table matching these patterns are enabled.  Enabled objects can be
 disabled with the tt(disable) builtin command.
-
-tt(enable -p) reenables patterns disabled with tt(disable -p).  Note
-that it does not override globbing options; for example, `tt(enable -p
-"~")' does not cause the pattern character tt(~) to be active unless
-the tt(EXTENDED_GLOB) option is also set.  To enable all possible
-patterns (so that they may be invidually disabled with tt(disable -p)),
-use `tt(setopt EXTENDED_GLOB KSH_GLOB NO_SH_GLOB)'.
 )
 findex(eval)
 cindex(evaluating arguments as commands)
@@ -629,11 +507,6 @@
 pindex(IGNORE_EOF, use of)
 An EOF condition will also cause the shell to exit, unless
 the tt(IGNORE_EOF) option is set.
-
-See notes at the end of
-ifzman(the section JOBS in in zmanref(zshmisc))\
-ifnzman(noderef(Jobs & Signals)) for some possibly unexpected interactions
-of the tt(exit) command with jobs.
 )
 findex(export)
 item(tt(export) [ var(name)[tt(=)var(value)] ... ])(
@@ -1003,19 +876,15 @@
 sitem(tt(datasize))(Maximum data size (including stack) for each process.)
 sitem(tt(descriptors))(Maximum value for a file descriptor.)
 sitem(tt(filesize))(Largest single file allowed.)
-sitem(tt(kqueues))(Maximum number of kqueues allocated.)
 sitem(tt(maxproc))(Maximum number of processes.)
 sitem(tt(maxpthreads))(Maximum number of threads per process.)
 sitem(tt(memorylocked))(Maximum amount of memory locked in RAM.)
 sitem(tt(memoryuse))(Maximum resident set size.)
 sitem(tt(msgqueue))(Maximum number of bytes in POSIX message queues.)
-sitem(tt(posixlocks))(Maximum number of POSIX locks per user.)
-sitem(tt(pseudoterminals))(Maximum number of pseudo-terminals.)
 sitem(tt(resident))(Maximum resident set size.)
 sitem(tt(sigpending))(Maximum number of pending signals.)
 sitem(tt(sockbufsize))(Maximum size of all socket buffers.)
 sitem(tt(stacksize))(Maximum stack size for each process.)
-sitem(tt(swapsize))(Maximum amount of swap used.)
 sitem(tt(vmemorysize))(Maximum amount of virtual memory.)
 endsitem()
 
@@ -1113,8 +982,8 @@
 arguments are printed with the row incrementing first.
 )
 item(tt(-D))(
-Treat the arguments as paths, replacing directory prefixes with tt(~)
-expressions corresponding to directory names, as appropriate.
+Treat the arguments as directory names, replacing prefixes with tt(~)
+expressions, as appropriate.
 )
 item(tt(-i))(
 If given together with tt(-o) or tt(-O), sorting is performed
@@ -1897,7 +1766,7 @@
 findex(ulimit)
 cindex(resource limits)
 cindex(limits, resource)
-item(tt(ulimit) [ [ tt(-SHacdfiklmnpqsTtvwx) | tt(-N) var(resource) [ var(limit) ] ... ])(
+item(tt(ulimit) [ [ tt(-SHacdfilmnpqrstvx) | tt(-N) var(resource) [ var(limit) ] ... ])(
 Set or display resource limits of the shell and the processes started by
 the shell.  The value of var(limit) can be a number in the unit specified
 below or one of the values `tt(unlimited)', which removes the limit on the
@@ -1928,19 +1797,16 @@
 sitem(tt(-d))(Kilobytes on the size of the data segment.)
 sitem(tt(-f))(512-byte blocks on the size of files written.)
 sitem(tt(-i))(The number of pending signals.)
-sitem(tt(-k))(The number of kqueues allocated.)
 sitem(tt(-l))(Kilobytes on the size of locked-in memory.)
 sitem(tt(-m))(Kilobytes on the size of physical memory.)
 sitem(tt(-n))(open file descriptors.)
-sitem(tt(-p))(The number of pseudo-terminals.)
 sitem(tt(-q))(Bytes in POSIX message queues.)
 sitem(tt(-s))(Kilobytes on the size of the stack.)
-sitem(tt(-T))(The number of simultaneous threads available to the user.)
 sitem(tt(-t))(CPU seconds to be used.)
+sitem(tt(-r))(The number of simultaneous threads available to the user.)
 sitem(tt(-u))(The number of processes available to the user.)
 sitem(tt(-v))(Kilobytes on the size of virtual memory.  On some systems this
 refers to the limit called `address space'.)
-sitem(tt(-w))(Kilobytes on the size of swapped out memory.)
 sitem(tt(-x))(The number of locks on files.)
 endsitem()
 
diff -ruN zsh-5.0.4/Doc/Zsh/calsys.yo zsh-5.0.2/Doc/Zsh/calsys.yo
--- zsh-5.0.4/Doc/Zsh/calsys.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/calsys.yo	2011-05-20 12:13:17.000000000 -0700
@@ -651,29 +651,16 @@
 arguments, hence the use of the additional colon to separate the date and
 time.
 
-example(AGEREF=2006/10/04:10:15
+example(AGEREF1=2006/10/04:10:15
 AGEREF2=2006/10/04:10:45
 print *+LPAR()PLUS()age+RPAR())
 
 This shows the same example before using another form of argument
-passing.  The dates and times in the parameters tt(AGEREF) and tt(AGEREF2)
+passing.  The dates and times in the parameters tt(AGEREF1) and tt(AGEREF2)
 stay in effect until unset, but will be overridden if any argument is
 passed as an explicit argument to age.  Any explicit argument
 causes both parameters to be ignored.
 
-Instead of an explicit date and time, it's possible to use the
-modification time of a file as the date and time for either argument
-by introducing the file name with a colon:
-
-example(print *+LPAR()e-age :file1-+RPAR())
-
-matches all files created on the same day (24 hours starting from
-midnight) as tt(file1).
-
-example(print *+LPAR()e-age :file1 :file2-+RPAR())
-
-matches all files modified no earlier than tt(file1) and
-no later than tt(file2); precision here is to the nearest second.
 
 texinode(Calendar Styles)(Calendar Utility Functions)(Calendar System User Functions)(Calendar Function System)
 sect(Styles)
diff -ruN zsh-5.0.4/Doc/Zsh/compsys.yo zsh-5.0.2/Doc/Zsh/compsys.yo
--- zsh-5.0.4/Doc/Zsh/compsys.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/compsys.yo	2012-09-06 11:20:24.000000000 -0700
@@ -3470,26 +3470,14 @@
 different name for the argument context field.
 )
 findex(_arguments)
-xitem(tt(_arguments) [ tt(-nswWCRS) ] [ tt(-A) var(pat) ] [ tt(-O) var(name) ] [ tt(-M) var(matchspec) ] [ tt(:) ] var(spec)...)
-item(tt(_arguments) [ var(opts)... ] tt(-)tt(-) [ -i var(pats) ] [ tt(-s) var(pair) ] [ var(helpspec)... ])(
-This function can be used to give a complete specification for completion
-for a command whose arguments follow standard UNIX option and argument
-conventions.  Options to tt(_arguments) itself must be in separate words,
-i.e. tt(-s -w), not tt(-sw).
-
-When calling tt(_arguments), all var(spec)s that describe options of the
-analyzed command line must precede all var(spec)s that describe non-option
-(aka "normal") arguments of the analyzed line.  To avoid ambiguity, all
-options to tt(_arguments) itself may be separated from the var(spec) forms
-by a single colon.
-
-The tt(-s -w -W -A) and tt(-S) options describe how parsing of the command
-line should proceed, and are discussed in context below.  The `tt(-)tt(-)'
-form is used to intuit var(spec) forms from the help output of the command
-being analyzed, and is described in detail below.  The var(opts) for the
-`tt(-)tt(-)' form are otherwise the same options as the first form.  Note
-that `tt(-s)' following `tt(-)tt(-)' has a distinct meaning from `tt(-s)'
-preceding `tt(-)tt(-)', and both may appear.
+item(tt(_arguments) [ tt(-nswWACRS) ] [ tt(-O) var(name) ] [ tt(-M) var(matchspec) ] [ tt(:) ] var(spec) ...)(
+This function can be used to give a complete specification for
+completion for a command whose arguments follow standard UNIX option and
+argument conventions.  The following forms specify individual sets of
+options and arguments; to avoid ambiguity, these may be separated from the
+options to tt(_arguments) itself by a single colon.  Options to
+tt(_arguments) itself must be in separate words, i.e. tt(-s -w), not
+tt(-sw).
 
 With the option tt(-n), tt(_arguments) sets the parameter tt(NORMARG)
 to the position of the first normal argument in the tt($words) array,
@@ -3498,17 +3486,6 @@
 should declare `tt(integer NORMARG)' if the tt(-n) option is passed;
 otherwise the parameter is not used.
 
-The option `tt(-M) var(matchspec)' sets a match specification to use to
-completion option names and values.  The default var(matchspec) is:
-
-example(tt(r:|[_-]=* r:|=*))
-
-This allows partial word completion after `tt(_)' and `tt(-)', for example
-`-f-b' can be completed to `tt(-foo-bar)'.
-
-Each of the following forms is a var(spec) describing individual sets of
-options or arguments on the command line being analyzed.
-
 startitem()
 xitem(var(n)tt(:)var(message)tt(:)var(action))
 item(var(n)tt(::)var(message)tt(:)var(action))(
@@ -3553,10 +3530,10 @@
 
 The combination of tt(-s) with tt(-w) allows single-letter options to be
 combined in a single word even if one or more of the options take
-arguments.  For example, if tt(-x) takes an argument, with no
-tt(-s) `tt(-xy)' is considered as a single (unhandled) option; with
-tt(-s) tt(-xy) is an option with the argument `tt(y)'; with both tt(-s)
-and tt(-w), tt(-xy) may be the option tt(-x) and the option tt(-y) with
+arguments.  For example, if tt(-a) takes an argument, with no
+tt(-s) `tt(-ab)' is considered as a single (unhandled) option; with
+tt(-s) tt(-ab) is an option with the argument `tt(b)'; with both tt(-s)
+and tt(-w), tt(-ab) may be the option tt(-a) and the option tt(-b) with
 arguments still to come.
 
 The option tt(-W) takes this a stage further:  it is possible to
@@ -3626,23 +3603,6 @@
 It is possible for options with a literal `PLUS()' or `tt(=)' to
 appear, but that character must be quoted, for example `tt(-\+)'.
 
-The options tt(-S) and tt(-A) are available to simplify the specifications
-for commands with standard option parsing.  With tt(-S), no option will be
-completed after a `tt(-)tt(-)' appearing on its own on the line; this
-argument will otherwise be ignored; hence in the line
-
-example(foobar -x -- -y)
-
-the `tt(-x)' is considered an option but the `tt(-y)' is considered an
-argument, while the `tt(-)tt(-)' is considered to be neither.
-
-With tt(-A), no options will be completed after the first non-option
-argument on the line.  The tt(-A) must be followed by a pattern matching
-all strings which are not to be taken as arguments.  For example, to make
-tt(_arguments) stop completing options after the first normal argument, but
-ignoring all strings starting with a hyphen even if they are not described
-by one of the var(optspec)s, the form is `tt(-A "-*")'.
-
 Each var(optarg) following an var(optspec) must take one of the
 following forms:
 
@@ -3716,11 +3676,6 @@
 tt(_all_labels) function to process all tag labels.  No special handling
 of tags is needed unless a function call introduces a new one.
 
-The option `tt(-O) var(name)' specifies the name of an array whose elements
-will be passed as arguments to functions called to execute var(action)s.
-For example, this can be used to pass the same set of options for the
-tt(compadd) builtin to all var(action)s.
-
 The forms for var(action) are as follows.
 
 startitem()
@@ -3849,18 +3804,6 @@
 the tt(curcontext) parameter is altered to append the same string that is
 stored in the tt(context) parameter.
 
-The option tt(-C) tells tt(_arguments) to modify the tt(curcontext)
-parameter for an action of the form `tt(->)var(state)'.  This is the
-standard parameter used to keep track of the current context.  Here it
-(and not the tt(context) array) should be made local to the calling
-function to avoid passing back the modified value and should be
-initialised to the current value at the start of the function:
-
-example(local curcontext="$curcontext")
-
-This is useful where it is not possible for multiple states to be valid
-together.
-
 It is possible to specify multiple sets of options and
 arguments with the sets separated by single hyphens.  The specifications
 before the first hyphen (if any) are shared by all the remaining sets.
@@ -3907,6 +3850,47 @@
 (as in `tt(-foo:*:...)'); here the option tt(-foo) swallows up all
 remaining arguments as described by the var(optarg) definitions.
 
+The options tt(-S) and tt(-A) are available to simplify the specifications
+for commands with standard option parsing.  With tt(-S), no option will be
+completed after a `tt(-)tt(-)' appearing on its own on the line; this
+argument will otherwise be ignored; hence in the line
+
+example(foobar -a -- -b)
+
+the `tt(-a)' is considered an option but the `tt(-b)' is considered an
+argument, while the `tt(-)tt(-)' is considered to be neither.
+
+With tt(-A), no options will be completed after the first non-option
+argument on the line.  The tt(-A) must be followed by a pattern matching
+all strings which are not to be taken as arguments.  For example, to make
+tt(_arguments) stop completing options after the first normal argument, but
+ignoring all strings starting with a hyphen even if they are not described
+by one of the var(optspec)s, the form is `tt(-A "-*")'.
+
+The option `tt(-O) var(name)' specifies the name of an array whose elements
+will be passed as arguments to functions called to execute var(actions).
+For example, this can be used to pass the same set of options for the
+tt(compadd) builtin to all var(action)s.
+
+The option `tt(-M) var(spec)' sets a match specification to use to
+completion option names and values.  It must appear before the first
+argument specification.  The default is `tt(r:|[_-]=* r:|=*)': this allows
+partial word completion after `tt(_)' and `tt(-)', for example `-f-b'
+can be completed to `tt(-foo-bar)'.
+
+The option tt(-C) tells tt(_arguments) to modify
+the tt(curcontext) parameter for an action of the form
+`tt(->)var(state)'.  This is the standard parameter used to keep track of
+the current context.  Here it (and not the tt(context) array) should be
+made local to the calling function
+to avoid passing back the modified value and should be initialised to the
+current value at the start of the function:
+
+example(local curcontext="$curcontext")
+
+This is useful where it is not possible for multiple states to be valid
+together.
+
 The option `tt(-)tt(-)' allows tt(_arguments) to work out the names of long
 options that support the `tt(-)tt(-help)' option which is standard in many
 GNU commands.  The command word is called with the argument
@@ -3917,16 +3901,11 @@
 In addition to options, `tt(_arguments -)tt(-)' will try to deduce the
 types of arguments available for options when the form
 `tt(-)tt(-)var(opt)=var(val)' is valid.  It is also possible to provide
-hints by examining the help text of the command and adding var(helpspec) of
-the form `var(pattern)tt(:)var(message)tt(:)var(action)'; note that other
-tt(_arguments) var(spec) forms are not used.  The var(pattern) is matched
+hints by examining the help text of the command and adding specifiers of
+the form `var(pattern)tt(:)var(message)tt(:)var(action)'; note that normal
+tt(_arguments) specifiers are not used.  The var(pattern) is matched
 against the help text for an option, and if it matches the var(message) and
-var(action) are used as for other argument specifiers.  The special case
-of `tt(*:)' means both var(message) and var(action) are empty, which has
-the effect of causing options having no description in the help output to
-be ordered in listings ahead of options that have a description.
-
-For example:
+var(action) are used as for other argument specifiers.  For example:
 
 example(_arguments -- '*\*:toggle:(yes no)' \ 
               '*=FILE*:file:_files' \ 
@@ -3968,23 +3947,12 @@
 useful with GNU tt(configure)).
 
 The `tt(_arguments -)tt(-)' form can also be followed by the option `tt(-s)
-var(pair)' to describe option aliases.  The var(pair) consists of a list
-of alternating patterns and corresponding replacements, enclosed in parens
-and quoted so that it forms a single argument word in the tt(_arguments)
-call.
-
-For example, some tt(configure)-script help output describes options only
-as `tt(-)tt(-enable-foo)', but the script also accepts the negated form
+var(pair)' to describe option aliases.  Each var(pair) consists of a
+pattern and a replacement.  For example, some tt(configure)-scripts
+describe options only as `tt(-)tt(-enable-foo)', but also accept
 `tt(-)tt(-disable-foo)'.  To allow completion of the second form:
 
-example(tt(_arguments -- -s "LPAR()#-)tt(-enable- -)tt(-disable-RPAR()"))
-
-Finally, note that tt(_arguments) generally expects to be the primary
-function handling any completion for which it is used.  It may have side
-effects which change the treatment of any matches added by other functions
-called after it.  To combine tt(_arguments) with other functions, those
-functions should be called either before tt(_arguments), as an var(action)
-within a var(spec), or in handlers for `tt(->)var(state)' actions.
+example(_arguments -- -s "LPAR()#-tt(-enable- -)tt(-disable-RPAR()"))
 
 Here is a more general example of the use of tt(_arguments):
 
@@ -4283,14 +4251,11 @@
 The tt(-12VJ) options and the var(group) are passed to tt(compadd) and
 hence determine the group the message string is added to.
 
-The second tt(-e) form gives a description for completions with the tag
-var(tag) to be shown even if there are no matches for that tag.  This form
-is called by tt(_arguments) in the event that there is no action for an
-option specification.  The tag can be omitted and if so the tag is taken
-from the parameter tt($curtag); this is maintained by the completion
-system and so is usually correct.  Note that if there are no matches at
-the time this function is called, tt(compstate[insert]) is cleared, so
-additional matches generated later are not inserted on the command line.
+The second form gives a description for completions with the tag
+var(tag) to be shown even if there are no matches for that tag.  The tag
+can be omitted and if so the tag is taken from the parameter
+tt($curtag); this is maintained by the completion system and so is
+usually correct.
 )
 findex(_multi_parts)
 item(tt(_multi_parts) var(sep) var(array))(
@@ -4449,7 +4414,8 @@
 described above.
 )
 findex(_pick_variant)
-xitem(tt(_pick_variant) [ tt(-b) var(builtin-label) ] [ tt(-c) var(command) ] [ tt(-r) var(name) ])
+xitem(tt(_pick_variant) [ tt(-b) var(builtin-label) ] [ tt(-c)
+var(command) ] [ tt(-r) var(name) ])
 item(   var(label)tt(=)var(pattern) ... var(label) [ var(args) ... ])(
 This function is used to resolve situations where a single command name
 requires more than one type of handling, either because it
diff -ruN zsh-5.0.4/Doc/Zsh/contrib.yo zsh-5.0.2/Doc/Zsh/contrib.yo
--- zsh-5.0.4/Doc/Zsh/contrib.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/contrib.yo	2012-09-30 09:12:58.000000000 -0700
@@ -619,7 +619,7 @@
 example(autoload -Uz vcs_info)
 
 It can be used in any existing prompt, because it does not require any
-specific tt($psvar) entries to be available.
+tt($psvar) entries to be left available.
 
 subsect(Quickstart)
 
@@ -2477,22 +2477,15 @@
 an example of how to call this function.
 )
 tindex(modify-current-argument)
-item(tt(modify-current-argument) [ var(expr-using-)tt($ARG) | var(func) ])(
+item(tt(modify-current-argument) var(expr-using-)tt($ARG))(
 This function provides a simple method of allowing user-defined widgets
 to modify the command line argument under the cursor (or immediately to the
-left of the cursor if the cursor is between arguments).
-
-The argument can be an expression which when evaluated operates on the shell
+left of the cursor if the cursor is between arguments).  The argument
+should be an expression which when evaluated operates on the shell
 parameter tt(ARG), which will have been set to the command line argument
 under the cursor.  The expression should be suitably quoted to prevent
 it being evaluated too early.
 
-Alternatively, if the argument does not contain the string tt(ARG), it
-is assumed to be a shell function, to which the current command line
-argument is passed as the only argument.  The function should set the
-variable tt(REPLY) to the new value for the command line argument.
-If the function returns non-zero status, so does the calling function.
-
 For example, a user-defined widget containing the following code
 converts the characters in the argument under the cursor into all upper
 case:
@@ -2504,18 +2497,6 @@
 throughout:
 
 example(modify-current-argument '${(qq)${(Q)ARG}}')
-
-The following performs directory expansion on the command line
-argument and replaces it by the absolute path:
-
-example(expand-dir+LPAR()RPAR() {
-  REPLY=${~1}
-  REPLY=${REPLY:a}
-}
-modify-current-argument expand-dir)
-
-In practice the function tt(expand-dir) would probably not be defined
-within the widget where tt(modify-current-argument) is called.
 )
 enditem()
 
@@ -2861,14 +2842,6 @@
 tt(sh) process.  This is more efficient, but may not work in the occasional
 cases where the mailcap handler uses strict POSIX syntax.
 )
-kindex(disown, MIME style)
-item(tt(disown))(
-If this boolean style is true, mailcap handlers started in the
-background will be disowned, i.e. not subject to job control within
-the parent shell.  Such handlers nearly always produce their own
-windows, so the only likely harmful side effect of setting the style is
-that it becomes harder to kill jobs from within the shell.
-)
 kindex(execute-as-is, MIME style)
 item(tt(execute-as-is))(
 This style gives a list of patterns to be matched against files
@@ -2881,28 +2854,6 @@
 handler, and the option tt(AUTO_CD) may be used to change to directories
 that happen to have MIME suffixes.
 )
-kindex(execute-never, MIME style)
-item(tt(execute-never))(
-This style is useful in combination with tt(execute-as-is).  It is
-set to an array of patterns corresponding to full paths to files that
-should never be treated as executable, even if the file passed to
-the MIME handler matches tt(execute-as-is).  This is useful for file
-systems that don't handle execute permission or that contain executables
-from another operating system.  For example, if tt(/mnt/windows) is a
-Windows mount, then
-
-example(zstyle ':mime:*' execute-never '/mnt/windows/*')
-
-will ensure that any files found in that area will be executed as MIME
-types even if they are executable.  As this example shows, the complete
-file name is matched against the pattern, regardless of how the file
-was passed to the handler.  The file is resolved to a full path using
-the tt(:A) modifier described in
-ifzman(the subsection Modifers in zmanref(zshexpn))\
-ifnzman(noderef(Modifiers)));
-this means that symbolic links are resolved where possible, so that
-links into other file systems behave in the correct fashion.
-)
 kindex(file-path, MIME style)
 item(tt(file-path))(
 Used if the style tt(find-file-in-path) is true for the same context.
@@ -3155,7 +3106,7 @@
 
 startitem()
 findex(zcalc)
-item(tt(zcalc) [ tt(-ef) ] [ var(expression) ... ])(
+item(tt(zcalc) [ var(expression) ... ])(
 A reasonably powerful calculator based on zsh's arithmetic evaluation
 facility.  The syntax is similar to that of formulae in most programming
 languages; see
@@ -3176,13 +3127,6 @@
 the file tt(~/.zcalc_history).  To exit, enter a blank line or type `tt(:q)'
 on its own (`tt(q)' is allowed for historical compatibility).
 
-A line ending with a single backslash is treated in the same fashion
-as it is in command line editing:  the backslash is removed, the
-function prompts for more input (the prompt is preceded by `tt(...)'
-to indicate this), and the lines are combined into one to get the final
-result.  In addition, if the input so far contains more open than
-close parentheses tt(zcalc) will prompt for more input.
-
 If arguments are given to tt(zcalc) on start up, they are used to prime the
 first few positional parameters.  A visual indication of this is given when
 the calculator starts.
@@ -3195,14 +3139,6 @@
 for example `tt(zcalc -#16)' (the `tt(#)' may have to be quoted, depending
 on the globbing options set).
 
-If the option `tt(-e)' is set, the function runs non-interactively:
-the arguments are treated as expressions to be evaluated as if entered
-interactively line by line.
-
-If the option `tt(-f)' is set, all numbers are treated as floating
-point, hence for example the expression `tt(3/4)' evaluates to 0.75
-rather than 0.  Options must appear in separate words.
-
 The prompt is configurable via the parameter tt(ZCALCPROMPT), which
 undergoes standard prompt expansion.  The index of the current entry is
 stored locally in the first element of the array tt(psvar), which can be
@@ -3255,13 +3191,11 @@
 )
 item(tt(:function) var(name) [ var(body) ])(
 Define a mathematical function or (with no var(body)) delete it.
-tt(:function) may be abbreviated to tt(:func) or simply tt(:f).
-The var(name) may contain the same characters as a shell function name.
 The function is defined using tt(zmathfuncdef), see below.
 
 Note that tt(zcalc) takes care of all quoting.  Hence for example:
 
-example(:f cube $1 * $1 * $1)
+example(function cube $1 * $1 * $1)
 
 defines a function to cube the sole argument.
 )
@@ -3652,7 +3586,7 @@
 ifnzman((noderef(Utilities))).
 )
 findex(zmv)
-item(tt(zmv) [ tt(-finqQsvwW) ] [ -C | -L | -M | -[pP] var(program) ] [ -o var(optstring) ] var(srcpat) var(dest) )(
+item(tt(zmv) [ tt(-finqQsvwW) ] [ -C | -L | -M | -p var(program) ] [ -o var(optstring) ] var(srcpat) var(dest) )(
 Move (usually, rename) files matching the pattern var(srcpat) to
 corresponding files having names of the form given by var(dest), where
 var(srcpat) contains parentheses surrounding patterns which will be
@@ -3697,13 +3631,7 @@
 tt(mv).  Whatever it does, it should at least understand the form
 ifzman(`var(program) tt(-)tt(-) var(oldname) var(newname)')\
 ifnzman(example(var(program) tt(-)tt(-) var(oldname) var(newname)))
-where var(oldname) and var(newname) are filenames generated by tt(zmv).
-var(program) will be split into words, so might be e.g. the name
-of an archive tool plus a copy or rename subcommand.)
-sitem(tt(-P) var(program))(As tt(-p) var(program), except that
-var(program) does not accept a following tt(-)tt(-) to indicate the
-end of options.  In this case filenames must already be in a sane
-form for the program in question.)
+where var(oldname) and var(newname) are filenames generated by tt(zmv).)
 sitem(tt(-o) var(optstring))(The var(optstring) is split into words and
 passed down verbatim to the tt(cp), tt(ln) or tt(mv) command called to
 perform the work.  It should probably begin with a `tt(-)'.)
diff -ruN zsh-5.0.4/Doc/Zsh/expn.yo zsh-5.0.2/Doc/Zsh/expn.yo
--- zsh-5.0.4/Doc/Zsh/expn.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/expn.yo	2012-10-25 01:50:52.000000000 -0700
@@ -57,7 +57,6 @@
 History expansion allows you to use words from previous command
 lines in the command line you are typing.  This simplifies spelling
 corrections and the repetition of complicated commands or arguments.
-
 vindex(HISTSIZE, use of)
 Immediately before execution, each command is saved in the history list,
 the size of which is controlled by the tt(HISTSIZE) parameter.  The one
@@ -749,8 +748,6 @@
 the length in characters of the result instead of
 the result itself.  If var(spec) is an array expression,
 substitute the number of elements of the result.
-This has the side-effect that joining is skipped even in quoted
-forms, which may affect other sub-expressions in var(spec).
 Note that `tt(^)', `tt(=)', and `tt(~)', below, must appear
 to the left of `tt(#)' when these forms are combined.
 )
@@ -873,12 +870,11 @@
 Create an array parameter with `tt(${)...tt(=)...tt(})',
 `tt(${)...tt(:=)...tt(})' or `tt(${)...tt(::=)...tt(})'.
 If this flag is repeated (as in `tt(AA)'), create an associative
-array parameter.  Assignment is made before sorting or padding;
-if field splitting is active, the var(word) part is split before
-assignment.  The var(name) part may be a subscripted range for
-ordinary arrays; the var(word) part em(must) be converted to
-an array, for example by using `tt(${(AA)=)var(name)tt(=)...tt(})'
-to activate field splitting, when creating an associative array.
+array parameter.  Assignment is made before sorting or padding.
+The var(name) part may be a subscripted range for ordinary
+arrays; the var(word) part em(must) be converted to an array, for
+example by using `tt(${(AA)=)var(name)tt(=)...tt(})' to activate
+field splitting, when creating an associative array.
 )
 item(tt(a))(
 Sort in array index order; when combined with `tt(O)' sort in reverse
@@ -888,9 +884,7 @@
 )
 item(tt(c))(
 With tt(${#)var(name)tt(}), count the total number of characters in an array,
-as if the elements were concatenated with spaces between them.  This is not
-a true join of the array, so other expressions used with this flag may have
-an effect on the elements of the array before it is counted.
+as if the elements were concatenated with spaces between them.
 )
 item(tt(C))(
 Capitalize the resulting words.  `Words' in this case refers to sequences
@@ -1314,8 +1308,7 @@
 subscript.  Thus if tt(var) is an array, tt(${var[1][2]}) is the second
 character of the first word, but tt(${var[2,4][2]}) is the entire third
 word (the second word of the range of words two through four of the
-original array).  Any number of subscripts may appear.  Flags such as
-tt((k)) and tt((v)) which alter the result of subscripting are applied.
+original array).  Any number of subscripts may appear.
 )
 item(tt(4.) em(Parameter name replacement))(
 The effect of any tt((P)) flag, which treats the value so far as a
@@ -1323,12 +1316,11 @@
 )
 item(tt(5.) em(Double-quoted joining))(
 If the value after this process is an array, and the substitution
-appears in double quotes, and neither an tt((@)) flag nor a tt(#)
-length operator is present at the current level, then words of the
-value are joined with the first character of the parameter tt($IFS),
-by default a space, between each word (single word arrays are not
-modified).  If the tt((j)) flag is present, that is used for joining
-instead of tt($IFS).
+appears in double quotes, and no tt((@)) flag is present at the current
+level, the words of the value are joined with the first character of the
+parameter tt($IFS), by default a space, between each word (single word
+arrays are not modified).  If the tt((j)) flag is present, that is used for
+joining instead of tt($IFS).
 )
 item(tt(6.) em(Nested subscripting))(
 Any remaining subscripts (i.e. of a nested substitution) are evaluated at
@@ -1708,14 +1700,14 @@
 It is also possible to define directory names using the tt(-d) option to the
 tt(hash) builtin.
 
-When the shell prints a path (e.g. when expanding tt(%~) in prompts or when
-printing the directory stack), the path is checked to see if it has a named
-directory as its prefix.  If so, then the prefix portion is replaced with a
-`tt(~)' followed by the name of the directory.
-The shorter of the two ways of referring to the directory is used,
-i.e. either the directory name or the full path; the name is used
-if they are the same length.
-The parameters tt($PWD) and tt($OLDPWD) are never abbreviated in this fashion.
+In certain circumstances (in prompts, for instance), when the shell
+prints a path, the path is checked to see if it has a named
+directory as its prefix.  If so, then the prefix portion
+is replaced with a `tt(~)' followed by the name of the directory.
+The shortest way of referring to the directory is used,
+with ties broken in favour of using a named directory,
+except when the directory is tt(/) itself.  The parameters tt($PWD) and
+tt($OLDPWD) are never abbreviated in this fashion.
 
 subsect(`=' expansion)
 
@@ -1957,12 +1949,10 @@
 Match the pattern in the parentheses.  (Like `tt(LPAR())...tt(RPAR())'.)
 )
 item(tt(*LPAR())...tt(RPAR()))(
-Match any number of occurrences.  (Like `tt(LPAR())...tt(RPAR()#)',
-except that recursive directory searching is not supported.)
+Match any number of occurrences.  (Like `tt(LPAR())...tt(RPAR()#)'.)
 )
 item(tt(PLUS()LPAR())...tt(RPAR()))(
-Match at least one occurrence.  (Like `tt(LPAR())...tt(RPAR()##)',
-except that recursive directory searching is not supported..)
+Match at least one occurrence.  (Like `tt(LPAR())...tt(RPAR()##)'.)
 )
 item(tt(?LPAR())...tt(RPAR()))(
 Match zero or one occurrence.  (Like `tt(LPAR()|)...tt(RPAR())'.)
diff -ruN zsh-5.0.4/Doc/Zsh/func.yo zsh-5.0.2/Doc/Zsh/func.yo
--- zsh-5.0.4/Doc/Zsh/func.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/func.yo	2011-07-31 11:27:42.000000000 -0700
@@ -264,16 +264,9 @@
 before it is executed.  The sole argument is the complete history
 line (so that any terminating newline will still be present).
 
-If any of the hook functions returns status 1 (or any non-zero value
-other than 2, though this is not guaranteed for future versions of the
-shell) the history line will not be saved, although it lingers in the
-history until the next line is executed, allowing you to reuse or edit
-it immediately.
-
-If any of the hook functions returns status 2 the history line
-will be saved on the internal history list, but not written to
-the history file.  In case of a conflict, the first non-zero status
-value is taken.
+If any of the hook functions return a non-zero value the history
+line will not be saved, although it lingers in the history until the
+next line is executed allow you to reuse or edit it immediately.
 
 A hook function may call `tt(fc -p) var(...)' to switch the history
 context so that the history is saved in a different file from the
@@ -281,13 +274,10 @@
 the history context is automatically restored after the processing
 of the history line is finished.
 
-The following example function works with one of the options
-tt(INC_APPEND_HISTORY) or tt(SHARE_HISTORY) set, in order that the line
-is written out immediately after the history entry is added.  It first
-adds the history line to the normal history with the newline stripped,
-which is usually the correct behaviour.  Then it switches the history
-context so that the line will be written to a history file in the
-current directory.
+The following example function first adds the history line to the normal
+history with the newline stripped,  which is usually the correct behaviour.
+Then it switches the history context so that the line will
+be written to a history file in the current directory.
 
 example(zshaddhistory+LPAR()RPAR() {
   print -sr -- ${1%%$'\n'}
diff -ruN zsh-5.0.4/Doc/Zsh/jobs.yo zsh-5.0.2/Doc/Zsh/jobs.yo
--- zsh-5.0.4/Doc/Zsh/jobs.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/jobs.yo	2012-02-22 11:31:07.000000000 -0800
@@ -115,18 +115,3 @@
 Otherwise, signals have the values
 inherited by the shell from its parent
 (but see the tt(TRAP)var(NAL) special functions in noderef(Functions)).
-
-cindex(exiting shell, and asynchronous jobs)
-cindex(asynchronous jobs, and exiting shell)
-cindex(jobs, asynchronous, and exiting shell)
-Certain jobs are run asynchronously by the shell other than those
-explicitly put into the background; even in cases where the shell
-would usually wait for such jobs, an explicit tt(exit) command
-or exit due to the option tt(ERR_EXIT) will cause the shell to
-exit without waiting.  Examples of such asynchronous jobs are
-process substitution, see
-ifzman(the section PROCESS SUBSTITUTION in the zmanref(zshexpn) manual page)\
-ifnzman(noderef(Process Substitution)), and the handler processes for
-multios, see
-ifzman(the section MULTIOS in the zmanref(zshmisc) manual page)\
-ifnzman(the section Multios in noderef(Redirection)).
diff -ruN zsh-5.0.4/Doc/Zsh/mod_curses.yo zsh-5.0.2/Doc/Zsh/mod_curses.yo
--- zsh-5.0.4/Doc/Zsh/mod_curses.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/mod_curses.yo	2008-07-23 14:58:38.000000000 -0700
@@ -84,11 +84,11 @@
 var(targetwin) into the array named var(array).
 These are, in order:
 startsitem()
-sitem(-)(The y and x coordinates of the cursor relative to the top left
+sitem()(The y and x coordinates of the cursor relative to the top left
 of var(targetwin))
-sitem(-)(The y and x coordinates of the top left of var(targetwin) on the
+sitem()(The y and x coordinates of the top left of var(targetwin) on the
 screen)
-sitem(-)(The size of var(targetwin) in y and x dimensions.)
+sitem()(The size of var(targetwin) in y and x dimensions.)
 endsitem()
 
 Outputting characters and strings are achieved by tt(char) and tt(string)
diff -ruN zsh-5.0.4/Doc/Zsh/mod_mapfile.yo zsh-5.0.2/Doc/Zsh/mod_mapfile.yo
--- zsh-5.0.4/Doc/Zsh/mod_mapfile.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/mod_mapfile.yo	2008-09-19 11:03:22.000000000 -0700
@@ -28,12 +28,9 @@
 
 A file may conveniently be read into an array as one line per element
 with the form
-`var(array)tt(=LPAR()"${(f@)mapfile[)var(filename)tt(]}"RPAR())'.
-The double quotes and the `tt(@)' are necessary to prevent empty lines
-from being removed.  Note that if the file ends with a newline,
-the shell will split on the final newline, generating an additional
-empty field; this can be suppressed by using
-`var(array)tt(=LPAR()"${(f@)${mapfile[)var(filename)tt(]%$'\n'}}"RPAR())'.
+`var(array)tt(=LPAR()"${(f)mapfile[)var(filename)tt(]}"RPAR())'.
+The double quotes are necessary to prevent empty lines from being
+removed.
 )
 enditem()
 
diff -ruN zsh-5.0.4/Doc/Zsh/mod_mathfunc.yo zsh-5.0.2/Doc/Zsh/mod_mathfunc.yo
--- zsh-5.0.4/Doc/Zsh/mod_mathfunc.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/mod_mathfunc.yo	2006-03-20 03:06:25.000000000 -0800
@@ -33,7 +33,7 @@
 The function tt(signgam) takes no arguments, and returns an integer, which
 is the C variable of the same name, as described in manref(gamma)(3).  Note
 that it is therefore only useful immediately after a call to tt(gamma) or
-tt(lgamma).  Note also that `tt(signgam+LPAR()RPAR())' and `tt(signgam)' are
+tt(lgamma).  Note also that `tt(signgam+LPAR()RPAR)' and `tt(signgam)' are
 distinct expressions.
 
 The following functions take two floating point arguments: tt(copysign),
diff -ruN zsh-5.0.4/Doc/Zsh/mod_parameter.yo zsh-5.0.2/Doc/Zsh/mod_parameter.yo
--- zsh-5.0.4/Doc/Zsh/mod_parameter.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/mod_parameter.yo	2011-01-19 12:42:13.000000000 -0800
@@ -57,14 +57,6 @@
 item(tt(dis_reswords))(
 Like tt(reswords) but for disabled reserved words.
 )
-vindex(patchars)
-item(tt(patchars))(
-This array contains the enabled pattern characters.
-)
-vindex(dis_patchars)
-item(tt(dis_patchars))(
-Like tt(patchars) but for disabled pattern characters.
-)
 vindex(aliases)
 item(tt(aliases))(
 This maps the names of the regular aliases currently enabled to their
diff -ruN zsh-5.0.4/Doc/Zsh/options.yo zsh-5.0.2/Doc/Zsh/options.yo
--- zsh-5.0.4/Doc/Zsh/options.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/options.yo	2012-11-09 14:43:01.000000000 -0800
@@ -485,17 +485,6 @@
 for filename generation, etc.  (An initial unquoted `tt(~)'
 always produces named directory expansion.)
 )
-pindex(FORCE_FLOAT)
-pindex(NO_FORCE_FLOAT)
-pindex(FORCEFLOAT)
-pindex(NOFORCEFLOAT)
-cindex(floating point, forcing use of)
-cindex(forcing use of floating point)
-item(tt(FORCE_FLOAT))(
-Constants in arithmetic evaluation will be treated as floating point
-even without the use of a decimal point.  Integers in any base
-will be converted.
-)
 pindex(GLOB)
 pindex(NO_GLOB)
 pindex(NOGLOB)
@@ -1240,7 +1229,6 @@
 cindex(exit status, printing)
 item(tt(PRINT_EXIT_VALUE) (tt(-1)))(
 Print the exit value of programs with non-zero exit status.
-This is only available at the command line in interactive shells.
 )
 pindex(RC_QUOTES)
 pindex(NO_RC_QUOTES)
@@ -1553,11 +1541,6 @@
 as it is by default, and the option tt(ERR_EXIT) is found to have been set
 on exit, then the command for which the tt(DEBUG) trap is being executed is
 skipped.  The option is restored after the trap exits.
-
-Exiting due to tt(ERR_EXIT) has certain interactions with asynchronous
-jobs noted in
-ifzman(the section JOBS in in zmanref(zshmisc))\
-ifnzman(noderef(Jobs & Signals)).
 )
 pindex(ERR_RETURN)
 pindex(NO_ERR_RETURN)
@@ -1623,19 +1606,6 @@
 with a formulation like `tt(emulate -L zsh)'; the tt(-L) activates
 tt(LOCAL_OPTIONS).
 )
-pindex(LOCAL_PATTERNS)
-pindex(NO_LOCAL_PATTERNS)
-pindex(LOCALPATTERNS)
-pindex(NOLOCALPATTERNS)
-item(tt(LOCAL_PATTERNS))(
-If this option is set at the point of return from a shell function,
-the state of pattern disables, as set with the builtin command
-`tt(disable -p)', is restored to what it was when the function was
-entered.  The behaviour of this option is similar to the effect
-of tt(LOCAL_OPTIONS) on options; hence `tt(emulate -L sh)' (or
-indeed any other emulation with the tt(-L) option) activates
-tt(LOCAL_PATTERNS).
-)
 pindex(LOCAL_TRAPS)
 pindex(NO_LOCAL_TRAPS)
 pindex(LOCALTRAPS)
@@ -1688,20 +1658,6 @@
 component in `tt(08#77)' are always interpreted as decimal, regardless
 of leading zeroes.
 )
-pindex(PIPE_FAIL)
-pindex(NO_PIPE_FAIL)
-pindex(PIPEFAIL)
-pindex(NOPIPEFAIL)
-cindex(exit status from pipeline)
-cindex(status, on exit from pipeline)
-cindex(pipeline, exit status from)
-item(tt(PIPE_FAIL))(
-By default, when a pipeline exits the exit status recorded by the shell
-and returned by the shell variable tt($?) reflects that of the
-rightmost element of a pipeline.  If this option is set, the exit status
-instead reflects the status of the rightmost element of the pipeline
-that was non-zero, or zero if all elements exited with zero status.
-)
 pindex(SOURCE_TRACE)
 pindex(NO_SOURCE_TRACE)
 pindex(SOURCETRACE)
diff -ruN zsh-5.0.4/Doc/Zsh/params.yo zsh-5.0.2/Doc/Zsh/params.yo
--- zsh-5.0.4/Doc/Zsh/params.yo	2013-12-19 11:35:10.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/params.yo	2012-10-02 11:44:40.000000000 -0700
@@ -431,15 +431,9 @@
 noderef(Invocation), and also noderef(Functions).
 The parameter var(n), where var(n) is a number,
 is the var(n)th positional parameter.
-The parameter `tt($0)' is a special case, see
-noderef(Parameters Set By The Shell).
-
 The parameters tt(*), tt(@) and tt(argv) are
 arrays containing all the positional parameters;
 thus `tt($argv[)var(n)tt(])', etc., is equivalent to simply `tt($)var(n)'.
-Note that the options tt(KSH_ARRAYS) or tt(KSH_ZERO_SUBSCRIPT) apply
-to these arrays as well, so with either of those options set,
-`tt(${argv[0]})' is equivalent to `tt($1)' and so on.
 
 Positional parameters may be changed after the shell or function starts by
 using the tt(set) builtin, by assigning to the tt(argv) array, or by direct
@@ -973,16 +967,6 @@
 The file to save the history in when an interactive shell exits.
 If unset, the history is not saved.
 )
-vindex(HISTORY_IGNORE)
-item(tt(HISTORY_IGNORE))(
-If set, is treated as a pattern at the time history files are written.
-Any potential history entry that matches the pattern is skipped.  For
-example, if the value is `tt(fc *)' then commands that invoke the
-interactive history editor are never written to the history file (compare
-the tt(HIST_NO_STORE) option or the tt(zshaddhistory) hook, either of
-which would prevent such commands from being added to the interactive
-history at all).
-)
 vindex(HISTSIZE)
 item(tt(HISTSIZE) <S>)(
 The maximum number of events stored in the internal history list.
@@ -1231,7 +1215,7 @@
 vindex(psvar)
 vindex(PSVAR)
 item(tt(psvar) <S> <Z> (tt(PSVAR) <S>))(
-An array (colon-separated list) whose elements can be used in
+An array (colon-separated list) whose first nine values can be used in
 tt(PROMPT) strings.  Setting tt(psvar) also sets tt(PSVAR), and
 vice versa.
 )
@@ -1547,17 +1531,4 @@
 ifzman(zmanref(zshcompsys))\
 ifnzman(noderef(Completion System)).
 )
-vindex(ZLE_RPROMPT_INDENT)
-item(tt(ZLE_RPROMPT_INDENT <S>))(
-If set, used to give the indentation between the right hand side of
-the right prompt in the line editor as given by tt(RPS1) or tt(RPROMPT)
-and the right hand side of the screen.  If not set, the value 1 is used.
-
-Typically this will be used to set the value to 0 so that the prompt
-appears flush with the right hand side of the screen.  This is not the
-default as many terminals do not handle this correctly, in particular
-when the prompt appears at the extreme bottom right of the screen.
-Recent virtual terminals are more likely to handle this case correctly.
-Some experimentation is necessary.
-)
 enditem()
diff -ruN zsh-5.0.4/Doc/Zsh/prompt.yo zsh-5.0.2/Doc/Zsh/prompt.yo
--- zsh-5.0.4/Doc/Zsh/prompt.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/prompt.yo	2010-12-06 11:31:02.000000000 -0800
@@ -100,13 +100,10 @@
 specifies leading components, i.e. tt(%-1d) specifies the first component.
 )
 item(tt(%~))(
-As tt(%d) and tt(%/), but if the current working directory starts with
-tt($HOME), that part is replaced by a `tt(~)'. Furthermore, if it has a named
+As tt(%d) and tt(%/), but if the current working directory has a named
 directory as its prefix, that part is replaced by a `tt(~)' followed by
-the name of the directory, but only if the result is shorter than
-the full path; 
-ifzman(see em(Dynamic) and em(Static named directories) in zmanref(zshexpn))\
-ifnzman(noderef(Filename Expansion)).
+the name of the directory.  If it starts with tt($HOME), that part is
+replaced by a `tt(~)'.
 )
 xitem(tt(%h))
 item(tt(%!))(
diff -ruN zsh-5.0.4/Doc/Zsh/zle.yo zsh-5.0.2/Doc/Zsh/zle.yo
--- zsh-5.0.4/Doc/Zsh/zle.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/Zsh/zle.yo	2012-05-03 13:12:16.000000000 -0700
@@ -308,7 +308,6 @@
 cindex(editing parameters)
 xitem(tt(vared) [ tt(-Aache) ] [ tt(-p) var(prompt) ] [ tt(-r) var(rprompt) ])
 xitem(  [ tt(-M) var(main-keymap) ] [ tt(-m) var(vicmd-keymap) ])
-xitem(  [ tt(-i) var(init-widget) ] [ tt(-f) var(finish-widget) ])
 item(  [ tt(-t) var(tty) ] var(name))(
 The value of the parameter var(name) is loaded into the edit
 buffer, and the line editor is invoked.  When the editor exits,
@@ -344,10 +343,6 @@
 is normally needed but the tt(-m) option may still be used.  On exit, the
 previous keymaps will be restored.
 
-tt(Vared) calls the usual `tt(zle-line-init)' and `tt(zle-line-finish)'
-hooks before and after it takes control. Using the tt(-i) and tt(-f)
-options, it is possible to replace these with other custom widgets.
-
 If `tt(-t) var(tty)' is given, var(tty) is the name of a terminal device
 to be used instead of the default tt(/dev/tty).  If var(tty) does not
 refer to a terminal an error is reported.
@@ -373,7 +368,7 @@
 xitem(tt(zle) tt(-M) var(string))
 xitem(tt(zle) tt(-U) var(string))
 xitem(tt(zle) tt(-K) var(keymap))
-xitem(tt(zle) tt(-F) [ tt(-L) | tt(-w) ] [ var(fd) [ var(handler) ] ])
+xitem(tt(zle) tt(-F) [ tt(-L) ] [ var(fd) [ var(handler) ] ])
 xitem(tt(zle) tt(-I))
 xitem(tt(zle) tt(-T) [ tt(tc) var(function) | tt(-r) tt(tc) | tt(-L) ] )
 item(tt(zle) var(widget) tt([ -n) var(num) tt(]) tt([ -Nw ] [ -K) var(keymap) tt(]) var(args) ...)(
@@ -487,7 +482,7 @@
 within this invocation of ZLE.  Any following invocation (e.g., the next
 command line) will start as usual with the `tt(main)' keymap selected.
 )
-item(tt(-F) [ tt(-L) | tt(-w) ] [ var(fd) [ var(handler) ] ])(
+item(tt(-F) [ tt(-L) ] [ var(fd) [ var(handler) ] ])(
 Only available if your system supports one of the `poll' or `select' system
 calls; most modern systems do.
 
@@ -502,13 +497,6 @@
 readable when installing the handler.  The user must make their own
 arrangements for handling the file descriptor when zle is not active.
 
-If the option tt(-w) is also given, the var(handler) is instead a
-line editor widget, typically a shell function made into a widget using
-tt(zle -N).  In that case var(handler) can use all the facilities of
-zle to update the current editing line.  Note, however, that as handling
-var(fd) takes place at a low level changes to the display will not
-automatically appear; the widget should call tt(zle -R) to force redisplay.
-
 Any number of handlers for any number of readable file descriptors may be
 installed.  Installing a handler for an var(fd) which is already handled
 causes the existing handler to be replaced.
diff -ruN zsh-5.0.4/Doc/help/.cvsignore zsh-5.0.2/Doc/help/.cvsignore
--- zsh-5.0.4/Doc/help/.cvsignore	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/help/.cvsignore	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-[_a-zA-Z0-9]*
diff -ruN zsh-5.0.4/Doc/help/.distfiles zsh-5.0.2/Doc/help/.distfiles
--- zsh-5.0.4/Doc/help/.distfiles	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/help/.distfiles	1969-12-31 16:00:00.000000000 -0800
@@ -1,5 +0,0 @@
-DISTFILES_SRC='
-    .cvsignore
-    .distfiles
-    [_a-zA-Z0-9]*
-'
diff -ruN zsh-5.0.4/Doc/help/alias zsh-5.0.2/Doc/help/alias
--- zsh-5.0.4/Doc/help/alias	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/alias	1969-12-31 16:00:00.000000000 -0800
@@ -1,42 +0,0 @@
-alias [ {+|-}gmrsL ] [ name[=value] ... ]
-       For each name with a corresponding value, define an  alias  with
-       that  value.   A trailing space in value causes the next word to
-       be checked for alias expansion.  If  the  -g  flag  is  present,
-       define  a global alias; global aliases are expanded even if they
-       do not occur in command position.
-
-       If the -s flag is present, define a suffix alias: if the command
-       word on a command line is in the form `text.name', where text is
-       any  non-empty  string,  it  is  replaced  by  the  text  `value
-       text.name'.   Note that name is treated as a literal string, not
-       a pattern.  A trailing space in value is  not  special  in  this
-       case.  For example,
-
-              alias -s ps=gv
-
-       will  cause  the command `*.ps' to be expanded to `gv *.ps'.  As
-       alias expansion is carried out earlier than globbing, the `*.ps'
-       will  then  be  expanded.  Suffix aliases constitute a different
-       name space from other aliases (so in the  above  example  it  is
-       still  possible  to  create an alias for the command ps) and the
-       two sets are never listed together.
-
-       For each name with no value, print the value of  name,  if  any.
-       With  no  arguments,  print  all currently defined aliases other
-       than suffix aliases.  If the -m flag is given the arguments  are
-       taken  as  patterns (they should be quoted to preserve them from
-       being interpreted as glob patterns), and  the  aliases  matching
-       these  patterns  are  printed.  When printing aliases and one of
-       the -g, -r or -s flags is  present,  restrict  the  printing  to
-       global, regular or suffix aliases, respectively; a regular alias
-       is one which is neither a global nor a suffix alias.   Using `+'
-       instead  of  `-',  or  ending the option list with a single `+',
-       prevents the values of the aliases from being printed.
-
-       If the -L flag is present, then print each  alias  in  a  manner
-       suitable  for  putting  in a startup script.  The exit status is
-       nonzero if a name (with no value) is given for  which  no  alias
-       has been defined.
-
-       For  more  on  aliases, include common problems, see the section
-       ALIASING in zshmisc(1).
diff -ruN zsh-5.0.4/Doc/help/bg zsh-5.0.2/Doc/help/bg
--- zsh-5.0.4/Doc/help/bg	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/bg	1969-12-31 16:00:00.000000000 -0800
@@ -1,4 +0,0 @@
-bg [ job ... ]
-job ... &
-       Put each specified job in the background, or the current job  if
-       none is specified.
diff -ruN zsh-5.0.4/Doc/help/bindkey zsh-5.0.2/Doc/help/bindkey
--- zsh-5.0.4/Doc/help/bindkey	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/bindkey	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-bindkey
-       See the section `Zle Builtins' in zshzle(1).
diff -ruN zsh-5.0.4/Doc/help/break zsh-5.0.2/Doc/help/break
--- zsh-5.0.4/Doc/help/break	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/break	1969-12-31 16:00:00.000000000 -0800
@@ -1,3 +0,0 @@
-break [ n ]
-       Exit from an enclosing for, while, until, select or repeat loop.
-       If n is specified, then break n levels instead of just one.
diff -ruN zsh-5.0.4/Doc/help/builtin zsh-5.0.2/Doc/help/builtin
--- zsh-5.0.4/Doc/help/builtin	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/builtin	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-builtin name [ args ... ]
-       Executes the builtin name, with the given args.
diff -ruN zsh-5.0.4/Doc/help/cap zsh-5.0.2/Doc/help/cap
--- zsh-5.0.4/Doc/help/cap	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/cap	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-cap    See the section `The zsh/cap Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/cd zsh-5.0.2/Doc/help/cd
--- zsh-5.0.4/Doc/help/cd	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/cd	1969-12-31 16:00:00.000000000 -0800
@@ -1,58 +0,0 @@
-cd [ -qsLP ] [ arg ]
-cd [ -qsLP ] old new
-cd [ -qsLP ] {+|-}n
-       Change the current directory.  In the  first  form,  change  the
-       current directory to arg, or to the value of $HOME if arg is not
-       specified.  If arg is `-', change to the previous directory.
-
-       Otherwise, if arg begins with a slash, attempt to change to  the
-       directory given by arg.
-
-       If  arg  does  not  begin with a slash, the behaviour depends on
-       whether the current directory `.' occurs in the list of directo-
-       ries  contained  in the shell parameter cdpath.  If it does not,
-       first attempt to change to the directory arg under  the  current
-       directory,  and  if that fails but cdpath is set and contains at
-       least one element attempt to change to the directory  arg  under
-       each  component  of  cdpath  in  turn  until successful.  If `.'
-       occurs in cdpath, then cdpath is searched strictly in  order  so
-       that `.' is only tried at the appropriate point.
-
-       The  order  of testing cdpath is modified if the option POSIX CD
-                                                                    -
-       is set, as described in the documentation for the option.
-
-       If no directory is found, the option CDABLE VARS is set,  and  a
-                                                  -
-       parameter  named  arg  exists  whose  value begins with a slash,
-       treat its value as the directory.  In that case,  the  parameter
-       is added to the named directory hash table.
-
-       The  second form of cd substitutes the string new for the string
-       old in the name of the current directory, and tries to change to
-       this new directory.
-
-       The third form of cd extracts an entry from the directory stack,
-       and changes to that directory.  An argument  of  the  form  `+n'
-       identifies  a  stack entry by counting from the left of the list
-       shown by the dirs command, starting with zero.  An  argument  of
-       the  form `-n' counts from the right.  If the PUSHD MINUS option
-                                                          -
-       is set, the meanings of `+' and `-' in this context are swapped.
-
-       If the -q (quiet) option is specified, the hook  function  chpwd
-       and  the  functions in the array chpwd functions are not called.
-                                             -
-       This is useful for calls to cd that do not change  the  environ-
-       ment seen by an interactive user.
-
-       If  the -s option is specified, cd refuses to change the current
-       directory if the given pathname contains symlinks.   If  the  -P
-       option is given or the CHASE LINKS option is set, symbolic links
-                                   -
-       are resolved to their true values.  If the -L  option  is  given
-       symbolic  links are retained in the directory (and not resolved)
-       regardless of the state of the CHASE LINKS option.
-                                           -
-
-chdir  Same as cd.
diff -ruN zsh-5.0.4/Doc/help/clone zsh-5.0.2/Doc/help/clone
--- zsh-5.0.4/Doc/help/clone	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/clone	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-clone  See the section `The zsh/clone Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/colon zsh-5.0.2/Doc/help/colon
--- zsh-5.0.4/Doc/help/colon	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/colon	1969-12-31 16:00:00.000000000 -0800
@@ -1,4 +0,0 @@
-: [ arg ... ]
-       This command does nothing, although normal  argument  expansions
-       is performed which may have effects on shell parameters.  A zero
-       exit status is returned.
diff -ruN zsh-5.0.4/Doc/help/command zsh-5.0.2/Doc/help/command
--- zsh-5.0.4/Doc/help/command	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/command	1969-12-31 16:00:00.000000000 -0800
@@ -1,11 +0,0 @@
-command [ -pvV ] simple command
-       The simple command argument is  taken  as  an  external  command
-       instead  of  a  function  or  builtin  and  is  executed. If the
-       POSIX BUILTINS option is set, builtins will also be executed but
-            -
-       certain  special  properties of them are suppressed. The -p flag
-       causes a default path to be searched instead of that  in  $path.
-       With  the  -v flag, command is similar to whence and with -V, it
-       is equivalent to whence -v.
-
-       See also the section `Precommand Modifiers'.
diff -ruN zsh-5.0.4/Doc/help/comparguments zsh-5.0.2/Doc/help/comparguments
--- zsh-5.0.4/Doc/help/comparguments	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/comparguments	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-comparguments
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/compcall zsh-5.0.2/Doc/help/compcall
--- zsh-5.0.4/Doc/help/compcall	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/compcall	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-compcall
-       See the section `The zsh/compctl Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/compctl zsh-5.0.2/Doc/help/compctl
--- zsh-5.0.4/Doc/help/compctl	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/compctl	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-compctl
-       See the section `The zsh/compctl Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/compdescribe zsh-5.0.2/Doc/help/compdescribe
--- zsh-5.0.4/Doc/help/compdescribe	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/compdescribe	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-compdescribe
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/compfiles zsh-5.0.2/Doc/help/compfiles
--- zsh-5.0.4/Doc/help/compfiles	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/compfiles	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-compfiles
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/compgroups zsh-5.0.2/Doc/help/compgroups
--- zsh-5.0.4/Doc/help/compgroups	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/compgroups	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-compgroups
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/compquote zsh-5.0.2/Doc/help/compquote
--- zsh-5.0.4/Doc/help/compquote	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/compquote	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-compquote
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/comptags zsh-5.0.2/Doc/help/comptags
--- zsh-5.0.4/Doc/help/comptags	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/comptags	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-comptags
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/comptry zsh-5.0.2/Doc/help/comptry
--- zsh-5.0.4/Doc/help/comptry	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/comptry	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-comptry
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/compvalues zsh-5.0.2/Doc/help/compvalues
--- zsh-5.0.4/Doc/help/compvalues	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/compvalues	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-compvalues
-       See the section `The zsh/computil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/continue zsh-5.0.2/Doc/help/continue
--- zsh-5.0.4/Doc/help/continue	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/continue	1969-12-31 16:00:00.000000000 -0800
@@ -1,4 +0,0 @@
-continue [ n ]
-       Resume the next iteration of the enclosing  for,  while,  until,
-       select  or  repeat  loop.   If  n is specified, break out of n-1
-       loops and resume at the nth enclosing loop.
diff -ruN zsh-5.0.4/Doc/help/dirs zsh-5.0.2/Doc/help/dirs
--- zsh-5.0.4/Doc/help/dirs	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/dirs	1969-12-31 16:00:00.000000000 -0800
@@ -1,17 +0,0 @@
-dirs [ -c ] [ arg ... ]
-dirs [ -lpv ]
-       With no arguments, print the contents of  the  directory  stack.
-       Directories  are added to this stack with the pushd command, and
-       removed with the cd or popd commands.  If arguments  are  speci-
-       fied,  load  them  onto  the directory stack, replacing anything
-       that was there, and push the current directory onto the stack.
-
-       -c     clear the directory stack.
-
-       -l     print directory names in full instead of using of using ~
-              expressions  (see Dynamic and Static named directories in
-              zshexpn(1)).
-
-       -p     print directory entries one per line.
-
-       -v     number the directories in the stack when printing.
diff -ruN zsh-5.0.4/Doc/help/disable zsh-5.0.2/Doc/help/disable
--- zsh-5.0.4/Doc/help/disable	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/disable	1969-12-31 16:00:00.000000000 -0800
@@ -1,103 +0,0 @@
-disable [ -afmprs ] name ...
-       Temporarily disable the named hash table elements  or  patterns.
-       The  default is to disable builtin commands.  This allows you to
-       use an external command with the same name as a builtin command.
-       The  -a  option  causes  disable  to  act  on  regular or global
-       aliases.  The -s option causes disable to act on suffix aliases.
-       The  -f option causes disable to act on shell functions.  The -r
-       options causes disable to act on reserved words.  Without  argu-
-       ments  all  disabled  hash table elements from the corresponding
-       hash table are printed.  With the  -m  flag  the  arguments  are
-       taken  as  patterns (which should be quoted to prevent them from
-       undergoing filename expansion), and all hash table elements from
-       the  corresponding  hash  table matching these patterns are dis-
-       abled.  Disabled objects can be enabled with the enable command.
-
-       With the option -p, name ... refer to elements  of  the  shell's
-       pattern  syntax  as  described  in the section `Filename Genera-
-       tion'.  Certain elements can be disabled  separately,  as  given
-       below.
-
-       Note  that  patterns not allowed by the current settings for the
-       options EXTENDED GLOB, KSH GLOB and SH GLOB are  never  enabled,
-                       -         -           -
-       regardless  of  the setting here.  For example, if EXTENDED GLOB
-                                                                  -
-       is not active, the pattern ^ is ineffective even if `disable  -p
-       "^"'  has  not been issued.  The list below indicates any option
-       settings that restrict the use of the  pattern.   It  should  be
-       noted  that  setting SH GLOB has a wider effect then merely dis-
-                              -
-       abling patterns as  certain  expressions,  in  particular  those
-       involving parentheses, are parsed differently.
-
-       The  following  patterns  may  be disabled; all the strings need
-       quoting on the command line to prevent them  from  being  inter-
-       preted  immediately as patterns and the patterns are shown below
-       in single quotes as a reminder.
-       '?'    The pattern character ?  wherever  it  occurs,  including
-              when preceding a parenthesis with KSH GLOB.
-                                                   -
-
-       '*'    The  pattern  character  *  wherever it occurs, including
-              recursive globbing and when preceding a parenthesis  with
-              KSH GLOB.
-                 -
-
-       '['    Character classes.
-
-       '<' (NO SH GLOB)
-              -  -
-              Numeric ranges.
-
-       '|' (NO SH GLOB)
-              -  -
-              Alternation  in  grouped  patterns,  case  statements, or
-              KSH GLOB parenthesised expressions.
-                 -
-
-       '(' (NO SH GLOB)
-              -  -
-              Grouping using single parentheses.  Disabling  this  does
-              not  disable  the  use  of parentheses for KSH GLOB where
-                                                            -
-              they are introduced by a special character, nor for  glob
-              qualifiers  (use  `setopt  NO BARE GLOB QUAL'  to disable
-                                           -    -    -
-              glob qualifiers that use parentheses only).
-
-       '~' (EXTENDED GLOB)
-                    -
-              Exclusion in the form A~B.
-
-       '^' (EXTENDED GLOB)
-                    -
-              Exclusion in the form A^B.
-
-       '#' (EXTENDED GLOB)
-                    -
-              The pattern character # wherever it occurs, both for rep-
-              etition of a previous pattern and for indicating globbing
-              flags.
-
-       '?(' (KSH GLOB)
-                -
-              The grouping form ?(...).  Note this is also disabled  if
-              '?' is disabled.
-
-       '*(' (KSH GLOB)
-                -
-              The  grouping form *(...).  Note this is also disabled if
-              '*' is disabled.
-
-       '+(' (KSH GLOB)
-                -
-              The grouping form +(...).
-
-       '!(' (KSH GLOB)
-                -
-              The grouping form !(...).
-
-       '@(' (KSH GLOB)
-                -
-              The grouping form @(...).
diff -ruN zsh-5.0.4/Doc/help/disown zsh-5.0.2/Doc/help/disown
--- zsh-5.0.4/Doc/help/disown	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/disown	1969-12-31 16:00:00.000000000 -0800
@@ -1,16 +0,0 @@
-disown [ job ... ]
-job ... &|
-job ... &!
-       Remove the specified jobs from the job table; the shell will  no
-       longer  report their status, and will not complain if you try to
-       exit an interactive shell with them running or stopped.   If  no
-       job is specified, disown the current job.
-
-       If  the  jobs are currently stopped and the AUTO CONTINUE option
-                                                       -
-       is not set, a warning is printed  containing  information  about
-       how  to make them running after they have been disowned.  If one
-       of the latter two forms is used, the jobs will automatically  be
-       made  running,  independent  of the setting of the AUTO CONTINUE
-                                                              -
-       option.
diff -ruN zsh-5.0.4/Doc/help/dot zsh-5.0.2/Doc/help/dot
--- zsh-5.0.4/Doc/help/dot	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/dot	1969-12-31 16:00:00.000000000 -0800
@@ -1,19 +0,0 @@
-. file [ arg ... ]
-       Read commands from file and execute them in  the  current  shell
-       environment.
-
-       If  file  does  not contain a slash, or if PATH DIRS is set, the
-                                                      -
-       shell looks in the components of $path  to  find  the  directory
-       containing  file.   Files  in the current directory are not read
-       unless  `.'  appears  somewhere  in  $path.   If  a  file  named
-       `file.zwc'  is  found,  is  newer than file, and is the compiled
-       form (created with the zcompile builtin) of file, then  commands
-       are read from that file instead of file.
-
-       If  any  arguments  arg  are  given,  they become the positional
-       parameters; the old positional parameters are restored when  the
-       file is done executing.  If file was not found the return status
-       is 127; if file was found  but  contained  a  syntax  error  the
-       return  status is 126; else the return status is the exit status
-       of the last command executed.
diff -ruN zsh-5.0.4/Doc/help/echo zsh-5.0.2/Doc/help/echo
--- zsh-5.0.4/Doc/help/echo	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/echo	1969-12-31 16:00:00.000000000 -0800
@@ -1,25 +0,0 @@
-echo [ -neE ] [ arg ... ]
-       Write each arg on the standard output, with a  space  separating
-       each one.  If the -n flag is not present, print a newline at the
-       end.  echo recognizes the following escape sequences:
-
-       \a     bell character
-       \b     backspace
-       \c     suppress final newline
-       \e     escape
-       \f     form feed
-       \n     linefeed (newline)
-       \r     carriage return
-       \t     horizontal tab
-       \v     vertical tab
-       \\     backslash
-       \0NNN  character code in octal
-       \xNN   character code in hexadecimal
-       \uNNNN unicode character code in hexadecimal
-       \UNNNNNNNN
-              unicode character code in hexadecimal
-
-       The -E flag, or the BSD ECHO option,  can  be  used  to  disable
-                              -
-       these escape sequences.  In the latter case, -e flag can be used
-       to enable them.
diff -ruN zsh-5.0.4/Doc/help/echotc zsh-5.0.2/Doc/help/echotc
--- zsh-5.0.4/Doc/help/echotc	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/echotc	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-echotc See the section `The zsh/termcap Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/echoti zsh-5.0.2/Doc/help/echoti
--- zsh-5.0.4/Doc/help/echoti	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/echoti	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-echoti See the section `The zsh/terminfo Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/emulate zsh-5.0.2/Doc/help/emulate
--- zsh-5.0.4/Doc/help/emulate	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/emulate	1969-12-31 16:00:00.000000000 -0800
@@ -1,104 +0,0 @@
-emulate [ -LR ] [ {zsh|sh|ksh|csh} [ flags ... ] ]
-       Without any argument print current emulation mode.
-
-       With single argument set up zsh options to emulate the specified
-       shell  as  much  as possible.  csh will never be fully emulated.
-       If the argument is not one of the shells listed above, zsh  will
-       be used as a default; more precisely, the tests performed on the
-       argument are the same as those used to determine  the  emulation
-       at  startup based on the shell name, see the section COMPATIBIL-
-       ITY in zsh(1) .  In addition to setting shell options, the  com-
-       mand  also restores the pristine state of pattern enables, as if
-       all patterns had been enabled using enable -p.
-
-       If the emulate command occurs inside a function  that  has  been
-       marked  for  execution tracing with functions -t then the xtrace
-       option will be turned on regardless of emulation mode  or  other
-       options.   Note that code executed inside the function by the .,
-       source, or  eval  commands  is  not  considered  to  be  running
-       directly  from  the function, hence does not provoke this behav-
-       iour.
-
-       If the -R switch is given, all settable  options  are  reset  to
-       their  default  value  corresponding  to the specified emulation
-       mode, except for  certain  options  describing  the  interactive
-       environment;  otherwise,  only  those  options  likely  to cause
-       portability problems in scripts and functions are  altered.   If
-       the  -L  switch  is given, the options LOCAL OPTIONS, LOCAL PAT-
-                                                   -              -
-       TERNS and LOCAL TRAPS will be set as well, causing  the  effects
-                      -
-       of  the emulate command and any setopt, disable -p or enable -p,
-       and trap commands to be local  to  the  immediately  surrounding
-       shell function, if any; normally these options are turned off in
-       all emulation modes except ksh. The -L switch is mutually exclu-
-       sive with the use of -c in flags.
-
-       The  flags  may be any of the invocation-time flags described in
-       the section INVOCATION in zsh(1), except that `-o EMACS' and `-o
-       VI'  may not be used.  Flags such as `+r'/`+o RESTRICTED' may be
-       prohibited in some circumstances.
-
-       If -c arg appears in flags, arg is evaluated while the requested
-       emulation  is temporarily in effect.  In this case the emulation
-       mode and all options  are  restored  to  their  previous  values
-       before  emulate  returns.  The -R switch may precede the name of
-       the shell to emulate; note this  has  a  meaning  distinct  from
-       including -R in flags.
-
-       Use  of -c enables `sticky' emulation mode for functions defined
-       within the evaluated expression:  the emulation mode is  associ-
-       ated  thereafter with the function so that whenever the function
-       is executed the emulation (respecting the -R switch, if present)
-       and  all  options  are set (and pattern disables cleared) before
-       entry to the function, and the state is restored after exit.  If
-       the  function  is called when the sticky emulation is already in
-       effect, either within an `emulate shell -c' expression or within
-       another  function with the same sticky emulation, entry and exit
-       from the function do not cause options to be altered (except due
-       to  standard processing such as the LOCAL OPTIONS option).  This
-                                                -
-       also applies to functions marked for autoload within the  sticky
-       emulation; the appropriate set of options will be applied at the
-       point the function is loaded as well as when it is run.
-
-       For example:
-
-              emulate sh -c 'fni() { setopt cshnullglob; }
-              fno() { fni; }'
-              fno
-
-       The two functions fni and fno are defined with sticky sh  emula-
-       tion.   fno  is  then  executed, causing options associated with
-       emulations to be set to their values in sh.  fni then calls fno;
-       because  fno  is  also marked for sticky sh emulation, no option
-       changes take place on entry to  or  exit  from  it.   Hence  the
-       option  cshnullglob,  turned off by sh emulation, will be turned
-       on within fni and remain on on return to fno.  On exit from fno,
-       the emulation mode and all options will be restored to the state
-       they were in before entry to the temporary emulation.
-
-       The documentation above is typically sufficient for the intended
-       purpose  of  executing code designed for other shells in a suit-
-       able environment.  More detailed rules follow.
-       1.     The sticky emulation  environment  provided  by  `emulate
-              shell  -c'  is  identical  to that provided by entry to a
-              function marked for sticky emulation as a consequence  of
-              being  defined  in such an environment.  Hence, for exam-
-              ple, the sticky emulation is  inherited  by  subfunctions
-              defined within functions with sticky emulation.
-       2.     No change of options takes place on entry to or exit from
-              functions that are not marked for sticky emulation, other
-              than  those that would normally take place, even if those
-              functions are called within sticky emulation.
-       3.     No special handling is provided for functions marked  for
-              autoload nor for functions present in wordcode created by
-              the zcompile command.
-       4.     The presence or absence of the -R switch to emulate  cor-
-              responds  to  different  sticky  emulation  modes, so for
-              example `emulate sh -c', `emulate -R sh -c' and  `emulate
-              csh -c' are treated as three distinct sticky emulations.
-       5.     Difference  in  shell options supplied in addition to the
-              basic emulation also mean the sticky emulations are  dif-
-              ferent,  so for example `emulate zsh -c' and `emulate zsh
-              -o cbases -c' are treated as distinct sticky emulations.
diff -ruN zsh-5.0.4/Doc/help/enable zsh-5.0.2/Doc/help/enable
--- zsh-5.0.4/Doc/help/enable	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/enable	1969-12-31 16:00:00.000000000 -0800
@@ -1,22 +0,0 @@
-enable [ -afmprs ] name ...
-       Enable the named hash table elements, presumably  disabled  ear-
-       lier  with  disable.  The default is to enable builtin commands.
-       The -a option causes enable to act on regular or global aliases.
-       The  -s  option  causes enable to act on suffix aliases.  The -f
-       option causes enable to act on shell functions.  The  -r  option
-       causes  enable  to act on reserved words.  Without arguments all
-       enabled hash table elements from the  corresponding  hash  table
-       are  printed.   With the -m flag the arguments are taken as pat-
-       terns (should be quoted) and all hash table  elements  from  the
-       corresponding  hash  table  matching these patterns are enabled.
-       Enabled objects can be disabled with the  disable  builtin  com-
-       mand.
-
-       enable  -p  reenables  patterns  disabled with disable -p.  Note
-       that it does not override globbing options; for example, `enable
-       -p  "~"'  does  not  cause  the pattern character ~ to be active
-       unless the EXTENDED GLOB option is also set.  To enable all pos-
-                          -
-       sible  patterns  (so  that  they may be invidually disabled with
-       disable -p), use `setopt EXTENDED GLOB KSH GLOB NO SH GLOB'.
-                                        -        -       -  -
diff -ruN zsh-5.0.4/Doc/help/eval zsh-5.0.2/Doc/help/eval
--- zsh-5.0.4/Doc/help/eval	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/eval	1969-12-31 16:00:00.000000000 -0800
@@ -1,6 +0,0 @@
-eval [ arg ... ]
-       Read the arguments as input to the shell and execute the result-
-       ing  command(s) in the current shell process.  The return status
-       is the same as if the commands had been executed directly by the
-       shell;  if  there  are no args or they contain no commands (i.e.
-       are an empty string or whitespace) the return status is zero.
diff -ruN zsh-5.0.4/Doc/help/exec zsh-5.0.2/Doc/help/exec
--- zsh-5.0.4/Doc/help/exec	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/exec	1969-12-31 16:00:00.000000000 -0800
@@ -1,6 +0,0 @@
-exec [ -cl ] [ -a argv0 ] simple command
-       Replace the current shell with an external command  rather  than
-       forking.   With  -c  clear the environment; with -l prepend - to
-       the argv[0] string of the command executed (to simulate a  login
-       shell); with -a argv0 set the argv[0] string of the command exe-
-       cuted.  See the section `Precommand Modifiers'.
diff -ruN zsh-5.0.4/Doc/help/exit zsh-5.0.2/Doc/help/exit
--- zsh-5.0.4/Doc/help/exit	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/exit	1969-12-31 16:00:00.000000000 -0800
@@ -1,15 +0,0 @@
-exit [ n ]
-       Exit the shell with the exit status specified by n; if  none  is
-       specified,  use  the exit status from the last command executed.
-       An EOF condition will also cause the shell to exit,  unless  the
-       IGNORE EOF option is set.
-             -
-
-       See  notes  at  the end of the section JOBS in in zshmisc(1) for
-       some possibly unexpected interactions of the exit  command  with
-       jobs.
-
-bye    Same as exit.
-
-logout [ n ]
-       Same as exit, except that it only works in a login shell.
diff -ruN zsh-5.0.4/Doc/help/export zsh-5.0.2/Doc/help/export
--- zsh-5.0.4/Doc/help/export	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/export	1969-12-31 16:00:00.000000000 -0800
@@ -1,5 +0,0 @@
-export [ name[=value] ... ]
-       The specified names are marked for automatic export to the envi-
-       ronment of subsequently executed commands.  Equivalent to  type-
-       set -gx.  If a parameter specified does not already exist, it is
-       created in the global scope.
diff -ruN zsh-5.0.4/Doc/help/false zsh-5.0.2/Doc/help/false
--- zsh-5.0.4/Doc/help/false	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/false	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-false [ arg ... ]
-       Do nothing and return an exit status of 1.
diff -ruN zsh-5.0.4/Doc/help/fc zsh-5.0.2/Doc/help/fc
--- zsh-5.0.4/Doc/help/fc	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/fc	1969-12-31 16:00:00.000000000 -0800
@@ -1,94 +0,0 @@
-fc [ -e ename ] [ -m match ] [ old=new ... ] [ first [ last ] ]
-fc -l [ -nrdfEiD ] [ -t timefmt ] [ -m match ]
-      [ old=new ... ] [ first [ last ] ]
-fc -p [ -a ] [ filename [ histsize [ savehistsize ] ] ]
-fc -P
-fc -ARWI [ filename ]
-       Select a range of commands from first to last from  the  history
-       list.  The arguments first and last may be specified as a number
-       or as a string.  A negative number is used as an offset  to  the
-       current  history  event  number.   A  string  specifies the most
-       recent event beginning with the given string.  All substitutions
-       old=new, if any, are then performed on the commands.
-
-       If  the  -l  flag is given, the resulting commands are listed on
-       standard output.  If the -m flag is also given the  first  argu-
-       ment  is taken as a pattern (should be quoted) and only the his-
-       tory events matching this pattern will be shown.  Otherwise  the
-       editor  program ename is invoked on a file containing these his-
-       tory events.  If ename is not given, the value of the  parameter
-       FCEDIT  is  used;  if that is not set the value of the parameter
-       EDITOR is used; if that is not set a  builtin  default,  usually
-       `vi'  is  used.   If  ename  is `-', no editor is invoked.  When
-       editing is complete, the edited command is executed.
-
-       If first is not specified, it will be set to -1 (the most recent
-       event), or to -16 if the -l flag is given.  If last is not spec-
-       ified, it will be set to first, or to  -1  if  the  -l  flag  is
-       given.
-
-       The  flag  -r reverses the order of the commands and the flag -n
-       suppresses command numbers when listing.
-
-       Also when listing,
-       -d     prints timestamps for each command
-       -f     prints full time-date stamps in the US  `MM/DD/YY  hh:mm'
-              format
-       -E     prints  full time-date stamps in the European `dd.mm.yyyy
-              hh:mm' format
-       -i     prints  full  time-date  stamps  in  ISO8601  `yyyy-mm-dd
-              hh:mm' format
-       -t fmt prints  time  and date stamps in the given format; fmt is
-              formatted with the strftime function with the zsh  exten-
-              sions  described  for the %D{string} prompt format in the
-              section EXPANSION OF PROMPT SEQUENCES in zshmisc(1).  The
-              resulting formatted string must be no more than 256 char-
-              acters or will not be printed.
-       -D     prints elapsed times; may be combined  with  one  of  the
-              options above.
-
-       `fc  -p'  pushes  the  current  history  list  onto  a stack and
-       switches to a new history list.  If the -a option is also speci-
-       fied,  this  history  list will be automatically popped when the
-       current function scope is exited, which is a much  better  solu-
-       tion than creating a trap function to call `fc -P' manually.  If
-       no arguments are specified, the  history  list  is  left  empty,
-       $HISTFILE  is  unset, and $HISTSIZE & $SAVEHIST are set to their
-       default values.  If one argument is given, $HISTFILE is  set  to
-       that filename, $HISTSIZE & $SAVEHIST are left unchanged, and the
-       history file is read in (if it exists)  to  initialize  the  new
-       list.   If a second argument is specified, $HISTSIZE & $SAVEHIST
-       are instead set to the single specified numeric value.  Finally,
-       if a third argument is specified, $SAVEHIST is set to a separate
-       value from $HISTSIZE.  You are free to change these  environment
-       values  for  the new history list however you desire in order to
-       manipulate the new history list.
-
-       `fc -P' pops the history list back to an older list saved by `fc
-       -p'.   The  current  list is saved to its $HISTFILE before it is
-       destroyed (assuming that $HISTFILE and $SAVEHIST are set  appro-
-       priately,  of  course).  The values of $HISTFILE, $HISTSIZE, and
-       $SAVEHIST are restored to the values they had when `fc  -p'  was
-       called.   Note  that  this  restoration can conflict with making
-       these variables "local", so your best bet is to avoid local dec-
-       larations  for  these  variables  in functions that use `fc -p'.
-       The one other guaranteed-safe  combination  is  declaring  these
-       variables  to be local at the top of your function and using the
-       automatic option (-a) with `fc -p'.  Finally, note  that  it  is
-       legal to manually pop a push marked for automatic popping if you
-       need to do so before the function exits.
-
-       `fc -R' reads the history from the given file,  `fc  -W'  writes
-       the  history out to the given file, and `fc -A' appends the his-
-       tory out to the given file.  If no filename  is  specified,  the
-       $HISTFILE  is  assumed.   If  the -I option is added to -R, only
-       those events that are not already contained within the  internal
-       history  list are added.  If the -I option is added to -A or -W,
-       only  those  events  that  are  new   since   last   incremental
-       append/write  to  the history file are appended/written.  In any
-       case, the created file will have no more than $SAVEHIST entries.
-
-history
-       Same as fc -l.
-
-r      Same as fc -e -.
diff -ruN zsh-5.0.4/Doc/help/fg zsh-5.0.2/Doc/help/fg
--- zsh-5.0.4/Doc/help/fg	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/fg	1969-12-31 16:00:00.000000000 -0800
@@ -1,4 +0,0 @@
-fg [ job ... ]
-job ...
-       Bring each specified job in turn to the foreground.  If  no  job
-       is specified, resume the current job.
diff -ruN zsh-5.0.4/Doc/help/functions zsh-5.0.2/Doc/help/functions
--- zsh-5.0.4/Doc/help/functions	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/functions	1969-12-31 16:00:00.000000000 -0800
@@ -1,93 +0,0 @@
-functions [ {+|-}UXkmtTuz ] [ name ... ]
-functions -M mathfn [ min [ max [ shellfn ] ] ]
-functions -M [ -m pattern ... ]
-functions +M [ -m ] mathfn
-       Equivalent to typeset -f, with the exception of the  -M  option.
-       Use of the -M option may not be combined with any of the options
-       handled by typeset -f.
-
-       functions -M mathfn defines mathfn as the name of a mathematical
-       function  recognised  in  all forms of arithmetical expressions;
-       see the  section  `Arithmetic  Evaluation'  in  zshmisc(1).   By
-       default mathfn may take any number of comma-separated arguments.
-       If min is given, it must have exactly min args; if min  and  max
-       are  both given, it must have at least min and at most max args.
-       max may be -1 to indicate that there is no upper limit.
-
-       By default the function is implemented by a  shell  function  of
-       the  same name; if shellfn is specified it gives the name of the
-       corresponding shell function while mathfn remains the name  used
-       in  arithmetical expressions.  The name of the function in $0 is
-       mathfn (not shellfn as would usually be the case), provided  the
-       option FUNCTION ARGZERO is in effect.  The positional parameters
-                      -
-       in the shell function correspond to the arguments of the  mathe-
-       matical  function  call.   The  result  of the last arithmetical
-       expression evaluated inside the shell function (even if it is  a
-       form  that  normally  only returns a status) gives the result of
-       the mathematical function.
-
-       functions -M with no arguments lists all such user-defined func-
-       tions  in  the  same  form as a definition.  With the additional
-       option -m and a list of arguments, all  functions  whose  mathfn
-       matches one of the pattern arguments are listed.
-
-       function +M removes the list of mathematical functions; with the
-       additional option -m the arguments are treated as  patterns  and
-       all  functions  whose  mathfn  matches  the pattern are removed.
-       Note that the shell function implementing the behaviour  is  not
-       removed (regardless of whether its name coincides with mathfn).
-
-       For example, the following prints the cube of 3:
-
-              zmath cube() { (( $1 * $1 * $1 )) }
-                   -
-              functions -M cube 1 1 zmath cube
-                                         -
-              print $(( cube(3) ))
-
-autoload [ {+|-}UXkmtz ] [ -w ] [ name ... ]
-       Equivalent to functions -u, with the exception of -X/+X and -w.
-
-       The flag -X may be used only inside a shell  function,  and  may
-       not be followed by a name.  It causes the calling function to be
-       marked for autoloading and then immediately loaded and executed,
-       with  the  current  array of positional parameters as arguments.
-       This replaces the previous definition of the  function.   If  no
-       function  definition is found, an error is printed and the func-
-       tion remains undefined and marked for autoloading.
-
-       The flag +X attempts to load each name as  an  autoloaded  func-
-       tion,  but  does  not execute it.  The exit status is zero (suc-
-       cess) if the function was not previously defined and  a  defini-
-       tion for it was found.  This does not replace any existing defi-
-       nition of the function.  The exit status is nonzero (failure) if
-       the  function  was  already  defined  or  when no definition was
-       found.  In the latter case the function  remains  undefined  and
-       marked  for  autoloading.   If ksh-style autoloading is enabled,
-       the function created will contain the contents of the file  plus
-       a call to the function itself appended to it, thus giving normal
-       ksh autoloading behaviour on the first call to the function.  If
-       the  -m flag is also given each name is treated as a pattern and
-       all functions already marked for autoload that match the pattern
-       are loaded.
-
-       With the -w flag, the names are taken as names of files compiled
-       with the zcompile builtin, and all functions defined in them are
-       marked for autoloading.
-
-       The flags -z and -k mark the function to be autoloaded using the
-       zsh or ksh style, as if the option KSH AUTOLOAD  were  unset  or
-                                             -
-       were  set,  respectively.  The flags override the setting of the
-       option at the time the function is loaded.
-
-       Note that the autoload command makes no attempt  to  ensure  the
-       shell  options  set  during the loading or execution of the file
-       have any particular value.  For this, the emulate command can be
-       used:
-
-              emulate zsh -c 'autoload -Uz func'
-
-       arranges  that  when  func  is loaded the shell is in native zsh
-       emulation, and this emulation is also applied when func is run.
diff -ruN zsh-5.0.4/Doc/help/getcap zsh-5.0.2/Doc/help/getcap
--- zsh-5.0.4/Doc/help/getcap	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/getcap	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-getcap See the section `The zsh/cap Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/getln zsh-5.0.2/Doc/help/getln
--- zsh-5.0.4/Doc/help/getln	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/getln	1969-12-31 16:00:00.000000000 -0800
@@ -1,3 +0,0 @@
-getln [ -AclneE ] name ...
-       Read the top value from the buffer stack and put it in the shell
-       parameter name.  Equivalent to read -zr.
diff -ruN zsh-5.0.4/Doc/help/getopts zsh-5.0.2/Doc/help/getopts
--- zsh-5.0.4/Doc/help/getopts	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/getopts	1969-12-31 16:00:00.000000000 -0800
@@ -1,29 +0,0 @@
-getopts optstring name [ arg ... ]
-       Checks the args for legal options.  If the args are omitted, use
-       the  positional parameters.  A valid option argument begins with
-       a `+' or a `-'.  An argument not beginning with a `+' or a  `-',
-       or  the argument `--', ends the options.  Note that a single `-'
-       is not considered a valid option argument.   optstring  contains
-       the letters that getopts recognizes.  If a letter is followed by
-       a `:', that option requires an argument.   The  options  can  be
-       separated from the argument by blanks.
-
-       Each  time  it  is  invoked, getopts places the option letter it
-       finds in the shell parameter name, prepended with a `+' when arg
-       begins  with  a  `+'.   The  index  of the next arg is stored in
-       OPTIND.  The option argument, if any, is stored in OPTARG.
-
-       The first option to be examined may  be  changed  by  explicitly
-       assigning  to  OPTIND.  OPTIND has an initial value of 1, and is
-       normally reset to 1 upon exit from a shell function.  OPTARG  is
-       not  reset  and  retains  its value from the most recent call to
-       getopts.  If either of OPTIND or OPTARG is explicitly unset,  it
-       remains  unset,  and the index or option argument is not stored.
-       The option itself is still stored in name in this case.
-
-       A leading `:' in optstring causes getopts to store the letter of
-       any  invalid  option  in  OPTARG,  and to set name to `?' for an
-       unknown option and to `:' when a required argument  is  missing.
-       Otherwise,  getopts sets name to `?' and prints an error message
-       when an option is invalid.  The  exit  status  is  nonzero  when
-       there are no more options.
diff -ruN zsh-5.0.4/Doc/help/hash zsh-5.0.2/Doc/help/hash
--- zsh-5.0.4/Doc/help/hash	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/hash	1969-12-31 16:00:00.000000000 -0800
@@ -1,46 +0,0 @@
-hash [ -Ldfmrv ] [ name[=value] ] ...
-       hash  can be used to directly modify the contents of the command
-       hash table, and the named directory hash  table.   Normally  one
-       would  modify these tables by modifying one's PATH (for the com-
-       mand hash table) or by  creating  appropriate  shell  parameters
-       (for  the named directory hash table).  The choice of hash table
-       to work on is determined by the -d option;  without  the  option
-       the  command  hash  table is used, and with the option the named
-       directory hash table is used.
-
-       Given no arguments, and  neither  the  -r  or  -f  options,  the
-       selected hash table will be listed in full.
-
-       The  -r option causes the selected hash table to be emptied.  It
-       will be subsequently rebuilt in  the  normal  fashion.   The  -f
-       option  causes the selected hash table to be fully rebuilt imme-
-       diately.  For the command hash table this hashes all  the  abso-
-       lute  directories  in the PATH, and for the named directory hash
-       table this adds all users' home directories.  These two  options
-       cannot be used with any arguments.
-
-       The  -m  option  causes  the  arguments  to be taken as patterns
-       (which should be quoted) and the  elements  of  the  hash  table
-       matching  those  patterns  are printed.  This is the only way to
-       display a limited selection of hash table elements.
-
-       For each name with a corresponding  value,  put  `name'  in  the
-       selected  hash  table, associating it with the pathname `value'.
-       In the command hash table, this means that  whenever  `name'  is
-       used  as  a  command argument, the shell will try to execute the
-       file given by `value'.  In the named directory hash table,  this
-       means that `value' may be referred to as `~name'.
-
-       For  each  name with no corresponding value, attempt to add name
-       to the hash table, checking what the appropriate value is in the
-       normal  manner  for  that  hash  table.  If an appropriate value
-       can't be found, then the hash table will be unchanged.
-
-       The -v option causes hash table entries to be listed as they are
-       added  by explicit specification.  If has no effect if used with
-       -f.
-
-       If the -L flag is present, then each hash table entry is printed
-       in the form of a call to hash.
-
-rehash Same as hash -r.
diff -ruN zsh-5.0.4/Doc/help/jobs zsh-5.0.2/Doc/help/jobs
--- zsh-5.0.4/Doc/help/jobs	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/jobs	1969-12-31 16:00:00.000000000 -0800
@@ -1,14 +0,0 @@
-jobs [ -dlprs ] [ job ... ]
-jobs -Z string
-       Lists information about each given job, or all jobs  if  job  is
-       omitted.   The  -l flag lists process IDs, and the -p flag lists
-       process groups.  If the -r flag is specified only  running  jobs
-       will be listed and if the -s flag is given only stopped jobs are
-       shown.  If the -d flag is given, the directory  from  which  the
-       job  was  started (which may not be the current directory of the
-       job) will also be shown.
-
-       The -Z option replaces  the  shell's  argument  and  environment
-       space  with  the  given  string,  truncated if necessary to fit.
-       This will normally be visible in ps (ps(1)) listings.  This fea-
-       ture is typically used by daemons, to indicate their state.
diff -ruN zsh-5.0.4/Doc/help/kill zsh-5.0.2/Doc/help/kill
--- zsh-5.0.4/Doc/help/kill	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/kill	1969-12-31 16:00:00.000000000 -0800
@@ -1,25 +0,0 @@
-kill [ -s signal name | -n signal number | -sig ] job ...
-                -                -
-kill -l [ sig ... ]
-       Sends  either  SIGTERM or the specified signal to the given jobs
-       or processes.  Signals are given by number or by names, with  or
-       without  the  `SIG'  prefix.   If  the  signal being sent is not
-       `KILL' or `CONT', then the job will be sent a `CONT'  signal  if
-       it  is stopped.  The argument job can be the process ID of a job
-       not in the job list.  In the second form, kill -l, if sig is not
-       specified  the signal names are listed.  Otherwise, for each sig
-       that is a name, the corresponding signal number is listed.   For
-       each  sig  that  is a signal number or a number representing the
-       exit status of a process which was terminated or  stopped  by  a
-       signal the name of the signal is printed.
-
-       On  some systems, alternative signal names are allowed for a few
-       signals.  Typical examples are SIGCHLD and SIGCLD or SIGPOLL and
-       SIGIO, assuming they correspond to the same signal number.  kill
-       -l will only list the preferred form, however kill -l  alt  will
-       show  if  the  alternative  form corresponds to a signal number.
-       For example, under Linux kill -l IO and kill -l POLL both output
-       29, hence kill -IO and kill -POLL have the same effect.
-
-       Many  systems  will  allow  process IDs to be negative to kill a
-       process group or zero to kill the current process group.
diff -ruN zsh-5.0.4/Doc/help/let zsh-5.0.2/Doc/help/let
--- zsh-5.0.4/Doc/help/let	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/let	1969-12-31 16:00:00.000000000 -0800
@@ -1,6 +0,0 @@
-let arg ...
-       Evaluate each arg as an arithmetic expression.  See the  section
-       `Arithmetic  Evaluation'  in  zshmisc(1)  for  a  description of
-       arithmetic expressions.  The exit status is 0 if  the  value  of
-       the  last  expression  is  nonzero, 1 if it is zero, and 2 if an
-       error occurred.
diff -ruN zsh-5.0.4/Doc/help/limit zsh-5.0.2/Doc/help/limit
--- zsh-5.0.4/Doc/help/limit	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/limit	1969-12-31 16:00:00.000000000 -0800
@@ -1,90 +0,0 @@
-limit [ -hs ] [ resource [ limit ] ] ...
-       Set or display resource limits.  Unless the -s  flag  is  given,
-       the  limit  applies  only  the  children of the shell.  If -s is
-       given without other arguments, the resource limits of  the  cur-
-       rent  shell  is set to the previously set resource limits of the
-       children.
-
-       If limit is not specified, print the  current  limit  placed  on
-       resource,  otherwise  set  the limit to the specified value.  If
-       the -h flag is given, use hard limits instead  of  soft  limits.
-       If no resource is given, print all limits.
-
-       When looping over multiple resources, the shell will abort imme-
-       diately if it detects a badly formed argument.  However,  if  it
-       fails to set a limit for some other reason it will continue try-
-       ing to set the remaining limits.
-
-       resource can be one of:
-
-       addressspace
-              Maximum amount of address space used.
-       aiomemorylocked
-              Maximum amount of memory locked in  RAM  for  AIO  opera-
-              tions.
-       aiooperations
-              Maximum number of AIO operations.
-       cachedthreads
-              Maximum number of cached threads.
-       coredumpsize
-              Maximum size of a core dump.
-       cputime
-              Maximum CPU seconds per process.
-       datasize
-              Maximum data size (including stack) for each process.
-       descriptors
-              Maximum value for a file descriptor.
-       filesize
-              Largest single file allowed.
-       kqueues
-              Maximum number of kqueues allocated.
-       maxproc
-              Maximum number of processes.
-       maxpthreads
-              Maximum number of threads per process.
-       memorylocked
-              Maximum amount of memory locked in RAM.
-       memoryuse
-              Maximum resident set size.
-       msgqueue
-              Maximum number of bytes in POSIX message queues.
-       posixlocks
-              Maximum number of POSIX locks per user.
-       pseudoterminals
-              Maximum number of pseudo-terminals.
-       resident
-              Maximum resident set size.
-       sigpending
-              Maximum number of pending signals.
-       sockbufsize
-              Maximum size of all socket buffers.
-       stacksize
-              Maximum stack size for each process.
-       swapsize
-              Maximum amount of swap used.
-       vmemorysize
-              Maximum amount of virtual memory.
-
-       Which of these resource limits are available depends on the sys-
-       tem.  resource can be abbreviated to any unambiguous prefix.  It
-       can also be an integer, which corresponds to the integer defined
-       for the resource by the operating system.
-
-       If argument corresponds to a number which is out of the range of
-       the  resources  configured into the shell, the shell will try to
-       read or write the limit anyway, and will report an error if this
-       fails.   As  the shell does not store such resources internally,
-       an attempt to set the limit will fail unless the  -s  option  is
-       present.
-
-       limit is a number, with an optional scaling factor, as follows:
-
-       nh     hours
-       nk     kilobytes (default)
-       nm     megabytes or minutes
-       [mm:]ss
-              minutes and seconds
-
-       The  limit  command  is  not  made available by default when the
-       shell starts in a mode emulating another shell.  It can be  made
-       available with the command `zmodload -F zsh/rlimits b:limit'.
diff -ruN zsh-5.0.4/Doc/help/log zsh-5.0.2/Doc/help/log
--- zsh-5.0.4/Doc/help/log	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/log	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-log    List  all users currently logged in who are affected by the cur-
-       rent setting of the watch parameter.
diff -ruN zsh-5.0.4/Doc/help/noglob zsh-5.0.2/Doc/help/noglob
--- zsh-5.0.4/Doc/help/noglob	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/noglob	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-noglob simple command
-       See the section `Precommand Modifiers'.
diff -ruN zsh-5.0.4/Doc/help/popd zsh-5.0.2/Doc/help/popd
--- zsh-5.0.4/Doc/help/popd	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/popd	1969-12-31 16:00:00.000000000 -0800
@@ -1,16 +0,0 @@
-popd [ [-q] {+|-}n ]
-       Remove an entry from the directory stack, and perform  a  cd  to
-       the  new top directory.  With no argument, the current top entry
-       is removed.  An argument of the form  `+n'  identifies  a  stack
-       entry  by  counting  from the left of the list shown by the dirs
-       command, starting with zero.  An argument of the form -n  counts
-       from  the right.  If the PUSHD MINUS option is set, the meanings
-                                     -
-       of `+' and `-' in this context are swapped.
-
-       If the -q (quiet) option is specified, the hook  function  chpwd
-       and  the functions in the array $chpwd functions are not called,
-                                             -
-       and the new directory stack is not printed.  This is useful  for
-       calls  to  popd  that  do  not change the environment seen by an
-       interactive user.
diff -ruN zsh-5.0.4/Doc/help/print zsh-5.0.2/Doc/help/print
--- zsh-5.0.4/Doc/help/print	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/print	1969-12-31 16:00:00.000000000 -0800
@@ -1,85 +0,0 @@
-print [ -abcDilmnNoOpPrsSz ] [ -u n ] [ -f format ] [ -C cols ]
-  [ -R [ -en ]] [ arg ... ]
-       With the `-f' option the arguments are printed as  described  by
-       printf.   With  no flags or with the flag `-', the arguments are
-       printed on the standard output as described by  echo,  with  the
-       following  differences:  the escape sequence `\M-x' metafies the
-       character x (sets the highest bit), `\C-x'  produces  a  control
-       character  (`\C-@'  and  `\C-?'  give  the  characters  NUL  and
-       delete), and `\E' is a synonym for `\e'.  Finally, if not in  an
-       escape  sequence, `\' escapes the following character and is not
-       printed.
-
-       -a     Print arguments with the column incrementing first.  Only
-              useful with the -c and -C options.
-
-       -b     Recognize  all the escape sequences defined for the bind-
-              key command, see zshzle(1).
-
-       -c     Print the arguments in columns.  Unless -a is also given,
-              arguments are printed with the row incrementing first.
-
-       -C cols
-              Print  the  arguments in cols columns.  Unless -a is also
-              given, arguments are printed with  the  row  incrementing
-              first.
-
-       -D     Treat  the  arguments  as paths, replacing directory pre-
-              fixes  with  ~  expressions  corresponding  to  directory
-              names, as appropriate.
-
-       -i     If  given  together  with  -o or -O, sorting is performed
-              case-independently.
-
-       -l     Print the arguments separated by newlines instead of spa-
-              ces.
-
-       -m     Take  the first argument as a pattern (should be quoted),
-              and remove it from the argument list together with subse-
-              quent arguments that do not match this pattern.
-
-       -n     Do not add a newline to the output.
-
-       -N     Print the arguments separated and terminated by nulls.
-
-       -o     Print the arguments sorted in ascending order.
-
-       -O     Print the arguments sorted in descending order.
-
-       -p     Print the arguments to the input of the coprocess.
-
-       -P     Perform   prompt   expansion  (see  EXPANSION  OF  PROMPT
-              SEQUENCES in zshmisc(1)).
-
-       -r     Ignore the escape conventions of echo.
-
-       -R     Emulate the BSD echo  command,  which  does  not  process
-              escape  sequences  unless  the  -e flag is given.  The -n
-              flag suppresses the trailing newline.  Only the -e and -n
-              flags  are  recognized  after -R; all other arguments and
-              options are printed.
-
-       -s     Place the results in the history list instead of  on  the
-              standard  output.   Each argument to the print command is
-              treated as a single word in the  history,  regardless  of
-              its content.
-
-       -S     Place  the  results in the history list instead of on the
-              standard output.  In this case only a single argument  is
-              allowed; it will be split into words as if it were a full
-              shell command line.  The effect is similar to reading the
-              line  from  a history file with the HIST LEX WORDS option
-                                                      -   -
-              active.
-
-       -u n   Print the arguments to file descriptor n.
-
-       -z     Push the arguments onto the editing buffer  stack,  sepa-
-              rated by spaces.
-
-       If  any  of `-m', `-o' or `-O' are used in combination with `-f'
-       and there are no arguments (after the  removal  process  in  the
-       case of `-m') then nothing is printed.
-
-pushln [ arg ... ]
-       Equivalent to print -nz.
diff -ruN zsh-5.0.4/Doc/help/printf zsh-5.0.2/Doc/help/printf
--- zsh-5.0.4/Doc/help/printf	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/printf	1969-12-31 16:00:00.000000000 -0800
@@ -1,30 +0,0 @@
-printf format [ arg ... ]
-       Print  the arguments according to the format specification. For-
-       matting rules are the  same  as  used  in  C.  The  same  escape
-       sequences  as  for echo are recognised in the format. All C con-
-       version specifications ending in one of csdiouxXeEfgGn are  han-
-       dled.  In  addition to this, `%b' can be used instead of `%s' to
-       cause escape sequences in the argument to be recognised and `%q'
-       can  be  used to quote the argument in such a way that allows it
-       to be reused as shell input. With the numeric format specifiers,
-       if the corresponding argument starts with a quote character, the
-       numeric value of the following character is used as  the  number
-       to  print  otherwise  the argument is evaluated as an arithmetic
-       expression. See the  section  `Arithmetic  Evaluation'  in  zsh-
-       misc(1)  for a description of arithmetic expressions. With `%n',
-       the corresponding argument is taken as an  identifier  which  is
-       created as an integer parameter.
-
-       Normally, conversion specifications are applied to each argument
-       in order but they can explicitly specify the nth argument is  to
-       be  used by replacing `%' by `%n$' and `*' by `*n$'.  It is rec-
-       ommended that you do not mix references of this  explicit  style
-       with  the normal style and the handling of such mixed styles may
-       be subject to future change.
-
-       If arguments remain unused after formatting, the  format  string
-       is reused until all arguments have been consumed. With the print
-       builtin, this can be suppressed by using the -r option. If  more
-       arguments  are  required by the format than have been specified,
-       the behaviour is as if zero or an empty string had  been  speci-
-       fied as the argument.
diff -ruN zsh-5.0.4/Doc/help/pushd zsh-5.0.2/Doc/help/pushd
--- zsh-5.0.4/Doc/help/pushd	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/pushd	1969-12-31 16:00:00.000000000 -0800
@@ -1,35 +0,0 @@
-pushd [ -qsLP ] [ arg ]
-pushd [ -qsLP ] old new
-pushd [ -qsLP ] {+|-}n
-       Change the current directory, and push the old current directory
-       onto the directory stack.  In the first form, change the current
-       directory to arg.  If arg is not specified, change to the second
-       directory on the stack (that is, exchange the top two  entries),
-       or  change  to  $HOME  if  the PUSHD TO HOME option is set or if
-                                           -  -
-       there is only one entry on the stack.  Otherwise, arg is  inter-
-       preted  as it would be by cd.  The meaning of old and new in the
-       second form is also the same as for cd.
-
-       The third form of pushd changes directory by rotating the direc-
-       tory  list.   An  argument  of  the form `+n' identifies a stack
-       entry by counting from the left of the list shown  by  the  dirs
-       command,  starting  with  zero.   An  argument  of the form `-n'
-       counts from the right.  If the PUSHD MINUS option  is  set,  the
-                                           -
-       meanings of `+' and `-' in this context are swapped.
-
-       If  the  -q (quiet) option is specified, the hook function chpwd
-       and the functions in the array $chpwd functions are not  called,
-                                            -
-       and  the new directory stack is not printed.  This is useful for
-       calls to pushd that do not change the  environment  seen  by  an
-       interactive user.
-
-       If  the  option  -q  is  not  specified  and  the  shell  option
-       PUSHD SILENT is not set, the directory  stack  will  be  printed
-            -
-       after a pushd is performed.
-
-       The  options  -s, -L and -P have the same meanings as for the cd
-       builtin.
diff -ruN zsh-5.0.4/Doc/help/pwd zsh-5.0.2/Doc/help/pwd
--- zsh-5.0.4/Doc/help/pwd	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/pwd	1969-12-31 16:00:00.000000000 -0800
@@ -1,6 +0,0 @@
-pwd [ -rLP ]
-       Print the absolute pathname of the  current  working  directory.
-       If the -r or the -P flag is specified, or the CHASE LINKS option
-                                                          -
-       is set and the -L flag is not given, the printed path  will  not
-       contain symbolic links.
diff -ruN zsh-5.0.4/Doc/help/read zsh-5.0.2/Doc/help/read
--- zsh-5.0.4/Doc/help/read	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/read	1969-12-31 16:00:00.000000000 -0800
@@ -1,114 +0,0 @@
-read [ -rszpqAclneE ] [ -t [ num ] ] [ -k [ num ] ] [ -d delim ]
- [ -u n ] [ name[?prompt] ] [ name ...  ]
-       Read  one  line and break it into fields using the characters in
-       $IFS as separators, except as noted below.  The first  field  is
-       assigned to the first name, the second field to the second name,
-       etc., with leftover fields assigned to the last name.   If  name
-       is omitted then REPLY is used for scalars and reply for arrays.
-
-       -r     Raw  mode:  a  `\'  at the end of a line does not signify
-              line continuation and backslashes in the line don't quote
-              the following character and are not removed.
-
-       -s     Don't  echo back characters if reading from the terminal.
-              Currently does not work with the -q option.
-
-       -q     Read only one character from the terminal and set name to
-              `y'  if  this  character was `y' or `Y' and to `n' other-
-              wise.  With this flag set the return status is zero  only
-              if the character was `y' or `Y'.  This option may be used
-              with a timeout; if the read times out, or encounters  end
-              of  file,  status  2 is returned.  Input is read from the
-              terminal unless one of -u or -p is present.  This  option
-              may also be used within zle widgets.
-
-       -k [ num ]
-              Read  only  one (or num) characters.  All are assigned to
-              the first name, without word  splitting.   This  flag  is
-              ignored  when -q is present.  Input is read from the ter-
-              minal unless one of -u or -p is present.  This option may
-              also be used within zle widgets.
-
-              Note  that  despite  the  mnemonic `key' this option does
-              read full characters, which may consist of multiple bytes
-              if the option MULTIBYTE is set.
-
-       -z     Read one entry from the editor buffer stack and assign it
-              to the first  name,  without  word  splitting.   Text  is
-              pushed  onto  the stack with `print -z' or with push-line
-              from the line  editor  (see  zshzle(1)).   This  flag  is
-              ignored when the -k or -q flags are present.
-
-       -e
-       -E     The  input  read is printed (echoed) to the standard out-
-              put.  If the -e flag is used, no input is assigned to the
-              parameters.
-
-       -A     The  first  name is taken as the name of an array and all
-              words are assigned to it.
-
-       -c
-       -l     These flags are allowed only if called inside a  function
-              used  for  completion (specified with the -K flag to com-
-              pctl).  If the -c flag is given, the words of the current
-              command are read. If the -l flag is given, the whole line
-              is assigned as a scalar.  If both flags are  present,  -l
-              is used and -c is ignored.
-
-       -n     Together with -c, the number of the word the cursor is on
-              is read.  With -l, the index of the character the  cursor
-              is on is read.  Note that the command name is word number
-              1, not word 0, and that when the cursor is at the end  of
-              the  line,  its character index is the length of the line
-              plus one.
-
-       -u n   Input is read from file descriptor n.
-
-       -p     Input is read from the coprocess.
-
-       -d delim
-              Input is terminated  by  the  first  character  of  delim
-              instead of by newline.
-
-       -t [ num ]
-              Test if input is available before attempting to read.  If
-              num is present, it must begin with a digit  and  will  be
-              evaluated  to  give  a  number of seconds, which may be a
-              floating point number; in this case the read times out if
-              input  is  not available within this time.  If num is not
-              present, it is taken to be zero,  so  that  read  returns
-              immediately  if  no  input  is available.  If no input is
-              available, return status 1 and do not set any variables.
-
-              This option is not available when reading from the editor
-              buffer  with  -z, when called from within completion with
-              -c or -l, with -q which clears  the  input  queue  before
-              reading,  or  within zle where other mechanisms should be
-              used to test for input.
-
-              Note that read does not attempt to alter the  input  pro-
-              cessing  mode.   The  default mode is canonical input, in
-              which an entire line is read at a time, so usually  `read
-              -t'  will not read anything until an entire line has been
-              typed.  However, when reading from the terminal  with  -k
-              input  is processed one key at a time; in this case, only
-              availability of the first character is  tested,  so  that
-              e.g. `read -t -k 2' can still block on the second charac-
-              ter.  Use two instances of `read -t -k' if  this  is  not
-              what is wanted.
-
-       If the first argument contains a `?', the remainder of this word
-       is used as a prompt on standard error when the shell is interac-
-       tive.
-
-       The  value  (exit  status)  of  read is 1 when an end-of-file is
-       encountered, or when -c or -l is present and the command is  not
-       called  from a compctl function, or as described for -q.  Other-
-       wise the value is 0.
-
-       The behavior of some combinations of the -k, -p, -q, -u  and  -z
-       flags  is  undefined.   Presently  -q cancels all the others, -p
-       cancels -u, -k cancels -z, and otherwise -z cancels both -p  and
-       -u.
-
-       The -c or -l flags cancel any and all of -kpquz.
diff -ruN zsh-5.0.4/Doc/help/return zsh-5.0.2/Doc/help/return
--- zsh-5.0.4/Doc/help/return	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/return	1969-12-31 16:00:00.000000000 -0800
@@ -1,15 +0,0 @@
-return [ n ]
-       Causes  a shell function or `.' script to return to the invoking
-       script with the return status specified by n.  If n is  omitted,
-       the return status is that of the last command executed.
-
-       If  return  was  executed from a trap in a TRAPNAL function, the
-       effect is different for zero and non-zero return  status.   With
-       zero  status  (or  after  an  implicit  return at the end of the
-       trap), the shell will return to whatever it was previously  pro-
-       cessing; with a non-zero status, the shell will behave as inter-
-       rupted except that the return status of the  trap  is  retained.
-       Note  that the numeric value of the signal which caused the trap
-       is passed as  the  first  argument,  so  the  statement  `return
-       $((128+$1))'  will  return  the same status as if the signal had
-       not been trapped.
diff -ruN zsh-5.0.4/Doc/help/sched zsh-5.0.2/Doc/help/sched
--- zsh-5.0.4/Doc/help/sched	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/sched	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-sched  See the section `The zsh/sched Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/set zsh-5.0.2/Doc/help/set
--- zsh-5.0.4/Doc/help/set	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/set	1969-12-31 16:00:00.000000000 -0800
@@ -1,49 +0,0 @@
-set [ {+|-}options | {+|-}o [ option name ] ] ... [ {+|-}A [ name ] ] [
-                                    -
-arg ... ]
-       Set  the options for the shell and/or set the positional parame-
-       ters, or declare and set an array.  If the -s option  is  given,
-       it  causes the specified arguments to be sorted before assigning
-       them to the positional parameters (or to the array name if -A is
-       used).   With  +s  sort  arguments in descending order.  For the
-       meaning of the other flags, see  zshoptions(1).   Flags  may  be
-       specified by name using the -o option. If no option name is sup-
-       plied with -o, the current option states are printed:   see  the
-       description  of setopt below for more information on the format.
-       With +o they are printed in a form that can be used as input  to
-       the shell.
-
-       If  the -A flag is specified, name is set to an array containing
-       the given args; if no name is specified, all arrays are  printed
-       together with their values.
-
-       If  +A  is  used  and name is an array, the given arguments will
-       replace the initial elements of that array; if no name is speci-
-       fied, all arrays are printed without their values.
-
-       The  behaviour  of arguments after -A name or +A name depends on
-       whether the option KSH ARRAYS is set.  If it  is  not  set,  all
-                             -
-       arguments  following  name  are treated as values for the array,
-       regardless of their form.  If the option is set,  normal  option
-       processing  continues  at that point; only regular arguments are
-       treated as values for the array.  This means that
-
-              set -A array -x -- foo
-
-       sets array to `-x -- foo' if KSH ARRAYS is not set, but sets the
-                                       -
-       array to foo and turns on the option `-x' if it is set.
-
-       If  the  -A  flag is not present, but there are arguments beyond
-       the options, the positional parameters are set.  If  the  option
-       list  (if  any)  is terminated by `--', and there are no further
-       arguments, the positional parameters will be unset.
-
-       If no arguments and no `--' are given, then the names and values
-       of  all  parameters  are printed on the standard output.  If the
-       only argument is `+', the names of all parameters are printed.
-
-       For historical reasons, `set -' is treated as `set +xv' and `set
-       -  args'  as  `set +xv -- args' when in any other emulation mode
-       than zsh's native mode.
diff -ruN zsh-5.0.4/Doc/help/setcap zsh-5.0.2/Doc/help/setcap
--- zsh-5.0.4/Doc/help/setcap	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/setcap	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-setcap See the section `The zsh/cap Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/setopt zsh-5.0.2/Doc/help/setopt
--- zsh-5.0.4/Doc/help/setopt	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/setopt	1969-12-31 16:00:00.000000000 -0800
@@ -1,30 +0,0 @@
-setopt [ {+|-}options | {+|-}o option name ] [ name ... ]
-                                     -
-       Set the options for the shell.   All  options  specified  either
-       with flags or by name are set.
-
-       If no arguments are supplied, the names of all options currently
-       set are printed.  The form is chosen so as to minimize the  dif-
-       ferences from the default options for the current emulation (the
-       default emulation being native  zsh,  shown  as  <Z>  in  zshop-
-       tions(1)).  Options that are on by default for the emulation are
-       shown with the prefix no only  if  they  are  off,  while  other
-       options are shown without the prefix no and only if they are on.
-       In addition to options changed from the  default  state  by  the
-       user,  any  options  activated  automatically  by the shell (for
-       example, SHIN STDIN or INTERACTIVE) will be shown in  the  list.
-                    -
-       The  format  is further modified by the option KSH OPTION PRINT,
-                                                         -      -
-       however the rationale for choosing options with or  without  the
-       no prefix remains the same in this case.
-
-       If  the  -m  flag  is  given the arguments are taken as patterns
-       (which should be quoted to protect  them  from  filename  expan-
-       sion),  and  all  options with names matching these patterns are
-       set.
-
-       Note that a bad option name does not cause execution  of  subse-
-       quent  shell  code to be aborted; this is behaviour is different
-       from that of `set -o'.  This is because set  is  regarded  as  a
-       special builtin by the POSIX standard, but setopt is not.
diff -ruN zsh-5.0.4/Doc/help/shift zsh-5.0.2/Doc/help/shift
--- zsh-5.0.4/Doc/help/shift	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/shift	1969-12-31 16:00:00.000000000 -0800
@@ -1,5 +0,0 @@
-shift [ n ] [ name ... ]
-       The  positional  parameters  ${n+1}  ...  are renamed to $1 ...,
-       where n is an arithmetic expression that defaults to 1.  If  any
-       names  are  given  then  the arrays with these names are shifted
-       instead of the positional parameters.
diff -ruN zsh-5.0.4/Doc/help/source zsh-5.0.2/Doc/help/source
--- zsh-5.0.4/Doc/help/source	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/source	1969-12-31 16:00:00.000000000 -0800
@@ -1,4 +0,0 @@
-source file [ arg ... ]
-       Same as  `.',  except  that  the  current  directory  is  always
-       searched  and  is  always  searched first, before directories in
-       $path.
diff -ruN zsh-5.0.4/Doc/help/stat zsh-5.0.2/Doc/help/stat
--- zsh-5.0.4/Doc/help/stat	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/stat	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-stat   See the section `The zsh/stat Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/suspend zsh-5.0.2/Doc/help/suspend
--- zsh-5.0.4/Doc/help/suspend	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/suspend	1969-12-31 16:00:00.000000000 -0800
@@ -1,4 +0,0 @@
-suspend [ -f ]
-       Suspend the execution of the shell (send it a SIGTSTP) until  it
-       receives  a  SIGCONT.   Unless the -f option is given, this will
-       refuse to suspend a login shell.
diff -ruN zsh-5.0.4/Doc/help/test zsh-5.0.2/Doc/help/test
--- zsh-5.0.4/Doc/help/test	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/test	1969-12-31 16:00:00.000000000 -0800
@@ -1,20 +0,0 @@
-test [ arg ... ]
-[ [ arg ... ] ]
-       Like the system version of test.  Added for  compatibility;  use
-       conditional  expressions  instead  (see the section `Conditional
-       Expressions').  The main  differences  between  the  conditional
-       expression  syntax  and the test and [ builtins are:  these com-
-       mands are not handled syntactically, so  for  example  an  empty
-       variable  expansion  may cause an argument to be omitted; syntax
-       errors cause status 2 to be returned instead of a  shell  error;
-       and  arithmetic  operators  expect integer arguments rather than
-       arithmetic expressions.
-
-       The command attempts to implement POSIX and its extensions where
-       these are specified.  Unfortunately there are intrinsic ambigui-
-       ties in the  syntax;  in  particular  there  is  no  distinction
-       between  test  operators  and  strings  that resemble them.  The
-       standard attempts to resolve these for small  numbers  of  argu-
-       ments  (up  to  four);  for five or more arguments compatibility
-       cannot be relied on.  Users are urged wherever possible  to  use
-       the `[[' test syntax which does not have these ambiguities.
diff -ruN zsh-5.0.4/Doc/help/times zsh-5.0.2/Doc/help/times
--- zsh-5.0.4/Doc/help/times	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/times	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-times  Print  the  accumulated  user and system times for the shell and
-       for processes run from the shell.
diff -ruN zsh-5.0.4/Doc/help/trap zsh-5.0.2/Doc/help/trap
--- zsh-5.0.4/Doc/help/trap	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/trap	1969-12-31 16:00:00.000000000 -0800
@@ -1,77 +0,0 @@
-trap [ arg ] [ sig ... ]
-       arg is a series of commands (usually quoted to protect  it  from
-       immediate  evaluation by the shell) to be read and executed when
-       the shell receives any of the signals specified by one  or  more
-       sig  args.  Each sig can be given as a number, or as the name of
-       a signal either with or without the string SIG in front (e.g. 1,
-       HUP, and SIGHUP are all the same signal).
-
-       If  arg  is  `-',  then the specified signals are reset to their
-       defaults, or, if no sig args are present, all traps are reset.
-
-       If arg is an  empty  string,  then  the  specified  signals  are
-       ignored by the shell (and by the commands it invokes).
-
-       If  arg  is  omitted but one or more sig args are provided (i.e.
-       the first argument is a valid signal number or name), the effect
-       is the same as if arg had been specified as `-'.
-
-       The  trap  command  with  no arguments prints a list of commands
-       associated with each signal.
-
-       If sig is ZERR then arg will be executed after each command with
-       a nonzero exit status.  ERR is an alias for ZERR on systems that
-       have no SIGERR signal (this is the usual case).
-
-       If sig is DEBUG then arg will be executed before each command if
-       the  option  DEBUG BEFORE CMD is set (as it is by default), else
-                         -      -
-       after each command.  Here, a `command' is what is described as a
-       `sublist'  in the shell grammar, see the section SIMPLE COMMANDS
-       & PIPELINES in zshmisc(1).  If DEBUG BEFORE CMD is  set  various
-                                           -      -
-       additional  features  are  available.   First, it is possible to
-       skip the next command by setting the option  ERR EXIT;  see  the
-                                                       -
-       description  of the ERR EXIT option in zshoptions(1).  Also, the
-                              -
-       shell parameter ZSH DEBUG CMD is set to the string corresponding
-                          -     -
-       to  the  command  to  be executed following the trap.  Note that
-       this string is reconstructed from the internal  format  and  may
-       not be formatted the same way as the original text.  The parame-
-       ter is unset after the trap is executed.
-
-       If sig is 0 or EXIT and the trap statement  is  executed  inside
-       the  body  of a function, then the command arg is executed after
-       the function completes.  The value of $? at the start of  execu-
-       tion is the exit status of the shell or the return status of the
-       function exiting.  If sig is 0 or EXIT and the trap statement is
-       not executed inside the body of a function, then the command arg
-       is executed when the shell terminates; the trap runs before  any
-       zshexit hook functions.
-
-       ZERR, DEBUG, and EXIT traps are not executed inside other traps.
-       ZERR and DEBUG traps are  kept  within  subshells,  while  other
-       traps are reset.
-
-       Note  that traps defined with the trap builtin are slightly dif-
-       ferent from those defined as `TRAPNAL () { ... }', as the latter
-       have  their  own function environment (line numbers, local vari-
-       ables, etc.) while the former use the environment of the command
-       in which they were called.  For example,
-
-              trap 'print $LINENO' DEBUG
-
-       will  print  the  line number of a command executed after it has
-       run, while
-
-              TRAPDEBUG() { print $LINENO; }
-
-       will always print the number zero.
-
-       Alternative signal names are allowed  as  described  under  kill
-       above.   Defining a trap under either name causes any trap under
-       an alternative name to be removed.  However, it  is  recommended
-       that  for  consistency  users  stick  exclusively to one name or
-       another.
diff -ruN zsh-5.0.4/Doc/help/true zsh-5.0.2/Doc/help/true
--- zsh-5.0.4/Doc/help/true	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/true	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-true [ arg ... ]
-       Do nothing and return an exit status of 0.
diff -ruN zsh-5.0.4/Doc/help/ttyctl zsh-5.0.2/Doc/help/ttyctl
--- zsh-5.0.4/Doc/help/ttyctl	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/ttyctl	1969-12-31 16:00:00.000000000 -0800
@@ -1,9 +0,0 @@
-ttyctl -fu
-       The -f option freezes the tty, and -u unfreezes  it.   When  the
-       tty  is  frozen, no changes made to the tty settings by external
-       programs will be honored by the shell, except for changes in the
-       size  of the screen; the shell will simply reset the settings to
-       their previous values as soon as each command exits or  is  sus-
-       pended.  Thus, stty and similar programs have no effect when the
-       tty is frozen.  Without options it reports whether the  terminal
-       is frozen or not.
diff -ruN zsh-5.0.4/Doc/help/typeset zsh-5.0.2/Doc/help/typeset
--- zsh-5.0.4/Doc/help/typeset	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/typeset	1969-12-31 16:00:00.000000000 -0800
@@ -1,264 +0,0 @@
-typeset [ {+|-}AEFHUafghklprtuxmz ] [ -LRZi [ n ]] [ name[=value] ... ]
-typeset -T [ {+|-}Urux ] [ -LRZ [ n ]] SCALAR[=value] array [ sep ]
-       Set or display attributes and values for shell parameters.
-
-       A parameter is created for each name that does not already refer
-       to one.  When inside a function, a new parameter is created  for
-       every  name  (even those that already exist), and is unset again
-       when the function completes.  See  `Local  Parameters'  in  zsh-
-       param(1).   The  same  rules  apply to special shell parameters,
-       which retain their special attributes when made local.
-
-       For each name=value assignment, the parameter  name  is  set  to
-       value.  Note that arrays currently cannot be assigned in typeset
-       expressions, only  scalars  and  integers.   Unless  the  option
-       KSH TYPESET  is  set, normal expansion rules apply to assignment
-          -
-       arguments, so value may be split into  separate  words;  if  the
-       option  is  set, assignments which can be recognised when expan-
-       sion is performed are treated as single words.  For example  the
-       command  typeset  vbl=$(echo  one  two) is treated as having one
-       argument if KSH TYPESET is set, but otherwise is treated as hav-
-                      -
-       ing the two arguments vbl=one and two.
-
-       If  the shell option TYPESET SILENT is not set, for each remain-
-                                   -
-       ing name that refers to a parameter that is set,  the  name  and
-       value of the parameter are printed in the form of an assignment.
-       Nothing is printed for newly-created  parameters,  or  when  any
-       attribute  flags  listed  below  are  given along with the name.
-       Using `+' instead of minus to introduce an  attribute  turns  it
-       off.
-
-       If  the -p option is given, parameters and values are printed in
-       the form of a typeset command and an assignment (which  will  be
-       printed  separately  for arrays and associative arrays), regard-
-       less of other flags and options.   Note  that  the  -h  flag  on
-       parameters is respected; no value will be shown for these param-
-       eters.
-
-       If the -T option is  given,  two  or  three  arguments  must  be
-       present (an exception is that zero arguments are allowed to show
-       the list of parameters created in this fashion).  The first  two
-       are  the name of a scalar and an array parameter (in that order)
-       that will be tied together in the manner  of  $PATH  and  $path.
-       The  optional  third  argument  is  a single-character separator
-       which will be used to join the elements of the array to form the
-       scalar;  if  absent,  a  colon is used, as with $PATH.  Only the
-       first character of the separator is significant;  any  remaining
-       characters  are  ignored.   Only  the  scalar  parameter  may be
-       assigned an initial value.  Both the scalar and  the  array  may
-       otherwise  be manipulated as normal.  If one is unset, the other
-       will automatically be unset too.  There is no way of untying the
-       variables  without unsetting them, or converting the type of one
-       of them with another typeset command; +T does not work,  assign-
-       ing  an  array  to SCALAR is an error, and assigning a scalar to
-       array sets it to be a  single-element  array.   Note  that  both
-       `typeset  -xT ...' and `export -T ...' work, but only the scalar
-       will be marked for export.  Setting the value using  the  scalar
-       version  causes  a  split  on  all  separators  (which cannot be
-       quoted).  It is possible to use the same two tied variables with
-       a  different  separator  character  in  which case the variables
-       remain joined as before but the separator is changed.  This flag
-       has a different meaning when used with -f; see below.
-
-       The  -g  (global)  flag  is treated specially: it means that any
-       resulting parameter will not be restricted to local scope.  Note
-       that  this  does not necessarily mean that the parameter will be
-       global, as the flag will apply to any existing  parameter  (even
-       if unset) from an enclosing function.  This flag does not affect
-       the parameter after creation, hence it has no effect when  list-
-       ing  existing  parameters,  nor does the flag +g have any effect
-       except in combination with -m (see below).
-
-       If no name is present, the names and values  of  all  parameters
-       are printed.  In this case the attribute flags restrict the dis-
-       play  to  only  those  parameters  that   have   the   specified
-       attributes,  and using `+' rather than `-' to introduce the flag
-       suppresses printing of the values of parameters when there is no
-       parameter  name.  Also, if the last option is the word `+', then
-       names are printed but values are not.
-
-       If the -m flag is given the name arguments are taken as patterns
-       (which  should be quoted).  With no attribute flags, all parame-
-       ters (or functions with the -f flag)  with  matching  names  are
-       printed  (the  shell  option  TYPESET SILENT is not used in this
-                                            -
-       case).  Note that -m is ignored if no patterns  are  given.   If
-       the  +g  flag is combined with -m, a new local parameter is cre-
-       ated for every matching parameter that  is  not  already  local.
-       Otherwise  -m  applies  all  other  flags  or assignments to the
-       existing parameters.  Except  when  assignments  are  made  with
-       name=value,  using  +m  forces  the  matching  parameters  to be
-       printed, even inside a function.
-
-       If no attribute flags are given and either no -m flag is present
-       or the +m form was used, each parameter name printed is preceded
-       by a list of the attributes of that parameter  (array,  associa-
-       tion,   exported,  integer,  readonly).   If  +m  is  used  with
-       attribute flags, and all those flags are introduced with +,  the
-       matching parameter names are printed but their values are not.
-
-       Attribute  flags that transform the final value (-L, -R, -Z, -l,
-       u) are only applied to the expanded value  at  the  point  of  a
-       parameter  expansion expression using `$'.  They are not applied
-       when a parameter is retrieved internally by the  shell  for  any
-       purpose.
-
-       The following attribute flags may be specified:
-
-       -A     The  names  refer  to  associative  array parameters; see
-              `Array Parameters' in zshparam(1).
-
-       -L     Left justify and remove leading blanks from value.  If  n
-              is  nonzero,  it defines the width of the field.  If n is
-              zero, the width is determined by the width of  the  value
-              of  the first assignment.  In the case of numeric parame-
-              ters, the length of the complete value  assigned  to  the
-              parameter  is  used to determine the width, not the value
-              that would be output.
-
-              The width is the count of characters, which may be multi-
-              byte  characters  if  the  MULTIBYTE option is in effect.
-              Note that the screen width of the character is not  taken
-              into  account;  if  this  is  required,  use padding with
-              parameter expansion flags ${(ml...)...} as  described  in
-              `Parameter Expansion Flags' in zshexpn(1).
-
-              When the parameter is expanded, it is filled on the right
-              with blanks or truncated if necessary to fit  the  field.
-              Note  truncation  can  lead  to  unexpected  results with
-              numeric parameters.  Leading zeros are removed if the  -Z
-              flag is also set.
-
-       -R     Similar  to  -L, except that right justification is used;
-              when the parameter is expanded, the field is left  filled
-              with  blanks  or truncated from the end.  May not be com-
-              bined with the -Z flag.
-
-       -U     For arrays (but not for associative  arrays),  keep  only
-              the  first occurrence of each duplicated value.  This may
-              also be set for colon-separated special  parameters  like
-              PATH  or FIGNORE, etc.  This flag has a different meaning
-              when used with -f; see below.
-
-       -Z     Specially handled if set along with the -L flag.   Other-
-              wise,  similar  to -R, except that leading zeros are used
-              for padding instead of  blanks  if  the  first  non-blank
-              character  is  a digit.  Numeric parameters are specially
-              handled:  they  are  always  eligible  for  padding  with
-              zeroes,  and  the  zeroes  are inserted at an appropriate
-              place in the output.
-
-       -a     The names refer to array parameters.  An array  parameter
-              may be created this way, but it may not be assigned to in
-              the typeset statement.  When displaying, both normal  and
-              associative arrays are shown.
-
-       -f     The  names refer to functions rather than parameters.  No
-              assignments can be made, and the only other  valid  flags
-              are -t, -T, -k, -u, -U and -z.  The flag -t turns on exe-
-              cution tracing for this function; the flag  -T  does  the
-              same,  but  turns off tracing on any function called from
-              the present one, unless that function also has the -t  or
-              -T  flag.   The  -u and -U flags cause the function to be
-              marked for autoloading; -U also causes alias expansion to
-              be  suppressed  when  the  function is loaded.  The fpath
-              parameter will be searched to find the  function  defini-
-              tion  when the function is first referenced; see the sec-
-              tion `Functions'. The -k and -z flags make  the  function
-              be   loaded  using  ksh-style  or  zsh-style  autoloading
-              respectively. If neither is given,  the  setting  of  the
-              KSH AUTOLOAD   option  determines  how  the  function  is
-                 -
-              loaded.
-
-       -h     Hide: only useful for special  parameters  (those  marked
-              `<S>' in the table in zshparam(1)), and for local parame-
-              ters with the same name as a  special  parameter,  though
-              harmless  for  others.   A  special  parameter  with this
-              attribute will not retain its special  effect  when  made
-              local.  Thus after `typeset -h PATH', a function contain-
-              ing `typeset PATH' will create an ordinary local  parame-
-              ter  without the usual behaviour of PATH.  Alternatively,
-              the local parameter may itself be given  this  attribute;
-              hence  inside  a  function  `typeset  -h PATH' creates an
-              ordinary local parameter and the special  PATH  parameter
-              is not altered in any way.  It is also possible to create
-              a local parameter using `typeset +h special',  where  the
-              local  copy of special will retain its special properties
-              regardless of having the -h  attribute.   Global  special
-              parameters  loaded from shell modules (currently those in
-              zsh/mapfile and zsh/parameter)  are  automatically  given
-              the -h attribute to avoid name clashes.
-
-       -H     Hide  value:  specifies that typeset will not display the
-              value of the parameter when listing parameters; the  dis-
-              play for such parameters is always as if the `+' flag had
-              been given.  Use of the parameter is  in  other  respects
-              normal, and the option does not apply if the parameter is
-              specified by name, or by  pattern  with  the  -m  option.
-              This   is  on  by  default  for  the  parameters  in  the
-              zsh/parameter and zsh/mapfile  modules.   Note,  however,
-              that  unlike the -h flag this is also useful for non-spe-
-              cial parameters.
-
-       -i     Use an internal integer representation.  If n is  nonzero
-              it  defines  the  output arithmetic base, otherwise it is
-              determined by the first assignment.  Bases from 2  to  36
-              inclusive are allowed.
-
-       -E     Use an internal double-precision floating point represen-
-              tation.  On output the variable will be converted to sci-
-              entific  notation.  If n is nonzero it defines the number
-              of significant figures to display; the default is ten.
-
-       -F     Use an internal double-precision floating point represen-
-              tation.   On  output  the  variable  will be converted to
-              fixed-point decimal notation.  If n is nonzero it defines
-              the  number of digits to display after the decimal point;
-              the default is ten.
-
-       -l     Convert the result to lower case whenever  the  parameter
-              is expanded.  The value is not converted when assigned.
-
-       -r     The  given  names are marked readonly.  Note that if name
-              is a special parameter, the  readonly  attribute  can  be
-              turned on, but cannot then be turned off.
-
-       -t     Tags  the named parameters.  Tags have no special meaning
-              to the shell.  This flag has  a  different  meaning  when
-              used with -f; see above.
-
-       -u     Convert  the  result to upper case whenever the parameter
-              is expanded.  The value is not converted  when  assigned.
-              This  flag has a different meaning when used with -f; see
-              above.
-
-       -x     Mark for automatic export to the  environment  of  subse-
-              quently  executed  commands.  If the option GLOBAL EXPORT
-                                                                -
-              is set, this implies the option -g,  unless  +g  is  also
-              explicitly  given;  in  other  words the parameter is not
-              made local to the enclosing function.  This is  for  com-
-              patibility with previous versions of zsh.
-
-declare
-       Same as typeset.
-
-float [ {+|-}EFHghlprtux ] [ -LRZ [ n ]] [ name[=value] ... ]
-       Equivalent  to  typeset  -E,  except  that options irrelevant to
-       floating point numbers are not permitted.
-
-integer [ {+|-}Hghilprtux ] [ -LRZ [ n ]] [ name[=value] ... ]
-       Equivalent  to  typeset  -i,  except  that options irrelevant to
-       integers are not permitted.
-
-local [ {+|-}AEFHUahlprtux ] [ -LRZi [ n ]] [ name[=value] ] ...
-       Same as typeset, except that the options -g, and -f are not per-
-       mitted.  In this case the -x option does not force  the  use  of
-       -g, i.e. exported variables will be local to functions.
-
-readonly
-       Same as typeset -r.
diff -ruN zsh-5.0.4/Doc/help/ulimit zsh-5.0.2/Doc/help/ulimit
--- zsh-5.0.4/Doc/help/ulimit	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/ulimit	1969-12-31 16:00:00.000000000 -0800
@@ -1,56 +0,0 @@
-ulimit [ [ -SHacdfiklmnpqsTtvwx | -N resource [ limit ] ... ]
-       Set  or  display  resource limits of the shell and the processes
-       started by the shell.  The value of limit can be a number in the
-       unit  specified  below  or  one of the values `unlimited', which
-       removes the limit on the resource, or  `hard',  which  uses  the
-       current value of the hard limit on the resource.
-
-       By  default, only soft limits are manipulated. If the -H flag is
-       given use hard limits instead of soft limits.  If the -S flag is
-       given together with the -H flag set both hard and soft limits.
-
-       If no options are used, the file size limit (-f) is assumed.
-
-       If limit is omitted the current value of the specified resources
-       are printed.  When more than one resource value is printed,  the
-       limit name and unit is printed before each value.
-
-       When looping over multiple resources, the shell will abort imme-
-       diately if it detects a badly formed argument.  However,  if  it
-       fails to set a limit for some other reason it will continue try-
-       ing to set the remaining limits.
-
-       Not all the following resources are supported  on  all  systems.
-       Running ulimit -a will show which are supported.
-
-       -a     Lists all of the current resource limits.
-       -b     Socket buffer size in bytes (N.B. not kilobytes)
-       -c     512-byte blocks on the size of core dumps.
-       -d     Kilobytes on the size of the data segment.
-       -f     512-byte blocks on the size of files written.
-       -i     The number of pending signals.
-       -k     The number of kqueues allocated.
-       -l     Kilobytes on the size of locked-in memory.
-       -m     Kilobytes on the size of physical memory.
-       -n     open file descriptors.
-       -p     The number of pseudo-terminals.
-       -q     Bytes in POSIX message queues.
-       -s     Kilobytes on the size of the stack.
-       -T     The number of simultaneous threads available to the user.
-       -t     CPU seconds to be used.
-       -u     The number of processes available to the user.
-       -v     Kilobytes on the size of virtual memory.  On some systems
-              this refers to the limit called `address space'.
-       -w     Kilobytes on the size of swapped out memory.
-       -x     The number of locks on files.
-
-       A resource may also be specified by  integer  in  the  form  `-N
-       resource', where resource corresponds to the integer defined for
-       the resource by the operating system.  This may be used  to  set
-       the  limits for resources known to the shell which do not corre-
-       spond to option letters.  Such limits will be shown by number in
-       the output of `ulimit -a'.
-
-       The  number may alternatively be out of the range of limits com-
-       piled into the shell.  The shell will try to read or  write  the
-       limit anyway, and will report an error if this fails.
diff -ruN zsh-5.0.4/Doc/help/umask zsh-5.0.2/Doc/help/umask
--- zsh-5.0.4/Doc/help/umask	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/umask	1969-12-31 16:00:00.000000000 -0800
@@ -1,8 +0,0 @@
-umask [ -S ] [ mask ]
-       The umask is set to mask.  mask can be either an octal number or
-       a symbolic value as described in chmod(1).  If mask is  omitted,
-       the  current value is printed.  The -S option causes the mask to
-       be printed as a symbolic value.  Otherwise, the mask is  printed
-       as  an octal number.  Note that in the symbolic form the permis-
-       sions you specify are those which are to be allowed (not denied)
-       to the users specified.
diff -ruN zsh-5.0.4/Doc/help/unhash zsh-5.0.2/Doc/help/unhash
--- zsh-5.0.4/Doc/help/unhash	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/unhash	1969-12-31 16:00:00.000000000 -0800
@@ -1,18 +0,0 @@
-unhash [ -adfms ] name ...
-       Remove  the element named name from an internal hash table.  The
-       default is remove elements from the command hash table.  The  -a
-       option  causes  unhash to remove regular or global aliases; note
-       when removing a global aliases that the argument must be  quoted
-       to  prevent  it  from  being expanded before being passed to the
-       command.  The -s option causes unhash to remove suffix  aliases.
-       The  -f  option causes unhash to remove shell functions.  The -d
-       options causes unhash to remove named directories.   If  the  -m
-       flag  is  given  the  arguments are taken as patterns (should be
-       quoted) and all elements of the corresponding  hash  table  with
-       matching names will be removed.
-
-unalias
-       Same as unhash -a.
-
-unfunction
-       Same as unhash -f.
diff -ruN zsh-5.0.4/Doc/help/unlimit zsh-5.0.2/Doc/help/unlimit
--- zsh-5.0.4/Doc/help/unlimit	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/unlimit	1969-12-31 16:00:00.000000000 -0800
@@ -1,10 +0,0 @@
-unlimit [ -hs ] resource ...
-       The  resource  limit for each resource is set to the hard limit.
-       If the -h flag is given and the  shell  has  appropriate  privi-
-       leges,  the  hard  resource  limit for each resource is removed.
-       The resources of the shell process are only changed  if  the  -s
-       flag is given.
-
-       The  unlimit  command  is not made available by default when the
-       shell starts in a mode emulating another shell.  It can be  made
-       available with the command `zmodload -F zsh/rlimits b:unlimit'.
diff -ruN zsh-5.0.4/Doc/help/unset zsh-5.0.2/Doc/help/unset
--- zsh-5.0.4/Doc/help/unset	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/unset	1969-12-31 16:00:00.000000000 -0800
@@ -1,20 +0,0 @@
-unset [ -fmv ] name ...
-       Each  named  parameter  is unset.  Local parameters remain local
-       even if unset; they appear unset within scope, but the  previous
-       value will still reappear when the scope ends.
-
-       Individual elements of associative array parameters may be unset
-       by using subscript syntax on name, which should  be  quoted  (or
-       the  entire  command  prefixed  with noglob) to protect the sub-
-       script from filename generation.
-
-       If the -m flag is specified the arguments are taken as  patterns
-       (should  be  quoted)  and all parameters with matching names are
-       unset.  Note that this cannot be used when unsetting associative
-       array  elements, as the subscript will be treated as part of the
-       pattern.
-
-       The -v flag specifies that name refers to  parameters.  This  is
-       the default behaviour.
-
-       unset -f is equivalent to unfunction.
diff -ruN zsh-5.0.4/Doc/help/unsetopt zsh-5.0.2/Doc/help/unsetopt
--- zsh-5.0.4/Doc/help/unsetopt	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/unsetopt	1969-12-31 16:00:00.000000000 -0800
@@ -1,9 +0,0 @@
-unsetopt [ {+|-}options | {+|-}o option name ] [ name ... ]
-                                       -
-       Unset  the  options for the shell.  All options specified either
-       with flags or by name are unset.  If no arguments are  supplied,
-       the names of all options currently unset are printed.  If the -m
-       flag is given the arguments are taken as patterns (which  should
-       be  quoted  to preserve them from being interpreted as glob pat-
-       terns), and all options with names matching these  patterns  are
-       unset.
diff -ruN zsh-5.0.4/Doc/help/vared zsh-5.0.2/Doc/help/vared
--- zsh-5.0.4/Doc/help/vared	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/vared	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-vared  See the section `Zle Builtins' in zshzle(1).
diff -ruN zsh-5.0.4/Doc/help/wait zsh-5.0.2/Doc/help/wait
--- zsh-5.0.4/Doc/help/wait	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/wait	1969-12-31 16:00:00.000000000 -0800
@@ -1,6 +0,0 @@
-wait [ job ... ]
-       Wait  for  the specified jobs or processes.  If job is not given
-       then all currently active child processes are waited for.   Each
-       job can be either a job specification or the process ID of a job
-       in the job table.  The exit status from this command is that  of
-       the job waited for.
diff -ruN zsh-5.0.4/Doc/help/whence zsh-5.0.2/Doc/help/whence
--- zsh-5.0.4/Doc/help/whence	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/whence	1969-12-31 16:00:00.000000000 -0800
@@ -1,43 +0,0 @@
-whence [ -vcwfpams ] name ...
-       For each name, indicate how it would be interpreted if used as a
-       command name.
-
-       -v     Produce a more verbose report.
-
-       -c     Print the results  in  a  csh-like  format.   This  takes
-              precedence over -v.
-
-       -w     For  each  name,  print `name: word' where word is one of
-              alias, builtin, command, function,  hashed,  reserved  or
-              none,  according  as  name  corresponds  to  an  alias, a
-              built-in command, an external command, a shell  function,
-              a command defined with the hash builtin, a reserved word,
-              or is not recognised.  This takes precedence over -v  and
-              -c.
-
-       -f     Causes  the contents of a shell function to be displayed,
-              which would otherwise not happen unless the -c flag  were
-              used.
-
-       -p     Do  a  path  search  for  name  even  if  it is an alias,
-              reserved word, shell function or builtin.
-
-       -a     Do a search for all occurrences of  name  throughout  the
-              command  path.   Normally  only  the  first occurrence is
-              printed.
-
-       -m     The arguments are taken as patterns (should  be  quoted),
-              and  the information is displayed for each command match-
-              ing one of these patterns.
-
-       -s     If a pathname contains symlinks, print  the  symlink-free
-              pathname as well.
-
-type [ -wfpams ] name ...
-       Equivalent to whence -v.
-
-where [ -wpms ] name ...
-       Equivalent to whence -ca.
-
-which [ -wpams ] name ...
-       Equivalent to whence -c.
diff -ruN zsh-5.0.4/Doc/help/zcompile zsh-5.0.2/Doc/help/zcompile
--- zsh-5.0.4/Doc/help/zcompile	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zcompile	1969-12-31 16:00:00.000000000 -0800
@@ -1,112 +0,0 @@
-zcompile [ -U ] [ -z | -k ] [ -R | -M ] file [ name ... ]
-zcompile -ca [ -m ] [ -R | -M ] file [ name ... ]
-zcompile -t file [ name ... ]
-       This  builtin  command  can  be  used  to  compile  functions or
-       scripts, storing the compiled form in a  file,  and  to  examine
-       files   containing   the  compiled  form.   This  allows  faster
-       autoloading of functions and execution of  scripts  by  avoiding
-       parsing of the text when the files are read.
-
-       The first form (without the -c, -a or -t options) creates a com-
-       piled file.  If only the file argument is given, the output file
-       has the name `file.zwc' and will be placed in the same directory
-       as the file.  The shell will load the compiled file  instead  of
-       the  normal  function  file when the function is autoloaded; see
-       the section `Autoloading Functions' in zshmisc(1) for a descrip-
-       tion  of  how  autoloaded functions are searched.  The extension
-       .zwc stands for `zsh word code'.
-
-       If there is at least one name argument, all the named files  are
-       compiled  into  the output file given as the first argument.  If
-       file does not end  in  .zwc,  this  extension  is  automatically
-       appended.   Files  containing  multiple  compiled  functions are
-       called `digest' files, and are intended to be used  as  elements
-       of the FPATH/fpath special array.
-
-       The  second form, with the -c or -a options, writes the compiled
-       definitions for all the named functions into file.  For -c,  the
-       names  must  be  functions  currently  defined in the shell, not
-       those marked for  autoloading.   Undefined  functions  that  are
-       marked for autoloading may be written by using the -a option, in
-       which case the fpath is searched and the contents of the defini-
-       tion  files  for  those  functions,  if found, are compiled into
-       file.  If both -c and -a are given, names of both defined  func-
-       tions  and  functions  marked  for autoloading may be given.  In
-       either case, the functions in files written with the  -c  or  -a
-       option  will  be  autoloaded  as if the KSH AUTOLOAD option were
-                                                  -
-       unset.
-
-       The reason for handling loaded and not-yet-loaded functions with
-       different  options is that some definition files for autoloading
-       define multiple functions, including the function with the  same
-       name  as the file, and, at the end, call that function.  In such
-       cases the output of `zcompile -c' does  not  include  the  addi-
-       tional  functions defined in the file, and any other initializa-
-       tion code in the file is lost.  Using `zcompile -a' captures all
-       this extra information.
-
-       If  the  -m option is combined with -c or -a, the names are used
-       as patterns and all functions whose names  match  one  of  these
-       patterns  will  be written. If no name is given, the definitions
-       of all functions currently defined or marked as autoloaded  will
-       be written.
-
-       The  third  form,  with the -t option, examines an existing com-
-       piled file.  Without further arguments, the names of the  origi-
-       nal files compiled into it are listed.  The first line of output
-       shows the version of the shell which compiled the file  and  how
-       the file will be used (i.e. by reading it directly or by mapping
-       it into memory).  With arguments,  nothing  is  output  and  the
-       return  status  is set to zero if definitions for all names were
-       found in the compiled file, and non-zero if the  definition  for
-       at least one name was not found.
-
-       Other options:
-
-       -U     Aliases are not expanded when compiling the named files.
-
-       -R     When  the  compiled file is read, its contents are copied
-              into the shell's memory, rather than  memory-mapped  (see
-              -M).   This  happens automatically on systems that do not
-              support memory mapping.
-
-              When compiling scripts instead of autoloadable functions,
-              it  is  often desirable to use this option; otherwise the
-              whole file, including the code to define functions  which
-              have  already  been  defined,  will remain mapped, conse-
-              quently wasting memory.
-
-       -M     The compiled file is mapped into the shell's memory  when
-              read.  This is done in such a way that multiple instances
-              of the shell running on the same  host  will  share  this
-              mapped file.  If neither -R nor -M is given, the zcompile
-              builtin decides what to do based on the size of the  com-
-              piled file.
-
-       -k
-       -z     These  options  are  used when the compiled file contains
-              functions which are to be autoloaded. If -z is given, the
-              function will be autoloaded as if the KSH AUTOLOAD option
-                                                       -
-              is not set, even if it is set at the  time  the  compiled
-              file is read, while if the -k is given, the function will
-              be loaded as if KSH AUTOLOAD is set.  These options  also
-                                 -
-              take  precedence  over  any -k or -z options specified to
-              the autoload builtin. If  neither  of  these  options  is
-              given,  the  function will be loaded as determined by the
-              setting of the KSH AUTOLOAD option at the time  the  com-
-                                -
-              piled file is read.
-
-              These  options may also appear as many times as necessary
-              between the listed names to specify the loading style  of
-              all following functions, up to the next -k or -z.
-
-              The created file always contains two versions of the com-
-              piled format, one for big-endian  machines  and  one  for
-              small-endian  machines.   The  upshot of this is that the
-              compiled file is machine independent and if it is read or
-              mapped,  only  one half of the file is actually used (and
-              mapped).
diff -ruN zsh-5.0.4/Doc/help/zformat zsh-5.0.2/Doc/help/zformat
--- zsh-5.0.4/Doc/help/zformat	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zformat	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-zformat
-       See the section `The zsh/zutil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/zftp zsh-5.0.2/Doc/help/zftp
--- zsh-5.0.4/Doc/help/zftp	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zftp	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-zftp   See the section `The zsh/zftp Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/zle zsh-5.0.2/Doc/help/zle
--- zsh-5.0.4/Doc/help/zle	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zle	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-zle    See the section `Zle Builtins' in zshzle(1).
diff -ruN zsh-5.0.4/Doc/help/zmodload zsh-5.0.2/Doc/help/zmodload
--- zsh-5.0.4/Doc/help/zmodload	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zmodload	1969-12-31 16:00:00.000000000 -0800
@@ -1,305 +0,0 @@
-zmodload [ -dL ] [ ... ]
-zmodload -F [ -lLme -P param ] module [+-]feature...
-zmodload -e [ -A ] [ ... ]
-zmodload [ -a [ -bcpf [ -I ] ] ] [ -iL ] ...
-zmodload -u [ -abcdpf [ -I ] ] [ -iL ] ...
-zmodload -A [ -L ] [ modalias[=module] ... ]
-zmodload -R modalias ...
-       Performs operations relating to zsh's loadable modules.  Loading
-       of  modules  while the shell is running (`dynamical loading') is
-       not available on all operating systems, or on all  installations
-       on  a particular operating system, although the zmodload command
-       itself is always available and can be used to manipulate modules
-       built  into  versions  of the shell executable without dynamical
-       loading.
-
-       Without arguments the names of all currently loaded binary  mod-
-       ules  are  printed.  The -L option causes this list to be in the
-       form of a series of zmodload  commands.   Forms  with  arguments
-       are:
-
-       zmodload [ -i ] name ...
-       zmodload -u [ -i ] name ...
-              In  the  simplest  case,  zmodload loads a binary module.
-              The module must be in a file with a  name  consisting  of
-              the specified name followed by a standard suffix, usually
-              `.so' (`.sl' on HPUX).  If the module  to  be  loaded  is
-              already loaded the duplicate module is ignored.  If zmod-
-              load detects an inconsistency, such as an invalid  module
-              name  or circular dependency list, the current code block
-              is aborted.   Hence `zmodload module 2>/dev/null' is suf-
-              ficient  to test whether a module is available.  If it is
-              available, the module is loaded if necessary, while if it
-              is  not  available, non-zero status is silently returned.
-              The option -i is accepted for compatibility  but  has  no
-              effect.
-
-              The  named  module is searched for in the same way a com-
-              mand is, using $module path instead of  $path.   However,
-                                    -
-              the  path  search  is performed even when the module name
-              contains a `/', which it usually does.  There is  no  way
-              to prevent the path search.
-
-              If  the  module  supports  features (see below), zmodload
-              tries to enable all features when loading a  module.   If
-              the  module  was successfully loaded but not all features
-              could be enabled, zmodload returns status 2.
-
-              With -u, zmodload unloads modules.  The same name must be
-              given  that  was given when the module was loaded, but it
-              is not necessary for the module to exist in the file sys-
-              tem.  The -i option suppresses the error if the module is
-              already unloaded (or was never loaded).
-
-              Each module has a boot and a cleanup function.  The  mod-
-              ule will not be loaded if its boot function fails.  Simi-
-              larly a module can only be unloaded if its cleanup  func-
-              tion runs successfully.
-
-       zmodload -F [ -almLe -P param ] module [+-]feature...
-              zmodload  -F  allows more selective control over the fea-
-              tures provided by modules.  With no  options  apart  from
-              -F,  the  module  named  module  is loaded, if it was not
-              already loaded, and the list of features is  set  to  the
-              required state.  If no features are specified, the module
-              is loaded, if it was not already loaded, but the state of
-              features is unchanged.  Each feature may be preceded by a
-              + to turn the feature on, or - to turn it off; the  +  is
-              assumed if neither character is present.  Any feature not
-              explicitly mentioned is left in its current state; if the
-              module was not previously loaded this means any such fea-
-              tures will remain disabled.  The return status is zero if
-              all  features  were  set, 1 if the module failed to load,
-              and 2 if some features could not be set (for  example,  a
-              parameter couldn't be added because there was a different
-              parameter of the same name) but the module was loaded.
-
-              The standard features are builtins,  conditions,  parame-
-              ters  and math functions; these are indicated by the pre-
-              fix `b:', `c:' (`C:' for an infix  condition),  `p:'  and
-              `f:',  respectively, followed by the name that the corre-
-              sponding feature would have in the shell.   For  example,
-              `b:strftime'  indicates  a  builtin  named  strftime  and
-              p:EPOCHSECONDS indicates a parameter named  EPOCHSECONDS.
-              The module may provide other (`abstract') features of its
-              own as indicated by its documentation; these have no pre-
-              fix.
-
-              With  -l  or  -L,  features  provided  by  the module are
-              listed.  With -l alone, a list of features together  with
-              their  states  is  shown,  one feature per line.  With -L
-              alone, a zmodload -F command  that  would  cause  enabled
-              features  of  the  module to be turned on is shown.  With
-              -lL, a zmodload -F command that would cause all the  fea-
-              tures  to be set to their current state is shown.  If one
-              of these combinations is given the option -P  param  then
-              the  parameter  param  is  set  to  an array of features,
-              either features together with their state or (if -L alone
-              is given) enabled features.
-
-              With the option -L the module name may be omitted; then a
-              list of all enabled features for  all  modules  providing
-              features  is printed in the form of zmodload -F commands.
-              If -l is also given, the state of both enabled  and  dis-
-              abled features is output in that form.
-
-              A  set of features may be provided together with -l or -L
-              and a module name; in that case only the state  of  those
-              features  is considered.  Each feature may be preceded by
-              + or - but the character has no effect.   If  no  set  of
-              features is provided, all features are considered.
-
-              With  -e,  the  command  first  tests  that the module is
-              loaded; if it is not, status 1 is returned.  If the  mod-
-              ule  is loaded, the list of features given as an argument
-              is examined.  Any feature given with no prefix is  simply
-              tested  to  see  if  the  module provides it; any feature
-              given with a prefix + or - is tested to see  if  is  pro-
-              vided  and  in the given state.  If the tests on all fea-
-              tures in the list succeed, status  0  is  returned,  else
-              status 1.
-
-              With  -m,  each  entry  in  the given list of features is
-              taken as a pattern to be matched against the list of fea-
-              tures  provided by the module.  An initial + or - must be
-              given explicitly.  This may not be combined with  the  -a
-              option as autoloads must be specified explicitly.
-
-              With  -a,  the  given  list  of  features  is  marked for
-              autoload from the specified module, which may not yet  be
-              loaded.   An  optional  +  may  appear before the feature
-              name.  If the feature is prefixed with  -,  any  existing
-              autoload  is  removed.  The options -l and -L may be used
-              to list autoloads.  Autoloading is specific to individual
-              features;  when  the  module is loaded only the requested
-              feature is enabled.  Autoload requests are  preserved  if
-              the  module  is  subsequently  unloaded until an explicit
-              `zmodload -Fa module -feature' is issued.  It is  not  an
-              error  to  request  an autoload for a feature of a module
-              that is already loaded.
-
-              When the  module  is  loaded  each  autoload  is  checked
-              against  the features actually provided by the module; if
-              the feature is  not  provided  the  autoload  request  is
-              deleted.   A  warning message is output; if the module is
-              being loaded to provide a  different  feature,  and  that
-              autoload  is successful, there is no effect on the status
-              of the current command.  If the module is already  loaded
-              at the time when zmodload -Fa is run, an error message is
-              printed and status 1 returned.
-
-              zmodload -Fa can be used with  the  -l,  -L,  -e  and  -P
-              options   for   listing  and  testing  the  existence  of
-              autoloadable features.  In this case -l is ignored if  -L
-              is  specified.   zmodload  -FaL with no module name lists
-              autoloads for all modules.
-
-              Note that only standard features as described  above  can
-              be  autoloaded;  other  features require the module to be
-              loaded before enabling.
-
-       zmodload -d [ -L ] [ name ]
-       zmodload -d name dep ...
-       zmodload -ud name [ dep ... ]
-              The -d option can be used to specify module dependencies.
-              The  modules named in the second and subsequent arguments
-              will be loaded before the module named in the first argu-
-              ment.
-
-              With  -d and one argument, all dependencies for that mod-
-              ule are listed.  With -d and  no  arguments,  all  module
-              dependencies are listed.  This listing is by default in a
-              Makefile-like format.  The -L option changes this  format
-              to a list of zmodload -d commands.
-
-              If -d and -u are both used, dependencies are removed.  If
-              only one argument is given,  all  dependencies  for  that
-              module are removed.
-
-       zmodload -ab [ -L ]
-       zmodload -ab [ -i ] name [ builtin ... ]
-       zmodload -ub [ -i ] builtin ...
-              The  -ab  option defines autoloaded builtins.  It defines
-              the specified builtins.  When any of  those  builtins  is
-              called,  the  module  specified  in the first argument is
-              loaded and all its features are  enabled  (for  selective
-              control  of  features  use  `zmodload -F -a' as described
-              above).  If only  the  name  is  given,  one  builtin  is
-              defined, with the same name as the module.  -i suppresses
-              the  error  if  the  builtin  is   already   defined   or
-              autoloaded,  but  not if another builtin of the same name
-              is already defined.
-
-              With -ab and no arguments, all  autoloaded  builtins  are
-              listed,  with  the  module  name  (if different) shown in
-              parentheses  after  the  builtin  name.   The  -L  option
-              changes this format to a list of zmodload -a commands.
-
-              If  -b  is  used  together with the -u option, it removes
-              builtins previously defined with -ab.  This is only  pos-
-              sible  if  the  builtin is not yet loaded.  -i suppresses
-              the error if the builtin is  already  removed  (or  never
-              existed).
-
-              Autoload  requests  are  retained if the module is subse-
-              quently unloaded until an explicit `zmodload -ub builtin'
-              is issued.
-
-       zmodload -ac [ -IL ]
-       zmodload -ac [ -iI ] name [ cond ... ]
-       zmodload -uc [ -iI ] cond ...
-              The  -ac  option  is  used to define autoloaded condition
-              codes. The cond strings give the names of the  conditions
-              defined  by the module. The optional -I option is used to
-              define infix condition names. Without this option  prefix
-              condition names are defined.
-
-              If given no condition names, all defined names are listed
-              (as a series of zmodload commands if  the  -L  option  is
-              given).
-
-              The  -uc option removes definitions for autoloaded condi-
-              tions.
-
-       zmodload -ap [ -L ]
-       zmodload -ap [ -i ] name [ parameter ... ]
-       zmodload -up [ -i ] parameter ...
-              The -p option is like the -b and -c  options,  but  makes
-              zmodload work on autoloaded parameters instead.
-
-       zmodload -af [ -L ]
-       zmodload -af [ -i ] name [ function ... ]
-       zmodload -uf [ -i ] function ...
-              The  -f  option  is  like the -b, -p, and -c options, but
-              makes zmodload work on autoloaded math functions instead.
-
-       zmodload -a [ -L ]
-       zmodload -a [ -i ] name [ builtin ... ]
-       zmodload -ua [ -i ] builtin ...
-              Equivalent to -ab and -ub.
-
-       zmodload -e [ -A ] [ string ... ]
-              The -e option without arguments lists all loaded modules;
-              if  the  -A  option  is also given, module aliases corre-
-              sponding to loaded modules are also shown.  If  arguments
-              are  provided,  nothing  is printed; the return status is
-              set to zero if all strings given as arguments  are  names
-              of loaded modules and to one if at least on string is not
-              the name of a loaded module.  This can be  used  to  test
-              for  the  availability  of things implemented by modules.
-              In this case, any aliases are automatically resolved  and
-              the -A flag is not used.
-
-       zmodload -A [ -L ] [ modalias[=module] ... ]
-              For each argument, if both modalias and module are given,
-              define modalias to be an alias for the module module.  If
-              the  module  modalias  is  ever  subsequently  requested,
-              either via a call to zmodload or  implicitly,  the  shell
-              will  attempt  to  load module instead.  If module is not
-              given, show the definition of modalias.  If no  arguments
-              are  given,  list all defined module aliases.  When list-
-              ing, if the -L flag was also given, list  the  definition
-              as a zmodload command to recreate the alias.
-
-              The  existence of aliases for modules is completely inde-
-              pendent of whether the name resolved is  actually  loaded
-              as  a module: while the alias exists, loading and unload-
-              ing the module under  any  alias  has  exactly  the  same
-              effect  as  using  the resolved name, and does not affect
-              the connection between the alias and  the  resolved  name
-              which can be removed either by zmodload -R or by redefin-
-              ing the alias.  Chains of aliases (i.e. where  the  first
-              resolved  name  is  itself an alias) are valid so long as
-              these are not circular.  As the  aliases  take  the  same
-              format as module names, they may include path separators:
-              in this case, there is no requirement for any part of the
-              path  named to exist as the alias will be resolved first.
-              For example, `any/old/alias' is always a valid alias.
-
-              Dependencies added to aliased modules are actually  added
-              to  the  resolved  module;  these  remain if the alias is
-              removed.  It is valid to create an alias  whose  name  is
-              one of the standard shell modules and which resolves to a
-              different module.  However, if a module has dependencies,
-              it  will  not  be  possible  to use the module name as an
-              alias as the module will already be marked as a  loadable
-              module in its own right.
-
-              Apart from the above, aliases can be used in the zmodload
-              command anywhere module  names  are  required.   However,
-              aliases will not be shown in lists of loaded modules with
-              a bare `zmodload'.
-
-       zmodload -R modalias ...
-              For each modalias argument that was previously defined as
-              a module alias via zmodload -A, delete the alias.  If any
-              was not defined, an error is caused and the remainder  of
-              the line is ignored.
-
-       Note  that  zsh  makes  no distinction between modules that were
-       linked into the shell and modules that are  loaded  dynamically.
-       In both cases this builtin command has to be used to make avail-
-       able the builtins and other things defined  by  modules  (unless
-       the  module  is  autoloaded  on these definitions). This is true
-       even for systems that don't support dynamic loading of modules.
diff -ruN zsh-5.0.4/Doc/help/zparseopts zsh-5.0.2/Doc/help/zparseopts
--- zsh-5.0.4/Doc/help/zparseopts	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zparseopts	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-zparseopts
-       See the section `The zsh/zutil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/zprof zsh-5.0.2/Doc/help/zprof
--- zsh-5.0.4/Doc/help/zprof	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zprof	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-zprof  See the section `The zsh/zprof Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/zpty zsh-5.0.2/Doc/help/zpty
--- zsh-5.0.4/Doc/help/zpty	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zpty	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-zpty   See the section `The zsh/zpty Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/zregexparse zsh-5.0.2/Doc/help/zregexparse
--- zsh-5.0.4/Doc/help/zregexparse	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zregexparse	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-zregexparse
-       See the section `The zsh/zutil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/zsocket zsh-5.0.2/Doc/help/zsocket
--- zsh-5.0.4/Doc/help/zsocket	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zsocket	1969-12-31 16:00:00.000000000 -0800
@@ -1,2 +0,0 @@
-zsocket
-       See the section `The zsh/net/socket Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/zstyle zsh-5.0.2/Doc/help/zstyle
--- zsh-5.0.4/Doc/help/zstyle	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/zstyle	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-zstyle See the section `The zsh/zutil Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help/ztcp zsh-5.0.2/Doc/help/ztcp
--- zsh-5.0.4/Doc/help/ztcp	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help/ztcp	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-ztcp   See the section `The zsh/net/tcp Module' in zshmodules(1).
diff -ruN zsh-5.0.4/Doc/help.txt zsh-5.0.2/Doc/help.txt
--- zsh-5.0.4/Doc/help.txt	2013-12-20 10:21:47.000000000 -0800
+++ zsh-5.0.2/Doc/help.txt	1969-12-31 16:00:00.000000000 -0800
@@ -1,18 +0,0 @@
-functions autoload
-exit bye
-cd chdir
-typeset declare
-typeset float
-fc history
-typeset integer
-typeset local
-exit logout
-print pushln
-fc r
-typeset readonly
-hash rehash
-whence type
-unhash unalias
-unhash unfunction
-whence where
-whence which
diff -ruN zsh-5.0.4/Doc/version.yo zsh-5.0.2/Doc/version.yo
--- zsh-5.0.4/Doc/version.yo	2013-12-20 10:21:40.000000000 -0800
+++ zsh-5.0.2/Doc/version.yo	2012-12-21 11:33:00.000000000 -0800
@@ -1,6 +1,6 @@
 IFDEF(INCWSLEVEL)(INCWSLEVEL())(STARTDEF())
-def(version)(0)(5.0.4)
-def(date)(0)(December 20, 2013)
+def(version)(0)(5.0.2)
+def(date)(0)(December 21, 2012)
 def(zshenv)(0)(/etc/zshenv)
 def(zprofile)(0)(/etc/zprofile)
 def(zshrc)(0)(/etc/zshrc)
diff -ruN zsh-5.0.4/Doc/zmacros.yo zsh-5.0.2/Doc/zmacros.yo
--- zsh-5.0.4/Doc/zmacros.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/zmacros.yo	2006-03-20 03:06:24.000000000 -0800
@@ -33,7 +33,6 @@
 DEFINEMACRO(LPAR)(0)(CHAR(40))
 DEFINEMACRO(RPAR)(0)(CHAR(41))
 DEFINEMACRO(PLUS)(0)(CHAR(43))
-DEFINEMACRO(LSQUARE)(0)(CHAR(91))
 
 DEFINEMACRO(DASH)(0)(ifztexi(--)ifnztexi(-))
 
diff -ruN zsh-5.0.4/Doc/zsh.1 zsh-5.0.2/Doc/zsh.1
--- zsh-5.0.4/Doc/zsh.1	2013-12-20 10:21:40.000000000 -0800
+++ zsh-5.0.2/Doc/zsh.1	2012-12-21 11:33:00.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSH" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSH" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zsh \- the Z shell
 .\" Yodl file: Zsh/intro.yo
diff -ruN zsh-5.0.4/Doc/zsh.texi zsh-5.0.2/Doc/zsh.texi
--- zsh-5.0.4/Doc/zsh.texi	2013-12-20 10:21:50.000000000 -0800
+++ zsh-5.0.2/Doc/zsh.texi	2012-12-21 11:33:06.000000000 -0800
@@ -20,7 +20,7 @@
 @ifinfo
 @dircategory Utilities
 @direntry
-* ZSH: (zsh).                     The Z Shell Manual.
+     * ZSH: (zsh).                     The Z Shell Manual.
 @end direntry
 @end ifinfo
 
@@ -29,8 +29,8 @@
 @end iftex
 @titlepage
 @title The Z Shell Manual
-@subtitle Version 5.0.4
-@subtitle Updated December 20, 2013
+@subtitle Version 5.0.2
+@subtitle Updated December 21, 2012
 @author Original documentation by Paul Falstad
 @page
 This is a texinfo version of the documentation for the Z Shell, originally by 
@@ -63,7 +63,7 @@
 
 @noindent
 @cindex version
-Version 5.0.4, last updated December 20, 2013.
+Version 5.0.2, last updated December 21, 2012.
 @end ifinfo
 
 @menu
@@ -430,8 +430,8 @@
 @item @t{<zsh-announce-unsubscribe@@zsh.org>}
 @item @t{<zsh-users-unsubscribe@@zsh.org>}
 @item @t{<zsh-workers-unsubscribe@@zsh.org>}
+@item
 @end table
-@sp 1
 
 @noindent
 YOU ONLY NEED TO JOIN ONE OF THE MAILING LISTS AS THEY ARE NESTED.
@@ -1080,8 +1080,8 @@
 @item @t{/etc/zshrc}
 @item @t{/etc/zlogin}
 @item @t{/etc/zlogout}    (installation-specific - @t{/etc} is the default)
+@item
 @end table
-@sp 1
 @c (avoiding a yodl bug)
 
 @noindent
@@ -1651,8 +1651,8 @@
 @item Errors in variable substitution syntax
 @item Failure to convert characters in @t{$'}...@t{'} expressions
 similar options
+@item
 @end table
-@sp 1
 
 @noindent
 If the @t{POSIX_BUILTINS} option is set, more errors associated with
@@ -2572,17 +2572,9 @@
 line (so that any terminating newline will still be present).
 
 @noindent
-If any of the hook functions returns status 1 (or any non-zero value
-other than 2, though this is not guaranteed for future versions of the
-shell) the history line will not be saved, although it lingers in the
-history until the next line is executed, allowing you to reuse or edit
-it immediately.
-
-@noindent
-If any of the hook functions returns status 2 the history line
-will be saved on the internal history list, but not written to
-the history file.  In case of a conflict, the first non-zero status
-value is taken.
+If any of the hook functions return a non-zero value the history
+line will not be saved, although it lingers in the history until the
+next line is executed allow you to reuse or edit it immediately.
 
 @noindent
 A hook function may call `@t{fc -p} @var{...}' to switch the history
@@ -2592,13 +2584,10 @@
 of the history line is finished.
 
 @noindent
-The following example function works with one of the options
-@t{INC_APPEND_HISTORY} or @t{SHARE_HISTORY} set, in order that the line
-is written out immediately after the history entry is added.  It first
-adds the history line to the normal history with the newline stripped,
-which is usually the correct behaviour.  Then it switches the history
-context so that the line will be written to a history file in the
-current directory.
+The following example function first adds the history line to the normal
+history with the newline stripped,  which is usually the correct behaviour.
+Then it switches the history context so that the line will
+be written to a history file in the current directory.
 
 @noindent
 @example
@@ -2884,20 +2873,6 @@
 Otherwise, signals have the values
 inherited by the shell from its parent
 (but see the @t{TRAP}@var{NAL} special functions in @ref{Functions}).
-
-@noindent
-@cindex exiting shell, and asynchronous jobs
-@cindex asynchronous jobs, and exiting shell
-@cindex jobs, asynchronous, and exiting shell
-Certain jobs are run asynchronously by the shell other than those
-explicitly put into the background; even in cases where the shell
-would usually wait for such jobs, an explicit @t{exit} command
-or exit due to the option @t{ERR_EXIT} will cause the shell to
-exit without waiting.  Examples of such asynchronous jobs are
-process substitution, see
-@ref{Process Substitution}, and the handler processes for
-multios, see
-the section Multios in @ref{Redirection}.
 @c (avoiding a yodl bug)
 @c Yodl file: Zsh/arith.yo
 @node Arithmetic Evaluation, Conditional Expressions, Jobs & Signals, Top
@@ -3549,12 +3524,10 @@
 specifies leading components, i.e. @t{%-1d} specifies the first component.
 
 @item @t{%~}
-As @t{%d} and @t{%/}, but if the current working directory starts with
-@t{$HOME}, that part is replaced by a `@t{~}'. Furthermore, if it has a named
+As @t{%d} and @t{%/}, but if the current working directory has a named
 directory as its prefix, that part is replaced by a `@t{~}' followed by
-the name of the directory, but only if the result is shorter than
-the full path; 
-@ref{Filename Expansion}.
+the name of the directory.  If it starts with @t{$HOME}, that part is
+replaced by a `@t{~}'.
 
 @item @t{%h}
 @itemx @t{%!}
@@ -3898,8 +3871,6 @@
 History expansion allows you to use words from previous command
 lines in the command line you are typing.  This simplifies spelling
 corrections and the repetition of complicated commands or arguments.
-
-@noindent
 @vindex HISTSIZE, use of
 Immediately before execution, each command is saved in the history list,
 the size of which is controlled by the @t{HISTSIZE} parameter.  The one
@@ -4687,8 +4658,6 @@
 the length in characters of the result instead of
 the result itself.  If @var{spec} is an array expression,
 substitute the number of elements of the result.
-This has the side-effect that joining is skipped even in quoted
-forms, which may affect other sub-expressions in @var{spec}.
 Note that `@t{^}', `@t{=}', and `@t{~}', below, must appear
 to the left of `@t{#}' when these forms are combined.
 
@@ -4819,12 +4788,11 @@
 Create an array parameter with `@t{$@{}...@t{=}...@t{@}}',
 `@t{$@{}...@t{:=}...@t{@}}' or `@t{$@{}...@t{::=}...@t{@}}'.
 If this flag is repeated (as in `@t{AA}'), create an associative
-array parameter.  Assignment is made before sorting or padding;
-if field splitting is active, the @var{word} part is split before
-assignment.  The @var{name} part may be a subscripted range for
-ordinary arrays; the @var{word} part @emph{must} be converted to
-an array, for example by using `@t{$@{(AA)=}@var{name}@t{=}...@t{@}}'
-to activate field splitting, when creating an associative array.
+array parameter.  Assignment is made before sorting or padding.
+The @var{name} part may be a subscripted range for ordinary
+arrays; the @var{word} part @emph{must} be converted to an array, for
+example by using `@t{$@{(AA)=}@var{name}@t{=}...@t{@}}' to activate
+field splitting, when creating an associative array.
 
 @item @t{a}
 Sort in array index order; when combined with `@t{O}' sort in reverse
@@ -4834,9 +4802,7 @@
 
 @item @t{c}
 With @t{$@{#}@var{name}@t{@}}, count the total number of characters in an array,
-as if the elements were concatenated with spaces between them.  This is not
-a true join of the array, so other expressions used with this flag may have
-an effect on the elements of the array before it is counted.
+as if the elements were concatenated with spaces between them.
 
 @item @t{C}
 Capitalize the resulting words.  `Words' in this case refers to sequences
@@ -5291,8 +5257,7 @@
 subscript.  Thus if @t{var} is an array, @t{$@{var[1][2]@}} is the second
 character of the first word, but @t{$@{var[2,4][2]@}} is the entire third
 word (the second word of the range of words two through four of the
-original array).  Any number of subscripts may appear.  Flags such as
-@t{(k)} and @t{(v)} which alter the result of subscripting are applied.
+original array).  Any number of subscripts may appear.
 
 @item @t{4.} @emph{Parameter name replacement}
 The effect of any @t{(P)} flag, which treats the value so far as a
@@ -5300,12 +5265,11 @@
 
 @item @t{5.} @emph{Double-quoted joining}
 If the value after this process is an array, and the substitution
-appears in double quotes, and neither an @t{(@@)} flag nor a @t{#}
-length operator is present at the current level, then words of the
-value are joined with the first character of the parameter @t{$IFS},
-by default a space, between each word (single word arrays are not
-modified).  If the @t{(j)} flag is present, that is used for joining
-instead of @t{$IFS}.
+appears in double quotes, and no @t{(@@)} flag is present at the current
+level, the words of the value are joined with the first character of the
+parameter @t{$IFS}, by default a space, between each word (single word
+arrays are not modified).  If the @t{(j)} flag is present, that is used for
+joining instead of @t{$IFS}.
 
 @item @t{6.} @emph{Nested subscripting}
 Any remaining subscripts (i.e. of a nested substitution) are evaluated at
@@ -5731,14 +5695,14 @@
 @t{hash} builtin.
 
 @noindent
-When the shell prints a path (e.g. when expanding @t{%~} in prompts or when
-printing the directory stack), the path is checked to see if it has a named
-directory as its prefix.  If so, then the prefix portion is replaced with a
-`@t{~}' followed by the name of the directory.
-The shorter of the two ways of referring to the directory is used,
-i.e. either the directory name or the full path; the name is used
-if they are the same length.
-The parameters @t{$PWD} and @t{$OLDPWD} are never abbreviated in this fashion.
+In certain circumstances (in prompts, for instance), when the shell
+prints a path, the path is checked to see if it has a named
+directory as its prefix.  If so, then the prefix portion
+is replaced with a `@t{~}' followed by the name of the directory.
+The shortest way of referring to the directory is used,
+with ties broken in favour of using a named directory,
+except when the directory is @t{/} itself.  The parameters @t{$PWD} and
+@t{$OLDPWD} are never abbreviated in this fashion.
 
 @noindent
 
@@ -6002,12 +5966,10 @@
 Match the pattern in the parentheses.  (Like `@t{(}...@t{)}'.)
 
 @item @t{*(}...@t{)}
-Match any number of occurrences.  (Like `@t{(}...@t{)#}',
-except that recursive directory searching is not supported.)
+Match any number of occurrences.  (Like `@t{(}...@t{)#}'.)
 
 @item @t{+(}...@t{)}
-Match at least one occurrence.  (Like `@t{(}...@t{)##}',
-except that recursive directory searching is not supported..)
+Match at least one occurrence.  (Like `@t{(}...@t{)##}'.)
 
 @item @t{?(}...@t{)}
 Match zero or one occurrence.  (Like `@t{(|}...@t{)}'.)
@@ -7322,16 +7284,9 @@
 @ref{Invocation}, and also @ref{Functions}.
 The parameter @var{n}, where @var{n} is a number,
 is the @var{n}th positional parameter.
-The parameter `@t{$0}' is a special case, see
-@ref{Parameters Set By The Shell}.
-
-@noindent
 The parameters @t{*}, @t{@@} and @t{argv} are
 arrays containing all the positional parameters;
 thus `@t{$argv[}@var{n}@t{]}', etc., is equivalent to simply `@t{$}@var{n}'.
-Note that the options @t{KSH_ARRAYS} or @t{KSH_ZERO_SUBSCRIPT} apply
-to these arrays as well, so with either of those options set,
-`@t{$@{argv[0]@}}' is equivalent to `@t{$1}' and so on.
 
 @noindent
 Positional parameters may be changed after the shell or function starts by
@@ -7888,16 +7843,6 @@
 The file to save the history in when an interactive shell exits.
 If unset, the history is not saved.
 
-@vindex HISTORY_IGNORE
-@item @t{HISTORY_IGNORE}
-If set, is treated as a pattern at the time history files are written.
-Any potential history entry that matches the pattern is skipped.  For
-example, if the value is `@t{fc *}' then commands that invoke the
-interactive history editor are never written to the history file (compare
-the @t{HIST_NO_STORE} option or the @t{zshaddhistory} hook, either of
-which would prevent such commands from being added to the interactive
-history at all).
-
 @vindex HISTSIZE
 @item @t{HISTSIZE} <S>
 The maximum number of events stored in the internal history list.
@@ -8146,7 +8091,7 @@
 @vindex psvar
 @vindex PSVAR
 @item @t{psvar} <S> <Z> (@t{PSVAR} <S>)
-An array (colon-separated list) whose elements can be used in
+An array (colon-separated list) whose first nine values can be used in
 @t{PROMPT} strings.  Setting @t{psvar} also sets @t{PSVAR}, and
 vice versa.
 
@@ -8497,20 +8442,6 @@
 See the completion system documentation in
 @ref{Completion System}.
 
-@vindex ZLE_RPROMPT_INDENT
-@item @t{ZLE_RPROMPT_INDENT <S>}
-If set, used to give the indentation between the right hand side of
-the right prompt in the line editor as given by @t{RPS1} or @t{RPROMPT}
-and the right hand side of the screen.  If not set, the value 1 is used.
-
-@noindent
-Typically this will be used to set the value to 0 so that the prompt
-appears flush with the right hand side of the screen.  This is not the
-default as many terminals do not handle this correctly, in particular
-when the prompt appears at the extreme bottom right of the screen.
-Recent virtual terminals are more likely to handle this case correctly.
-Some experimentation is necessary.
-
 @end table
 @c (avoiding a yodl bug)
 @c Yodl file: Zsh/options.yo
@@ -9023,17 +8954,6 @@
 for filename generation, etc.  (An initial unquoted `@t{~}'
 always produces named directory expansion.)
 
-@pindex FORCE_FLOAT
-@pindex NO_FORCE_FLOAT
-@pindex FORCEFLOAT
-@pindex NOFORCEFLOAT
-@cindex floating point, forcing use of
-@cindex forcing use of floating point
-@item @t{FORCE_FLOAT}
-Constants in arithmetic evaluation will be treated as floating point
-even without the use of a decimal point.  Integers in any base
-will be converted.
-
 @pindex GLOB
 @pindex NO_GLOB
 @pindex NOGLOB
@@ -9807,7 +9727,6 @@
 @cindex exit status, printing
 @item @t{PRINT_EXIT_VALUE} (@t{-1})
 Print the exit value of programs with non-zero exit status.
-This is only available at the command line in interactive shells.
 
 @pindex RC_QUOTES
 @pindex NO_RC_QUOTES
@@ -10134,11 +10053,6 @@
 on exit, then the command for which the @t{DEBUG} trap is being executed is
 skipped.  The option is restored after the trap exits.
 
-@noindent
-Exiting due to @t{ERR_EXIT} has certain interactions with asynchronous
-jobs noted in
-@ref{Jobs & Signals}.
-
 @pindex ERR_RETURN
 @pindex NO_ERR_RETURN
 @pindex ERRRETURN
@@ -10203,19 +10117,6 @@
 with a formulation like `@t{emulate -L zsh}'; the @t{-L} activates
 @t{LOCAL_OPTIONS}.
 
-@pindex LOCAL_PATTERNS
-@pindex NO_LOCAL_PATTERNS
-@pindex LOCALPATTERNS
-@pindex NOLOCALPATTERNS
-@item @t{LOCAL_PATTERNS}
-If this option is set at the point of return from a shell function,
-the state of pattern disables, as set with the builtin command
-`@t{disable -p}', is restored to what it was when the function was
-entered.  The behaviour of this option is similar to the effect
-of @t{LOCAL_OPTIONS} on options; hence `@t{emulate -L sh}' (or
-indeed any other emulation with the @t{-L} option) activates
-@t{LOCAL_PATTERNS}.
-
 @pindex LOCAL_TRAPS
 @pindex NO_LOCAL_TRAPS
 @pindex LOCALTRAPS
@@ -10273,20 +10174,6 @@
 component in `@t{08#77}' are always interpreted as decimal, regardless
 of leading zeroes.
 
-@pindex PIPE_FAIL
-@pindex NO_PIPE_FAIL
-@pindex PIPEFAIL
-@pindex NOPIPEFAIL
-@cindex exit status from pipeline
-@cindex status, on exit from pipeline
-@cindex pipeline, exit status from
-@item @t{PIPE_FAIL}
-By default, when a pipeline exits the exit status recorded by the shell
-and returned by the shell variable @t{$?} reflects that of the
-rightmost element of a pipeline.  If this option is set, the exit status
-instead reflects the status of the rightmost element of the pipeline
-that was non-zero, or zero if all elements exited with zero status.
-
 @pindex SOURCE_TRACE
 @pindex NO_SOURCE_TRACE
 @pindex SOURCETRACE
@@ -11176,45 +11063,6 @@
 @noindent
 @cindex builtin commands
 @cindex commands, builtin
-
-Some shell builtin commands take options as described in individual
-entries; these are often referred to in the list below as `@t{flags}' to
-avoid confusion with shell options, which may also have an effect on the
-behaviour of builtin commands.  In this introductory section,
-`@t{option}' always has the meaning of an option to a command that should
-be familiar to most command line users.
-
-@noindent
-Typically, options are single letters preceded by a hyphen (@t{-}).
-Options that take an argument accept it either immediately following the
-option letter or after white space, for example `@t{print -C3 *}' or
-`@t{print -C 3 *}' are equivalent.  Arguments to options are not the
-same as arguments to the command; the documentation indicates which is
-which.  Options that do not take an argument may be combined in a single
-word, for example `@t{print -ca *}' and `@t{print -c -a *}' are
-equivalent.
-
-@noindent
-Some shell builtin commands also take options that begin with `@t{+}'
-instead of `@t{-}'.  The list below makes clear which commands these
-are.
-
-@noindent
-Options (together with their individual arguments, if any) must appear
-in a group before any non-option arguments; once the first non-option
-argument has been found, option processing is terminated.
-
-@noindent
-All builtin commands other than precommand modifiers, even those that
-have no options, can be given the argument `@t{--}' to terminate option
-processing.  This indicates that the following words are non-option
-arguments, but is otherwise ignored.  This is useful in cases where
-arguments to the command may begin with `@t{-}'.  For historical
-reasons, most builtin commands also recognize a single `@t{-}' in a
-separate word for this purpose; note that this is less standard and
-use of `@t{--} is recommended.
-
-@noindent
 @table @asis
 @item @t{-} @var{simple command}
 See @ref{Precommand Modifiers}.
@@ -11260,7 +11108,7 @@
 occur in command position.
 
 @noindent
-If the @t{-s} flag is present, define a suffix alias: if the command
+If the @t{-s} flags is present, define a suffix alias: if the command
 word on a command line is in the form `@var{text}@t{.}@var{name}', where
 @var{text} is any non-empty string, it is replaced by the text
 `@var{value} @var{text}@t{.}@var{name}'.  Note that @var{name} is treated as
@@ -11529,7 +11377,7 @@
 clear the directory stack.
 
 @item @t{-l}
-print directory names in full instead of using of using @t{~} expressions (@ref{Filename Expansion}).
+print directory names in full instead of using of using @t{~} expressions.
 
 @item @t{-p}
 print directory entries one per line.
@@ -11544,8 +11392,8 @@
 @findex disable
 @cindex disabling commands
 @cindex commands, disabling
-@item @t{disable} [ @t{-afmprs} ] @var{name} ...
-Temporarily disable the @var{name}d hash table elements or patterns.  The default
+@item @t{disable} [ @t{-afmrs} ] @var{name} ...
+Temporarily disable the @var{name}d hash table elements.  The default
 is to disable builtin commands.  This allows you to use an external
 command with the same name as a builtin command.  The @t{-a} option
 causes @t{disable} to act on regular or global aliases.  The @t{-s}
@@ -11559,83 +11407,6 @@
 are disabled.  Disabled objects can be enabled with the @t{enable}
 command.
 
-@noindent
-With the option @t{-p}, @var{name} ... refer to elements of the
-shell's pattern syntax as described in @ref{Filename Generation}.
-Certain elements can be disabled separately, as given below.
-
-@noindent
-Note that patterns
-not allowed by the current settings for the options @t{EXTENDED_GLOB},
-@t{KSH_GLOB} and @t{SH_GLOB} are never enabled, regardless of the
-setting here.  For example, if @t{EXTENDED_GLOB} is not active,
-the pattern @t{^} is ineffective even if `@t{disable -p "^"}' has
-not been issued.  The list below indicates any option settings
-that restrict the use of the pattern.  It should be noted that
-setting @t{SH_GLOB} has a wider effect then merely disabling patterns
-as certain expressions, in particular those involving parentheses,
-are parsed differently.
-
-@noindent
-The following patterns may be disabled; all
-the strings need quoting on the command line to prevent them from
-being interpreted immediately as patterns and the patterns are
-shown below in single quotes as a reminder.
-@table @asis
-@item @t{'?'}
-The pattern character @t{?} wherever it occurs, including when preceding
-a parenthesis with @t{KSH_GLOB}.
-
-@item @t{'*'}
-The pattern character @t{*} wherever it occurs, including recursive
-globbing and when preceding a parenthesis with @t{KSH_GLOB}.
-
-@item '['
-Character classes.
-
-@item @t{'<'} (@t{NO_SH_GLOB})
-Numeric ranges.
-
-@item @t{'|'} (@t{NO_SH_GLOB})
-Alternation in grouped patterns, case statements, or KSH_GLOB
-parenthesised expressions.
-
-@item @t{'('} (@t{NO_SH_GLOB})
-Grouping using single parentheses.  Disabling this does not disable the
-use of parentheses for @t{KSH_GLOB} where they are introduced by a
-special character, nor for glob qualifiers (use `@t{setopt
-NO_BARE_GLOB_QUAL}' to disable glob qualifiers that use parentheses
-only).
-
-@item @t{'~'} (@t{EXTENDED_GLOB})
-Exclusion in the form @var{A}@t{~}@var{B}.
-
-@item @t{'^'} (@t{EXTENDED_GLOB})
-Exclusion in the form @var{A}@t{^}@var{B}.
-
-@item @t{'#'} (@t{EXTENDED_GLOB})
-The pattern character @t{#} wherever it occurs, both for
-repetition of a previous pattern and for indicating globbing flags.
-
-@item @t{'?('} (@t{KSH_GLOB})
-The grouping form @t{?(}@var{...}@t{)}.  Note this is also
-disabled if @t{'?'} is disabled.
-
-@item @t{'*('} (@t{KSH_GLOB})
-The grouping form @t{*(}@var{...}@t{)}.  Note this is also
-disabled if @t{'*'} is disabled.
-
-@item @t{'+('} (@t{KSH_GLOB})
-The grouping form @t{+(}@var{...}@t{)}.
-
-@item @t{'!('} (@t{KSH_GLOB})
-The grouping form @t{!(}@var{...}@t{)}.
-
-@item @t{'@@('} (@t{KSH_GLOB})
-The grouping form @t{@@(}@var{...}@t{)}.
-
-@end table
-
 @findex disown
 @cindex jobs, disowning
 @item @t{disown} [ @var{job} ... ]
@@ -11723,9 +11494,7 @@
 argument are the same as those used to determine the emulation at startup
 based on the shell name, see
 @ref{Compatibility}
-.  In addition to setting shell options, the command also restores
-the pristine state of pattern enables, as if all patterns had been
-enabled using @t{enable -p}.
+.
 
 @noindent
 If the @t{emulate} command occurs inside a function that has been
@@ -11741,11 +11510,9 @@
 mode, except for certain options describing the interactive
 environment; otherwise, only those options likely to cause portability
 problems in scripts and functions are altered.  If the @t{-L} switch is given,
-the options @t{LOCAL_OPTIONS}, @t{LOCAL_PATTERNS} and @t{LOCAL_TRAPS}
-will be set as
-well, causing the effects of the @t{emulate} command and any @t{setopt},
-@t{disable -p} or @t{enable -p}, and @t{trap} commands to be local to
-the immediately surrounding shell
+the options @t{LOCAL_OPTIONS} and @t{LOCAL_TRAPS} will be set as
+well, causing the effects of the @t{emulate} command and any @t{setopt} and
+@t{trap} commands to be local to the immediately surrounding shell
 function, if any; normally these options are turned off in all emulation
 modes except @t{ksh}. The @t{-L} switch is mutually exclusive with the
 use of @t{-c} in @var{flags}.
@@ -11769,8 +11536,7 @@
 within the evaluated expression:  the emulation mode is associated
 thereafter with the function so that whenever the function is executed
 the emulation (respecting the @t{-R} switch, if present) and all
-options are set (and pattern disables cleared)
-before entry to the function, and the state is restored after exit.
+options are set before entry to the function, and restored after exit.
 If the function is called when the sticky emulation is already in
 effect, either within an `@t{emulate} @var{shell} @t{-c}' expression or
 within another function with the same sticky emulation, entry and exit
@@ -11838,7 +11604,7 @@
 @findex enable
 @cindex enabling commands
 @cindex commands, enabling
-@item @t{enable} [ @t{-afmprs} ] @var{name} ...
+@item @t{enable} [ @t{-afmrs} ] @var{name} ...
 Enable the @var{name}d hash table elements, presumably disabled
 earlier with @t{disable}.  The default is to enable builtin commands.
 The @t{-a} option causes @t{enable} to act on regular or global aliases.
@@ -11851,14 +11617,6 @@
 hash table matching these patterns are enabled.  Enabled objects can be
 disabled with the @t{disable} builtin command.
 
-@noindent
-@t{enable -p} reenables patterns disabled with @t{disable -p}.  Note
-that it does not override globbing options; for example, `@t{enable -p
-"~"}' does not cause the pattern character @t{~} to be active unless
-the @t{EXTENDED_GLOB} option is also set.  To enable all possible
-patterns (so that they may be invidually disabled with @t{disable -p}),
-use `@t{setopt EXTENDED_GLOB KSH_GLOB NO_SH_GLOB}'.
-
 @findex eval
 @cindex evaluating arguments as commands
 @item @t{eval} [ @var{arg} ... ]
@@ -11883,11 +11641,6 @@
 An EOF condition will also cause the shell to exit, unless
 the @t{IGNORE_EOF} option is set.
 
-@noindent
-See notes at the end of
-@ref{Jobs & Signals} for some possibly unexpected interactions
-of the @t{exit} command with jobs.
-
 @findex export
 @item @t{export} [ @var{name}[@t{=}@var{value}] ... ]
 The specified @var{name}s are marked for automatic export
@@ -12302,8 +12055,6 @@
 Maximum value for a file descriptor.
 @item @t{filesize}
 Largest single file allowed.
-@item @t{kqueues}
-Maximum number of kqueues allocated.
 @item @t{maxproc}
 Maximum number of processes.
 @item @t{maxpthreads}
@@ -12314,10 +12065,6 @@
 Maximum resident set size.
 @item @t{msgqueue}
 Maximum number of bytes in POSIX message queues.
-@item @t{posixlocks}
-Maximum number of POSIX locks per user.
-@item @t{pseudoterminals}
-Maximum number of pseudo-terminals.
 @item @t{resident}
 Maximum resident set size.
 @item @t{sigpending}
@@ -12326,8 +12073,6 @@
 Maximum size of all socket buffers.
 @item @t{stacksize}
 Maximum stack size for each process.
-@item @t{swapsize}
-Maximum amount of swap used.
 @item @t{vmemorysize}
 Maximum amount of virtual memory.
 @end table
@@ -12436,8 +12181,8 @@
 arguments are printed with the row incrementing first.
 
 @item @t{-D}
-Treat the arguments as paths, replacing directory prefixes with @t{~}
-expressions corresponding to directory names, as appropriate.
+Treat the arguments as directory names, replacing prefixes with @t{~}
+expressions, as appropriate.
 
 @item @t{-i}
 If given together with @t{-o} or @t{-O}, sorting is performed
@@ -13274,7 +13019,7 @@
 @findex ulimit
 @cindex resource limits
 @cindex limits, resource
-@item @t{ulimit} [ [ @t{-SHacdfiklmnpqsTtvwx} | @t{-N} @var{resource} [ @var{limit} ] ... ]
+@item @t{ulimit} [ [ @t{-SHacdfilmnpqrstvx} | @t{-N} @var{resource} [ @var{limit} ] ... ]
 Set or display resource limits of the shell and the processes started by
 the shell.  The value of @var{limit} can be a number in the unit specified
 below or one of the values `@t{unlimited}', which removes the limit on the
@@ -13317,31 +13062,25 @@
 512-byte blocks on the size of files written.
 @item @t{-i}
 The number of pending signals.
-@item @t{-k}
-The number of kqueues allocated.
 @item @t{-l}
 Kilobytes on the size of locked-in memory.
 @item @t{-m}
 Kilobytes on the size of physical memory.
 @item @t{-n}
 open file descriptors.
-@item @t{-p}
-The number of pseudo-terminals.
 @item @t{-q}
 Bytes in POSIX message queues.
 @item @t{-s}
 Kilobytes on the size of the stack.
-@item @t{-T}
-The number of simultaneous threads available to the user.
 @item @t{-t}
 CPU seconds to be used.
+@item @t{-r}
+The number of simultaneous threads available to the user.
 @item @t{-u}
 The number of processes available to the user.
 @item @t{-v}
 Kilobytes on the size of virtual memory.  On some systems this
 refers to the limit called `address space'.
-@item @t{-w}
-Kilobytes on the size of swapped out memory.
 @item @t{-x}
 The number of locks on files.
 @end table
@@ -14342,7 +14081,6 @@
 @cindex editing parameters
 @item @t{vared} [ @t{-Aache} ] [ @t{-p} @var{prompt} ] [ @t{-r} @var{rprompt} ]
 @itemx   [ @t{-M} @var{main-keymap} ] [ @t{-m} @var{vicmd-keymap} ]
-@itemx   [ @t{-i} @var{init-widget} ] [ @t{-f} @var{finish-widget} ]
 @itemx   [ @t{-t} @var{tty} ] @var{name}
 The value of the parameter @var{name} is loaded into the edit
 buffer, and the line editor is invoked.  When the editor exits,
@@ -14383,11 +14121,6 @@
 previous keymaps will be restored.
 
 @noindent
-@t{Vared} calls the usual `@t{zle-line-init}' and `@t{zle-line-finish}'
-hooks before and after it takes control. Using the @t{-i} and @t{-f}
-options, it is possible to replace these with other custom widgets.
-
-@noindent
 If `@t{-t} @var{tty}' is given, @var{tty} is the name of a terminal device
 to be used instead of the default @t{/dev/tty}.  If @var{tty} does not
 refer to a terminal an error is reported.
@@ -14413,7 +14146,7 @@
 @itemx @t{zle} @t{-M} @var{string}
 @itemx @t{zle} @t{-U} @var{string}
 @itemx @t{zle} @t{-K} @var{keymap}
-@itemx @t{zle} @t{-F} [ @t{-L} | @t{-w} ] [ @var{fd} [ @var{handler} ] ]
+@itemx @t{zle} @t{-F} [ @t{-L} ] [ @var{fd} [ @var{handler} ] ]
 @itemx @t{zle} @t{-I}
 @itemx @t{zle} @t{-T} [ @t{tc} @var{function} | @t{-r} @t{tc} | @t{-L} ] 
 @itemx @t{zle} @var{widget} @t{[ -n} @var{num} @t{]} @t{[ -Nw ] [ -K} @var{keymap} @t{]} @var{args} ...
@@ -14535,7 +14268,7 @@
 within this invocation of ZLE.  Any following invocation (e.g., the next
 command line) will start as usual with the `@t{main}' keymap selected.
 
-@item @t{-F} [ @t{-L} | @t{-w} ] [ @var{fd} [ @var{handler} ] ]
+@item @t{-F} [ @t{-L} ] [ @var{fd} [ @var{handler} ] ]
 Only available if your system supports one of the `poll' or `select' system
 calls; most modern systems do.
 
@@ -14552,14 +14285,6 @@
 arrangements for handling the file descriptor when zle is not active.
 
 @noindent
-If the option @t{-w} is also given, the @var{handler} is instead a
-line editor widget, typically a shell function made into a widget using
-@t{zle -N}.  In that case @var{handler} can use all the facilities of
-zle to update the current editing line.  Note, however, that as handling
-@var{fd} takes place at a low level changes to the display will not
-automatically appear; the widget should call @t{zle -R} to force redisplay.
-
-@noindent
 Any number of handlers for any number of readable file descriptors may be
 installed.  Installing a handler for an @var{fd} which is already handled
 causes the existing handler to be replaced.
@@ -14960,8 +14685,8 @@
 used for contexts in the parameter @t{zle_highlight},
 @ref{Character Highlighting};
 for example, @t{standout} or @t{fg=red,bold}.
+@item
 @end table
-@sp 1
 
 @noindent
 For example, 
@@ -21816,28 +21541,14 @@
 different name for the argument context field.
 
 @findex _arguments
-@item @t{_arguments} [ @t{-nswWCRS} ] [ @t{-A} @var{pat} ] [ @t{-O} @var{name} ] [ @t{-M} @var{matchspec} ] [ @t{:} ] @var{spec}...
-@itemx @t{_arguments} [ @var{opts}... ] @t{-}@t{-} [ -i @var{pats} ] [ @t{-s} @var{pair} ] [ @var{helpspec}... ]
-This function can be used to give a complete specification for completion
-for a command whose arguments follow standard UNIX option and argument
-conventions.  Options to @t{_arguments} itself must be in separate words,
-i.e. @t{-s -w}, not @t{-sw}.
-
-@noindent
-When calling @t{_arguments}, all @var{spec}s that describe options of the
-analyzed command line must precede all @var{spec}s that describe non-option
-(aka "normal") arguments of the analyzed line.  To avoid ambiguity, all
-options to @t{_arguments} itself may be separated from the @var{spec} forms
-by a single colon.
-
-@noindent
-The @t{-s -w -W -A} and @t{-S} options describe how parsing of the command
-line should proceed, and are discussed in context below.  The `@t{-}@t{-}'
-form is used to intuit @var{spec} forms from the help output of the command
-being analyzed, and is described in detail below.  The @var{opts} for the
-`@t{-}@t{-}' form are otherwise the same options as the first form.  Note
-that `@t{-s}' following `@t{-}@t{-}' has a distinct meaning from `@t{-s}'
-preceding `@t{-}@t{-}', and both may appear.
+@item @t{_arguments} [ @t{-nswWACRS} ] [ @t{-O} @var{name} ] [ @t{-M} @var{matchspec} ] [ @t{:} ] @var{spec} ...
+This function can be used to give a complete specification for
+completion for a command whose arguments follow standard UNIX option and
+argument conventions.  The following forms specify individual sets of
+options and arguments; to avoid ambiguity, these may be separated from the
+options to @t{_arguments} itself by a single colon.  Options to
+@t{_arguments} itself must be in separate words, i.e. @t{-s -w}, not
+@t{-sw}.
 
 @noindent
 With the option @t{-n}, @t{_arguments} sets the parameter @t{NORMARG}
@@ -21848,23 +21559,6 @@
 otherwise the parameter is not used.
 
 @noindent
-The option `@t{-M} @var{matchspec}' sets a match specification to use to
-completion option names and values.  The default @var{matchspec} is:
-
-@noindent
-@example
-@t{r:|[_-]=* r:|=*}
-@end example
-
-@noindent
-This allows partial word completion after `@t{_}' and `@t{-}', for example
-`-f-b' can be completed to `@t{-foo-bar}'.
-
-@noindent
-Each of the following forms is a @var{spec} describing individual sets of
-options or arguments on the command line being analyzed.
-
-@noindent
 @table @asis
 @item @var{n}@t{:}@var{message}@t{:}@var{action}
 @itemx @var{n}@t{::}@var{message}@t{:}@var{action}
@@ -21912,10 +21606,10 @@
 @noindent
 The combination of @t{-s} with @t{-w} allows single-letter options to be
 combined in a single word even if one or more of the options take
-arguments.  For example, if @t{-x} takes an argument, with no
-@t{-s} `@t{-xy}' is considered as a single (unhandled) option; with
-@t{-s} @t{-xy} is an option with the argument `@t{y}'; with both @t{-s}
-and @t{-w}, @t{-xy} may be the option @t{-x} and the option @t{-y} with
+arguments.  For example, if @t{-a} takes an argument, with no
+@t{-s} `@t{-ab}' is considered as a single (unhandled) option; with
+@t{-s} @t{-ab} is an option with the argument `@t{b}'; with both @t{-s}
+and @t{-w}, @t{-ab} may be the option @t{-a} and the option @t{-b} with
 arguments still to come.
 
 @noindent
@@ -21994,29 +21688,6 @@
 appear, but that character must be quoted, for example `@t{-\+}'.
 
 @noindent
-The options @t{-S} and @t{-A} are available to simplify the specifications
-for commands with standard option parsing.  With @t{-S}, no option will be
-completed after a `@t{-}@t{-}' appearing on its own on the line; this
-argument will otherwise be ignored; hence in the line
-
-@noindent
-@example
-foobar -x -- -y
-@end example
-
-@noindent
-the `@t{-x}' is considered an option but the `@t{-y}' is considered an
-argument, while the `@t{-}@t{-}' is considered to be neither.
-
-@noindent
-With @t{-A}, no options will be completed after the first non-option
-argument on the line.  The @t{-A} must be followed by a pattern matching
-all strings which are not to be taken as arguments.  For example, to make
-@t{_arguments} stop completing options after the first normal argument, but
-ignoring all strings starting with a hyphen even if they are not described
-by one of the @var{optspec}s, the form is `@t{-A "-*"}'.
-
-@noindent
 Each @var{optarg} following an @var{optspec} must take one of the
 following forms:
 
@@ -22099,12 +21770,6 @@
 of tags is needed unless a function call introduces a new one.
 
 @noindent
-The option `@t{-O} @var{name}' specifies the name of an array whose elements
-will be passed as arguments to functions called to execute @var{action}s.
-For example, this can be used to pass the same set of options for the
-@t{compadd} builtin to all @var{action}s.
-
-@noindent
 The forms for @var{action} are as follows.
 
 @noindent
@@ -22255,23 +21920,6 @@
 stored in the @t{context} parameter.
 
 @noindent
-The option @t{-C} tells @t{_arguments} to modify the @t{curcontext}
-parameter for an action of the form `@t{->}@var{state}'.  This is the
-standard parameter used to keep track of the current context.  Here it
-(and not the @t{context} array) should be made local to the calling
-function to avoid passing back the modified value and should be
-initialised to the current value at the start of the function:
-
-@noindent
-@example
-local curcontext="$curcontext"
-@end example
-
-@noindent
-This is useful where it is not possible for multiple states to be valid
-together.
-
-@noindent
 It is possible to specify multiple sets of options and
 arguments with the sets separated by single hyphens.  The specifications
 before the first hyphen (if any) are shared by all the remaining sets.
@@ -22329,6 +21977,60 @@
 remaining arguments as described by the @var{optarg} definitions.
 
 @noindent
+The options @t{-S} and @t{-A} are available to simplify the specifications
+for commands with standard option parsing.  With @t{-S}, no option will be
+completed after a `@t{-}@t{-}' appearing on its own on the line; this
+argument will otherwise be ignored; hence in the line
+
+@noindent
+@example
+foobar -a -- -b
+@end example
+
+@noindent
+the `@t{-a}' is considered an option but the `@t{-b}' is considered an
+argument, while the `@t{-}@t{-}' is considered to be neither.
+
+@noindent
+With @t{-A}, no options will be completed after the first non-option
+argument on the line.  The @t{-A} must be followed by a pattern matching
+all strings which are not to be taken as arguments.  For example, to make
+@t{_arguments} stop completing options after the first normal argument, but
+ignoring all strings starting with a hyphen even if they are not described
+by one of the @var{optspec}s, the form is `@t{-A "-*"}'.
+
+@noindent
+The option `@t{-O} @var{name}' specifies the name of an array whose elements
+will be passed as arguments to functions called to execute @var{actions}.
+For example, this can be used to pass the same set of options for the
+@t{compadd} builtin to all @var{action}s.
+
+@noindent
+The option `@t{-M} @var{spec}' sets a match specification to use to
+completion option names and values.  It must appear before the first
+argument specification.  The default is `@t{r:|[_-]=* r:|=*}': this allows
+partial word completion after `@t{_}' and `@t{-}', for example `-f-b'
+can be completed to `@t{-foo-bar}'.
+
+@noindent
+The option @t{-C} tells @t{_arguments} to modify
+the @t{curcontext} parameter for an action of the form
+`@t{->}@var{state}'.  This is the standard parameter used to keep track of
+the current context.  Here it (and not the @t{context} array) should be
+made local to the calling function
+to avoid passing back the modified value and should be initialised to the
+current value at the start of the function:
+
+@noindent
+@example
+local curcontext="$curcontext"
+@end example
+
+@noindent
+This is useful where it is not possible for multiple states to be valid
+together.
+
+@noindent
 The option `@t{-}@t{-}' allows @t{_arguments} to work out the names of long
 options that support the `@t{-}@t{-help}' option which is standard in many
 GNU commands.  The command word is called with the argument
@@ -22340,17 +22042,11 @@
 In addition to options, `@t{_arguments -}@t{-}' will try to deduce the
 types of arguments available for options when the form
 `@t{-}@t{-}@var{opt}=@var{val}' is valid.  It is also possible to provide
-hints by examining the help text of the command and adding @var{helpspec} of
-the form `@var{pattern}@t{:}@var{message}@t{:}@var{action}'; note that other
-@t{_arguments} @var{spec} forms are not used.  The @var{pattern} is matched
+hints by examining the help text of the command and adding specifiers of
+the form `@var{pattern}@t{:}@var{message}@t{:}@var{action}'; note that normal
+@t{_arguments} specifiers are not used.  The @var{pattern} is matched
 against the help text for an option, and if it matches the @var{message} and
-@var{action} are used as for other argument specifiers.  The special case
-of `@t{*:}' means both @var{message} and @var{action} are empty, which has
-the effect of causing options having no description in the help output to
-be ordered in listings ahead of options that have a description.
-
-@noindent
-For example:
+@var{action} are used as for other argument specifiers.  For example:
 
 @noindent
 @example
@@ -22408,30 +22104,17 @@
 
 @noindent
 The `@t{_arguments -}@t{-}' form can also be followed by the option `@t{-s}
-@var{pair}' to describe option aliases.  The @var{pair} consists of a list
-of alternating patterns and corresponding replacements, enclosed in parens
-and quoted so that it forms a single argument word in the @t{_arguments}
-call.
-
-@noindent
-For example, some @t{configure}-script help output describes options only
-as `@t{-}@t{-enable-foo}', but the script also accepts the negated form
+@var{pair}' to describe option aliases.  Each @var{pair} consists of a
+pattern and a replacement.  For example, some @t{configure}-scripts
+describe options only as `@t{-}@t{-enable-foo}', but also accept
 `@t{-}@t{-disable-foo}'.  To allow completion of the second form:
 
 @noindent
 @example
-@t{_arguments -- -s "(#-}@t{-enable- -}@t{-disable-)"}
+_arguments -- -s "(#-@t{-enable- -}@t{-disable-)"}
 @end example
 
 @noindent
-Finally, note that @t{_arguments} generally expects to be the primary
-function handling any completion for which it is used.  It may have side
-effects which change the treatment of any matches added by other functions
-called after it.  To combine @t{_arguments} with other functions, those
-functions should be called either before @t{_arguments}, as an @var{action}
-within a @var{spec}, or in handlers for `@t{->}@var{state}' actions.
-
-@noindent
 Here is a more general example of the use of @t{_arguments}:
 
 @noindent
@@ -22780,14 +22463,11 @@
 hence determine the group the message string is added to.
 
 @noindent
-The second @t{-e} form gives a description for completions with the tag
-@var{tag} to be shown even if there are no matches for that tag.  This form
-is called by @t{_arguments} in the event that there is no action for an
-option specification.  The tag can be omitted and if so the tag is taken
-from the parameter @t{$curtag}; this is maintained by the completion
-system and so is usually correct.  Note that if there are no matches at
-the time this function is called, @t{compstate[insert]} is cleared, so
-additional matches generated later are not inserted on the command line.
+The second form gives a description for completions with the tag
+@var{tag} to be shown even if there are no matches for that tag.  The tag
+can be omitted and if so the tag is taken from the parameter
+@t{$curtag}; this is maintained by the completion system and so is
+usually correct.
 
 @findex _multi_parts
 @item @t{_multi_parts} @var{sep} @var{array}
@@ -22963,7 +22643,8 @@
 described above.
 
 @findex _pick_variant
-@item @t{_pick_variant} [ @t{-b} @var{builtin-label} ] [ @t{-c} @var{command} ] [ @t{-r} @var{name} ]
+@item @t{_pick_variant} [ @t{-b} @var{builtin-label} ] [ @t{-c}
+@var{command} ] [ @t{-r} @var{name} ]
 @itemx    @var{label}@t{=}@var{pattern} ... @var{label} [ @var{args} ... ]
 This function is used to resolve situations where a single command name
 requires more than one type of handling, either because it
@@ -23579,8 +23260,8 @@
 @item @t{compctl} @t{-M} @var{match-specs} ...
 @item @t{compctl} @t{-L} [ @t{-CDTM} ] [ @var{command} ... ]
 @item @t{compctl} @t{+} @var{command} ...
+@item
 @end table
-@sp 1
 
 @noindent
 Control the editor's completion behavior according to the supplied set
@@ -23724,8 +23405,8 @@
 @item [ @t{-y} @var{func-or-var} ] [ @t{-l} @var{cmd} ] [ @t{-h} @var{cmd} ] [ @t{-U} ]
 @item [ @t{-t} @var{continue} ] [ @t{-J} @var{name} ] [ @t{-V} @var{name} ]
 @item [ @t{-M} @var{match-spec} ]
+@item
 @end table
-@sp 1
 
 @noindent
 The remaining @var{options} specify the type of command arguments
@@ -24157,8 +23838,8 @@
 @noindent
 @table @asis
 @item @t{compctl} [ @t{-CDT} ] @var{options} @t{+} @var{options} [ @t{+} ... ] [ @t{+} ] @var{command} ...
+@item
 @end table
-@sp 1
 
 @noindent
 The form with `@t{+}' specifies alternative options. Completion is
@@ -24185,8 +23866,8 @@
 @item          [ @var{command} ... ]
 @item @t{compctl} [ @t{-CDT} ] @var{options} [ @t{-x} @var{pattern} @var{options} @t{-} ... @t{-}@t{-} ]
 @item          [ @t{+} @var{options} [ @t{-x} ... @t{-}@t{-} ] ... [@t{+}] ] [ @var{command} ... ]
+@item
 @end table
-@sp 1
 
 @noindent
 The form with `@t{-x}' specifies extended completion for the
@@ -25300,13 +24981,13 @@
 @var{targetwin} into the array named @var{array}.
 These are, in order:
 @table @asis
-@item -
+@item 
 The y and x coordinates of the cursor relative to the top left
 of @var{targetwin}
-@item -
+@item 
 The y and x coordinates of the top left of @var{targetwin} on the
 screen
-@item -
+@item 
 The size of @var{targetwin} in y and x dimensions.
 @end table
 
@@ -25895,12 +25576,9 @@
 @noindent
 A file may conveniently be read into an array as one line per element
 with the form
-`@var{array}@t{=("$@{(f@@)mapfile[}@var{filename}@t{]@}")}'.
-The double quotes and the `@t{@@}' are necessary to prevent empty lines
-from being removed.  Note that if the file ends with a newline,
-the shell will split on the final newline, generating an additional
-empty field; this can be suppressed by using
-`@var{array}@t{=("$@{(f@@)$@{mapfile[}@var{filename}@t{]%$'\n'@}@}")}'.
+`@var{array}@t{=("$@{(f)mapfile[}@var{filename}@t{]@}")}'.
+The double quotes are necessary to prevent empty lines from being
+removed.
 
 @end table
 
@@ -25975,7 +25653,7 @@
 The function @t{signgam} takes no arguments, and returns an integer, which
 is the C variable of the same name, as described in man page gamma(3).  Note
 that it is therefore only useful immediately after a call to @t{gamma} or
-@t{lgamma}.  Note also that `@t{signgam()}' and `@t{signgam}' are
+@t{lgamma}.  Note also that `@t{signgam(RPAR}' and `@t{signgam}' are
 distinct expressions.
 
 @noindent
@@ -26162,14 +25840,6 @@
 @item @t{dis_reswords}
 Like @t{reswords} but for disabled reserved words.
 
-@vindex patchars
-@item @t{patchars}
-This array contains the enabled pattern characters.
-
-@vindex dis_patchars
-@item @t{dis_patchars}
-Like @t{patchars} but for disabled pattern characters.
-
 @vindex aliases
 @item @t{aliases}
 This maps the names of the regular aliases currently enabled to their
@@ -29336,42 +29006,19 @@
 
 @noindent
 @example
-AGEREF=2006/10/04:10:15
+AGEREF1=2006/10/04:10:15
 AGEREF2=2006/10/04:10:45
 print *(+age)
 @end example
 
 @noindent
 This shows the same example before using another form of argument
-passing.  The dates and times in the parameters @t{AGEREF} and @t{AGEREF2}
+passing.  The dates and times in the parameters @t{AGEREF1} and @t{AGEREF2}
 stay in effect until unset, but will be overridden if any argument is
 passed as an explicit argument to age.  Any explicit argument
 causes both parameters to be ignored.
 
 @noindent
-Instead of an explicit date and time, it's possible to use the
-modification time of a file as the date and time for either argument
-by introducing the file name with a colon:
-
-@noindent
-@example
-print *(e-age :file1-)
-@end example
-
-@noindent
-matches all files created on the same day (24 hours starting from
-midnight) as @t{file1}.
-
-@noindent
-@example
-print *(e-age :file1 :file2-)
-@end example
-
-@noindent
-matches all files modified no earlier than @t{file1} and
-no later than @t{file2}; precision here is to the nearest second.
-
-@noindent
 @node Calendar Styles, Calendar Utility Functions, Calendar System User Functions, Calendar Function System
 
 @section Styles
@@ -31392,7 +31039,7 @@
 mkdir ~/zsh_help
 cd ~/zsh_help
 man zshall | colcrt - | \ 
-perl ~/zsh-5.0.4/Util/helpfiles
+perl ~/zsh-5.0.2/Util/helpfiles
 @end example
 
 @noindent
@@ -31548,7 +31195,7 @@
 
 @noindent
 @example
-zsh -f ~/zsh-5.0.4/Functions/Misc/zkbd
+zsh -f ~/zsh-5.0.2/Functions/Misc/zkbd
 @end example
 
 @noindent
@@ -31613,7 +31260,7 @@
 
 @noindent
 @example
-. ~/zsh-5.0.4/Util/reporter > zsh.report
+. ~/zsh-5.0.2/Util/reporter > zsh.report
 @end example
 
 @noindent
@@ -32113,7 +31760,7 @@
 
 @noindent
 It can be used in any existing prompt, because it does not require any
-specific @t{$psvar} entries to be available.
+@t{$psvar} entries to be left available.
 
 @noindent
 
@@ -34470,25 +34117,16 @@
 an example of how to call this function.
 
 @tindex modify-current-argument
-@item @t{modify-current-argument} [ @var{expr-using-}@t{$ARG} | @var{func} ]
+@item @t{modify-current-argument} @var{expr-using-}@t{$ARG}
 This function provides a simple method of allowing user-defined widgets
 to modify the command line argument under the cursor (or immediately to the
-left of the cursor if the cursor is between arguments).
-
-@noindent
-The argument can be an expression which when evaluated operates on the shell
+left of the cursor if the cursor is between arguments).  The argument
+should be an expression which when evaluated operates on the shell
 parameter @t{ARG}, which will have been set to the command line argument
 under the cursor.  The expression should be suitably quoted to prevent
 it being evaluated too early.
 
 @noindent
-Alternatively, if the argument does not contain the string @t{ARG}, it
-is assumed to be a shell function, to which the current command line
-argument is passed as the only argument.  The function should set the
-variable @t{REPLY} to the new value for the command line argument.
-If the function returns non-zero status, so does the calling function.
-
-@noindent
 For example, a user-defined widget containing the following code
 converts the characters in the argument under the cursor into all upper
 case:
@@ -34508,23 +34146,6 @@
 modify-current-argument '$@{(qq)$@{(Q)ARG@}@}'
 @end example
 
-@noindent
-The following performs directory expansion on the command line
-argument and replaces it by the absolute path:
-
-@noindent
-@example
-expand-dir() @{
-  REPLY=$@{~1@}
-  REPLY=$@{REPLY:a@}
-@}
-modify-current-argument expand-dir
-@end example
-
-@noindent
-In practice the function @t{expand-dir} would probably not be defined
-within the widget where @t{modify-current-argument} is called.
-
 @end table
 
 @noindent
@@ -34930,14 +34551,6 @@
 @t{sh} process.  This is more efficient, but may not work in the occasional
 cases where the mailcap handler uses strict POSIX syntax.
 
-@kindex disown, MIME style
-@item @t{disown}
-If this boolean style is true, mailcap handlers started in the
-background will be disowned, i.e. not subject to job control within
-the parent shell.  Such handlers nearly always produce their own
-windows, so the only likely harmful side effect of setting the style is
-that it becomes harder to kill jobs from within the shell.
-
 @kindex execute-as-is, MIME style
 @item @t{execute-as-is}
 This style gives a list of patterns to be matched against files
@@ -34950,31 +34563,6 @@
 handler, and the option @t{AUTO_CD} may be used to change to directories
 that happen to have MIME suffixes.
 
-@kindex execute-never, MIME style
-@item @t{execute-never}
-This style is useful in combination with @t{execute-as-is}.  It is
-set to an array of patterns corresponding to full paths to files that
-should never be treated as executable, even if the file passed to
-the MIME handler matches @t{execute-as-is}.  This is useful for file
-systems that don't handle execute permission or that contain executables
-from another operating system.  For example, if @t{/mnt/windows} is a
-Windows mount, then
-
-@noindent
-@example
-zstyle ':mime:*' execute-never '/mnt/windows/*'
-@end example
-
-@noindent
-will ensure that any files found in that area will be executed as MIME
-types even if they are executable.  As this example shows, the complete
-file name is matched against the pattern, regardless of how the file
-was passed to the handler.  The file is resolved to a full path using
-the @t{:A} modifier described in
-@ref{Modifiers};
-this means that symbolic links are resolved where possible, so that
-links into other file systems behave in the correct fashion.
-
 @kindex file-path, MIME style
 @item @t{file-path}
 Used if the style @t{find-file-in-path} is true for the same context.
@@ -35153,7 +34741,7 @@
 flags, and quoted so that the output can be run as a complete zsh
 command line.  This is used by the completion system to decide how to
 complete after a file handled by @t{zsh-mime-setup}.
-)
+
 @findex pick-web-browser
 @item @t{pick-web-browser}
 This function is separate from the two MIME functions described above
@@ -35257,7 +34845,7 @@
 @noindent
 @table @asis
 @findex zcalc
-@item @t{zcalc} [ @t{-ef} ] [ @var{expression} ... ]
+@item @t{zcalc} [ @var{expression} ... ]
 A reasonably powerful calculator based on zsh's arithmetic evaluation
 facility.  The syntax is similar to that of formulae in most programming
 languages; see
@@ -35278,14 +34866,6 @@
 on its own (`@t{q}' is allowed for historical compatibility).
 
 @noindent
-A line ending with a single backslash is treated in the same fashion
-as it is in command line editing:  the backslash is removed, the
-function prompts for more input (the prompt is preceded by `@t{...}'
-to indicate this), and the lines are combined into one to get the final
-result.  In addition, if the input so far contains more open than
-close parentheses @t{zcalc} will prompt for more input.
-
-@noindent
 If arguments are given to @t{zcalc} on start up, they are used to prime the
 first few positional parameters.  A visual indication of this is given when
 the calculator starts.
@@ -35301,16 +34881,6 @@
 on the globbing options set).
 
 @noindent
-If the option `@t{-e}' is set, the function runs non-interactively:
-the arguments are treated as expressions to be evaluated as if entered
-interactively line by line.
-
-@noindent
-If the option `@t{-f}' is set, all numbers are treated as floating
-point, hence for example the expression `@t{3/4}' evaluates to 0.75
-rather than 0.  Options must appear in separate words.
-
-@noindent
 The prompt is configurable via the parameter @t{ZCALCPROMPT}, which
 undergoes standard prompt expansion.  The index of the current entry is
 stored locally in the first element of the array @t{psvar}, which can be
@@ -35366,8 +34936,6 @@
 
 @item @t{:function} @var{name} [ @var{body} ]
 Define a mathematical function or (with no @var{body}) delete it.
-@t{:function} may be abbreviated to @t{:func} or simply @t{:f}.
-The @var{name} may contain the same characters as a shell function name.
 The function is defined using @t{zmathfuncdef}, see below.
 
 @noindent
@@ -35375,7 +34943,7 @@
 
 @noindent
 @example
-:f cube $1 * $1 * $1
+function cube $1 * $1 * $1
 @end example
 
 @noindent
@@ -35835,7 +35403,7 @@
 (@ref{Utilities}).
 
 @findex zmv
-@item @t{zmv} [ @t{-finqQsvwW} ] [ -C | -L | -M | -[pP] @var{program} ] [ -o @var{optstring} ] @var{srcpat} @var{dest} 
+@item @t{zmv} [ @t{-finqQsvwW} ] [ -C | -L | -M | -p @var{program} ] [ -o @var{optstring} ] @var{srcpat} @var{dest} 
 Move (usually, rename) files matching the pattern @var{srcpat} to
 corresponding files having names of the form given by @var{dest}, where
 @var{srcpat} contains parentheses surrounding patterns which will be
@@ -35900,13 +35468,6 @@
 @var{program} @t{-}@t{-} @var{oldname} @var{newname}
 @end example
 where @var{oldname} and @var{newname} are filenames generated by @t{zmv}.
-@var{program} will be split into words, so might be e.g. the name
-of an archive tool plus a copy or rename subcommand.
-@item @t{-P} @var{program}
-As @t{-p} @var{program}, except that
-@var{program} does not accept a following @t{-}@t{-} to indicate the
-end of options.  In this case filenames must already be in a sane
-form for the program in question.
 @item @t{-o} @var{optstring}
 The @var{optstring} is split into words and
 passed down verbatim to the @t{cp}, @t{ln} or @t{mv} command called to
diff -ruN zsh-5.0.4/Doc/zshall.1 zsh-5.0.2/Doc/zshall.1
--- zsh-5.0.4/Doc/zshall.1	2013-12-20 10:21:45.000000000 -0800
+++ zsh-5.0.2/Doc/zshall.1	2012-12-21 11:33:04.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHALL" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHALL" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshall \- the Z shell meta\-man page
 .\" Yodl file: Zsh/intro.yo
@@ -434,7 +434,7 @@
 .so man1/zshtcpsys.1
 .so man1/zshzftpsys.1
 .so man1/zshcontrib.1
-.TH "ZSHALL" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHALL" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .\" Yodl file: Zsh/filelist.yo
 .SH "FILES"
 .PD 0
diff -ruN zsh-5.0.4/Doc/zshbuiltins.1 zsh-5.0.2/Doc/zshbuiltins.1
--- zsh-5.0.4/Doc/zshbuiltins.1	2013-12-20 10:21:40.000000000 -0800
+++ zsh-5.0.2/Doc/zshbuiltins.1	2012-12-21 11:33:01.000000000 -0800
@@ -1,42 +1,8 @@
-.TH "ZSHBUILTINS" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHBUILTINS" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshbuiltins \- zsh built\-in commands
 .\" Yodl file: Zsh/builtins.yo
 .SH "SHELL BUILTIN COMMANDS"
-
-Some shell builtin commands take options as described in individual
-entries; these are often referred to in the list below as `\fBflags\fP\&' to
-avoid confusion with shell options, which may also have an effect on the
-behaviour of builtin commands\&.  In this introductory section,
-`\fBoption\fP\&' always has the meaning of an option to a command that should
-be familiar to most command line users\&.
-.PP
-Typically, options are single letters preceded by a hyphen (\fB\-\fP)\&.
-Options that take an argument accept it either immediately following the
-option letter or after white space, for example `\fBprint \-C3 *\fP\&' or
-`\fBprint \-C 3 *\fP\&' are equivalent\&.  Arguments to options are not the
-same as arguments to the command; the documentation indicates which is
-which\&.  Options that do not take an argument may be combined in a single
-word, for example `\fBprint \-ca *\fP\&' and `\fBprint \-c \-a *\fP' are
-equivalent\&.
-.PP
-Some shell builtin commands also take options that begin with `\fB+\fP\&'
-instead of `\fB\-\fP\&'\&.  The list below makes clear which commands these
-are\&.
-.PP
-Options (together with their individual arguments, if any) must appear
-in a group before any non\-option arguments; once the first non\-option
-argument has been found, option processing is terminated\&.
-.PP
-All builtin commands other than precommand modifiers, even those that
-have no options, can be given the argument `\fB\-\-\fP\&' to terminate option
-processing\&.  This indicates that the following words are non\-option
-arguments, but is otherwise ignored\&.  This is useful in cases where
-arguments to the command may begin with `\fB\-\fP\&'\&.  For historical
-reasons, most builtin commands also recognize a single `\fB\-\fP\&' in a
-separate word for this purpose; note that this is less standard and
-use of `\fB\-\-\fP is recommended\&.
-.PP
 .PD 0
 .TP
 .PD
@@ -76,7 +42,7 @@
 occur in command position\&.
 .RS
 .PP
-If the \fB\-s\fP flag is present, define a suffix alias: if the command
+If the \fB\-s\fP flags is present, define a suffix alias: if the command
 word on a command line is in the form `\fItext\fP\fB\&.\fP\fIname\fP\&', where
 \fItext\fP is any non\-empty string, it is replaced by the text
 `\fIvalue\fP \fItext\fP\fB\&.\fP\fIname\fP\&'\&.  Note that \fIname\fP is treated as
@@ -328,7 +294,7 @@
 clear the directory stack\&.
 .TP
 \fB\-l\fP
-print directory names in full instead of using of using \fB~\fP expressions (see \fIDynamic\fP and \fIStatic named directories\fP in \fIzshexpn\fP(1))\&.
+print directory names in full instead of using of using \fB~\fP expressions\&.
 .TP
 \fB\-p\fP
 print directory entries one per line\&.
@@ -338,8 +304,8 @@
 .PP
 .RE
 .TP
-\fBdisable\fP [ \fB\-afmprs\fP ] \fIname\fP \&.\&.\&.
-Temporarily disable the \fIname\fPd hash table elements or patterns\&.  The default
+\fBdisable\fP [ \fB\-afmrs\fP ] \fIname\fP \&.\&.\&.
+Temporarily disable the \fIname\fPd hash table elements\&.  The default
 is to disable builtin commands\&.  This allows you to use an external
 command with the same name as a builtin command\&.  The \fB\-a\fP option
 causes \fBdisable\fP to act on regular or global aliases\&.  The \fB\-s\fP
@@ -352,82 +318,6 @@
 table elements from the corresponding hash table matching these patterns
 are disabled\&.  Disabled objects can be enabled with the \fBenable\fP
 command\&.
-.RS
-.PP
-With the option \fB\-p\fP, \fIname\fP \&.\&.\&. refer to elements of the
-shell\&'s pattern syntax as described in the section `Filename Generation'\&.
-Certain elements can be disabled separately, as given below\&.
-.PP
-Note that patterns
-not allowed by the current settings for the options \fBEXTENDED_GLOB\fP,
-\fBKSH_GLOB\fP and \fBSH_GLOB\fP are never enabled, regardless of the
-setting here\&.  For example, if \fBEXTENDED_GLOB\fP is not active,
-the pattern \fB^\fP is ineffective even if `\fBdisable \-p "^"\fP\&' has
-not been issued\&.  The list below indicates any option settings
-that restrict the use of the pattern\&.  It should be noted that
-setting \fBSH_GLOB\fP has a wider effect then merely disabling patterns
-as certain expressions, in particular those involving parentheses,
-are parsed differently\&.
-.PP
-The following patterns may be disabled; all
-the strings need quoting on the command line to prevent them from
-being interpreted immediately as patterns and the patterns are
-shown below in single quotes as a reminder\&.
-.PD 0
-.TP
-.PD
-\fB\&'?'\fP
-The pattern character \fB?\fP wherever it occurs, including when preceding
-a parenthesis with \fBKSH_GLOB\fP\&.
-.TP
-\fB\&'*'\fP
-The pattern character \fB*\fP wherever it occurs, including recursive
-globbing and when preceding a parenthesis with \fBKSH_GLOB\fP\&.
-.TP
-\&'['
-Character classes\&.
-.TP
-\fB\&'<'\fP (\fBNO_SH_GLOB\fP)
-Numeric ranges\&.
-.TP
-\fB\&'|'\fP (\fBNO_SH_GLOB\fP)
-Alternation in grouped patterns, case statements, or KSH_GLOB
-parenthesised expressions\&.
-.TP
-\fB\&'('\fP (\fBNO_SH_GLOB\fP)
-Grouping using single parentheses\&.  Disabling this does not disable the
-use of parentheses for \fBKSH_GLOB\fP where they are introduced by a
-special character, nor for glob qualifiers (use `\fBsetopt
-NO_BARE_GLOB_QUAL\fP\&' to disable glob qualifiers that use parentheses
-only)\&.
-.TP
-\fB\&'~'\fP (\fBEXTENDED_GLOB\fP)
-Exclusion in the form \fIA\fP\fB~\fP\fIB\fP\&.
-.TP
-\fB\&'^'\fP (\fBEXTENDED_GLOB\fP)
-Exclusion in the form \fIA\fP\fB^\fP\fIB\fP\&.
-.TP
-\fB\&'#'\fP (\fBEXTENDED_GLOB\fP)
-The pattern character \fB#\fP wherever it occurs, both for
-repetition of a previous pattern and for indicating globbing flags\&.
-.TP
-\fB\&'?('\fP (\fBKSH_GLOB\fP)
-The grouping form \fB?(\fP\fI\&.\&.\&.\fP\fB)\fP\&.  Note this is also
-disabled if \fB\&'?'\fP is disabled\&.
-.TP
-\fB\&'*('\fP (\fBKSH_GLOB\fP)
-The grouping form \fB*(\fP\fI\&.\&.\&.\fP\fB)\fP\&.  Note this is also
-disabled if \fB\&'*'\fP is disabled\&.
-.TP
-\fB\&'+('\fP (\fBKSH_GLOB\fP)
-The grouping form \fB+(\fP\fI\&.\&.\&.\fP\fB)\fP\&.
-.TP
-\fB\&'!('\fP (\fBKSH_GLOB\fP)
-The grouping form \fB!(\fP\fI\&.\&.\&.\fP\fB)\fP\&.
-.TP
-\fB\&'@('\fP (\fBKSH_GLOB\fP)
-The grouping form \fB@(\fP\fI\&.\&.\&.\fP\fB)\fP\&.
-.RE
 .TP
 .PD 0
 \fBdisown\fP [ \fIjob\fP \&.\&.\&. ]
@@ -525,9 +415,7 @@
 argument are the same as those used to determine the emulation at startup
 based on the shell name, see
 the section COMPATIBILITY in \fIzsh\fP(1)
-\&.  In addition to setting shell options, the command also restores
-the pristine state of pattern enables, as if all patterns had been
-enabled using \fBenable \-p\fP\&.
+\&.
 .PP
 If the \fBemulate\fP command occurs inside a function that has been
 marked for execution tracing with \fBfunctions \-t\fP then the \fBxtrace\fP
@@ -541,11 +429,9 @@
 mode, except for certain options describing the interactive
 environment; otherwise, only those options likely to cause portability
 problems in scripts and functions are altered\&.  If the \fB\-L\fP switch is given,
-the options \fBLOCAL_OPTIONS\fP, \fBLOCAL_PATTERNS\fP and \fBLOCAL_TRAPS\fP
-will be set as
-well, causing the effects of the \fBemulate\fP command and any \fBsetopt\fP,
-\fBdisable \-p\fP or \fBenable \-p\fP, and \fBtrap\fP commands to be local to
-the immediately surrounding shell
+the options \fBLOCAL_OPTIONS\fP and \fBLOCAL_TRAPS\fP will be set as
+well, causing the effects of the \fBemulate\fP command and any \fBsetopt\fP and
+\fBtrap\fP commands to be local to the immediately surrounding shell
 function, if any; normally these options are turned off in all emulation
 modes except \fBksh\fP\&. The \fB\-L\fP switch is mutually exclusive with the
 use of \fB\-c\fP in \fIflags\fP\&.
@@ -566,8 +452,7 @@
 within the evaluated expression:  the emulation mode is associated
 thereafter with the function so that whenever the function is executed
 the emulation (respecting the \fB\-R\fP switch, if present) and all
-options are set (and pattern disables cleared)
-before entry to the function, and the state is restored after exit\&.
+options are set before entry to the function, and restored after exit\&.
 If the function is called when the sticky emulation is already in
 effect, either within an `\fBemulate\fP \fIshell\fP \fB\-c\fP\&' expression or
 within another function with the same sticky emulation, entry and exit
@@ -636,7 +521,7 @@
 .PD
 .RE
 .TP
-\fBenable\fP [ \fB\-afmprs\fP ] \fIname\fP \&.\&.\&.
+\fBenable\fP [ \fB\-afmrs\fP ] \fIname\fP \&.\&.\&.
 Enable the \fIname\fPd hash table elements, presumably disabled
 earlier with \fBdisable\fP\&.  The default is to enable builtin commands\&.
 The \fB\-a\fP option causes \fBenable\fP to act on regular or global aliases\&.
@@ -648,15 +533,6 @@
 (should be quoted) and all hash table elements from the corresponding
 hash table matching these patterns are enabled\&.  Enabled objects can be
 disabled with the \fBdisable\fP builtin command\&.
-.RS
-.PP
-\fBenable \-p\fP reenables patterns disabled with \fBdisable \-p\fP\&.  Note
-that it does not override globbing options; for example, `\fBenable \-p
-"~"\fP\&' does not cause the pattern character \fB~\fP to be active unless
-the \fBEXTENDED_GLOB\fP option is also set\&.  To enable all possible
-patterns (so that they may be invidually disabled with \fBdisable \-p\fP),
-use `\fBsetopt EXTENDED_GLOB KSH_GLOB NO_SH_GLOB\fP\&'\&.
-.RE
 .TP
 \fBeval\fP [ \fIarg\fP \&.\&.\&. ]
 Read the arguments as input to the shell and execute the resulting
@@ -677,12 +553,6 @@
 is specified, use the exit status from the last command executed\&.
 An EOF condition will also cause the shell to exit, unless
 the \fBIGNORE_EOF\fP option is set\&.
-.RS
-.PP
-See notes at the end of
-the section JOBS in in \fIzshmisc\fP(1) for some possibly unexpected interactions
-of the \fBexit\fP command with jobs\&.
-.RE
 .TP
 \fBexport\fP [ \fIname\fP[\fB=\fP\fIvalue\fP] \&.\&.\&. ]
 The specified \fIname\fPs are marked for automatic export
@@ -1092,9 +962,6 @@
 \fBfilesize\fP
 Largest single file allowed\&.
 .TP
-\fBkqueues\fP
-Maximum number of kqueues allocated\&.
-.TP
 \fBmaxproc\fP
 Maximum number of processes\&.
 .TP
@@ -1110,12 +977,6 @@
 \fBmsgqueue\fP
 Maximum number of bytes in POSIX message queues\&.
 .TP
-\fBposixlocks\fP
-Maximum number of POSIX locks per user\&.
-.TP
-\fBpseudoterminals\fP
-Maximum number of pseudo\-terminals\&.
-.TP
 \fBresident\fP
 Maximum resident set size\&.
 .TP
@@ -1128,9 +989,6 @@
 \fBstacksize\fP
 Maximum stack size for each process\&.
 .TP
-\fBswapsize\fP
-Maximum amount of swap used\&.
-.TP
 \fBvmemorysize\fP
 Maximum amount of virtual memory\&.
 .PD
@@ -1236,8 +1094,8 @@
 arguments are printed with the row incrementing first\&.
 .TP
 \fB\-D\fP
-Treat the arguments as paths, replacing directory prefixes with \fB~\fP
-expressions corresponding to directory names, as appropriate\&.
+Treat the arguments as directory names, replacing prefixes with \fB~\fP
+expressions, as appropriate\&.
 .TP
 \fB\-i\fP
 If given together with \fB\-o\fP or \fB\-O\fP, sorting is performed
@@ -2016,7 +1874,7 @@
 compatibility with previous versions of zsh\&.
 .RE
 .TP
-\fBulimit\fP [ [ \fB\-SHacdfiklmnpqsTtvwx\fP | \fB\-N\fP \fIresource\fP [ \fIlimit\fP ] \&.\&.\&. ]
+\fBulimit\fP [ [ \fB\-SHacdfilmnpqrstvx\fP | \fB\-N\fP \fIresource\fP [ \fIlimit\fP ] \&.\&.\&. ]
 Set or display resource limits of the shell and the processes started by
 the shell\&.  The value of \fIlimit\fP can be a number in the unit specified
 below or one of the values `\fBunlimited\fP\&', which removes the limit on the
@@ -2061,9 +1919,6 @@
 \fB\-i\fP
 The number of pending signals\&.
 .TP
-\fB\-k\fP
-The number of kqueues allocated\&.
-.TP
 \fB\-l\fP
 Kilobytes on the size of locked\-in memory\&.
 .TP
@@ -2073,21 +1928,18 @@
 \fB\-n\fP
 open file descriptors\&.
 .TP
-\fB\-p\fP
-The number of pseudo\-terminals\&.
-.TP
 \fB\-q\fP
 Bytes in POSIX message queues\&.
 .TP
 \fB\-s\fP
 Kilobytes on the size of the stack\&.
 .TP
-\fB\-T\fP
-The number of simultaneous threads available to the user\&.
-.TP
 \fB\-t\fP
 CPU seconds to be used\&.
 .TP
+\fB\-r\fP
+The number of simultaneous threads available to the user\&.
+.TP
 \fB\-u\fP
 The number of processes available to the user\&.
 .TP
@@ -2095,9 +1947,6 @@
 Kilobytes on the size of virtual memory\&.  On some systems this
 refers to the limit called `address space\&'\&.
 .TP
-\fB\-w\fP
-Kilobytes on the size of swapped out memory\&.
-.TP
 \fB\-x\fP
 The number of locks on files\&.
 .PD
diff -ruN zsh-5.0.4/Doc/zshcalsys.1 zsh-5.0.2/Doc/zshcalsys.1
--- zsh-5.0.4/Doc/zshcalsys.1	2013-12-20 10:21:41.000000000 -0800
+++ zsh-5.0.2/Doc/zshcalsys.1	2012-12-21 11:33:01.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHCALSYS" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHCALSYS" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshcalsys \- zsh calendar system
 .\" Yodl file: Zsh/calsys.yo
@@ -742,40 +742,18 @@
 .PP
 .RS
 .nf
-\fBAGEREF=2006/10/04:10:15
+\fBAGEREF1=2006/10/04:10:15
 AGEREF2=2006/10/04:10:45
 print *(+age)\fP
 .fi
 .RE
 .PP
 This shows the same example before using another form of argument
-passing\&.  The dates and times in the parameters \fBAGEREF\fP and \fBAGEREF2\fP
+passing\&.  The dates and times in the parameters \fBAGEREF1\fP and \fBAGEREF2\fP
 stay in effect until unset, but will be overridden if any argument is
 passed as an explicit argument to age\&.  Any explicit argument
 causes both parameters to be ignored\&.
 .PP
-Instead of an explicit date and time, it\&'s possible to use the
-modification time of a file as the date and time for either argument
-by introducing the file name with a colon:
-.PP
-.RS
-.nf
-\fBprint *(e\-age :file1\-)\fP
-.fi
-.RE
-.PP
-matches all files created on the same day (24 hours starting from
-midnight) as \fBfile1\fP\&.
-.PP
-.RS
-.nf
-\fBprint *(e\-age :file1 :file2\-)\fP
-.fi
-.RE
-.PP
-matches all files modified no earlier than \fBfile1\fP and
-no later than \fBfile2\fP; precision here is to the nearest second\&.
-.PP
 .SH "STYLES"
 .PP
 The zsh style mechanism using the \fBzstyle\fP command is describe in
diff -ruN zsh-5.0.4/Doc/zshcompctl.1 zsh-5.0.2/Doc/zshcompctl.1
--- zsh-5.0.4/Doc/zshcompctl.1	2013-12-20 10:21:41.000000000 -0800
+++ zsh-5.0.2/Doc/zshcompctl.1	2012-12-21 11:33:01.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHCOMPCTL" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHCOMPCTL" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshcompctl \- zsh programmable completion
 .\" Yodl file: Zsh/compctl.yo
diff -ruN zsh-5.0.4/Doc/zshcompsys.1 zsh-5.0.2/Doc/zshcompsys.1
--- zsh-5.0.4/Doc/zshcompsys.1	2013-12-20 10:21:42.000000000 -0800
+++ zsh-5.0.2/Doc/zshcompsys.1	2012-12-21 11:33:01.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHCOMPSYS" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHCOMPSYS" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshcompsys \- zsh completion system
 .\" Yodl file: Zsh/compsys.yo
@@ -3541,30 +3541,15 @@
 different name for the argument context field\&.
 .RE
 .TP
-.PD 0
-\fB_arguments\fP [ \fB\-nswWCRS\fP ] [ \fB\-A\fP \fIpat\fP ] [ \fB\-O\fP \fIname\fP ] [ \fB\-M\fP \fImatchspec\fP ] [ \fB:\fP ] \fIspec\fP\&.\&.\&.
-.TP
-.PD
-\fB_arguments\fP [ \fIopts\fP\&.\&.\&. ] \fB\-\fP\fB\-\fP [ \-i \fIpats\fP ] [ \fB\-s\fP \fIpair\fP ] [ \fIhelpspec\fP\&.\&.\&. ]
-This function can be used to give a complete specification for completion
-for a command whose arguments follow standard UNIX option and argument
-conventions\&.  Options to \fB_arguments\fP itself must be in separate words,
-i\&.e\&. \fB\-s \-w\fP, not \fB\-sw\fP\&.
-.RS
-.PP
-When calling \fB_arguments\fP, all \fIspec\fPs that describe options of the
-analyzed command line must precede all \fIspec\fPs that describe non\-option
-(aka "normal") arguments of the analyzed line\&.  To avoid ambiguity, all
-options to \fB_arguments\fP itself may be separated from the \fIspec\fP forms
-by a single colon\&.
-.PP
-The \fB\-s \-w \-W \-A\fP and \fB\-S\fP options describe how parsing of the command
-line should proceed, and are discussed in context below\&.  The `\fB\-\fP\fB\-\fP\&'
-form is used to intuit \fIspec\fP forms from the help output of the command
-being analyzed, and is described in detail below\&.  The \fIopts\fP for the
-`\fB\-\fP\fB\-\fP\&' form are otherwise the same options as the first form\&.  Note
-that `\fB\-s\fP\&' following `\fB\-\fP\fB\-\fP' has a distinct meaning from `\fB\-s\fP'
-preceding `\fB\-\fP\fB\-\fP\&', and both may appear\&.
+\fB_arguments\fP [ \fB\-nswWACRS\fP ] [ \fB\-O\fP \fIname\fP ] [ \fB\-M\fP \fImatchspec\fP ] [ \fB:\fP ] \fIspec\fP \&.\&.\&.
+This function can be used to give a complete specification for
+completion for a command whose arguments follow standard UNIX option and
+argument conventions\&.  The following forms specify individual sets of
+options and arguments; to avoid ambiguity, these may be separated from the
+options to \fB_arguments\fP itself by a single colon\&.  Options to
+\fB_arguments\fP itself must be in separate words, i\&.e\&. \fB\-s \-w\fP, not
+\fB\-sw\fP\&.
+.RS
 .PP
 With the option \fB\-n\fP, \fB_arguments\fP sets the parameter \fBNORMARG\fP
 to the position of the first normal argument in the \fB$words\fP array,
@@ -3573,21 +3558,6 @@
 should declare `\fBinteger NORMARG\fP\&' if the \fB\-n\fP option is passed;
 otherwise the parameter is not used\&.
 .PP
-The option `\fB\-M\fP \fImatchspec\fP\&' sets a match specification to use to
-completion option names and values\&.  The default \fImatchspec\fP is:
-.PP
-.RS
-.nf
-\fB\fBr:|[_\-]=* r:|=*\fP\fP
-.fi
-.RE
-.PP
-This allows partial word completion after `\fB_\fP\&' and `\fB\-\fP', for example
-`\-f\-b\&' can be completed to `\fB\-foo\-bar\fP'\&.
-.PP
-Each of the following forms is a \fIspec\fP describing individual sets of
-options or arguments on the command line being analyzed\&.
-.PP
 .PD 0
 .TP
 .PD 0
@@ -3650,10 +3620,10 @@
 .PP
 The combination of \fB\-s\fP with \fB\-w\fP allows single\-letter options to be
 combined in a single word even if one or more of the options take
-arguments\&.  For example, if \fB\-x\fP takes an argument, with no
-\fB\-s\fP `\fB\-xy\fP\&' is considered as a single (unhandled) option; with
-\fB\-s\fP \fB\-xy\fP is an option with the argument `\fBy\fP\&'; with both \fB\-s\fP
-and \fB\-w\fP, \fB\-xy\fP may be the option \fB\-x\fP and the option \fB\-y\fP with
+arguments\&.  For example, if \fB\-a\fP takes an argument, with no
+\fB\-s\fP `\fB\-ab\fP\&' is considered as a single (unhandled) option; with
+\fB\-s\fP \fB\-ab\fP is an option with the argument `\fBb\fP\&'; with both \fB\-s\fP
+and \fB\-w\fP, \fB\-ab\fP may be the option \fB\-a\fP and the option \fB\-b\fP with
 arguments still to come\&.
 .PP
 The option \fB\-W\fP takes this a stage further:  it is possible to
@@ -3731,27 +3701,6 @@
 It is possible for options with a literal `+\&' or `\fB=\fP' to
 appear, but that character must be quoted, for example `\fB\-\e+\fP\&'\&.
 .PP
-The options \fB\-S\fP and \fB\-A\fP are available to simplify the specifications
-for commands with standard option parsing\&.  With \fB\-S\fP, no option will be
-completed after a `\fB\-\fP\fB\-\fP\&' appearing on its own on the line; this
-argument will otherwise be ignored; hence in the line
-.PP
-.RS
-.nf
-\fBfoobar \-x \-\- \-y\fP
-.fi
-.RE
-.PP
-the `\fB\-x\fP\&' is considered an option but the `\fB\-y\fP' is considered an
-argument, while the `\fB\-\fP\fB\-\fP\&' is considered to be neither\&.
-.PP
-With \fB\-A\fP, no options will be completed after the first non\-option
-argument on the line\&.  The \fB\-A\fP must be followed by a pattern matching
-all strings which are not to be taken as arguments\&.  For example, to make
-\fB_arguments\fP stop completing options after the first normal argument, but
-ignoring all strings starting with a hyphen even if they are not described
-by one of the \fIoptspec\fPs, the form is `\fB\-A "\-*"\fP\&'\&.
-.PP
 Each \fIoptarg\fP following an \fIoptspec\fP must take one of the
 following forms:
 .PP
@@ -3837,11 +3786,6 @@
 \fB_all_labels\fP function to process all tag labels\&.  No special handling
 of tags is needed unless a function call introduces a new one\&.
 .PP
-The option `\fB\-O\fP \fIname\fP\&' specifies the name of an array whose elements
-will be passed as arguments to functions called to execute \fIaction\fPs\&.
-For example, this can be used to pass the same set of options for the
-\fBcompadd\fP builtin to all \fIaction\fPs\&.
-.PP
 The forms for \fIaction\fP are as follows\&.
 .PP
 .PD 0
@@ -3992,22 +3936,6 @@
 the \fBcurcontext\fP parameter is altered to append the same string that is
 stored in the \fBcontext\fP parameter\&.
 .PP
-The option \fB\-C\fP tells \fB_arguments\fP to modify the \fBcurcontext\fP
-parameter for an action of the form `\fB\->\fP\fIstate\fP\&'\&.  This is the
-standard parameter used to keep track of the current context\&.  Here it
-(and not the \fBcontext\fP array) should be made local to the calling
-function to avoid passing back the modified value and should be
-initialised to the current value at the start of the function:
-.PP
-.RS
-.nf
-\fBlocal curcontext="$curcontext"\fP
-.fi
-.RE
-.PP
-This is useful where it is not possible for multiple states to be valid
-together\&.
-.PP
 It is possible to specify multiple sets of options and
 arguments with the sets separated by single hyphens\&.  The specifications
 before the first hyphen (if any) are shared by all the remaining sets\&.
@@ -4062,6 +3990,55 @@
 (as in `\fB\-foo:*:\&.\&.\&.\fP\&'); here the option \fB\-foo\fP swallows up all
 remaining arguments as described by the \fIoptarg\fP definitions\&.
 .PP
+The options \fB\-S\fP and \fB\-A\fP are available to simplify the specifications
+for commands with standard option parsing\&.  With \fB\-S\fP, no option will be
+completed after a `\fB\-\fP\fB\-\fP\&' appearing on its own on the line; this
+argument will otherwise be ignored; hence in the line
+.PP
+.RS
+.nf
+\fBfoobar \-a \-\- \-b\fP
+.fi
+.RE
+.PP
+the `\fB\-a\fP\&' is considered an option but the `\fB\-b\fP' is considered an
+argument, while the `\fB\-\fP\fB\-\fP\&' is considered to be neither\&.
+.PP
+With \fB\-A\fP, no options will be completed after the first non\-option
+argument on the line\&.  The \fB\-A\fP must be followed by a pattern matching
+all strings which are not to be taken as arguments\&.  For example, to make
+\fB_arguments\fP stop completing options after the first normal argument, but
+ignoring all strings starting with a hyphen even if they are not described
+by one of the \fIoptspec\fPs, the form is `\fB\-A "\-*"\fP\&'\&.
+.PP
+The option `\fB\-O\fP \fIname\fP\&' specifies the name of an array whose elements
+will be passed as arguments to functions called to execute \fIactions\fP\&.
+For example, this can be used to pass the same set of options for the
+\fBcompadd\fP builtin to all \fIaction\fPs\&.
+.PP
+The option `\fB\-M\fP \fIspec\fP\&' sets a match specification to use to
+completion option names and values\&.  It must appear before the first
+argument specification\&.  The default is `\fBr:|[_\-]=* r:|=*\fP\&': this allows
+partial word completion after `\fB_\fP\&' and `\fB\-\fP', for example `\-f\-b'
+can be completed to `\fB\-foo\-bar\fP\&'\&.
+.PP
+The option \fB\-C\fP tells \fB_arguments\fP to modify
+the \fBcurcontext\fP parameter for an action of the form
+`\fB\->\fP\fIstate\fP\&'\&.  This is the standard parameter used to keep track of
+the current context\&.  Here it (and not the \fBcontext\fP array) should be
+made local to the calling function
+to avoid passing back the modified value and should be initialised to the
+current value at the start of the function:
+.PP
+.RS
+.nf
+\fBlocal curcontext="$curcontext"\fP
+.fi
+.RE
+.PP
+This is useful where it is not possible for multiple states to be valid
+together\&.
+.PP
 The option `\fB\-\fP\fB\-\fP\&' allows \fB_arguments\fP to work out the names of long
 options that support the `\fB\-\fP\fB\-help\fP\&' option which is standard in many
 GNU commands\&.  The command word is called with the argument
@@ -4072,16 +4049,11 @@
 In addition to options, `\fB_arguments \-\fP\fB\-\fP\&' will try to deduce the
 types of arguments available for options when the form
 `\fB\-\fP\fB\-\fP\fIopt\fP=\fIval\fP\&' is valid\&.  It is also possible to provide
-hints by examining the help text of the command and adding \fIhelpspec\fP of
-the form `\fIpattern\fP\fB:\fP\fImessage\fP\fB:\fP\fIaction\fP\&'; note that other
-\fB_arguments\fP \fIspec\fP forms are not used\&.  The \fIpattern\fP is matched
+hints by examining the help text of the command and adding specifiers of
+the form `\fIpattern\fP\fB:\fP\fImessage\fP\fB:\fP\fIaction\fP\&'; note that normal
+\fB_arguments\fP specifiers are not used\&.  The \fIpattern\fP is matched
 against the help text for an option, and if it matches the \fImessage\fP and
-\fIaction\fP are used as for other argument specifiers\&.  The special case
-of `\fB*:\fP\&' means both \fImessage\fP and \fIaction\fP are empty, which has
-the effect of causing options having no description in the help output to
-be ordered in listings ahead of options that have a description\&.
-.PP
-For example:
+\fIaction\fP are used as for other argument specifiers\&.  For example:
 .PP
 .RS
 .nf
@@ -4135,28 +4107,17 @@
 useful with GNU \fBconfigure\fP)\&.
 .PP
 The `\fB_arguments \-\fP\fB\-\fP\&' form can also be followed by the option `\fB\-s\fP
-\fIpair\fP\&' to describe option aliases\&.  The \fIpair\fP consists of a list
-of alternating patterns and corresponding replacements, enclosed in parens
-and quoted so that it forms a single argument word in the \fB_arguments\fP
-call\&.
-.PP
-For example, some \fBconfigure\fP\-script help output describes options only
-as `\fB\-\fP\fB\-enable\-foo\fP\&', but the script also accepts the negated form
+\fIpair\fP\&' to describe option aliases\&.  Each \fIpair\fP consists of a
+pattern and a replacement\&.  For example, some \fBconfigure\fP\-scripts
+describe options only as `\fB\-\fP\fB\-enable\-foo\fP\&', but also accept
 `\fB\-\fP\fB\-disable\-foo\fP\&'\&.  To allow completion of the second form:
 .PP
 .RS
 .nf
-\fB\fB_arguments \-\- \-s "(#\-\fP\fB\-enable\- \-\fP\fB\-disable\-)"\fP\fP
+\fB_arguments \-\- \-s "(#\-\fB\-enable\- \-\fP\fB\-disable\-)"\fP\fP
 .fi
 .RE
 .PP
-Finally, note that \fB_arguments\fP generally expects to be the primary
-function handling any completion for which it is used\&.  It may have side
-effects which change the treatment of any matches added by other functions
-called after it\&.  To combine \fB_arguments\fP with other functions, those
-functions should be called either before \fB_arguments\fP, as an \fIaction\fP
-within a \fIspec\fP, or in handlers for `\fB\->\fP\fIstate\fP\&' actions\&.
-.PP
 Here is a more general example of the use of \fB_arguments\fP:
 .PP
 .RS
@@ -4486,14 +4447,11 @@
 The \fB\-12VJ\fP options and the \fIgroup\fP are passed to \fBcompadd\fP and
 hence determine the group the message string is added to\&.
 .PP
-The second \fB\-e\fP form gives a description for completions with the tag
-\fItag\fP to be shown even if there are no matches for that tag\&.  This form
-is called by \fB_arguments\fP in the event that there is no action for an
-option specification\&.  The tag can be omitted and if so the tag is taken
-from the parameter \fB$curtag\fP; this is maintained by the completion
-system and so is usually correct\&.  Note that if there are no matches at
-the time this function is called, \fBcompstate[insert]\fP is cleared, so
-additional matches generated later are not inserted on the command line\&.
+The second form gives a description for completions with the tag
+\fItag\fP to be shown even if there are no matches for that tag\&.  The tag
+can be omitted and if so the tag is taken from the parameter
+\fB$curtag\fP; this is maintained by the completion system and so is
+usually correct\&.
 .RE
 .TP
 \fB_multi_parts\fP \fIsep\fP \fIarray\fP
@@ -4661,7 +4619,8 @@
 .RE
 .TP
 .PD 0
-\fB_pick_variant\fP [ \fB\-b\fP \fIbuiltin\-label\fP ] [ \fB\-c\fP \fIcommand\fP ] [ \fB\-r\fP \fIname\fP ]
+\fB_pick_variant\fP [ \fB\-b\fP \fIbuiltin\-label\fP ] [ \fB\-c\fP
+\fIcommand\fP ] [ \fB\-r\fP \fIname\fP ]
 .TP
 .PD
    \fIlabel\fP\fB=\fP\fIpattern\fP \&.\&.\&. \fIlabel\fP [ \fIargs\fP \&.\&.\&. ]
diff -ruN zsh-5.0.4/Doc/zshcompwid.1 zsh-5.0.2/Doc/zshcompwid.1
--- zsh-5.0.4/Doc/zshcompwid.1	2013-12-20 10:21:42.000000000 -0800
+++ zsh-5.0.2/Doc/zshcompwid.1	2012-12-21 11:33:01.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHCOMPWID" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHCOMPWID" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshcompwid \- zsh completion widgets
 .\" Yodl file: Zsh/compwid.yo
diff -ruN zsh-5.0.4/Doc/zshcontrib.1 zsh-5.0.2/Doc/zshcontrib.1
--- zsh-5.0.4/Doc/zshcontrib.1	2013-12-20 10:21:43.000000000 -0800
+++ zsh-5.0.2/Doc/zshcontrib.1	2012-12-21 11:33:02.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHCONTRIB" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHCONTRIB" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshcontrib \- user contributions to zsh
 .\" Yodl file: Zsh/contrib.yo
@@ -44,7 +44,7 @@
 \fBmkdir ~/zsh_help
 cd ~/zsh_help
 man zshall | colcrt \- | \e 
-perl ~/zsh\-5\&.0\&.4/Util/helpfiles\fP
+perl ~/zsh\-5\&.0\&.2/Util/helpfiles\fP
 .fi
 .RE
 .PP
@@ -179,7 +179,7 @@
 .PP
 .RS
 .nf
-\fBzsh \-f ~/zsh\-5\&.0\&.4/Functions/Misc/zkbd\fP
+\fBzsh \-f ~/zsh\-5\&.0\&.2/Functions/Misc/zkbd\fP
 .fi
 .RE
 .PP
@@ -235,7 +235,7 @@
 .PP
 .RS
 .nf
-\fB\&. ~/zsh\-5\&.0\&.4/Util/reporter > zsh\&.report\fP
+\fB\&. ~/zsh\-5\&.0\&.2/Util/reporter > zsh\&.report\fP
 .fi
 .RE
 .PP
@@ -690,7 +690,7 @@
 .RE
 .PP
 It can be used in any existing prompt, because it does not require any
-specific \fB$psvar\fP entries to be available\&.
+\fB$psvar\fP entries to be left available\&.
 .PP
 .SS "Quickstart"
 .PP
@@ -3056,22 +3056,15 @@
 an example of how to call this function\&.
 .RE
 .TP
-\fBmodify\-current\-argument\fP [ \fIexpr\-using\-\fP\fB$ARG\fP | \fIfunc\fP ]
+\fBmodify\-current\-argument\fP \fIexpr\-using\-\fP\fB$ARG\fP
 This function provides a simple method of allowing user\-defined widgets
 to modify the command line argument under the cursor (or immediately to the
-left of the cursor if the cursor is between arguments)\&.
-.RS
-.PP
-The argument can be an expression which when evaluated operates on the shell
+left of the cursor if the cursor is between arguments)\&.  The argument
+should be an expression which when evaluated operates on the shell
 parameter \fBARG\fP, which will have been set to the command line argument
 under the cursor\&.  The expression should be suitably quoted to prevent
 it being evaluated too early\&.
-.PP
-Alternatively, if the argument does not contain the string \fBARG\fP, it
-is assumed to be a shell function, to which the current command line
-argument is passed as the only argument\&.  The function should set the
-variable \fBREPLY\fP to the new value for the command line argument\&.
-If the function returns non\-zero status, so does the calling function\&.
+.RS
 .PP
 For example, a user\-defined widget containing the following code
 converts the characters in the argument under the cursor into all upper
@@ -3092,22 +3085,6 @@
 \fBmodify\-current\-argument \&'${(qq)${(Q)ARG}}'\fP
 .fi
 .RE
-.PP
-The following performs directory expansion on the command line
-argument and replaces it by the absolute path:
-.PP
-.RS
-.nf
-\fBexpand\-dir() {
-  REPLY=${~1}
-  REPLY=${REPLY:a}
-}
-modify\-current\-argument expand\-dir\fP
-.fi
-.RE
-.PP
-In practice the function \fBexpand\-dir\fP would probably not be defined
-within the widget where \fBmodify\-current\-argument\fP is called\&.
 .RE
 .RE
 .PP
@@ -3485,13 +3462,6 @@
 \fBsh\fP process\&.  This is more efficient, but may not work in the occasional
 cases where the mailcap handler uses strict POSIX syntax\&.
 .TP
-\fBdisown\fP
-If this boolean style is true, mailcap handlers started in the
-background will be disowned, i\&.e\&. not subject to job control within
-the parent shell\&.  Such handlers nearly always produce their own
-windows, so the only likely harmful side effect of setting the style is
-that it becomes harder to kill jobs from within the shell\&.
-.TP
 \fBexecute\-as\-is\fP
 This style gives a list of patterns to be matched against files
 passed for execution with a handler program\&.  If the file matches
@@ -3503,32 +3473,6 @@
 handler, and the option \fBAUTO_CD\fP may be used to change to directories
 that happen to have MIME suffixes\&.
 .TP
-\fBexecute\-never\fP
-This style is useful in combination with \fBexecute\-as\-is\fP\&.  It is
-set to an array of patterns corresponding to full paths to files that
-should never be treated as executable, even if the file passed to
-the MIME handler matches \fBexecute\-as\-is\fP\&.  This is useful for file
-systems that don\&'t handle execute permission or that contain executables
-from another operating system\&.  For example, if \fB/mnt/windows\fP is a
-Windows mount, then
-.RS
-.PP
-.RS
-.nf
-\fBzstyle \&':mime:*' execute\-never '/mnt/windows/*'\fP
-.fi
-.RE
-.PP
-will ensure that any files found in that area will be executed as MIME
-types even if they are executable\&.  As this example shows, the complete
-file name is matched against the pattern, regardless of how the file
-was passed to the handler\&.  The file is resolved to a full path using
-the \fB:A\fP modifier described in
-the subsection Modifers in \fIzshexpn\fP(1).RE;
-this means that symbolic links are resolved where possible, so that
-links into other file systems behave in the correct fashion\&.
-.RE
-.TP
 \fBfile\-path\fP
 Used if the style \fBfind\-file\-in\-path\fP is true for the same context\&.
 Set to an array of directories that are used for searching for the
@@ -3690,7 +3634,7 @@
 flags, and quoted so that the output can be run as a complete zsh
 command line\&.  This is used by the completion system to decide how to
 complete after a file handled by \fBzsh\-mime\-setup\fP\&.
-)
+.RE
 .TP
 \fBpick\-web\-browser\fP
 This function is separate from the two MIME functions described above
@@ -3791,7 +3735,7 @@
 .PD 0
 .TP
 .PD
-\fBzcalc\fP [ \fB\-ef\fP ] [ \fIexpression\fP \&.\&.\&. ]
+\fBzcalc\fP [ \fIexpression\fP \&.\&.\&. ]
 A reasonably powerful calculator based on zsh\&'s arithmetic evaluation
 facility\&.  The syntax is similar to that of formulae in most programming
 languages; see
@@ -3811,13 +3755,6 @@
 the file \fB~/\&.zcalc_history\fP\&.  To exit, enter a blank line or type `\fB:q\fP\&'
 on its own (`\fBq\fP\&' is allowed for historical compatibility)\&.
 .PP
-A line ending with a single backslash is treated in the same fashion
-as it is in command line editing:  the backslash is removed, the
-function prompts for more input (the prompt is preceded by `\fB\&.\&.\&.\fP\&'
-to indicate this), and the lines are combined into one to get the final
-result\&.  In addition, if the input so far contains more open than
-close parentheses \fBzcalc\fP will prompt for more input\&.
-.PP
 If arguments are given to \fBzcalc\fP on start up, they are used to prime the
 first few positional parameters\&.  A visual indication of this is given when
 the calculator starts\&.
@@ -3830,14 +3767,6 @@
 for example `\fBzcalc \-#16\fP\&' (the `\fB#\fP' may have to be quoted, depending
 on the globbing options set)\&.
 .PP
-If the option `\fB\-e\fP\&' is set, the function runs non\-interactively:
-the arguments are treated as expressions to be evaluated as if entered
-interactively line by line\&.
-.PP
-If the option `\fB\-f\fP\&' is set, all numbers are treated as floating
-point, hence for example the expression `\fB3/4\fP\&' evaluates to 0\&.75
-rather than 0\&.  Options must appear in separate words\&.
-.PP
 The prompt is configurable via the parameter \fBZCALCPROMPT\fP, which
 undergoes standard prompt expansion\&.  The index of the current entry is
 stored locally in the first element of the array \fBpsvar\fP, which can be
@@ -3892,8 +3821,6 @@
 .TP
 \fB:function\fP \fIname\fP [ \fIbody\fP ]
 Define a mathematical function or (with no \fIbody\fP) delete it\&.
-\fB:function\fP may be abbreviated to \fB:func\fP or simply \fB:f\fP\&.
-The \fIname\fP may contain the same characters as a shell function name\&.
 The function is defined using \fBzmathfuncdef\fP, see below\&.
 .RS
 .PP
@@ -3901,7 +3828,7 @@
 .PP
 .RS
 .nf
-\fB:f cube $1 * $1 * $1\fP
+\fBfunction cube $1 * $1 * $1\fP
 .fi
 .RE
 .PP
@@ -4338,7 +4265,7 @@
 See `Keyboard Definition\&'
 above\&.
 .TP
-\fBzmv\fP [ \fB\-finqQsvwW\fP ] [ \-C | \-L | \-M | \-[pP] \fIprogram\fP ] [ \-o \fIoptstring\fP ] \fIsrcpat\fP \fIdest\fP 
+\fBzmv\fP [ \fB\-finqQsvwW\fP ] [ \-C | \-L | \-M | \-p \fIprogram\fP ] [ \-o \fIoptstring\fP ] \fIsrcpat\fP \fIdest\fP 
 Move (usually, rename) files matching the pattern \fIsrcpat\fP to
 corresponding files having names of the form given by \fIdest\fP, where
 \fIsrcpat\fP contains parentheses surrounding patterns which will be
@@ -4412,14 +4339,6 @@
 \fBmv\fP\&.  Whatever it does, it should at least understand the form
 `\fIprogram\fP \fB\-\fP\fB\-\fP \fIoldname\fP \fInewname\fP\&'
 where \fIoldname\fP and \fInewname\fP are filenames generated by \fBzmv\fP\&.
-\fIprogram\fP will be split into words, so might be e\&.g\&. the name
-of an archive tool plus a copy or rename subcommand\&.
-.TP
-\fB\-P\fP \fIprogram\fP
-As \fB\-p\fP \fIprogram\fP, except that
-\fIprogram\fP does not accept a following \fB\-\fP\fB\-\fP to indicate the
-end of options\&.  In this case filenames must already be in a sane
-form for the program in question\&.
 .TP
 \fB\-o\fP \fIoptstring\fP
 The \fIoptstring\fP is split into words and
diff -ruN zsh-5.0.4/Doc/zshexpn.1 zsh-5.0.2/Doc/zshexpn.1
--- zsh-5.0.4/Doc/zshexpn.1	2013-12-20 10:21:43.000000000 -0800
+++ zsh-5.0.2/Doc/zshexpn.1	2012-12-21 11:33:02.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHEXPN" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHEXPN" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshexpn \- zsh expansion and substitution
 .\" Yodl file: Zsh/expn.yo
@@ -50,7 +50,6 @@
 History expansion allows you to use words from previous command
 lines in the command line you are typing\&.  This simplifies spelling
 corrections and the repetition of complicated commands or arguments\&.
-.PP
 Immediately before execution, each command is saved in the history list,
 the size of which is controlled by the \fBHISTSIZE\fP parameter\&.  The one
 most recent command is always retained in any case\&.  Each saved command in
@@ -795,8 +794,6 @@
 the length in characters of the result instead of
 the result itself\&.  If \fIspec\fP is an array expression,
 substitute the number of elements of the result\&.
-This has the side\-effect that joining is skipped even in quoted
-forms, which may affect other sub\-expressions in \fIspec\fP\&.
 Note that `\fB^\fP\&', `\fB=\fP', and `\fB~\fP', below, must appear
 to the left of `\fB#\fP\&' when these forms are combined\&.
 .TP
@@ -915,12 +912,11 @@
 Create an array parameter with `\fB${\fP\&.\&.\&.\fB=\fP\&.\&.\&.\fB}\fP\&',
 `\fB${\fP\&.\&.\&.\fB:=\fP\&.\&.\&.\fB}\fP\&' or `\fB${\fP\&.\&.\&.\fB::=\fP\&.\&.\&.\fB}\fP'\&.
 If this flag is repeated (as in `\fBAA\fP\&'), create an associative
-array parameter\&.  Assignment is made before sorting or padding;
-if field splitting is active, the \fIword\fP part is split before
-assignment\&.  The \fIname\fP part may be a subscripted range for
-ordinary arrays; the \fIword\fP part \fImust\fP be converted to
-an array, for example by using `\fB${(AA)=\fP\fIname\fP\fB=\fP\&.\&.\&.\fB}\fP\&'
-to activate field splitting, when creating an associative array\&.
+array parameter\&.  Assignment is made before sorting or padding\&.
+The \fIname\fP part may be a subscripted range for ordinary
+arrays; the \fIword\fP part \fImust\fP be converted to an array, for
+example by using `\fB${(AA)=\fP\fIname\fP\fB=\fP\&.\&.\&.\fB}\fP\&' to activate
+field splitting, when creating an associative array\&.
 .TP
 \fBa\fP
 Sort in array index order; when combined with `\fBO\fP\&' sort in reverse
@@ -930,9 +926,7 @@
 .TP
 \fBc\fP
 With \fB${#\fP\fIname\fP\fB}\fP, count the total number of characters in an array,
-as if the elements were concatenated with spaces between them\&.  This is not
-a true join of the array, so other expressions used with this flag may have
-an effect on the elements of the array before it is counted\&.
+as if the elements were concatenated with spaces between them\&.
 .TP
 \fBC\fP
 Capitalize the resulting words\&.  `Words\&' in this case refers to sequences
@@ -1386,8 +1380,7 @@
 subscript\&.  Thus if \fBvar\fP is an array, \fB${var[1][2]}\fP is the second
 character of the first word, but \fB${var[2,4][2]}\fP is the entire third
 word (the second word of the range of words two through four of the
-original array)\&.  Any number of subscripts may appear\&.  Flags such as
-\fB(k)\fP and \fB(v)\fP which alter the result of subscripting are applied\&.
+original array)\&.  Any number of subscripts may appear\&.
 .TP
 \fB4\&.\fP \fIParameter name replacement\fP
 The effect of any \fB(P)\fP flag, which treats the value so far as a
@@ -1395,12 +1388,11 @@
 .TP
 \fB5\&.\fP \fIDouble\-quoted joining\fP
 If the value after this process is an array, and the substitution
-appears in double quotes, and neither an \fB(@)\fP flag nor a \fB#\fP
-length operator is present at the current level, then words of the
-value are joined with the first character of the parameter \fB$IFS\fP,
-by default a space, between each word (single word arrays are not
-modified)\&.  If the \fB(j)\fP flag is present, that is used for joining
-instead of \fB$IFS\fP\&.
+appears in double quotes, and no \fB(@)\fP flag is present at the current
+level, the words of the value are joined with the first character of the
+parameter \fB$IFS\fP, by default a space, between each word (single word
+arrays are not modified)\&.  If the \fB(j)\fP flag is present, that is used for
+joining instead of \fB$IFS\fP\&.
 .TP
 \fB6\&.\fP \fINested subscripting\fP
 Any remaining subscripts (i\&.e\&. of a nested substitution) are evaluated at
@@ -1770,14 +1762,14 @@
 It is also possible to define directory names using the \fB\-d\fP option to the
 \fBhash\fP builtin\&.
 .PP
-When the shell prints a path (e\&.g\&. when expanding \fB%~\fP in prompts or when
-printing the directory stack), the path is checked to see if it has a named
-directory as its prefix\&.  If so, then the prefix portion is replaced with a
-`\fB~\fP\&' followed by the name of the directory\&.
-The shorter of the two ways of referring to the directory is used,
-i\&.e\&. either the directory name or the full path; the name is used
-if they are the same length\&.
-The parameters \fB$PWD\fP and \fB$OLDPWD\fP are never abbreviated in this fashion\&.
+In certain circumstances (in prompts, for instance), when the shell
+prints a path, the path is checked to see if it has a named
+directory as its prefix\&.  If so, then the prefix portion
+is replaced with a `\fB~\fP\&' followed by the name of the directory\&.
+The shortest way of referring to the directory is used,
+with ties broken in favour of using a named directory,
+except when the directory is \fB/\fP itself\&.  The parameters \fB$PWD\fP and
+\fB$OLDPWD\fP are never abbreviated in this fashion\&.
 .PP
 .SS "`=\&' expansion"
 .PP
@@ -2018,12 +2010,10 @@
 Match the pattern in the parentheses\&.  (Like `\fB(\fP\&.\&.\&.\fB)\fP\&'\&.)
 .TP
 \fB*(\fP\&.\&.\&.\fB)\fP
-Match any number of occurrences\&.  (Like `\fB(\fP\&.\&.\&.\fB)#\fP\&',
-except that recursive directory searching is not supported\&.)
+Match any number of occurrences\&.  (Like `\fB(\fP\&.\&.\&.\fB)#\fP\&'\&.)
 .TP
 \fB+(\fP\&.\&.\&.\fB)\fP
-Match at least one occurrence\&.  (Like `\fB(\fP\&.\&.\&.\fB)##\fP\&',
-except that recursive directory searching is not supported\&.\&.)
+Match at least one occurrence\&.  (Like `\fB(\fP\&.\&.\&.\fB)##\fP\&'\&.)
 .TP
 \fB?(\fP\&.\&.\&.\fB)\fP
 Match zero or one occurrence\&.  (Like `\fB(|\fP\&.\&.\&.\fB)\fP\&'\&.)
diff -ruN zsh-5.0.4/Doc/zshmisc.1 zsh-5.0.2/Doc/zshmisc.1
--- zsh-5.0.4/Doc/zshmisc.1	2013-12-20 10:21:44.000000000 -0800
+++ zsh-5.0.2/Doc/zshmisc.1	2012-12-21 11:33:02.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHMISC" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHMISC" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshmisc \- everything and then some
 .\" Yodl file: Zsh/grammar.yo
@@ -1307,16 +1307,9 @@
 line (so that any terminating newline will still be present)\&.
 .RS
 .PP
-If any of the hook functions returns status 1 (or any non\-zero value
-other than 2, though this is not guaranteed for future versions of the
-shell) the history line will not be saved, although it lingers in the
-history until the next line is executed, allowing you to reuse or edit
-it immediately\&.
-.PP
-If any of the hook functions returns status 2 the history line
-will be saved on the internal history list, but not written to
-the history file\&.  In case of a conflict, the first non\-zero status
-value is taken\&.
+If any of the hook functions return a non\-zero value the history
+line will not be saved, although it lingers in the history until the
+next line is executed allow you to reuse or edit it immediately\&.
 .PP
 A hook function may call `\fBfc \-p\fP \fI\&.\&.\&.\fP\&' to switch the history
 context so that the history is saved in a different file from the
@@ -1324,13 +1317,10 @@
 the history context is automatically restored after the processing
 of the history line is finished\&.
 .PP
-The following example function works with one of the options
-\fBINC_APPEND_HISTORY\fP or \fBSHARE_HISTORY\fP set, in order that the line
-is written out immediately after the history entry is added\&.  It first
-adds the history line to the normal history with the newline stripped,
-which is usually the correct behaviour\&.  Then it switches the history
-context so that the line will be written to a history file in the
-current directory\&.
+The following example function first adds the history line to the normal
+history with the newline stripped,  which is usually the correct behaviour\&.
+Then it switches the history context so that the line will
+be written to a history file in the current directory\&.
 .PP
 .RS
 .nf
@@ -1571,16 +1561,6 @@
 Otherwise, signals have the values
 inherited by the shell from its parent
 (but see the \fBTRAP\fP\fINAL\fP special functions in the section `Functions\&')\&.
-.PP
-Certain jobs are run asynchronously by the shell other than those
-explicitly put into the background; even in cases where the shell
-would usually wait for such jobs, an explicit \fBexit\fP command
-or exit due to the option \fBERR_EXIT\fP will cause the shell to
-exit without waiting\&.  Examples of such asynchronous jobs are
-process substitution, see
-the section PROCESS SUBSTITUTION in the \fIzshexpn\fP(1) manual page, and the handler processes for
-multios, see
-the section MULTIOS in the \fIzshmisc\fP(1) manual page\&.
 .\" Yodl file: Zsh/arith.yo
 .SH "ARITHMETIC EVALUATION"
 The shell can perform integer and floating point arithmetic, either using
@@ -2188,12 +2168,10 @@
 specifies leading components, i\&.e\&. \fB%\-1d\fP specifies the first component\&.
 .TP
 \fB%~\fP
-As \fB%d\fP and \fB%/\fP, but if the current working directory starts with
-\fB$HOME\fP, that part is replaced by a `\fB~\fP\&'\&. Furthermore, if it has a named
+As \fB%d\fP and \fB%/\fP, but if the current working directory has a named
 directory as its prefix, that part is replaced by a `\fB~\fP\&' followed by
-the name of the directory, but only if the result is shorter than
-the full path; 
-see \fIDynamic\fP and \fIStatic named directories\fP in \fIzshexpn\fP(1)\&.
+the name of the directory\&.  If it starts with \fB$HOME\fP, that part is
+replaced by a `\fB~\fP\&'\&.
 .TP
 .PD 0
 \fB%h\fP
diff -ruN zsh-5.0.4/Doc/zshmodules.1 zsh-5.0.2/Doc/zshmodules.1
--- zsh-5.0.4/Doc/zshmodules.1	2013-12-20 10:21:44.000000000 -0800
+++ zsh-5.0.2/Doc/zshmodules.1	2012-12-21 11:33:03.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHMODULES" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHMODULES" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshmodules \- zsh loadable modules
 .\" Yodl file: Zsh/modules.yo
@@ -871,15 +871,15 @@
 These are, in order:
 .PD 0
 .TP
-\-
+
 The y and x coordinates of the cursor relative to the top left
 of \fItargetwin\fP
 .TP
-\-
+
 The y and x coordinates of the top left of \fItargetwin\fP on the
 screen
 .TP
-\-
+
 The size of \fItargetwin\fP in y and x dimensions\&.
 .PD
 .PP
@@ -1402,12 +1402,9 @@
 .PP
 A file may conveniently be read into an array as one line per element
 with the form
-`\fIarray\fP\fB=("${(f@)mapfile[\fP\fIfilename\fP\fB]}")\fP\&'\&.
-The double quotes and the `\fB@\fP\&' are necessary to prevent empty lines
-from being removed\&.  Note that if the file ends with a newline,
-the shell will split on the final newline, generating an additional
-empty field; this can be suppressed by using
-`\fIarray\fP\fB=("${(f@)${mapfile[\fP\fIfilename\fP\fB]%$\&'\en'}}")\fP'\&.
+`\fIarray\fP\fB=("${(f)mapfile[\fP\fIfilename\fP\fB]}")\fP\&'\&.
+The double quotes are necessary to prevent empty lines from being
+removed\&.
 .RE
 .RE
 .PP
@@ -1467,7 +1464,7 @@
 The function \fBsigngam\fP takes no arguments, and returns an integer, which
 is the C variable of the same name, as described in \fIgamma\fP(3)\&.  Note
 that it is therefore only useful immediately after a call to \fBgamma\fP or
-\fBlgamma\fP\&.  Note also that `\fBsigngam()\fP\&' and `\fBsigngam\fP' are
+\fBlgamma\fP\&.  Note also that `\fBsigngam(RPAR\fP\&' and `\fBsigngam\fP' are
 distinct expressions\&.
 .PP
 The following functions take two floating point arguments: \fBcopysign\fP,
@@ -1623,12 +1620,6 @@
 \fBdis_reswords\fP
 Like \fBreswords\fP but for disabled reserved words\&.
 .TP
-\fBpatchars\fP
-This array contains the enabled pattern characters\&.
-.TP
-\fBdis_patchars\fP
-Like \fBpatchars\fP but for disabled pattern characters\&.
-.TP
 \fBaliases\fP
 This maps the names of the regular aliases currently enabled to their
 expansions\&.
diff -ruN zsh-5.0.4/Doc/zshoptions.1 zsh-5.0.2/Doc/zshoptions.1
--- zsh-5.0.4/Doc/zshoptions.1	2013-12-20 10:21:44.000000000 -0800
+++ zsh-5.0.2/Doc/zshoptions.1	2012-12-21 11:33:03.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHOPTIONS" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHOPTIONS" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshoptions \- zsh options
 .\" Yodl file: Zsh/options.yo
@@ -290,11 +290,6 @@
 for filename generation, etc\&.  (An initial unquoted `\fB~\fP\&'
 always produces named directory expansion\&.)
 .TP
-\fBFORCE_FLOAT\fP
-Constants in arithmetic evaluation will be treated as floating point
-even without the use of a decimal point\&.  Integers in any base
-will be converted\&.
-.TP
 \fBGLOB\fP (\fB+F\fP, ksh: \fB+f\fP) <D>
 Perform filename generation (globbing)\&.
 (See the section `Filename Generation\&'\&.)
@@ -777,7 +772,6 @@
 .TP
 \fBPRINT_EXIT_VALUE\fP (\fB\-1\fP)
 Print the exit value of programs with non\-zero exit status\&.
-This is only available at the command line in interactive shells\&.
 .TP
 \fBRC_QUOTES\fP
 Allow the character sequence `\fB\&''\fP' to signify a single quote
@@ -962,10 +956,6 @@
 as it is by default, and the option \fBERR_EXIT\fP is found to have been set
 on exit, then the command for which the \fBDEBUG\fP trap is being executed is
 skipped\&.  The option is restored after the trap exits\&.
-.PP
-Exiting due to \fBERR_EXIT\fP has certain interactions with asynchronous
-jobs noted in
-the section JOBS in in \fIzshmisc\fP(1)\&.
 .RE
 .TP
 \fBERR_RETURN\fP
@@ -1008,15 +998,6 @@
 with a formulation like `\fBemulate \-L zsh\fP\&'; the \fB\-L\fP activates
 \fBLOCAL_OPTIONS\fP\&.
 .TP
-\fBLOCAL_PATTERNS\fP
-If this option is set at the point of return from a shell function,
-the state of pattern disables, as set with the builtin command
-`\fBdisable \-p\fP\&', is restored to what it was when the function was
-entered\&.  The behaviour of this option is similar to the effect
-of \fBLOCAL_OPTIONS\fP on options; hence `\fBemulate \-L sh\fP\&' (or
-indeed any other emulation with the \fB\-L\fP option) activates
-\fBLOCAL_PATTERNS\fP\&.
-.TP
 \fBLOCAL_TRAPS\fP <K>
 If this option is set when a signal trap is set inside a function, then the
 previous status of the trap for that signal will be restored when the
@@ -1061,13 +1042,6 @@
 of leading zeroes\&.
 .RE
 .TP
-\fBPIPE_FAIL\fP
-By default, when a pipeline exits the exit status recorded by the shell
-and returned by the shell variable \fB$?\fP reflects that of the
-rightmost element of a pipeline\&.  If this option is set, the exit status
-instead reflects the status of the rightmost element of the pipeline
-that was non\-zero, or zero if all elements exited with zero status\&.
-.TP
 \fBSOURCE_TRACE\fP
 If set, zsh will print an informational message announcing the name of
 each file it loads\&.  The format of the output is similar to that
diff -ruN zsh-5.0.4/Doc/zshparam.1 zsh-5.0.2/Doc/zshparam.1
--- zsh-5.0.4/Doc/zshparam.1	2013-12-20 10:21:45.000000000 -0800
+++ zsh-5.0.2/Doc/zshparam.1	2012-12-21 11:33:03.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHPARAM" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHPARAM" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshparam \- zsh parameters
 .\" Yodl file: Zsh/params.yo
@@ -475,15 +475,9 @@
 the section `Invocation\&', and also the section `Functions'\&.
 The parameter \fIn\fP, where \fIn\fP is a number,
 is the \fIn\fPth positional parameter\&.
-The parameter `\fB$0\fP\&' is a special case, see
-the section `Parameters Set By The Shell\&'\&.
-.PP
 The parameters \fB*\fP, \fB@\fP and \fBargv\fP are
 arrays containing all the positional parameters;
 thus `\fB$argv[\fP\fIn\fP\fB]\fP\&', etc\&., is equivalent to simply `\fB$\fP\fIn\fP'\&.
-Note that the options \fBKSH_ARRAYS\fP or \fBKSH_ZERO_SUBSCRIPT\fP apply
-to these arrays as well, so with either of those options set,
-`\fB${argv[0]}\fP\&' is equivalent to `\fB$1\fP' and so on\&.
 .PP
 Positional parameters may be changed after the shell or function starts by
 using the \fBset\fP builtin, by assigning to the \fBargv\fP array, or by direct
@@ -963,15 +957,6 @@
 The file to save the history in when an interactive shell exits\&.
 If unset, the history is not saved\&.
 .TP
-\fBHISTORY_IGNORE\fP
-If set, is treated as a pattern at the time history files are written\&.
-Any potential history entry that matches the pattern is skipped\&.  For
-example, if the value is `\fBfc *\fP\&' then commands that invoke the
-interactive history editor are never written to the history file (compare
-the \fBHIST_NO_STORE\fP option or the \fBzshaddhistory\fP hook, either of
-which would prevent such commands from being added to the interactive
-history at all)\&.
-.TP
 \fBHISTSIZE\fP <S>
 The maximum number of events stored in the internal history list\&.
 If you use the \fBHIST_EXPIRE_DUPS_FIRST\fP option, setting this value
@@ -1198,7 +1183,7 @@
 In sh or ksh emulation, the default is `\fB+ \fP\&'\&.
 .TP
 \fBpsvar\fP <S> <Z> (\fBPSVAR\fP <S>)
-An array (colon\-separated list) whose elements can be used in
+An array (colon\-separated list) whose first nine values can be used in
 \fBPROMPT\fP strings\&.  Setting \fBpsvar\fP also sets \fBPSVAR\fP, and
 vice versa\&.
 .TP
@@ -1556,18 +1541,4 @@
 See the completion system documentation in
 \fIzshcompsys\fP(1)\&.
 .RE
-.TP
-\fBZLE_RPROMPT_INDENT <S>\fP
-If set, used to give the indentation between the right hand side of
-the right prompt in the line editor as given by \fBRPS1\fP or \fBRPROMPT\fP
-and the right hand side of the screen\&.  If not set, the value 1 is used\&.
-.RS
-.PP
-Typically this will be used to set the value to 0 so that the prompt
-appears flush with the right hand side of the screen\&.  This is not the
-default as many terminals do not handle this correctly, in particular
-when the prompt appears at the extreme bottom right of the screen\&.
-Recent virtual terminals are more likely to handle this case correctly\&.
-Some experimentation is necessary\&.
-.RE
 .RE
diff -ruN zsh-5.0.4/Doc/zshroadmap.1 zsh-5.0.2/Doc/zshroadmap.1
--- zsh-5.0.4/Doc/zshroadmap.1	2013-12-20 10:21:45.000000000 -0800
+++ zsh-5.0.2/Doc/zshroadmap.1	2012-12-21 11:33:03.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHROADMAP" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHROADMAP" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshroadmap \- informal introduction to the zsh manual
 .\" Yodl file: Zsh/roadmap.yo
diff -ruN zsh-5.0.4/Doc/zshtcpsys.1 zsh-5.0.2/Doc/zshtcpsys.1
--- zsh-5.0.4/Doc/zshtcpsys.1	2013-12-20 10:21:45.000000000 -0800
+++ zsh-5.0.2/Doc/zshtcpsys.1	2012-12-21 11:33:03.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHTCPSYS" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHTCPSYS" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshtcpsys \- zsh tcp system
 .\" Yodl file: Zsh/tcpsys.yo
diff -ruN zsh-5.0.4/Doc/zshzftpsys.1 zsh-5.0.2/Doc/zshzftpsys.1
--- zsh-5.0.4/Doc/zshzftpsys.1	2013-12-20 10:21:45.000000000 -0800
+++ zsh-5.0.2/Doc/zshzftpsys.1	2012-12-21 11:33:03.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHZFTPSYS" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHZFTPSYS" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshzftpsys \- zftp function front\-end
 .\" Yodl file: Zsh/zftpsys.yo
diff -ruN zsh-5.0.4/Doc/zshzle.1 zsh-5.0.2/Doc/zshzle.1
--- zsh-5.0.4/Doc/zshzle.1	2013-12-20 10:21:45.000000000 -0800
+++ zsh-5.0.2/Doc/zshzle.1	2012-12-21 11:33:04.000000000 -0800
@@ -1,4 +1,4 @@
-.TH "ZSHZLE" "1" "December 20, 2013" "zsh 5\&.0\&.4"
+.TH "ZSHZLE" "1" "December 21, 2012" "zsh 5\&.0\&.2"
 .SH "NAME"
 zshzle \- zsh command line editor
 .\" Yodl file: Zsh/zle.yo
@@ -355,9 +355,6 @@
 .PD 0
   [ \fB\-M\fP \fImain\-keymap\fP ] [ \fB\-m\fP \fIvicmd\-keymap\fP ]
 .TP
-.PD 0
-  [ \fB\-i\fP \fIinit\-widget\fP ] [ \fB\-f\fP \fIfinish\-widget\fP ]
-.TP
 .PD
   [ \fB\-t\fP \fItty\fP ] \fIname\fP
 The value of the parameter \fIname\fP is loaded into the edit
@@ -395,10 +392,6 @@
 is normally needed but the \fB\-m\fP option may still be used\&.  On exit, the
 previous keymaps will be restored\&.
 .PP
-\fBVared\fP calls the usual `\fBzle\-line\-init\fP\&' and `\fBzle\-line\-finish\fP'
-hooks before and after it takes control\&. Using the \fB\-i\fP and \fB\-f\fP
-options, it is possible to replace these with other custom widgets\&.
-.PP
 If `\fB\-t\fP \fItty\fP\&' is given, \fItty\fP is the name of a terminal device
 to be used instead of the default \fB/dev/tty\fP\&.  If \fItty\fP does not
 refer to a terminal an error is reported\&.
@@ -435,7 +428,7 @@
 \fBzle\fP \fB\-K\fP \fIkeymap\fP
 .TP
 .PD 0
-\fBzle\fP \fB\-F\fP [ \fB\-L\fP | \fB\-w\fP ] [ \fIfd\fP [ \fIhandler\fP ] ]
+\fBzle\fP \fB\-F\fP [ \fB\-L\fP ] [ \fIfd\fP [ \fIhandler\fP ] ]
 .TP
 .PD 0
 \fBzle\fP \fB\-I\fP
@@ -561,7 +554,7 @@
 command line) will start as usual with the `\fBmain\fP\&' keymap selected\&.
 .RE
 .TP
-\fB\-F\fP [ \fB\-L\fP | \fB\-w\fP ] [ \fIfd\fP [ \fIhandler\fP ] ]
+\fB\-F\fP [ \fB\-L\fP ] [ \fIfd\fP [ \fIhandler\fP ] ]
 Only available if your system supports one of the `poll\&' or `select' system
 calls; most modern systems do\&.
 .RS
@@ -577,13 +570,6 @@
 readable when installing the handler\&.  The user must make their own
 arrangements for handling the file descriptor when zle is not active\&.
 .PP
-If the option \fB\-w\fP is also given, the \fIhandler\fP is instead a
-line editor widget, typically a shell function made into a widget using
-\fBzle \-N\fP\&.  In that case \fIhandler\fP can use all the facilities of
-zle to update the current editing line\&.  Note, however, that as handling
-\fIfd\fP takes place at a low level changes to the display will not
-automatically appear; the widget should call \fBzle \-R\fP to force redisplay\&.
-.PP
 Any number of handlers for any number of readable file descriptors may be
 installed\&.  Installing a handler for an \fIfd\fP which is already handled
 causes the existing handler to be replaced\&.
diff -ruN zsh-5.0.4/Doc/ztexi.yo zsh-5.0.2/Doc/ztexi.yo
--- zsh-5.0.4/Doc/ztexi.yo	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Doc/ztexi.yo	2008-01-03 09:04:10.000000000 -0800
@@ -71,7 +71,7 @@
   NOTRANS(@ifinfo)+NL()\
   NOTRANS(@dircategory Utilities)+NL()\
   NOTRANS(@direntry)+NL()\
-  NOTRANS(* ZSH: (zsh).                     The Z Shell Manual.)+NL()\
+  NOTRANS(     * ZSH: (zsh).                     The Z Shell Manual.)+NL()\
   NOTRANS(@end direntry)+NL()\
   NOTRANS(@end ifinfo)+NL()\
 )
@@ -193,8 +193,8 @@
   startitem()\
 )
 def(endlist)(0)(\
-  enditem()+NL()\
-  NOTRANS(@sp 1)\
+  NOTRANS(@item)+NL()\
+  enditem()\
 )
 def(list)(1)(\
   item(ARG1)()\
diff -ruN zsh-5.0.4/Etc/ChangeLog-3.0 zsh-5.0.2/Etc/ChangeLog-3.0
--- zsh-5.0.4/Etc/ChangeLog-3.0	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Etc/ChangeLog-3.0	2011-05-20 12:13:17.000000000 -0700
@@ -1093,20 +1093,20 @@
 	* Src/subst.c: Zoltan's patch for rcexpandparam bug, from
 	zsh-workers 3548.
 
-Thu Sep 26 01:57:07 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Sep 26 01:57:07 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0.5 released
 
 	* Src/rlimits.awk: SunOS 4 nawk doesn't support /re/ || /re/ { ... }
 
-Thu Sep 25 05:00:07 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Sep 25 05:00:07 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Spelling and zrealloc fix from Martin Buchholz <mrb@Eng.Sun.COM>
 	  (3478)
 
 	* After a='a ' ${(o)=a}b should expand to two words, `a' `b'.
 
-Sun Sep 21 07:48:07 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Sep 21 07:48:07 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_main.c, Src/zle_tricky.c: Use gotmult instead of
 	  zmult	!= 1 to test for prefix-arg.  From Bart (3322)
@@ -1130,14 +1130,14 @@
  	  determine the file marks.  From Peter (3285) with some fixes by
  	  me.
 
-Sat Sep 20 06:37:55 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Sep 20 06:37:55 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c: typeset -U array; array=(1 2 1) created a
  	  non-unique array.
 
 	* Src/math.c: $((0x1+0x2)) did not work
 
-Fri Sep 19 05:46:49 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Sep 19 05:46:49 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: Remove wrong (int (*)(void)) prototype
  	  from match_username cast.  Go back to no prototype at all, since
@@ -1147,7 +1147,7 @@
 	* Src/params.c: Keep the old environment until the new environment
  	  is completely built.
 
-Tue Sep 16 04:43:25 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Sep 16 04:43:25 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: Show explanation if there are no or more
  	  than one possible completions.
@@ -1160,14 +1160,14 @@
  	  Src/utils.c: Setting LINES and COLUMNS manually now works, and
  	  it is equivalent to stty rows and stty columns.
 
-Sat Aug  2 20:00:18 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Aug  2 20:00:18 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c, Src/utils.c, Src/zsh.h: RC_EXPAND_PARAM fixes
 
 	* Src/parse.c: [[ bug bug ]] bug caused BUG: wrong character in
 	  hungetc()
 
-Sun Jul 13 07:53:01 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jul 13 07:53:01 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c: */ should only glob searchable directories or
  	  directory links.
@@ -1180,7 +1180,7 @@
 
 	* Src/builtin.c: Read builtin cleanup, handle backslashes correctly
 
-Mon Jun 30 04:48:17 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun 30 04:48:17 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/jobs.c: bg should set STAT_NOSTTY.  From SUZUKI Hisao
  	  <suzuki@otsl.oki.co.jp>
@@ -1188,7 +1188,7 @@
 	* Src/exec.c, Src/jobs.c, Src/zsh.h: Ignore tty settings set by
  	  background jobs
 
-Mon Jun 23 05:57:10 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun 23 05:57:10 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0.4 released
 
@@ -1196,28 +1196,28 @@
 
 	* Src/glob.c: The pattern *a~b did not match aa.  From Peter (3249)
 
-Sun Jun 22 23:08:08 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun 22 23:08:08 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_refresh.c: zle refresh coredump fix from Geoff (3260)
 
-Sat Jun 21 02:52:35 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jun 21 02:52:35 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/jobs.c: Do not inherit tty settings from suspended jobs.
 
 	* configure, configure.in: Use case instead of sed hack to test
 	  for aix
 
-Fri Jun 20 03:58:04 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun 20 03:58:04 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/jobs.c: Another attempt to get tty settings right
 
-Tue Jun 17 05:53:19 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 17 05:53:19 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c: paramsubst return the array elements directly
  	  without copying them which can lead to data corruption.  From
  	  Zefram (3250)
 
-Mon Jun 16 05:35:01 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun 16 05:35:01 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: autoparamkeys and completeinword did not
  	  work well when : is pressed after a successfull completion
@@ -1232,14 +1232,14 @@
 	* Src/params.c: Put only valid exported zsh parameters into the
  	  new environment
 
-Fri Jun  6 06:23:29 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun  6 06:23:29 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/jobs.c: zsh forgot stty settings when a backgrounded job
  	  terminated while zle was active.  From Peter (3196)
 
 ---- Version 3.1 diverged from 3.0 at this point, later to become 4.0 ----
 
-Tue Jun  3 06:14:14 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun  3 06:14:14 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0.3 released
 
@@ -1247,30 +1247,30 @@
 
 	* Src/jobs.c: pg(){ less;};:|pg caused suspended (tty input)
 
-Mon Jun  2 07:17:08 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun  2 07:17:08 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_refresh.c: Xterm cut & paste fixes from Geoff (3135)
 
 	* Src/hist.c: Fix !# history expansion during completion.  From
  	  Peter (3132)
 
-Sun Jun  1 08:02:19 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun  1 08:02:19 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/system.h: Use _POSIX_VDISABLE is available.  Fixes ^@ in zle
  	  on some systems.
 
-Thu May 29 05:17:31 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 29 05:17:31 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/cond.c: directories are always executable by root
 
 	* META-FAQ: The zsh web page moved.
 
-Tue May 20 05:22:16 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May 20 05:22:16 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c: if abort or edit used on a correct prompt, do not
  	  attempt to correct further words on the line.
 
-Sun May 18 18:57:08 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May 18 18:57:08 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/exec.c, Src/init.c, Src/signals.c, Src/jobs.c:
  	  Do not handle SIGPIPE specially for shells with job control
@@ -1282,11 +1282,11 @@
 	* Src/exec.c, Src/signals.c: `:`; while true; do; done was
  	  uninterruptible
 
-Mon May 12 09:01:55 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May 12 09:01:55 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hist.c: !:2-1 history expansion caused memory corruption
 
-Sun May 11 08:52:00 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May 11 08:52:00 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c: $((foo);bar) syntax works
 
@@ -1299,7 +1299,7 @@
 	* Src/builtin.c: make sure zexit is not reentered when its
  	  execution is interrupted by a signal.
 
-Fri May  9 07:59:00 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri May  9 07:59:00 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi: @br{} removed
 
@@ -1309,7 +1309,7 @@
 	* Src/jobs.c: printjobs() set errflag when the foreground process
  	  was interrupted.
 
-Thu May  8 09:18:56 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May  8 09:18:56 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/cond.c: [[ -x file ]] does stat for privileged users
 
@@ -1320,40 +1320,40 @@
 	* Src/zle_tricky.c, Src/hist.c, Src/lex.c, Src/parse.c:
 	  ((foo);bar) now works
 
-Tue May  6 05:56:36 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May  6 05:56:36 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/signals.c: WINCH traps did not work.  From Peter (3093)
 
-Wed Apr 30 07:40:30 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Apr 30 07:40:30 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/text.c: printing case commands were broken.  From Zefram (3062)
 
-Mon Apr 28 07:28:34 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Apr 28 07:28:34 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/system.h, acconfig.h, config.h.in, configure,
  	  configure.in, Src/rlimits.c: Use rlim_t if available
 
 	* Etc/FAQ: March 24 1997 FAQ from Peter
 
-Sat Apr 26 06:26:11 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Apr 26 06:26:11 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Functions/zed: Reenter zed if it fails to save the file
 
 	* Functions/zed: Use bindkey -L to temporarily save bindings.
   	  From Zefram (3012)
 
-Fri Apr 25 06:41:36 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Apr 25 06:41:36 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Functions/cdmatch, Misc/compctl-examples: compctl-examples
  	  improvements from Zefram (3006)
 
 	* Src/globals.h: NOTIFY is off in sh/ksh mode.  From Zefram (3003)
 
-Sun Apr 20 07:24:12 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Apr 20 07:24:12 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c, Src/params.c, Src/utils.c: Remove setintenv()
 
-Tue Apr 15 05:51:27 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Apr 15 05:51:27 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_refresh.c: SGTABTYPE can contain more than one bit
  	  set.  From Geoff (2976)
@@ -1366,7 +1366,7 @@
 	* Src/builtin.c: vared path caused permanent
  	  allocation in arrayfixenv
 
-Sat Mar  8 00:17:24 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Mar  8 00:17:24 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: Sometimes an incorrect compctl
  	  caused a core dump.  From Peter (2942)
@@ -1380,7 +1380,7 @@
  	  terminals centralized in zlevarsetfn().  From Bart and me (2956,
  	  2957)
 
-Fri Mar  7 23:54:18 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Mar  7 23:54:18 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle.h, Src/zle_misc.c, Src/zle_refresh.c,
 	  Src/utils.c: act as if single_line_zle were set when LINES < 3.
@@ -1404,17 +1404,17 @@
 
 	* Src/lex.c: eval \$\{$#\} did not work
 
-Mon Jan 27 22:04:29 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jan 27 22:04:29 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/signals.c: temprarily set breaks to zero when executing a trap
 
 	* Src/exec.c: do not reset breaks in doshfunc
 
-Sun Jan 26 02:55:02 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jan 26 02:55:02 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c: set noerrexit to -1 in setupvals()
 
-Sat Jan 25 20:07:46 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jan 25 20:07:46 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c, Src/utils.c: some assignments were missing from my
  	  spacesplit fix
@@ -1425,7 +1425,7 @@
 	* Src/zle.h, Src/zle_misc.c, Src/zle_refresh.c:
  	  redisplay fix for multiline prompts from Geoff (2817)
 
-Mon Jan 20 21:11:22 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jan 20 21:11:22 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hashtable.h, acconfig.h, config.h.in, configure,
  	  configure.in: some old compilers cannot initialise a union
@@ -1433,16 +1433,16 @@
 	* Src/zle_utils.c: move the mark when characters are
 	  inserted/deleted.  From Peter (2807)
 
-Sat Jan 18 22:34:17 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jan 18 22:34:17 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* acconfig.h, config.h.in, configure, configure.in: use the
  	  AC_FUNC_STRCOLL builtin autoconf test
 
-Tue Jan 14 13:52:36 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jan 14 13:52:36 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_move.c: vi-goto-column did not move to the last column
 
-Sat Jan 11 23:45:50 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jan 11 23:45:50 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/system.h: define lstat(X,Y) instead of lstst if HAVE_LSTAT
  	  is not defined
@@ -1456,12 +1456,12 @@
 
 	* Src/builtin.c: fix bugs when there was no current job after disown
 
-Thu Jan  9 14:44:28 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jan  9 14:44:28 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hist.c: Peter's patch broke history expansion in some cases.
   	  From Peter (2755)
 
-Wed Jan  8 22:02:51 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jan  8 22:02:51 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/globals.h, Src/hist.c, Src/lex.c: hist_ignore_dups did not
  	  work with fc in precmd().  From Peter (2748)
@@ -1469,7 +1469,7 @@
 	* configure, configure.in: on NetBSD <sys/time.h> is needed for
  	  rlimit type checks.  Based on article 2742 from Geoff
 
-Tue Jan  7 23:10:24 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jan  7 23:10:24 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c, Src/builtin.c, Src/exec.c: print error when
 	  changing read-only variables, prevent core dump when assigning
@@ -1477,12 +1477,12 @@
 
 	* Src/zle_tricky.c: compctl -S bugfix
 
-Mon Jan  6 20:43:36 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jan  6 20:43:36 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, acconfig.h, config.h.in, configure, configure.in:
 	  better /dev/fd filesystem check
 
-Sun Jan  5 23:33:32 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jan  5 23:33:32 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/system.h, Src/utils.c, acconfig.h,
  	  config.h.in, configure, configure.in: checks for quad_t and
@@ -1496,17 +1496,17 @@
 	* Src/zle_main.c: EOF ignored in interactive mode when not in
  	  the first line.  From Peter (2713)
 
-Fri Jan  3 02:26:03 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jan  3 02:26:03 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Misc/compctl-examples: setopt/unsetopt compctl fixes
 
-Thu Jan  2 20:57:33 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jan  2 20:57:33 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* configure, configure.in: alpha-linux defines signals in
  	  <asm/signum.h>.  From David Krinsky <krinsky@hcs.harvard.edu>
  	  (2706)
 
-Wed Jan  1 20:04:06 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jan  1 20:04:06 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c, Src/hashtable.h: remove the struct iparam hack
  	  which assumed that sizeof(long) == sizeof(void*)
@@ -1514,7 +1514,7 @@
 	* Src/system.h, configure, configure.in: dgux CLOBBERS_TYPEAHEAD.
   	  From Roderick Schertler <roderick@gate.net> (2623)
 
-Tue Dec 31 02:28:09 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Dec 31 02:28:09 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c, Src/params.c, Src/utils.c: use
  	  dupstrpfx/ztrduppfx
@@ -1523,7 +1523,7 @@
  	  foo='echo ' ; alias bar=foo, foo bar should expand to foo echo.
   	  From Peter (2558)
 
-Sun Dec 29 22:34:21 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Dec 29 22:34:21 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Doc/zshexpn.man, Doc/zshmisc.man, Src/glob.c,
  	  Src/lex.c: brace related bugfixes
@@ -1533,7 +1533,7 @@
 	* Src/exec.c, Src/loop.c, Src/parse.c: case argument should not be
  	  globbed
 
-Thu Dec 19 21:37:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Dec 19 21:37:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* zsh-3.0.2 repacked
 
@@ -1543,7 +1543,7 @@
 	* Etc/FAQ: FAQ from Peter: Id: zsh.FAQ,v 2.22 1996/12/19 09:52:11
  	  pws Exp
 
-Tue Dec 17 20:08:58 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Dec 17 20:08:58 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0.2 released
 
@@ -1552,7 +1552,7 @@
 	* Src/Makefile.in: rlimits.h depends on rlimits.awk.  Cosmetic
  	  changes.  From Zefram (2589)
 
-Mon Dec 16 03:33:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Dec 16 03:33:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* README: unknown limits should no longer be a problem
 
@@ -1562,14 +1562,14 @@
 	* Src/builtin.c: fg %% failed and disabled job control sometimes
  	  when there were no current job
 
-Sun Dec 15 22:09:21 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Dec 15 22:09:21 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Doc/zshzle.man, Src/zle_hist.c:
  	  insert-last-word with numeric arguments inserts the given word
  	  from the previous history event.  From Bart (2445),
  	  documentation by me.
 
-Sat Dec 14 02:44:21 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Dec 14 02:44:21 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c (execcmd): builtin < / > / closed stdin
 
@@ -1582,7 +1582,7 @@
 
 	* configure, configure.in: working fifos should be tested in /tmp
 
-Wed Dec 11 02:30:39 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Dec 11 02:30:39 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c, Src/builtin.c, Src/exec.c, Src/globals.h,
  	  Src/hist.c, Src/init.c, Src/input.c, Src/lex.c, Src/zsh.h:
@@ -1593,7 +1593,7 @@
 
 	* Src/params.c: use the heap in getstrvalue()
 
-Tue Dec 10 02:27:35 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Dec 10 02:27:35 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_refresh.c: single line zle refresh bugfix from Geoff
  	  (2549)
@@ -1608,7 +1608,7 @@
 
 	* Src/builtin.c: use the heap in zexit()
 
-Sun Dec  8 21:32:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Dec  8 21:32:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/input.c: no further input should be attempted when lexstop
  	  is true (e.g. after eof).
@@ -1637,7 +1637,7 @@
 	* Src/builtin.c: show metafied characters correctly in bad option
  	  errors.  From Zefram (2497)
 
-Tue Nov 26 02:45:15 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Nov 26 02:45:15 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c: the STTY parameter did not work well when pipes were
  	  used.  From Peter (2474)
@@ -1645,11 +1645,11 @@
 	* Etc/FAQ: FAQ from Peter: Id: zsh.FAQ,v 2.21 1996/11/25 09:13:28
  	  pws Exp
 
-Sun Nov 24 22:44:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Nov 24 22:44:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_move.c: vi-goto-mark fix from Thorsten
 
-Sat Nov 23 23:34:58 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Nov 23 23:34:58 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c:
 	  ((...)) substituted the expression twice and coredumped on (())
@@ -1657,7 +1657,7 @@
 	* Doc/zsh.texi, Doc/zshcompctl.man: compctl -e clarification from
  	  Peter (2453)
 
-Wed Nov 20 00:58:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Nov 20 00:58:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c: The spell checker always tries to fix as many
  	  leading directory compontents as possible.  From Bart (2429)
@@ -1665,7 +1665,7 @@
 	* Src/zle_tricky.c: my spell-word fix used an uninitialised
  	  pointer.  Fix from Bart (2428)
 
-Sun Nov 17 21:21:22 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Nov 17 21:21:22 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c: remove a few memory leaks when initialising the
  	  parameter table.
@@ -1676,7 +1676,7 @@
 	* Src/exec.c, Src/parse.c, Src/text.c, Src/zsh.h: do not convert
  	  ((...)) to builtin let internally.
 
-Sat Nov 16 23:57:40 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Nov 16 23:57:40 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: spell-word zle function did not work for word
  	  beginning with a tilde
@@ -1690,11 +1690,11 @@
 	* Src/zle_tricky.c: the cursor moved back on TAB when it was on
  	  "".  From Zefram (2415)
 
-Thu Nov 14 12:59:25 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Nov 14 12:59:25 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_refresh.c: one more refresh fix from Geoff (2404)
 
-Wed Nov 13 21:47:28 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Nov 13 21:47:28 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* config.guess, config.sub: recognize i[6-9]86
 
@@ -1709,11 +1709,11 @@
 
 	* Src/zle_refresh.c: zle_refresh scrolling change from Geoff (2351)
 
-Tue Nov 12 21:35:18 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Nov 12 21:35:18 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c, Src/zle_refresh.c: zle-refresh patch from Geoff (2336)
 
-Sun Nov  3 23:00:05 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Nov  3 23:00:05 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/system.h: set OPEN_MAX to 64 if NOFILE is not defined
 
@@ -1723,7 +1723,7 @@
 	* Functions/pushd: setopt localoptions must come after
 	  emulate -R zsh
 
-Sat Nov  2 22:47:53 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Nov  2 22:47:53 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/compat.c, Src/hashtable.c, Src/utils.c: do not blindly
  	  assume that . and .. are always the first two enrties in a
@@ -1732,7 +1732,7 @@
 
 	* Src/utils.c: max_zsh_fd should not be decreased below zero
 
-Thu Oct 31 01:38:10 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Oct 31 01:38:10 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hist.c: zsh splitted lines longer than 1022 while reading
  	  the history file
@@ -1741,7 +1741,7 @@
 
 	* Src/builtin.c: read -c ignored its first parameter
 
-Fri Oct 25 20:50:38 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Oct 25 20:50:38 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0.1 released
 
@@ -1751,7 +1751,7 @@
 
 	* Src/zle_main.c: key binding coredump fix from Peter (2131)
 
-Thu Oct 24 10:02:00 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Oct 24 10:02:00 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: A minor bugfix related to alwayslastprompt and
  	  compctl -X from Geoff (2255)
@@ -1760,28 +1760,28 @@
 
 	* Etc/FAQ: checked in with -k by hzoli at 1996/10/25 19:57:51
 
-Mon Oct 21 20:39:19 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Oct 21 20:39:19 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Doc/zshoptions.man: Better documentation of
  	  GLOB_ASSIGN and MAGIC_EQUAL_SUBST from Peter (2164)
 
-Sun Oct 20 00:08:41 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Oct 20 00:08:41 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* configure, configure.in: I made a stupid mistake in the Cray
  	  hacks for nis_list
 
-Sat Oct 19 19:39:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Oct 19 19:39:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* configure, configure.in: allow cross-compiling
 
-Fri Oct 18 20:34:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Oct 18 20:34:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.man, Doc/zsh.texi, Doc/zshall.man: Paul Falstad's
  	  preferred E-mail address is pjf@cts.com
 
 	* Src/hist.c: A little simplifiction.
 
-Wed Oct 16 22:58:08 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Oct 16 22:58:08 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/BUGS: sed in HP-UX 10.20 is broken.
 
@@ -1789,7 +1789,7 @@
  	  that from the directory stack.  popd should warn when the
  	  directory stack is empty.  From Bart (zsh-users 437)
 
-Tue Oct 15 21:07:03 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Oct 15 21:07:03 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_utils.c: use int instead of char in getzlequery
 
@@ -1811,7 +1811,7 @@
 	* Src/zle_refresh.c: bugfix and optimisation for poor terminals
  	  from Geoff (2221)
 
-Tue Oct  8 23:19:38 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Oct  8 23:19:38 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/BUGS, Etc/CONTRIBUTORS, Etc/MACHINES, Etc/NEWS: spell fixes
  	  from Geoff (2190)
@@ -1821,7 +1821,7 @@
 	* Src/prototypes.h, acconfig.h, config.h.in, configure,
  	  configure.in: make compilation possible on OSF/1 V4.x with gcc
 
-Tue Oct  8 00:16:29 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Oct  8 00:16:29 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c: PS3 and PS4 were only initialized in non-interactive
  	  shells
@@ -1845,7 +1845,7 @@
 
 	* Src/utils.c: a litle optimization
 
-Sun Oct  6 12:21:08 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Oct  6 12:21:08 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Functions/cdmatch, Functions/cdmatch2, Functions/multicomp: add
  	  emulate -R zsh to some function examples.  From Bart (2172)
@@ -1857,7 +1857,7 @@
 	* Doc/zsh.texi, Doc/zshexpn.man, Etc/NEWS, Src/glob.c: trailing /
  	  in a glob pattern now works like in other shells.
 
-Thu Oct  3 00:02:35 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Oct  3 00:02:35 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* configure, configure.in: on AIX curses should always be
  	  preferred to termcap
@@ -1870,13 +1870,13 @@
 
 	* Src/glob.c: echo foo(:t:r) gave no matches error
 
-Tue Oct  1 00:50:49 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Oct  1 00:50:49 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/exec.c, Src/hashtable.h, Src/params.c,
  	  Src/zle_tricky.c: dots no longer appear in place of empty
  	  components of PATH, MANPATH etc.
 
-Sat Sep 28 21:22:31 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Sep 28 21:22:31 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zsh.h, Src/builtin.c, Src/hashtable.h, Src/init.c,
  	  Src/jobs.c, Src/params.c, Src/utils.c, Src/zle_misc.c,
@@ -1895,7 +1895,7 @@
 	* Src/init.c: initialise ttystrname in init_io to avoid duplicated
  	  call of ttyname
 
-Tue Sep 24 19:45:30 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Sep 24 19:45:30 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_refresh.c: one character long prompts did not work.
   	  From Geoff (2118)
@@ -1907,7 +1907,7 @@
 	* Src/zle_utils.c: ^C answer to a query printed a funny character.
 	  From hoh@approve.se (Goran Larsson) (2144)
 
-Mon Sep 23 23:28:38 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Sep 23 23:28:38 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c: array assignments stopped working after my previous fix
 
@@ -1922,7 +1922,7 @@
 	* Src/builtin.c: POSIX: shift n should fail with error message if
  	  n > $#
 
-Sat Sep 14 04:19:41 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Sep 14 04:19:41 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c: metafy/unmetafy speedups
 
@@ -1937,13 +1937,13 @@
 
 	* Src/params.c: shift <number> did not work
 
-Fri Sep 13 03:30:51 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Sep 13 03:30:51 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: read builtin simplifications and improvements
 
 	* Src/builtin.c: the read builtin did not handle meta characters
 
-Sat Sep  7 15:19:40 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Sep  7 15:19:40 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c, config.h.in, configure, configure.in:
 	  setting the USERNAME parameter executes initgroups()
@@ -1951,7 +1951,7 @@
 	* configure, configure.in: define HAVE_NIS_PLUS only if the
  	  nis_list function is found
 
-Tue Sep  3 20:33:07 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Sep  3 20:33:07 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: autoload has no effect for already defined
  	  functions & other cosmetic changes
@@ -1959,7 +1959,7 @@
 	* Src/utils.c: control keys at a query prompt left ^ as a garbage
  	  on the screen.  Fix from hoh@approve.se (Goran Larsson)
 
-Sun Sep  1 22:58:11 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Sep  1 22:58:11 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/NEWS: more news
 
@@ -1970,7 +1970,7 @@
 
 	* Src/builtin.c: umask prints 0222 instead of 222
 
-Sat Aug 31 23:43:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Aug 31 23:43:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: fc -e should not change lastval
 
@@ -2005,7 +2005,7 @@
 
 	* Src/zle_refresh.c: xterm cut&paste fix from Geoff (2095)
 
-Thu Aug 29 21:07:24 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Aug 29 21:07:24 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c, Src/zle_tricky.c: run-help always uses the alias
  	  expanded word
@@ -2013,13 +2013,13 @@
 	* Src/zle_refresh.c: fixes for slow refresh on some terminals from
  	  Geoff (2091)
 
-Mon Aug 26 00:02:36 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Aug 26 00:02:36 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c: save/restore underscore on execsave/execrestore
 
 	* Src/zle_tricky.c: line was wrongly used unmetafied in getcurcmd()
 
-Sun Aug 25 23:06:43 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Aug 25 23:06:43 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Functions/checkmail, Doc/zsh.texi, Doc/zshmisc.man, Src/cond.c,
  	  Src/parse.c: new -N contitional test to check if the access time
@@ -2027,7 +2027,7 @@
  	  checkmail function is also included to check mailpath or the
  	  given forlers for new mails.
 
-	* Src/builtin.c: umask error message fix from J√°nos Farkas
+	* Src/builtin.c: umask error message fix from J·nos Farkas
  	  <chexum@shadow.banki.hu> (2061)
 
 	* Src/mem.c, Src/zsh.h: halloc simplification
@@ -2043,7 +2043,7 @@
 	* Src/exec.c, Src/globals.h, Src/signals.c, Src/signals.h,
  	  Src/utils.c: Some little speedups
 
-Fri Aug 23 19:18:43 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Aug 23 19:18:43 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: compctl -X did not work
 
@@ -2053,7 +2053,7 @@
 
 	* Src/params.c: $foo[(i)...], caused invalid subscript error
 
-Thu Aug 22 21:57:47 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Aug 22 21:57:47 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* META-FAQ: ftp.uit.no now mirrors the primary site.
   	  ftp.nis.co.jp should be used instead of shirakaba.nis.co.jp
@@ -2066,7 +2066,7 @@
 	* Etc/MACHINES: better description of the OSF/1 header bug
 	  workaround
 
-Thu Aug 15 17:40:38 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Aug 15 17:40:38 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0.0 released
 
@@ -2088,7 +2088,7 @@
 
 	* Src/exec.c: $(< nosuchfile) dumped core.  From Peter (1985)
 
-Wed Aug 14 17:02:39 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Aug 14 17:02:39 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/parse.c: ignore spaces in case foo in ( f* | b* ) ...
 
@@ -2104,7 +2104,7 @@
  	  Doc/zshoptions.man, Src/exec.c, Src/globals.h, Src/hashtable.h,
  	  Src/zsh.h: POSIX_BUILTIN option added
 
-Tue Aug 13 20:36:44 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Aug 13 20:36:44 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Doc/zshparam.man, Src/init.c, Src/zle_misc.c: PS2
  	  defaults to %_> , %_ prints all shell constructs.  From Peter
@@ -2112,7 +2112,7 @@
 
 	* Src/hist.c: a cast was missing in a debug test
 
-Mon Aug 12 18:01:08 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Aug 12 18:01:08 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: limit fixes for Alpha/Linux 2.0.x from Jeff Blank
  	  <jfblank@mtu.edu> (1951)
@@ -2135,7 +2135,7 @@
 
 	* Src/hist.c, Src/signals.c: Zsh coredumped on auto-logout
 
-Sun Aug 11 19:46:50 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Aug 11 19:46:50 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/input.c: Fix history expansion in foo<!$.  This may also fix
  	  some other rare bugs.  From Peter (1930)
@@ -2151,7 +2151,7 @@
 	* Src/zle_tricky.c: Untokenize and quote the current command
  	  before passing it to run-help.  Based on art. 1920 from Bart.
 
-Sun Aug  4 18:28:00 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Aug  4 18:28:00 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0-pre6 released
 
@@ -2167,7 +2167,7 @@
 
 	* Src/zle_tricky.c: do not complete unset special parameters
 
-Sat Aug  3 02:54:46 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Aug  3 02:54:46 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c, Src/builtin.c, Src/globals.h, Src/zsh.h: setopt
  	  prints non-default options.  From Wayne (1907)
@@ -2177,7 +2177,7 @@
 
 	* Src/zle_utils.c: zsfree used on the non-null-terminated vibuf[*].buf
 
-Fri Aug  2 20:05:50 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Aug  2 20:05:50 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi: spelling fixes from Mark and added reference to
  	  obtaining precompiled documentation, zsh-doc.tar.gz from Clive
@@ -2204,11 +2204,11 @@
 	* Src/hist.c: strinbeg/strinend increases/decreases strin.  This
  	  fixes the here-document within command substitution bug.
 
-Thu Aug  1 17:56:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Aug  1 17:56:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c: \" should remain unchanged in here documents
 
-Wed Jul 31 19:10:04 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jul 31 19:10:04 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0-pre5 released
 
@@ -2249,7 +2249,7 @@
  	  message.  This makes debugging easier since a breakpoint can be
  	  set to dputs.
 
-Tue Jul 30 20:28:38 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jul 30 20:28:38 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c, Src/utils.c: zsh -s dereferenced wordchars while
  	  it was still NULL.  Reported by Peter.
@@ -2260,7 +2260,7 @@
 	* Doc/zshmisc.man, Src/hashtable.h: MANPATH is not special in
  	  sh/ksh mode
 
-Mon Jul 29 23:44:19 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul 29 23:44:19 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/mem.c: a little-bit improved ZSH_MEM_WARNING
 
@@ -2282,7 +2282,7 @@
 	* Src/parse.c: zsh -c 'echo foo ; & echo bar' should give parse
 	  error.
 
-Sun Jul 28 22:34:08 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jul 28 22:34:08 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshoptions.man: SH_FILE_EXPN renamed to SH_FILE_EXPANSION,
  	  -s works as SHIN_STDIN again in sh/ksh mode, -t is
@@ -2309,13 +2309,13 @@
 
 	* Src/globals.h: -s is back in sh/ksh mode for SHIN_STDIN
 
-Sat Jul 27 20:24:36 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jul 27 20:24:36 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/compat.c, Src/glob.c, Src/init.c, Src/mem.c,
  	  Src/zle_tricky.c: changes to make the upcoming gcc-2.8.0 more
  	  silent
 
-Fri Jul 26 21:02:59 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jul 26 21:02:59 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0-pre4 released
 
@@ -2341,7 +2341,7 @@
 	* Src/hashtable.c: print { } for empty funxtion definitions.  From
  	  Peter (1778)
 
-Thu Jul 25 21:50:36 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jul 25 21:50:36 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/signals.c, Src/subst.c: old compilers do not like char []
  	  automatic initializers
@@ -2375,14 +2375,14 @@
 
 	* Etc/FAQ: checked in with -k by hzoli at 1996/07/25 20:32:43
 
-Wed Jul 24 15:02:42 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jul 24 15:02:42 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/NEWS, Src/lex.c: disallow [[-z $foo]] again since it will
  	  cause problems with POSIX character classes (e.g. [[:ALPHA:]]).
 
 	* Src/zle_misc.c: deletechar works at the end of lines.
 
-Tue Jul 23 21:04:22 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jul 23 21:04:22 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/exec.c, Src/globals.h, Src/hashtable.c,
  	  Src/jobs.c, Src/signals.c, Src/zsh.h: more signal trap fixes
@@ -2400,7 +2400,7 @@
 	* Src/builtin.c: whence -c (and which) tells if the given command
  	  is not found.
 
-Mon Jul 22 20:32:13 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul 22 20:32:13 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshexpn.man, Doc/zshoptions.man, Doc/zshparam.man,
  	  Src/globals.h, Src/subst.c, Src/zsh.h: SH_FILE_EXPN option and
@@ -2421,7 +2421,7 @@
  	  documentation.  Updated to include changes made to man-pages
  	  pre2 -> pre3.  FIXME: URL for ps & dvi. From Clive (1730)
 
-Mon Jul 22 01:26:09 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul 22 01:26:09 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, Doc/zshmisc.man: traps defined by the trap builtin
  	  are unset in subshells
@@ -2444,7 +2444,7 @@
  	  reorganization: setopt no_something is the same as unsetopt
  	  something.  From Zefram.
 
-Sat Jul 20 17:07:14 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jul 20 17:07:14 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* acconfig.h, config.h.in, configure, configure.in: configure
  	  check for working strcoll()
@@ -2468,7 +2468,7 @@
 
 	* Src/lex.c: cmdstack changed bugfix from Zefram (1671)
 
-Fri Jul 19 19:25:14 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jul 19 19:25:14 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c: parameter modifier fixes, better diagnostics
 
@@ -2498,11 +2498,11 @@
 
 	* Src/lex.c: do not handle `<' in case patterns specially
 
-Thu Jul 18 23:03:59 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jul 18 23:03:59 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c: a little simplification
 
-Mon Jul 15 04:43:43 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul 15 04:43:43 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0-pre3 released
 
@@ -2534,7 +2534,7 @@
 	  always be raised up to the hard limits of the shell.
 	  Optimization: setrlimit() is only called when necessary.
 
-Sat Jul 13 20:26:35 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jul 13 20:26:35 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/NEWS, Doc/zshmisc.man, Src/globals.h, Src/hashtable.h,
  	  Src/hist.c, Src/lex.c, Src/parse.c, Src/utils.c,
@@ -2545,7 +2545,7 @@
 	* Src/lex.c: parsestr() failed if the string contained a backslash
  	  newline
 
-Fri Jul 12 17:19:02 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jul 12 17:19:02 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_hist.c, Src/zle_main.c: always execute the zle command
 	  which ended an I-search.  From Wayne (1613)
@@ -2567,7 +2567,7 @@
  	  changed to foo () command for ksh and POSIX compatibility.  This
  	  syntax does not require NO_SHORT_LOOPS.
 
-Thu Jul 11 21:03:51 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jul 11 21:03:51 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c: handle metacharacters in here documents
 
@@ -2584,7 +2584,7 @@
 
 	* Src/zle_tricky.c: fix completing in $(...)
 
-Wed Jul 10 20:52:55 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jul 10 20:52:55 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c, Src/subst.c, config.h.in, configure, configure.in:
  	  use strcoll for sorting.  From Andrej Borsenkow
@@ -2592,7 +2592,7 @@
 
 	* Src/exec.c: FOO=bar function leaved FOO=bar in the environment
 
-Wed Jul 10 02:34:49 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jul 10 02:34:49 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c: FOO=bar function leaved FOO=bar in the environment
 
@@ -2603,7 +2603,7 @@
 	* Src/utils.c, Src/zle_tricky.c: menu completion after ~/ and
  	  $foo/ fixed
 
-Tue Jul  9 21:09:29 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jul  9 21:09:29 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Doc/zshmisc.man, Src/parse.c: case foo in
  	  (pattern) ... syntax documented and parsing improved
@@ -2626,18 +2626,18 @@
 	* Src/lex.c: do not call exalias if errflag is true (fixes
  	  push-line-or-edit)
 
-Mon Jul  8 20:37:59 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul  8 20:37:59 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c: set shout fully buffered
 
-Mon Jul  8 01:56:51 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul  8 01:56:51 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, Src/globals.h, Src/hist.c, Src/init.c, Src/input.c,
 	  Src/lex.c, Src/parse.c, Src/zsh.h: doexpandhist() no does not
 	  mess up the history.  Here document are put into the history and
 	  some other here document fixes.
 
-Sun Jul  7 16:03:48 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jul  7 16:03:48 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c: alloc_stackp debug check fix
 
@@ -2646,16 +2646,16 @@
 
 	* Doc/zshbuiltins.man: improve ulimit documentation
 
-Sun Jul  7 00:18:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jul  7 00:18:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c: remove warning about the new <> behaviour
 
-Sat Jul  6 18:17:13 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jul  6 18:17:13 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: fix completing in process and command
 	  substitutions
 
-Fri Jul  5 21:58:31 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jul  5 21:58:31 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c, acconfig.h, config.h.in, configure,
  	  configure.in: configure check for NIS+ and some othe related
@@ -2675,7 +2675,7 @@
  	  --enable-etcdir is back.  The customized locations are put into
  	  the manual
 
-Thu Jul  4 20:46:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jul  4 20:46:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0-pre2 released
 
@@ -2694,17 +2694,17 @@
 	  PERMALLOC { l = dupstruct(list); } LASTALLOC;
 	  Idea from Bart and Zefram
 
-Thu Jul  4 13:18:11 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jul  4 13:18:11 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshoptions.man: >| is preferred to >!
 
-Mon Jul  1 20:59:36 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul  1 20:59:36 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshmisc.man, Doc/zshoptions.man, Src/globals.h, Src/parse.c,
  	  Src/zsh.h: CSH_JUNKIE_PAREN option removed.  From Bart Schaefer
  	  (1496) with some modifications
 
-Mon Jul  1 20:13:26 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul  1 20:13:26 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/mem.c, acconfig.h, config.h.in, configure, configure.in:
 	  check for brk/sbrk prototypes
@@ -2716,7 +2716,7 @@
 
 	* Src/system.h: RLIMIT_ definitions are not hidden in HPUX 10.x
 
-Mon Jul  1 14:01:46 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul  1 14:01:46 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: ulimit fixes
 
@@ -2726,7 +2726,7 @@
  	  DIRSTACKSIZE, KEYTIMEOUT, LISTMAX, LOGCHECK, MAILCHECK, PERIOD,
  	  REPORTTIME, SAVEHIST and TMOUT are no longer special parameters.
 
-Mon Jul  1 02:27:23 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul  1 02:27:23 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/globals.h, Src/builtin.c, Src/exec.c, Src/init.c, Src/lex.c,
  	  Src/mem.c, Src/signals.c, Src/utils.c, Src/zle_main.c,
@@ -2737,17 +2737,17 @@
  	  used instead of return between heapalloc/permalloc and
  	  lastalloc.  From Bart Schaefer (1490) with some modifications
 
-Mon Jul  1 01:13:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jul  1 01:13:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshbuiltins.man, Src/builtin.c, Src/exec.c, Src/hashtable.h:
 	  limit/unlimit/ulimit changes, bash/ksh compatible ulimit
 
-Sun Jun 30 21:14:16 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun 30 21:14:16 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/intro.ms, Doc/zsh.man, Doc/zshall.man:
 	  Paul Falstad's E-mail is pf@software.com
 
-Sun Jun 30 15:46:13 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun 30 15:46:13 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c (doshfunc): do not change the value of underscore
 
@@ -2761,23 +2761,23 @@
 
 	* Src/exec.c: cmdoutpid and cmdoutval added to execstack
 
-Sun Jun 30 01:30:27 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun 30 01:30:27 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/mem.c: fill freed memory with zeros if ZSH_MEM_DEBUG is defined
 
 	* Src/exec.c, Src/globals.h, Src/jobs.c, Src/signals.c, Src/zsh.h:
  	  cmdoutpid and cmdoutval added to execstack
 
-Sat Jun 29 15:24:54 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jun 29 15:24:54 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/hist.c, Src/utils.c: fix problems with quad_t
  	  resource limits.  From Geoff (1444,1471)
 
-Fri Jun 28 17:52:52 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun 28 17:52:52 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: use the heap during the execution of chpwd()
 
-Fri Jun 28 15:00:11 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun 28 15:00:11 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* ChangeLog: zsh-3.0-pre1 released
 
@@ -2787,25 +2787,25 @@
 
 	* Makefile.in: make release changes
 
-Fri Jun 28 14:08:44 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun 28 14:08:44 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/Makefile.in: zsh.info and zsh.dvi depends on zsh.texi
 
 	* Doc/zsh.texi: Fixed compctl -d and -e. Added ref to ***/.
 	  HISTCHARS depreciated, use histchars.
 
-Fri Jun 28 13:46:02 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun 28 13:46:02 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c: foo.bar(:r) did not work
 
-Fri Jun 28 01:27:57 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun 28 01:27:57 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_misc.c: alwayslastprompt fix when listing in
  	  execute-named-command
 
 	* Doc/zshparam.man, Src/jobs.c: %% represents % in TIMEFMT
 
-Thu Jun 27 23:51:19 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jun 27 23:51:19 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/BUGS: I hope that all awk problems are solved by now
 
@@ -2830,7 +2830,7 @@
 	* INSTALL, acconfig.h, config.h.in, configure, configure.in:
  	  --enable-etcdir added
 
-Wed Jun 26 23:19:48 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jun 26 23:19:48 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hist.c, Doc/zshexpn.man: get !# work again.  From Peter
  	  (1218 and 1219)
@@ -2847,7 +2847,7 @@
 
 	* Doc/zshbuiltins.man, Src/builtin.c: POSIX conforming kill builtin
 
-Wed Jun 26 08:58:31 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jun 26 08:58:31 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.man, Doc/zshall.man, Doc/zshbuiltins.man,
  	  Doc/zshcompctl.man, Doc/zshexpn.man, Doc/zshmisc.man,
@@ -2857,11 +2857,11 @@
 	* Doc/zshbuiltins.man, Doc/zshmisc.man: -, command, exec and
  	  noglob are builtins
 
-Tue Jun 25 23:15:04 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 25 23:15:04 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c: \<nevline>c was interpreted as \c in dquote_parse()
 
-Tue Jun 25 21:07:59 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 25 21:07:59 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/NEWS: AUTO_PUSHD and IFS change description
 
@@ -2881,31 +2881,31 @@
 	* Src/exec.c: save underscore, lastval, noeval and badcshglob in
  	  execsave
 
-Tue Jun 25 19:46:34 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 25 19:46:34 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshexpn.man: trailing newlines are removed in command
  	  substitution
 
-Tue Jun 25 00:52:10 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 25 00:52:10 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, Src/signals.c: new function execsave()/execrestore()
  	  used in dotrap()
 
-Mon Jun 24 21:05:00 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun 24 21:05:00 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c: doshfunc must use the heap
 
 	* Src/signals.c: dotrap should not change allocation state
 
 	* Src/watch.c: do not watch utmp entries without a login name.
-  	  From J√°nos Farkas (1432)
+  	  From J·nos Farkas (1432)
 
 	* Src/utils.c: handle terminals faster than 100000 baud.  From
- 	  J√°nos Farkas (1431) with modifications
+ 	  J·nos Farkas (1431) with modifications
 
 	* Src/subst.c: fix nested $[$[...]] sunstitution
 
-Fri Jun 21 14:40:00 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun 21 14:40:00 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshexpn.man: <> is a redirection operator.
 	  From Mark Borges (1390)
@@ -2925,7 +2925,7 @@
 	* Src/glob.c: remove the undocumented [(foo)(bar)] glob feature
 	  since it is the same as (foo|bar).
 
-Thu Jun 20 20:58:14 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jun 20 20:58:14 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/parse.c: enable < =(...) and > =(...) again
 
@@ -2935,17 +2935,17 @@
 	* Src/zle_tricky.c: allow tilde and equals substitution with
 	  compctl -g
 
-Wed Jun 19 20:55:00 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jun 19 20:55:00 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-2.6-beta21 released
 
-Wed Jun 19 20:51:45 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jun 19 20:51:45 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: on Solaris RLIMIT_AS == RLIMIT_VMEM
 
 	* configure, configure.in: remove -pedantic from gcc options
 
-Wed Jun 19 20:21:33 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jun 19 20:21:33 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hashtable.c: fix printing of the command name tables and
  	  displaying of arrays etc.  From Zefram (1259)
@@ -2954,19 +2954,19 @@
  	  integer variables to zero before unsetting.  From Zefram (1258)
 
 
-Wed Jun 19 20:12:37 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jun 19 20:12:37 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/params.c, Src/subst.c, Src/utils.c: handle
 	  the case when the first character of IFS is a meta character
 
-Tue Jun 18 21:05:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 18 21:05:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshexpn.man: [...] glob documentation
 
 	* Doc/zshoptions.man: SH_GLOB disables numeric globbing on the
  	  result of parameter expansions and in some other cases.
 
-Tue Jun 18 19:28:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 18 19:28:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c, Src/utils.c: handle null (but not unset) IFS
 
@@ -2978,11 +2978,11 @@
  	  characters.  in notstrcmp(): handle arbitrary big numbers if
  	  NUMERICGLOBSORT is used.
 
-Mon Jun 17 18:33:44 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun 17 18:33:44 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c: reset lexstop to zero after most hungetc's
 
-Mon Jun 17 02:14:04 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun 17 02:14:04 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi: a major update from Clive Messer
  	  <clive@epos.demon.co.uk>
@@ -2991,7 +2991,7 @@
  	  Src/subst.c, Src/utils.c, Src/ztype.h: ksh/POSIX compatible IFS
  	  behaviour
 
-Sun Jun 16 19:37:01 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun 16 19:37:01 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c: ${(Oi)...} should sort case-independently in
 	  descending order.  From Thorsten Meinecke (1337)
@@ -3002,17 +3002,17 @@
 
 	* Src/exec.c: make noclobber a bit more secure
 
-Sun Jun 16 18:50:47 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun 16 18:50:47 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Misc/compctl-examples: compctl for the RedHat rpm utility
 
-Sun Jun 16 14:50:42 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun 16 14:50:42 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/system.h: include <sys/ioctl.h> if GWINSZ_IN_SYS_IOCTL is
  	  defined.  This in fact just removes an earlier experimental
  	  patch which accicently got into the release.
 
-Sat Jun 15 23:37:44 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jun 15 23:37:44 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshmisc.man, Etc/NEWS, Src/exec.c, Src/glob.c,
  	  Src/globals.h, Src/lex.c, Src/parse.c, Src/text.c, Src/zsh.h:
@@ -3022,7 +3022,7 @@
 
 	* Src/zle_tricky.c: use heapalloc() in reversemenucomplete()
 
-Tue Jun 11 21:03:45 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun 11 21:03:45 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, Src/glob.c, Src/globals.h, Src/lex.c, Src/parse.c,
  	  Src/text.c, Src/zsh.h: POSIX redirection changes.  Epand word
@@ -3038,7 +3038,7 @@
 
 	* Src/zle_tricky.c: use heapalloc() in do_menucomp()
 
-Mon Jun 10 20:58:16 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun 10 20:58:16 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c: treat pattern/ as pattern(-/) instead of pattern(/)
 
@@ -3054,14 +3054,14 @@
 
 	* Src/builtin.c: handle RLIMIT_AS in Linux 2.0
 
-Sun Jun  9 23:30:02 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun  9 23:30:02 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: compctl -L fixes
 
 	* Src/zle_tricky.c: compctl -l '' foo only worked for the first
  	  argument of foo.
 
-Fri Jun  7 15:24:18 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jun  7 15:24:18 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-2.6-beta20
 
@@ -3081,7 +3081,7 @@
  	  mailpath, manpath, watch, psvar and path in sh/ksh compatibility
  	  mode.
 
-Thu Jun  6 20:23:23 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jun  6 20:23:23 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c (doexpansion): move newlinklist() after heapalloc()
 
@@ -3095,29 +3095,29 @@
  	  now only completes enabled commands.  -d, -e documentation
  	  fixed.
 
-Wed Jun  5 22:27:49 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jun  5 22:27:49 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: getcurcmd() did not use the heap when it
  	  called the lexer.  I also added some debug tests.
 
-Mon Jun  3 18:53:10 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun  3 18:53:10 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hashtable.c, Src/zle_hist.c, Src/zle_main.c,
  	  Src/zle_tricky.c, Src/zle_utils.c: add some (char *) and
  	  (unsigned char *) casts
 
-Mon Jun  3 16:55:44 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun  3 16:55:44 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-2.6-beta20-test1
 
 	* Src/subst.c: multsub() did not like when prefork() resulted in
  	  an empty list
 
-Mon Jun  3 03:14:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun  3 03:14:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c: fix brace expansion bug
 
-Mon Jun  3 01:42:58 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun  3 01:42:58 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Makefile.in: config.status depends on Src/version.h
 
@@ -3141,7 +3141,7 @@
  	  Src/zle_tricky.c, Src/zle_vi.c, Src/zsh.h: reorganized option
  	  handling from Zefram (1227)
 
-Sun Jun  2 23:36:36 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun  2 23:36:36 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, Src/builtin.c, Src/glob.c, Src/hashtable.h,
  	  Src/subst.c, Src/zsh.h: reorganize execcmd() again.  Glob only
@@ -3161,11 +3161,11 @@
 	* Src/parse.c: give warnings when DEBUG is defined and the lexer
  	  is called with !useheap
 
-Fri May 31 14:09:34 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri May 31 14:09:34 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, Src/utils.c: nicezputs and nicechar fixes
 
-Thu May 30 18:20:46 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 30 18:20:46 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c: simplify makecline which also fixes a bug introcuced
  	  by the previous patch
@@ -3176,17 +3176,17 @@
   	  Interpret EXEC=exec ; $EXEC something like other shells.  From
  	  Peter (1229)
 
-Tue May 28 20:49:53 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May 28 20:49:53 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_misc.c: fix gosmacs-transpose-chars bug when a line has
 	  less than two characters
 
-Mon May 27 23:52:54 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May 27 23:52:54 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: clwords initialisation after resizing clwords
 	  was wrong.  From Zefram (1173)
 
-Mon May 27 17:43:31 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May 27 17:43:31 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c: typeset -i2 a now works.  Based on art. 1165 from
 	  SUZUKI Hisao <suzuki@oz.fantasy.otsl.oki.co.jp>
@@ -3195,11 +3195,11 @@
 
 	* Doc/zshbuiltins.man: revised read manual entry from Peter (663)
 
-Sun May 26 23:14:07 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May 26 23:14:07 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/FAQ: New version from Peter
 
-Thu May 23 20:14:05 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 23 20:14:05 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: further improve handling of null at the end of
  	  a completion word
@@ -3214,7 +3214,7 @@
 	* Src/zle_tricky.c (quotename): handle the (metafied) null
  	  character.  From Zefram (1143)
 
-Thu May 23 13:40:50 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 23 13:40:50 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-2.6-beta19 released
 
@@ -3224,25 +3224,25 @@
 	* Src/glob.c, Src/subst.c, Doc/zshexpn.man: ${...:#...}
 	  substitution now removes matching array elements
 
-Thu May 23 01:29:48 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 23 01:29:48 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zshoptions.man: an attempt was made to document SH_GLOB
 
 	* Src/builtin.c: popd now works even if chaselinks is set.  From
  	  Anthony (1123)
 
-Wed May 22 23:43:01 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed May 22 23:43:01 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c, Src/zle_tricky.c: add some remnulargs()
 
 	* Src/builtin.c: print -m fixed
 
-Wed May 22 21:00:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed May 22 21:00:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c, Src/globals.h, Src/init.c, Src/lex.c, Src/zsh.h:
 	  SH_GLOB option added
 
-Wed May 22 20:19:13 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed May 22 20:19:13 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/signames.awk: revert changes made in beta18.
 
@@ -3250,7 +3250,7 @@
 
 	* Src/exec.c (getoutputfile): open the file before zfork()
 
-Tue May 21 19:39:16 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May 21 19:39:16 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-2.6-beta18 released
 
@@ -3265,7 +3265,7 @@
 
 	* META-FAQ: Ftp site list changes
 
-Mon May 20 01:24:24 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May 20 01:24:24 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/signames.awk: change #else to \#else since some nawks did
  	  not like the former.  From Johan Danielsson <joda@pdc.kth.se>
@@ -3283,7 +3283,7 @@
 	* Src/zle_tricky.c: Undo Zefram's modifications in quotename() to
 	  fix a bug when completing ~/foo
 
-Sun May 19 23:20:45 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May 19 23:20:45 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: Reformat and add some comments.
 	  From Zefram (1092)
@@ -3306,7 +3306,7 @@
  	  Make substitution compatible with (ba)sh and other little
  	  cleanups in lex.c.
 
-Fri May 17 20:23:47 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri May 17 20:23:47 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: 2.6-beta18-test1
 
@@ -3319,7 +3319,7 @@
 
 	* Etc/MACHINES: Note about GNU strip bug on OSF/1
 
-Thu May 16 23:46:44 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 16 23:46:44 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_hist.c, Src/zle_utils.c: Some simple cleanups in
 	  doisearch() and hstrnstr()
@@ -3328,12 +3328,12 @@
 	  repeated on an empty search.  It also fixes a rare isearch bug.
 	  From Wayne (1084)
 
-Thu May 16 00:15:42 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 16 00:15:42 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* acconfig.h, config.h.in, configure, configure.in, Src/system.h:
 	  configure hacks against SCO bugs
 
-Wed May 15 01:41:33 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed May 15 01:41:33 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_hist.c, Src/zle_misc.c: More 8-bit zle changes
 
@@ -3342,7 +3342,7 @@
 
 	* Src/builtin.c: compctl fixes from Zefram (1068)
 
-Tue May 14 03:19:34 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May 14 03:19:34 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c, Src/zle_hist.c, Src/zle_main.c, Src/zsh.h: Keep
  	  modified history lines until the next accept* function.  Make
@@ -3352,7 +3352,7 @@
 	* Src/exec.c: in getoutputfile() returned the ztrdupped name from
  	  the jobtable From Peter (1061)
 
-Mon May 13 02:17:07 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May 13 02:17:07 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: temporary 8-bit clean patches
 
@@ -3380,16 +3380,16 @@
  	  Src/utils.c: In metafy use -1 instead of zero if the len is
  	  unknown
 
-Sun May 12 01:46:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May 12 01:46:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c, Src/zle_hist.c, Src/zle_utils.c:
 	  Incremental search fixes from Wayne (1051)
 
-Sat May 11 00:42:14 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat May 11 00:42:14 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* config.guess, configure: Use autoconf-2.10
 
-Fri May 10 21:01:56 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri May 10 21:01:56 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/glob.c, Src/hashtable.c, Src/utils.c,
  	  Src/zle.h, Src/zle_hist.c, Src/zle_main.c, Src/zle_misc.c,
@@ -3409,7 +3409,7 @@
 
 	* Src/exec.c: Metafy was missing for autoloaded functions
 
-Fri May 10 12:06:23 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri May 10 12:06:23 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Makefile.in: Improve check-rcs and handle dot-files (like
 	  Src/.indent.pro)
@@ -3417,7 +3417,7 @@
 	* Src/zle_tricky.c: Use permanent allocation for cmdstr instead of
 	  the heap to prevent SEGV
 
-Tue May  7 20:49:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May  7 20:49:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/glob.c, Src/input.c, Src/zle_misc.c,
  	  Src/zle_tricky.c: Some changes to make Ultrix cc happy (1001)
@@ -3428,11 +3428,11 @@
 	* Src/exec.c: Close process substitution file descriptors in the
  	  child process (987)
 
-Tue May  6 23:59:59 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May  6 23:59:59 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* zsh-2.6-beta17 released
 
-Mon May  6 01:37:20 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May  6 01:37:20 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/signals.h: SIGNAL_HANDTYPE is RETSIGTYPE (*)_((int))
 
@@ -3455,7 +3455,7 @@
  	  are marked in fdtable.  Use /dev/fd/ if it is available for
  	  <(...) and >(...) process substitutions.
 
-Fri May  3 03:38:28 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri May  3 03:38:28 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* README, META-FAQ, Util/zsh-development-guide: new maintainer.
 	  Some other changes in the README.
@@ -3878,7 +3878,7 @@
 
 	* Workaround a bug in GNU autoconf which makes configure think
  	  that there is no -lcourses and -lncurses if the test for
- 	  -ltermcap failed.  From J√°nos Farkas <chexum@shadow.banki.hu>
+ 	  -ltermcap failed.  From J·nos Farkas <chexum@shadow.banki.hu>
  	  (972)
 
 	Sun April 27 1996
diff -ruN zsh-5.0.4/Etc/ChangeLog-3.1 zsh-5.0.2/Etc/ChangeLog-3.1
--- zsh-5.0.4/Etc/ChangeLog-3.1	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Etc/ChangeLog-3.1	2012-02-05 11:22:59.000000000 -0800
@@ -7067,7 +7067,7 @@
 	* Clint: 9333: Completion/User/_a2ps: a2ps can take PostScript
 	input files.
 
-	* Johan Sundstr√∂m: 9331: Doc/Zsh/compwid.yo: typo.
+	* Johan Sundstrˆm: 9331: Doc/Zsh/compwid.yo: typo.
 
 	* Sven: 9330: Src/mem.c: debugging message not needed when using
 	mmap().
@@ -10568,7 +10568,7 @@
 
 	* pws: 7148: INSTALL: User subdirectory
 
-	* Thomas K√∂hler: 7146: Completion/User/_make: didn't work.
+	* Thomas Kˆhler: 7146: Completion/User/_make: didn't work.
 
 	* pws: 7145: Completion/User/_sh: use compset -q for completing
 	  after -c option	  
@@ -13536,7 +13536,7 @@
 	  Src/zsh.h: Option RM_STAR_WAIT to wait ten seconds at the `rm
 	  *' prompt.  (zefram, 2999)
 
-Tue Jun  3 06:14:14 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jun  3 06:14:14 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.1.2 released
 
@@ -13544,7 +13544,7 @@
 
 	* Src/jobs.c: pg(){ less;};:|pg caused suspended (tty input)
 
-Mon Jun  2 07:52:31 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jun  2 07:52:31 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/paths.yo.in: Updated date
 
@@ -13578,7 +13578,7 @@
 
 	* Src/glob.c: The T glob flag did not work
 
-Sun Jun  1 08:02:19 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jun  1 08:02:19 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/system.h: Use _POSIX_VDISABLE is available.  Fixes ^@ in zle
  	  on some systems.
@@ -13600,7 +13600,7 @@
  	  Src/subst.c, Src/text.c, Src/utils.c, Src/watch.c: Declare
  	  functions used locally in one file static.
 
-Sat May 31 07:29:53 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat May 31 07:29:53 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/comp.h, Src/prototypes.h, Src/makepro.sh,
  	  Src/Builtins/Makefile.in, Src/Makefile.in,
@@ -13609,7 +13609,7 @@
   	  Generate prototypes for static functions.  Ideas from articles
  	  3123 and 3124 from Zefram.
 
-Thu May 29 05:17:31 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May 29 05:17:31 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/cond.c: directories are always executable by root
 
@@ -13618,12 +13618,12 @@
 	* aclocal.m4, configure, configure.in: --enable-ansi2knr configure
  	  option added.  From Zefram (3122)
 
-Tue May 20 05:22:16 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May 20 05:22:16 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c: if abort or edit used on a correct prompt, do not
  	  attempt to correct further words on the line.
 
-Sun May 18 18:57:08 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May 18 18:57:08 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/exec.c, Src/init.c, Src/signals.c, Src/jobs.c:
  	  Do not handle SIGPIPE specially for shells with job control
@@ -13635,14 +13635,14 @@
 	* Src/exec.c, Src/signals.c: `:`; while true; do; done was
  	  uninterruptible
 
-Mon May 12 09:01:55 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May 12 09:01:55 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* configure, configure.in: on NetBSD <sys/time.h> is needed for
  	  rlimit type checks.  From Geoff.
 
 	* Src/hist.c: !:2-1 history expansion caused memory corruption
 
-Sun May 11 08:52:00 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May 11 08:52:00 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/lex.c: $((foo);bar) syntax works
 
@@ -13655,7 +13655,7 @@
 	* Src/builtin.c: make sure zexit is not reentered when its
  	  execution is interrupted by a signal.
 
-Fri May  9 07:59:00 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri May  9 07:59:00 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c: print_if_link (used by whence -s) did not work well.
 
@@ -13667,7 +13667,7 @@
 	* Src/jobs.c: printjobs() set errflag when the foreground process
  	  was interrupted.
 
-Thu May  8 09:18:56 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu May  8 09:18:56 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/cond.c: [[ -x file ]] does stat for privileged users
 
@@ -13680,11 +13680,11 @@
 	* Src/Zle/zle_tricky.c, Src/hist.c, Src/lex.c, Src/parse.c:
 	  ((foo);bar) now works
 
-Wed May  7 14:50:08 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed May  7 14:50:08 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/Makefile.in: make clean should delete generated htmls
 
-Tue May  6 06:33:06 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue May  6 06:33:06 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Etc/Makefile.in: rules to create FAQ and FAQ.html from the yodl
  	  source
@@ -13711,7 +13711,7 @@
  	  Allow adding/deleting nodes during scanhashtable.  From Zefram
  	  (3058)
 
-Mon May  5 09:29:22 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon May  5 09:29:22 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hist.c: % word designator fix from Bruce Murphy
  	  <packrat@iinet.net.au> (3065)
@@ -13751,7 +13751,7 @@
  	  Src/builtin.c, Src/params.c: local parameters can hide special
  	  parameters.  From Zefram (3048)
 
-Sun May  4 06:16:44 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun May  4 06:16:44 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Builtins/Makefile.in, Src/Makefile.in,
  	  Src/Modules/Makefile.in, Src/Zle/Makefile.in, aczsh.m4,
@@ -13772,7 +13772,7 @@
  	  created.  rlimits.c moved to Src/Builtins and converted into a
  	  loadable module.
 
-Wed Apr 30 07:40:30 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Apr 30 07:40:30 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/Zsh/grammar.yo, Src/globals.h, Src/lex.c, Src/loop.c,
  	  Src/parse.c, Src/text.c, Src/zsh.h: ksh style ;& case
@@ -13804,7 +13804,7 @@
  	  acconfig.h, aclocal.m4: The config part of the nameclash patch
  	  from Zefram (3028).  The code part does not work with ansi2knr.
 
-Mon Apr 28 07:28:34 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Apr 28 07:28:34 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/comp.h, Src/Zle/comp1.c, Src/Zle/compctl.c,
  	  Src/Zle/deltochar.c, Src/Zle/zle.h, Src/Zle/zle_bindings.c,
@@ -13865,7 +13865,7 @@
 	* Src/Zle/zle_main.c, Src/Zle/zle_tricky.c: menu completion did
  	  not work well with auto_param_keys.  From Zefram (3011)
 
-Sat Apr 26 06:26:11 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Apr 26 06:26:11 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Functions/zed: Reenter zed if it fails to save the file
 
@@ -13888,7 +13888,7 @@
  	  allow autoloading multiple builtins from a single file in one
  	  command.  From Zefram (2997)
 
-Fri Apr 25 06:41:36 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Apr 25 06:41:36 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zman.yo: use UPPERCASE yodl macro
 
@@ -13928,11 +13928,11 @@
  	  Doc/Zsh/seealso.yo, Doc/zsh.yo, Doc/zshmodules.yo: Module
  	  documentations from zefram (2994)
 
-Sun Apr 20 07:24:12 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Apr 20 07:24:12 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c, Src/params.c, Src/utils.c: Remove setintenv()
 
-Tue Apr 15 05:51:27 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Apr 15 05:51:27 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_refresh.c: SGTABTYPE can contain more than one bit
  	  set.  From Geoff (2976)
@@ -13958,16 +13958,16 @@
 	* Src/Zle/zle_main.c: vared path caused permanent
  	  allocation in arrayfixenv
 
-Sat Apr 12 04:27:34 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Apr 12 04:27:34 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_misc.c: Overwrite mode did not work
 
-Sat Mar  8 00:17:24 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Mar  8 00:17:24 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/compctl.c: Sometimes an incorrect compctl caused a core
  	  dump.  From Peter (2942)
 
-Fri Mar  7 23:54:18 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Mar  7 23:54:18 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in: zle_binding.pro is not used
 
@@ -14037,7 +14037,7 @@
 	* config.h.in, Src/compat.c, Src/utils.c, configure, configure.in:
 	  stupid AIX 3.2 does not have fchdir
 
-Tue Jan 28 00:57:37 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jan 28 00:57:37 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.1.1 released
 
@@ -14046,7 +14046,7 @@
  	  Doc/zshmisc.1, Doc/zshoptions.1, Doc/zshparam.1, Doc/zshzle.1:
  	  yodl generated generated documentation
 
-Mon Jan 27 22:04:29 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jan 27 22:04:29 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/signals.c: temprarily set breaks to zero when executing a trap
 
@@ -14054,7 +14054,7 @@
 
 	* Src/parse.c: words following for ((...)) are in command position.
 
-Sun Jan 26 23:29:48 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jan 26 23:29:48 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/hashtable.h: fix cd -, use unrecognized
  	  option arguments literally
@@ -14066,7 +14066,7 @@
 
 	* Src/init.c: set noerrexit to -1 in setupvals()
 
-Sat Jan 25 20:07:46 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jan 25 20:07:46 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/subst.c, Src/utils.c: some assignments were missing from my
  	  spacesplit fix
@@ -14079,7 +14079,7 @@
 	* Src/Modules/Makefile.in, Src/Modules/clone.c: new builtin: start
  	  a forked instance of the current shell on a new terminal
 
-Thu Jan 23 15:45:27 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jan 23 15:45:27 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_refresh.c, Src/globals.h, Src/prompt.c:
 	  redisplay fix for multiline prompts from Geoff (2817)
@@ -14099,14 +14099,14 @@
 
 	* Doc/Zsh/zle.yo: what-cursor-position zle function documented
 
-Wed Jan 22 00:54:02 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jan 22 00:54:02 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/Zsh/builtins.yo: cd -sLP documentation
 
 	* Doc/Zsh/builtins.yo, Src/module.c: zmodload -au removes defined
  	  but not yet loaded builtins
 
-Tue Jan 21 20:38:24 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jan 21 20:38:24 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/ztexi.yo: sitem() fix for TeX
 
@@ -14114,7 +14114,7 @@
 
 	* Doc/Zsh/builtins.yo, Doc/ztexi.yo: TeX changes
 
-Mon Jan 20 21:11:22 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jan 20 21:11:22 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/hashtable.h, acconfig.h, config.h.in, configure,
  	  configure.in: some old compilers cannot initialise a union
@@ -14142,14 +14142,14 @@
 	* Src/Modules/files.c: rm -r works with arbitrary deep
  	  hierarchies.  rm -r can be interrupted
 
-Sun Jan 19 13:30:36 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jan 19 13:30:36 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c: glob arbitrary deep directory structures
 
 	* Src/mem.c, Src/Zle/zle_keymap.c, Src/subst.c, Src/utils.c,
 	  Src/zsh.h: add real hrealloc()
 
-Sat Jan 18 22:34:17 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jan 18 22:34:17 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_keymap.c: in bindkey -s the string was not zrdupped.
 
@@ -14165,7 +14165,7 @@
 	  alloca() and VARARR macro added which defines a variable sized
 	  automatic array
 
-Tue Jan 14 23:17:34 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jan 14 23:17:34 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/glob.c: debugging changes (the change is mostrly reindentation)
 
@@ -14179,13 +14179,13 @@
 	* Src/options.c, Src/init.c: the -r command line option turns on
 	  restricted mode
 
-Mon Jan 13 21:28:35 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jan 13 21:28:35 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/exec.c, Src/hashtable.h, Src/init.c,
 	  Src/options.c, Src/params.c, Src/text.c, Src/zsh.h: RESTRICTED
 	  option added
 
-Sun Jan 12 01:00:04 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jan 12 01:00:04 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_tricky.c: automenu starts iff lastambig is true.
 	  From Zefram (2781)
@@ -14204,7 +14204,7 @@
 	* Src/Zle/zle.h, Src/Zle/zle_hist.c, Src/Zle/zle_utils.c: remove
 	  some code duplications and undo fixes.  From Zefram (2769)
 
-Sat Jan 11 23:45:50 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Jan 11 23:45:50 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/compat.c: lstat is defined to stat on systems without lstat
 
@@ -14222,14 +14222,14 @@
 
 	* Src/builtin.c: fix bugs when there was no current job after disown
 
-Thu Jan  9 16:07:31 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jan  9 16:07:31 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/rlimits.c: zstrtorlimit was defined instead of zstrtorlimt
 
 	* Src/Modules/Makefile.in, Src/Zle/Makefile.in: some buggy makes
 	  could not find out how to make .so from .c
 
-Wed Jan  8 22:02:51 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jan  8 22:02:51 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/Zsh/zle.yo, Doc/zsh.texi, Doc/zshzle.man, Src/Zle/zle.h,
 	  Src/Zle/zle_bindings.c, Src/Zle/zle_main.c, Src/Zle/zle_misc.c,
@@ -14268,7 +14268,7 @@
 	  Doc/zshoptions.yo, Doc/zshparam.yo, Doc/zshzle.yo, Doc/ztexi.yo:
 	  documentation rewritten into yodl format by Zefram.
 
-Tue Jan  7 23:10:24 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Jan  7 23:10:24 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c, Src/builtin.c, Src/exec.c: print error when
 	  changing read-only variables, prevent core dump when assigning
@@ -14276,7 +14276,7 @@
 
 	* Src/Zle/zle_tricky.c: compctl -S bugfix
 
-Mon Jan  6 20:43:36 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Jan  6 20:43:36 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, acconfig.h, config.h.in, configure, configure.in:
 	  better /dev/fd filesystem check
@@ -14307,7 +14307,7 @@
 	  Src/Zle/zle_thingy.c, Src/Zle/zle_tricky.c, Src/Zle/zle_vi.c,
 	  Src/mods.conf: first zle extendability patch from Zefram (2710)
 
-Sun Jan  5 23:33:32 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Jan  5 23:33:32 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/builtin.c, Src/exec.c: do builtin autoloading in execcmd and
 	  do not ignore BINF_PSPECIAL and BINF_MAGICEQUALS flags for the
@@ -14335,7 +14335,7 @@
 	* Src/Zle/zle_main.c: EOF ignored in interactive mode when not in
 	  the first line.  From Peter (2713)
 
-Fri Jan  3 02:26:03 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Jan  3 02:26:03 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Misc/compctl-examples: setopt/unsetopt compctl fixes
 
@@ -14364,7 +14364,7 @@
 	* Src/prompt.c: my long directories in prompt fix broke prompt
 	  truncation.  From Zefram (2687)
 
-Thu Jan  2 20:57:33 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Jan  2 20:57:33 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* configure, configure.in: alpha-linux defines signals in
 	  <asm/signum.h>.  From David Krinsky <krinsky@hcs.harvard.edu>
@@ -14400,7 +14400,7 @@
 	* Src/conf.sed, Src/mkbltnmlst.sh, Src/mkstamp.sh: move big shell
 	  scripts from the Makefile to separate files.
 
-Wed Jan  1 20:04:06 1997  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Jan  1 20:04:06 1997  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/options.c: remove union initialisation hacks and use optno
 	  for aliases
@@ -14411,7 +14411,7 @@
 	* Src/system.h, configure, configure.in: dgux CLOBBERS_TYPEAHEAD.
 	  From Roderick Schertler <roderick@gate.net> (2623)
 
-Tue Dec 31 02:28:09 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Dec 31 02:28:09 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in, Src/Modules/Makefile.in, Src/Zle/Makefile.in:
 	  improve proto dependency rules
@@ -14428,7 +14428,7 @@
 	* Src/Zle/zle_tricky.c, Src/params.c, Src/utils.c: use
 	  dupstrpfx/ztrduppfx
 
-Mon Dec 30 23:24:46 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Dec 30 23:24:46 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in, Src/init.c, Src/mods.conf, Src/xmods.conf:
 	  automatic generation of linked-in module boot code and automatic
@@ -14458,7 +14458,7 @@
 	  Rearrange functions so that they are already defined when first
 	  referenced.
 
-Sun Dec 29 22:34:21 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Dec 29 22:34:21 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Doc/zshexpn.man, Doc/zshmisc.man, Src/glob.c,
 	  Src/lex.c: brace related bugfixes
@@ -14468,7 +14468,7 @@
 	* Src/exec.c, Src/loop.c, Src/parse.c: case argument should not be
 	  globbed
 
-Sat Dec 28 19:55:04 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Dec 28 19:55:04 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/options.c (optlookup): no prefix was ignored
 
@@ -14477,7 +14477,7 @@
 	  addbuiltins() and deletebuiltins() functions to add/delete a
 	  group of builtins.  From Zefram (2646)
 
-Fri Dec 27 23:33:20 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Dec 27 23:33:20 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Modules/example.c, Src/Zle/compctl.c, Src/Zle/zle_main.c,
 	  Src/init.c, Src/module.c: addbuiltin can now set all members of
@@ -14492,7 +14492,7 @@
 
 	* Src/exec.c: minor noclobber changes
 
-Thu Dec 26 22:43:13 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Dec 26 22:43:13 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c, Src/hist.c, Src/lex.c, Src/mem.c, Src/params.c,
 	  Src/subst.c, Src/text.c, Src/utils.c: all "can't happen"
@@ -14541,7 +14541,7 @@
 	* Src/builtin.c, Src/compat.c, Src/utils.c: handle arbitrary long
 	  pathnames in pwd
 
-Wed Dec 25 16:04:45 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Dec 25 16:04:45 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Doc/zshoptions.man, Src/Makefile.in,
 	  Src/Zle/zle_tricky.c, Src/builtin.c, Src/glob.c, Src/globals.h,
@@ -14549,7 +14549,7 @@
 	  Src/utils.c, Src/zsh.h, Src/options.c: New hash table for
 	  options, option aliases.  From Zefram (2612)
 
-Tue Dec 24 02:25:20 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Dec 24 02:25:20 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_tricky.c, Src/glob.c, Src/hashtable.c, Src/utils.c:
 	  move . and .. special case handling into zreaddir().	From
@@ -14567,7 +14567,7 @@
 	  improvements, better support for builtin modules.  From Zefram
 	  (2611)
 
-Sat Dec 21 02:00:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Dec 21 02:00:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.1.0 released
 
@@ -14583,7 +14583,7 @@
 	* configure, configure.in: SunOS 4 shared libraries do not work
  	  when they are stripped
 
-Thu Dec 19 21:27:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Dec 19 21:27:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c: work around a bug in NeXTStep 3.2 which caused slow
  	  refresh
@@ -14591,19 +14591,19 @@
 	* Etc/FAQ: FAQ from Peter: Id: zsh.FAQ,v 2.22 1996/12/19 09:52:11
  	  pws Exp
 
-Wed Dec 18 23:51:24 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Dec 18 23:51:24 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Doc/zsh.texi, Etc/FAQ, META-FAQ: ftp.prz.tu-berlin.de no longer
  	  mirrors zsh, uiarchive.uiuc.edu name correction
 
-Tue Dec 17 20:08:58 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Dec 17 20:08:58 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/params.c: remove some compiler varnings
 
 	* Src/Makefile.in: rlimits.h depends on rlimits.awk.  Cosmetic
  	  changes.  From Zefram (2589)
 
-Mon Dec 16 03:33:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Dec 16 03:33:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* README: unknown limits should no longer be a problem
 
@@ -14613,13 +14613,13 @@
 	* Src/builtin.c: fg %% failed and disabled job control sometimes
  	  when there were no current job
 
-Sun Dec 15 01:07:40 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Dec 15 01:07:40 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* README: beta warning
 
 	* Misc/compctl-examples: compctl for zmodload
 
-Sat Dec 14 22:50:00 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Dec 14 22:50:00 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_main.c: Remove unnecessary prefix delay in zle.
   	  From Zefram (2583)
@@ -14635,7 +14635,7 @@
 
 	* configure, configure.in: working fifos should be tested in /tmp
 
-Wed Dec 11 02:30:39 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Dec 11 02:30:39 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_tricky.c, Src/builtin.c, Src/exec.c, Src/globals.h,
  	  Src/hist.c, Src/init.c, Src/input.c, Src/lex.c, Src/zsh.h:
@@ -14646,7 +14646,7 @@
 
 	* Src/params.c: use the heap in getstrvalue()
 
-Tue Dec 10 02:27:35 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Dec 10 02:27:35 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_refresh.c: single line zle refresh bugfix from Geoff
  	  (2549)
@@ -14661,7 +14661,7 @@
 
 	* Src/builtin.c: use the heap in zexit()
 
-Sun Dec  8 21:32:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Dec  8 21:32:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c, Doc/zshbuiltins.man, Src/hashtable.h, Src/module.c:
  	  zmodload can be used to define atoloaded builtins and module
@@ -14709,7 +14709,7 @@
 	* Src/builtin.c: show metafied characters correctly in bad option
  	  errors.  From Zefram (2497)
 
-Thu Dec  5 03:59:45 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Dec  5 03:59:45 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in, Src/Modules/Makefile.in, Src/Modules/example.c,
  	  Src/Zle/Makefile.in, Src/Zle/deltochar.c, Src/Zle/zle.h,
@@ -14726,7 +14726,7 @@
  	  cleanup_modname is back since on elf all module use one common
  	  name space.  Lots of other changes.
 
-Wed Nov 27 03:20:53 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Nov 27 03:20:53 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_main.c, Src/Zle/zle_vi.c: ANSI was broken and fixed
  	  again in zle_main.c ESC in vi command mode caused SEGV.  From
@@ -14736,7 +14736,7 @@
  	  --enable-zsh-debug.  Link non-debugged zsh with -s.  From Zefram
  	  (2479)
 
-Tue Nov 26 02:45:15 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Nov 26 02:45:15 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c: the STTY parameter did not work well when pipes were
  	  used.  From Peter (2474)
@@ -14767,7 +14767,7 @@
 	* Etc/FAQ: FAQ from Peter: Id: zsh.FAQ,v 2.21 1996/11/25 09:13:28
  	  pws Exp
 
-Mon Nov 25 02:39:08 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Nov 25 02:39:08 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/module.c: try to load the modules with .DL_EXT appended
  	  first.  Honor PATH_DIRS when loading a module.
@@ -14784,7 +14784,7 @@
  	  Src/init.c, Src/main.c, Src/module.c: modules can now statically
  	  compiled into zsh.  From Zefram (2455)
 
-Sun Nov 24 22:44:12 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Nov 24 22:44:12 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Zle/zle_move.c: vi-goto-mark fix from Thorsten
 
@@ -14795,7 +14795,7 @@
  	  Src/lex.c, Src/loop.c, Src/parse.c, Src/utils.c, Src/zsh.h: for
  	  ((expr; expr; expr)) command added
 
-Sat Nov 23 23:34:58 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Nov 23 23:34:58 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/exec.c:
 	  ((...)) substituted the expression twice and coredumped on (())
@@ -14813,7 +14813,7 @@
 	* Src/subst.c, acconfig.h, config.h.in, configure, configure.in:
  	  added configure check for variable-length automatic arrays
 
-Wed Nov 20 00:58:06 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Nov 20 00:58:06 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/utils.c: The spell checker always tries to fix as many
  	  leading directory compontents as possible.  From Bart (2429)
@@ -14825,7 +14825,7 @@
 	* Src/Zle/zle_tricky.c: my spell-word fix used an uninitialised
  	  pointer.  Fix from Bart (2428)
 
-Sun Nov 17 21:21:22 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Nov 17 21:21:22 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in: fix the .SUFFIXES list
 
@@ -14847,7 +14847,7 @@
 	* Src/exec.c, Src/parse.c, Src/text.c, Src/zsh.h: do not convert
  	  ((...)) to builtin let internally.
 
-Sat Nov 16 23:57:40 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Nov 16 23:57:40 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_tricky.c: spell-word zle function did not work for word
  	  beginning with a tilde
@@ -14871,14 +14871,14 @@
 	* Src/zle_tricky.c: the cursor moved back on TAB when it was on
  	  "".  From Zefram (2415)
 
-Thu Nov 14 12:59:25 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Nov 14 12:59:25 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/zle_refresh.c: one more refresh fix from Geoff (2404)
 
 	* Src/Makefile.in, Src/Modules/deltochar.c, Src/Modules/example.c,
  	  configure, configure.in: move modules into Src/Modules
 
-Wed Nov 13 21:47:28 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Nov 13 21:47:28 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Modules/deltochar.c, Src/Modules/example.c, Src/module.c:
  	  unload the module if the boot routine failed
@@ -14905,7 +14905,7 @@
  	  Src/zle_main.c, Src/zle_misc.c, Src/zle_tricky.c, Src/zle_vi.c:
  	  zle function modules from Peter (2339)
 
-Tue Nov 12 21:35:18 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Tue Nov 12 21:35:18 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/init.c, Src/zle_refresh.c: zle-refresh patch from Geoff (2336)
 
@@ -14914,7 +14914,7 @@
 
 	* Src/Makefile.in: added automatic ansi2knr rules
 
-Mon Nov 11 21:55:17 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Mon Nov 11 21:55:17 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in, Src/Modules/example.c, Src/module.c, configure,
  	  configure.in: various module changes from Zefram (2338)
@@ -14922,12 +14922,12 @@
 	* configure, configure.in: a $ was missing.  IRIX gcc needs
  	  -shared for modules.  From Peter
 
-Wed Nov  6 20:54:33 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Wed Nov  6 20:54:33 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in, Src/mod_example.c: moduule modifications for
  	  old compilers
 
-Sun Nov  3 23:00:05 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sun Nov  3 23:00:05 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/system.h: set OPEN_MAX to 64 if NOFILE is not defined
 
@@ -14937,7 +14937,7 @@
 	* Functions/pushd: setopt localoptions must come after
 	  emulate -R zsh
 
-Sat Nov  2 22:47:53 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Sat Nov  2 22:47:53 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/compat.c, Src/hashtable.c, Src/utils.c: do not blindly
  	  assume that . and .. are always the first two enrties in a
@@ -14946,7 +14946,7 @@
 
 	* Src/utils.c: max_zsh_fd should not be decreased below zero
 
-Thu Oct 31 01:38:10 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Thu Oct 31 01:38:10 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/Makefile.in, Src/globals.h, Src/hashtable.c,
  	  Src/hashtable.h, Src/init.c, Src/mod_example.c, Src/module.c,
@@ -14960,6 +14960,6 @@
 
 	* Src/builtin.c: read -c ignored its first parameter
 
-Fri Oct 25 20:50:38 1996  Zolt√°n Hidv√©gi  <hzoli@cs.elte.hu>
+Fri Oct 25 20:50:38 1996  Zolt·n HidvÈgi  <hzoli@cs.elte.hu>
 
 	* Src/version.h: zsh-3.0.1 released
diff -ruN zsh-5.0.4/Etc/FAQ zsh-5.0.2/Etc/FAQ
--- zsh-5.0.4/Etc/FAQ	2013-12-20 10:26:56.000000000 -0800
+++ zsh-5.0.2/Etc/FAQ	2012-12-21 11:33:24.000000000 -0800
@@ -231,7 +231,7 @@
 
 1.5: What's the latest version?
 
-  Zsh 5.0.4 is the latest production version.  For details of all the
+  Zsh 5.0.2 is the latest production version.  For details of all the
   changes, see the NEWS file in the source distribution.
 
   A beta of the next version is sometimes available.  Development of zsh is
diff -ruN zsh-5.0.4/Etc/FAQ.yo zsh-5.0.2/Etc/FAQ.yo
--- zsh-5.0.4/Etc/FAQ.yo	2013-12-20 10:26:25.000000000 -0800
+++ zsh-5.0.2/Etc/FAQ.yo	2012-12-21 11:31:28.000000000 -0800
@@ -301,7 +301,7 @@
 
 sect(What's the latest version?)
 
-  Zsh 5.0.4 is the latest production version.  For details of all the
+  Zsh 5.0.2 is the latest production version.  For details of all the
   changes, see the NEWS file in the source distribution.
 
   A beta of the next version is sometimes available.  Development of zsh is
diff -ruN zsh-5.0.4/Etc/zsh-development-guide zsh-5.0.2/Etc/zsh-development-guide
--- zsh-5.0.4/Etc/zsh-development-guide	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Etc/zsh-development-guide	2012-12-20 10:31:32.000000000 -0800
@@ -39,7 +39,7 @@
   intelligently.  Please make sure the filenames in the diff header
   are relative to the top-level directory of the zsh distribution; for
   example, it should say "Src/init.c" rather than "init.c" or
-  "zsh/Src/init.c".  Git-style naming of diffs is also acceptable.
+  "zsh/Src/init.c".
 
 * Please put only one bug fix or feature enhancement in a single patch and
   only one patch per mail message.  This helps me to multiplex the many
@@ -52,85 +52,9 @@
 * Please test your patch and make sure it applies cleanly. It takes
   considerably more time to manually merge a patch into the baseline code.
 
-* By convention, patches should be sent with a Subject: line starting with
-  one of "PATCH:", "[PATCH]" or "[PATCH n/m]" (for a patch series).
-
-Git Workflow
-------------
-
-Zsh has migrated from CVS to git for version control. Thus far, we have
-avoided further changes to our workflow.
- 
- * To allow changesets to be cross-referenced between the mailing list
-   archives and version control history, commit messages should start with
-   the mailing list sequence number. This number is generated by the list
-   server and inserted as an X-Seq: header field in the e-mail.
- 
- * An entry in the ChangeLog file should be added manually before pushing
-   a commit to the master repository. Don't create a separate change for
-   this: amend the existing commit in your local repository.
-
- * Do not merge your private feature branches onto the master branch: a
-   linear history without merge commits is simpler to follow (and to
-   bisect).
-
-Use of Git
-----------
-
-Micro Git Tutorial:
-
-  % $VISUAL file1.c file2.c new-file3.c
-  % git add new-file3.c
-  % git commit -a
-  % git push
-
- "git commit -a" automatically finds files which are tracked and have
- been modified, but doesn't pick up new files; "git add" adds a file to
- the index to be part of the next commit, and can be used for new files
- or for existing files (commit -a is a shortcut for the latter)
-
- "git push" assumes that you're on the master branch and the repository
- was created by cloning it from some place, with default options.
-
-Using a Local Feature Branch:
-
-  % git checkout -b feature_foo
-  % $VISUAL path/to/files ...
-  % git commit -a
-  [ generate single patch for changes ]
-  % git diff master
-  [ do mailing-list stuff here ]
-  [ Switch back to master: ]
-  % git checkout master
-  [ and get the most recent changes: ]
-  % git pull
-  [ make the branch content now be relative to *new* master tip ]
-  % git checkout feature_foo
-  % git rebase master
-  [ then bring in your changes: ]
-  % git checkout master
-  % git merge --squash feature_foo
-  % $VISUAL ChangeLog
-  % git add ChangeLog
-  % git commit --amend
-  % git push
-  [ cleanup ]
-  % git branch -d feature_foo
-
-  The above assumes you want all your changes on the feature branch to be
-  seen as a single change publicly. The normal git way to generate patches
-  is to use git format-patch which produces separate patches already
-  prepared for e-mailing. If you want to keep changes separate, don't use
-  the --squash option to git merge. In this case, it can be wise to use
-  --ff-only which ensures that you don't get a merge commit by only doing
-  the merge if the master can be trivially moved forward. An alternative is
-  to use git cherry-pick to pick out individual changes.
-
-Git further reading:
- * git help tutorial
- * git help tutorial-2
- * git help gitcore-tutorial
- * http://www-cs-students.stanford.edu/~blynn/gitmagic/
+* There is now a zsh patch archive.  To have your patches appear in the
+  archive, send them to the mailing list with a Subject: line starting
+  with "PATCH:".
 
 Testing
 -------
@@ -243,11 +167,6 @@
   also #include other system headers.  It *must not* #include any other
   module's headers or any other .pro files.
 
-* The repository includes a `.editorconfig' file with whitespace/indent
-  control settings. Information about text editor plugins and this file
-  can be found at <http://editorconfig.org/>.
-
-
 Modules
 -------
 
@@ -922,13 +841,13 @@
 ---------------------
 
 zsh is distributed in two parts: a "src" distribution containing all
-the source files (roughly, but not exactly, corresponding to the git
+the source files (roughly, but not exactly, corresponding to the CVS
 tree), and a "doc" distribution containing some pre-built files from
 the documentation directory.  All the files in the "doc" distribution
 may be generated from files in the "src" distribution with appropriate
 freely available tools.
 
-To indicate which files should be distributed, each directory in the git
+To indicate which files should be distributed, each directory in the CVS
 tree includes a file .distfiles that sets any number of a set of Bourne
 shell (scalar) parameters.  The value of the parameter is expanded as a
 set of standard command line arguments.  Basic globbing is allowed in the
@@ -943,6 +862,6 @@
   distribution.
 
 - DISTFILES_NOT is a list of files that will not be included in a
-  distribution, but that need to be present in the git tree.  This
+  distribution, but that need to be present in the CVS tree.  This
   variable is not used by the zsh build process and is present for
   the convenience of external checks.
diff -ruN zsh-5.0.4/Functions/Calendar/age zsh-5.0.2/Functions/Calendar/age
--- zsh-5.0.4/Functions/Calendar/age	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Calendar/age	2010-07-28 11:51:43.000000000 -0700
@@ -18,7 +18,7 @@
 # are allowed, but whitespace must be quoted to ensure age receives
 # the correct arguments.
 #
-#   AGEREF=2006/10/04:10:15
+#   AGEREF1=2006/10/04:10:15
 #   AGEREF2=2006/10/04:10:45
 #   print *(+age)
 #
@@ -33,27 +33,21 @@
 
 autoload -Uz calendar_scandate
 
-local timefmt
 local -a vals tmp
 
 [[ -e $REPLY ]] || return 1
-zstat -A vals +mtime -- $REPLY || return 1
+zstat -A vals +mtime $REPLY || return 1
 
 if (( $# >= 1 )); then
   if [[ $1 = :* ]]; then
-      if (( $# > 1 )); then
-	  timefmt="%Y/%m/%d:%H:%M:%S"
-      else
-	  timefmt="%Y/%m/%d"
-      fi
-      zstat -A tmp -F $timefmt +mtime -- ${1#:} || return 1
+    zstat -A tmp -F "%Y/%m/%d" +mtime ${1[2,-1]} || return 1
     local AGEREF=$tmp[1]
   else
     local AGEREF=$1
   fi
   # if 1 argument given, never use globally defined AGEREF2
   if [[ $2 = :* ]]; then
-    zstat -A tmp -F "%Y/%m/%d:%H:%M:%S" +mtime -- ${2#:} || return 1
+    zstat -A tmp -F "%Y/%m/%d" +mtime ${2[2,-1]} || return 1
     local AGEREF2=$tmp[1]
   else
     local AGEREF2=$2
diff -ruN zsh-5.0.4/Functions/MIME/zsh-mime-handler zsh-5.0.2/Functions/MIME/zsh-mime-handler
--- zsh-5.0.4/Functions/MIME/zsh-mime-handler	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/MIME/zsh-mime-handler	2011-12-10 14:40:56.000000000 -0800
@@ -74,25 +74,21 @@
 fi
 suffix=${suffix#*.}
 
-local handler flags no_sh no_bg arg bg_flag="&"
+local handler flags no_sh no_bg arg
 integer i
-local -a exec_asis hand_nonex exec_never
+local -a exec_asis hand_nonex
 
 # Set to a list of patterns which are ignored and executed as they are,
 # despite being called for interpretation by the mime handler.
 # Defaults to executable files, which ensures that they are executed as
 # they are, even if they have a suffix.
 zsh-mime-contexts -a $suffix execute-as-is exec_asis || exec_asis=('*(*)' '*(/)')
-zsh-mime-contexts -a $suffix execute-never exec_never
 
 # Set to a list of patterns for which the handler will be used even
 # if the file doesn't exist on the disk.
 zsh-mime-contexts -a $suffix handle-nonexistent hand_nonex ||
   hand_nonex=('[[:alpha:]]#:/*')
 
-# Set to true if the job should be disowned.
-zsh-mime-contexts -t $suffix disown && bg_flag="&!"
-
 local pattern
 local -a files
 
@@ -126,9 +122,6 @@
 for pattern in $exec_asis; do
   files=(${dirpref}${~pattern})
   if [[ -n ${files[(r)$1]} ]]; then
-    for pattern in $exec_never; do
-      [[ ${1:A} = ${~pattern} ]] && break 2
-    done
     if (( list )); then
       for (( i = 1; i <= $#; i++ )); do
 	(( i == 1 )) || print -n " "
@@ -316,8 +309,8 @@
   # Otherwise it's equivalent to removing the eval and all the quotes,
   # including the (q) flags.
   if [[ -n $stdin ]]; then
-    eval cat ${(q)argv} "|" ${(q)execargs} $bg_flag
+    eval cat ${(q)argv} "|" ${(q)execargs} "&"
   else
-    eval ${(q)execargs} $bg_flag
+    eval ${(q)execargs} "&"
   fi
 fi
diff -ruN zsh-5.0.4/Functions/Misc/run-help zsh-5.0.2/Functions/Misc/run-help
--- zsh-5.0.4/Functions/Misc/run-help	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Misc/run-help	2010-07-28 11:51:43.000000000 -0700
@@ -10,7 +10,7 @@
 
 emulate -RL zsh
 
-local HELPDIR="${HELPDIR:-@runhelpdir@}"
+local HELPDIR="${HELPDIR:-/usr/share/zsh/$ZSH_VERSION/help}"
 
 [[ $1 == "." ]] && 1="dot"
 [[ $1 == ":" ]] && 1="colon"
@@ -56,10 +56,6 @@
     [[ -n $noalias && $what = *" is an alias "* ]] && continue
     builtin print -r $what
     case $what in
-    (*( is an alias for (noglob|nocorrect))*)
-	[[ ${what[(w)7]:t} != ${what[(w)1]} ]] &&
-	  run_help_orig_cmd=${what[(w)1]} run-help ${what[(w)7]:t}
-	;;
     (*( is an alias)*)
 	[[ ${what[(w)6]:t} != ${what[(w)1]} ]] &&
 	  run_help_orig_cmd=${what[(w)1]} run-help ${what[(w)6]:t}
diff -ruN zsh-5.0.4/Functions/Misc/zcalc zsh-5.0.2/Functions/Misc/zcalc
--- zsh-5.0.4/Functions/Misc/zcalc	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Misc/zcalc	2010-07-28 11:51:43.000000000 -0700
@@ -85,13 +85,10 @@
 # similarly -##<base>; they set the default output base, with and without
 # a base discriminator in front, respectively.
 #
-# With the option -e, the arguments are evaluated as if entered
-# interactively.  So, for example:
-#   zcalc -e -\#16 -e 1055
-# prints
-#   0x41f
-# Any number of expressions may be given and they are evaluated
-# sequentially just as if read automatically.
+#
+# To do:
+# - separate zcalc history from shell history using arrays --- or allow
+#   zsh to switch internally to and from array-based history.
 
 emulate -L zsh
 setopt extendedglob
@@ -100,8 +97,7 @@
 # begin with _.
 local line ans base defbase forms match mbegin mend psvar optlist opt arg
 local compcontext="-zcalc-line-"
-integer num outdigits outform=1 expression_mode
-local -a expressions
+integer num outdigits outform=1
 
 # We use our own history file with an automatic pop on exit.
 history -ap "${ZDOTDIR:-$HOME}/.zcalc_history"
@@ -118,7 +114,7 @@
 (( PI = 4 * atan(1), E = exp(1) ))
 
 # Process command line
-while [[ -n $1 && $1 = -(|[#-]*|f|e) ]]; do
+while [[ -n $1 && $1 = -(|[#-]*) ]]; do
   optlist=${1[2,-1]}
   shift
   [[ $optlist = (|-) ]] && break
@@ -134,30 +130,19 @@
 	       arg=$1
 	       shift
 	    else
-	       print -- "-# requires an argument" >&2
+	       print "-# requires an argument" >&2
 	       return 1
 	    fi
 	    if [[ $arg != (|\#)[[:digit:]]## ]]; then
-	      print -- "-# requires a decimal number as an argument" >&2
+	      print - "-# requires a decimal number as an argument" >&2
 	      return 1
 	    fi
             defbase="[#${arg}]"
 	    ;;
-	(f) # Force floating point operation
-	    setopt forcefloat
-	    ;;
-        (e) # Arguments are expressions
-	    (( expression_mode = 1 ));
-	    ;;
     esac
   done
 done
 
-if (( expression_mode )); then
-  expressions=("$@")
-  argv=()
-fi
-
 for (( num = 1; num <= $#; num++ )); do
   # Make sure all arguments have been evaluated.
   # The `$' before the second argv forces string rather than numeric
@@ -167,31 +152,7 @@
 done
 
 psvar[1]=$num
-local prev_line cont_prompt
-while (( expression_mode )) ||
-  vared -cehp "${cont_prompt}${ZCALCPROMPT}" line; do
-  if (( expression_mode )); then
-    (( ${#expressions} )) || break
-    line=$expressions[1]
-    shift expressions
-  fi
-  if [[ $line = (|*[^\\])('\\')#'\' ]]; then
-    prev_line+=$line[1,-2]
-    cont_prompt="..."
-    line=
-    continue
-  fi
-  line="$prev_line$line"
-  prev_line=
-  cont_prompt=
-  # Test whether there are as many open as close
-  # parentheses in the line so far.
-  if [[ ${#line//[^\(]} -gt ${#line//[^\)]} ]]; then
-      prev_line+=$line
-      cont_prompt="..."
-      line=
-      continue
-  fi
+while vared -cehp "${ZCALCPROMPT}" line; do
   [[ -z $line ]] && break
   # special cases
   # Set default base if `[#16]' or `[##16]' etc. on its own.
@@ -204,7 +165,6 @@
 	defbase=$match[1]
       fi
       print -s -- $line
-      print -- $(( ${defbase} ans ))
       line=
       continue
     else
@@ -260,7 +220,7 @@
       continue
     ;;
 
-    ((function|:f(unc(tion|)|))[[:blank:]]##(#b)([^[:blank:]]##)(|[[:blank:]]##([^[:blank:]]*)))
+    ((:|)function[[:blank:]]##(#b)([^[:blank:]]##)(|[[:blank:]]##([^[:blank:]]*)))
       zmathfuncdef $match[1] $match[3]
       line=
       continue
diff -ruN zsh-5.0.4/Functions/Misc/zmv zsh-5.0.2/Functions/Misc/zmv
--- zsh-5.0.4/Functions/Misc/zmv	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Misc/zmv	2012-08-21 10:59:32.000000000 -0700
@@ -93,11 +93,7 @@
 #  -p <program>
 #      Call <program> instead of cp, ln or mv.  Whatever it does, it should
 #      at least understand the form '<program> -- <oldname> <newname>',
-#      where <oldname> and <newname> are filenames generated. <program>
-#      will be split into words.
-#  -P <program>
-#      As -p, but the program doesn't understand the "--" convention.
-#      In this case the file names must already be sane.
+#      where <oldname> and <newname> are filenames generated.
 #  -w  Pick out wildcard parts of the pattern, as described above, and
 #      implicitly add parentheses for referring to them.
 #  -W  Just like -w, with the addition of turning wildcards in the
@@ -127,16 +123,14 @@
 
 local f g args match mbegin mend files action myname tmpf opt exec
 local opt_f opt_i opt_n opt_q opt_Q opt_s opt_M opt_C opt_L 
-local opt_o opt_p opt_P opt_v opt_w opt_W MATCH MBEGIN MEND
+local opt_o opt_p opt_v opt_w opt_W MATCH MBEGIN MEND
 local pat repl errstr fpat hasglobqual opat
 typeset -A from to
 integer stat
 
-local dashes=--
-
 myname=${(%):-%N}
 
-while getopts ":o:p:P:MCLfinqQsvwW" opt; do
+while getopts ":o:p:MCLfinqQsvwW" opt; do
   if [[ $opt = "?" ]]; then
     print -r -- "$myname: unrecognized option: -$OPTARG" >&2
     return 1
@@ -150,7 +144,6 @@
 [[ -n $opt_C ]] && action=cp
 [[ -n $opt_L ]] && action=ln
 [[ -n $opt_p ]] && action=$opt_p
-[[ -n $opt_P ]] && action=$opt_P dashes=
 
 if [[ -z $action ]]; then
   action=$myname[-2,-1]
@@ -285,7 +278,7 @@
 
 for f in $files; do
   [[ -z $to[$f] ]] && continue
-  exec=(${=action} ${=opt_o} $opt_s $dashes $f $to[$f])
+  exec=($action ${=opt_o} $opt_s -- $f $to[$f])
   [[ -n $opt_i$opt_n$opt_v ]] && print -r -- ${(q-)exec}
   if [[ -n $opt_i ]]; then
     read -q 'opt?Execute? ' || continue
diff -ruN zsh-5.0.4/Functions/VCS_Info/Backends/VCS_INFO_detect_svn zsh-5.0.2/Functions/VCS_Info/Backends/VCS_INFO_detect_svn
--- zsh-5.0.4/Functions/VCS_Info/Backends/VCS_INFO_detect_svn	2013-12-05 12:03:46.000000000 -0800
+++ zsh-5.0.2/Functions/VCS_Info/Backends/VCS_INFO_detect_svn	2011-11-18 13:16:05.000000000 -0800
@@ -7,5 +7,5 @@
 [[ $1 == '--flavours' ]] && return 1
 
 VCS_INFO_check_com ${vcs_comm[cmd]} || return 1
-vcs_comm[detect_need_file]="entries format wc.db"
+vcs_comm[detect_need_file]="entries format"
 VCS_INFO_bydir_detect '.svn' || return 1
diff -ruN zsh-5.0.4/Functions/VCS_Info/Backends/VCS_INFO_get_data_git zsh-5.0.2/Functions/VCS_Info/Backends/VCS_INFO_get_data_git
--- zsh-5.0.4/Functions/VCS_Info/Backends/VCS_INFO_get_data_git	2013-11-29 15:28:25.000000000 -0800
+++ zsh-5.0.2/Functions/VCS_Info/Backends/VCS_INFO_get_data_git	2012-08-21 10:59:32.000000000 -0700
@@ -5,10 +5,10 @@
 setopt localoptions extendedglob NO_shwordsplit
 local gitdir gitbase gitbranch gitaction gitunstaged gitstaged gitsha1
 local stgitpatch stgitunapplied
-local -A hook_com
+local -xA hook_com
 
 VCS_INFO_git_getaction () {
-    local gitdir=$1
+    local gitaction='' gitdir=$1
     local tmp
 
     for tmp in "${gitdir}/rebase-apply" \
@@ -22,6 +22,7 @@
             else
                 gitaction="am/rebase"
             fi
+            printf '%s' ${gitaction}
             return 0
         fi
     done
@@ -29,7 +30,7 @@
     for tmp in "${gitdir}/rebase-merge/interactive" \
                "${gitdir}/.dotest-merge/interactive" ; do
         if [[ -f "${tmp}" ]] ; then
-            gitaction="rebase-i"
+            printf '%s' "rebase-i"
             return 0
         fi
     done
@@ -37,35 +38,25 @@
     for tmp in "${gitdir}/rebase-merge" \
                "${gitdir}/.dotest-merge" ; do
         if [[ -d "${tmp}" ]] ; then
-            gitaction="rebase-m"
+            printf '%s' "rebase-m"
             return 0
         fi
     done
 
     if [[ -f "${gitdir}/MERGE_HEAD" ]] ; then
-        gitaction="merge"
+        printf '%s' "merge"
         return 0
     fi
 
     if [[ -f "${gitdir}/BISECT_LOG" ]] ; then
-        gitaction="bisect"
+        printf '%s' "bisect"
         return 0
     fi
-
-    if [[ -f "${gitdir}/CHERRY_PICK_HEAD" ]] ; then
-        if [[ -d "${gitdir}/sequencer" ]] ; then
-            gitaction=cherry-seq
-        else
-            gitaction=cherry
-        fi
-        return 0
-    fi
-
     return 1
 }
 
 VCS_INFO_git_getbranch () {
-    local gitdir=$1 tmp actiondir
+    local gitbranch gitdir=$1 tmp actiondir
     local gitsymref="${vcs_comm[cmd]} symbolic-ref HEAD"
 
     actiondir=''
@@ -104,11 +95,12 @@
         fi
     fi
 
+    printf '%s' "${gitbranch}"
     return 0
 }
 
 gitdir=${vcs_comm[gitdir]}
-VCS_INFO_git_getbranch ${gitdir}
+gitbranch="$(VCS_INFO_git_getbranch ${gitdir})"
 if zstyle -t ":vcs_info:${vcs}:${usercontext}:${rrn}" get-revision ; then
     gitsha1=$(${vcs_comm[cmd]} rev-parse --quiet --verify HEAD)
 else
@@ -131,14 +123,12 @@
 fi
 
 VCS_INFO_adjust
-VCS_INFO_git_getaction ${gitdir}
-gitbase=$( ${vcs_comm[cmd]} rev-parse --show-toplevel )
+gitaction="$(VCS_INFO_git_getaction ${gitdir})"
+gitbase=${PWD%/${$( ${vcs_comm[cmd]} rev-parse --show-prefix )%/##}}
 rrn=${gitbase:t}
 
 local patchdir=${gitdir}/patches/${gitbranch}
-if [[ -d $patchdir ]] && [[ -f $patchdir/applied ]] \
-   && [[ -f $patchdir/unapplied ]]
-then
+if [[ -d $patchdir ]] ; then
     local -a stgit_applied stgit_unapplied stgit_all
 
     stgit_applied=(${(f)"$(< "${patchdir}/applied")"})
diff -ruN zsh-5.0.4/Functions/VCS_Info/VCS_INFO_reposub zsh-5.0.2/Functions/VCS_Info/VCS_INFO_reposub
--- zsh-5.0.4/Functions/VCS_Info/VCS_INFO_reposub	2013-11-29 15:28:25.000000000 -0800
+++ zsh-5.0.2/Functions/VCS_Info/VCS_INFO_reposub	2008-09-19 05:58:51.000000000 -0700
@@ -5,9 +5,9 @@
 setopt localoptions extendedglob NO_shwordsplit
 local base=${1%%/##}
 
-[[ $(pwd -P) == ${base}/* ]] || {
+[[ ${PWD} == ${base}/* ]] || {
     printf '.'
     return 1
 }
-printf '%s' ${$(pwd -P)#$base/}
+printf '%s' ${PWD#$base/}
 return 0
diff -ruN zsh-5.0.4/Functions/Zle/down-line-or-beginning-search zsh-5.0.2/Functions/Zle/down-line-or-beginning-search
--- zsh-5.0.4/Functions/Zle/down-line-or-beginning-search	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Zle/down-line-or-beginning-search	2007-08-22 13:24:47.000000000 -0700
@@ -3,8 +3,6 @@
 
 emulate -L zsh
 
-typeset -g __searching __savecursor
-
 if [[ ${+NUMERIC} -eq 0 &&
     ( $LASTWIDGET = $__searching || $RBUFFER != *$'\n'* ) ]]
 then
diff -ruN zsh-5.0.4/Functions/Zle/keeper zsh-5.0.2/Functions/Zle/keeper
--- zsh-5.0.4/Functions/Zle/keeper	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Zle/keeper	2005-12-04 21:42:11.000000000 -0800
@@ -4,9 +4,6 @@
 # Shell Corner column on UnixReview.com in January 2005 at the URL
 # <http://www.unixreview.com/documents/s=9513/ur0501a/ur0501a.htm>
 #
-# Article still available on the Wayback Machine:
-# <http://web.archive.org/web/20050207041146/http://www.unixreview.com/documents/s=9513/ur0501a/ur0501a.htm>
-#
 # A few minor edits have been made to those functions for this file.  Key
 # bindings are commented out to avoid clashes with any existing bindings.
 ##
@@ -72,21 +69,17 @@
 # "_insert_kept".
 
 _expand_word_and_keep() {
-    {
-        function compadd {
-            local -A args
-            zparseopts -E -A args J:
-            if [[ $args[-J] == all-expansions ]]
-            then
-                builtin compadd -A kept "$@"
-                kept=( ${(Q)${(z)kept}} )
-            fi
-            builtin compadd "$@"
-        }
-        _expand_word
-    } always {
-        unfunction compadd
+    function compadd() {
+        local -A args
+        zparseopts -E -A args J:
+        if [[ $args[-J] == all-expansions ]]
+        then
+            builtin compadd -A kept "$@"
+            kept=( ${(Q)${(z)kept}} )
+        fi
+        builtin compadd "$@"
     }
+    { _expand_word } always { unfunction compadd }
 }
 
 zle -C _expand_word complete-word _expand_word_and_keep
diff -ruN zsh-5.0.4/Functions/Zle/modify-current-argument zsh-5.0.2/Functions/Zle/modify-current-argument
--- zsh-5.0.4/Functions/Zle/modify-current-argument	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Zle/modify-current-argument	2011-01-28 14:09:28.000000000 -0800
@@ -14,27 +14,24 @@
 setopt localoptions noksharrays multibyte
 
 local -a reply
-integer posword poschar fromend endoffset
-local REPLY REPLY2
+integer REPLY REPLY2 fromend endoffset
 
 autoload -Uz split-shell-arguments
 split-shell-arguments
 
-(( posword = REPLY, poschar = REPLY2 ))
-
 # Can't do this unless there's some text under or left of us.
-(( posword < 2 )) && return 1
+(( REPLY < 2 )) && return 1
 
 # Get the index of the word we want.
-if (( posword & 1 )); then
+if (( REPLY & 1 )); then
   # Odd position; need previous word.
-  (( posword-- ))
+  (( REPLY-- ))
   # Pretend position was just after the end of it.
-  (( poschar = ${#reply[posword]} + 1 ))
+  (( REPLY2 = ${#reply[REPLY]} + 1 ))
 fi
 
 # Work out offset from end of string
-(( fromend = $poschar - ${#reply[posword]} - 1 ))
+(( fromend = $REPLY2 - ${#reply[REPLY]} - 1 ))
 if (( fromend >= -1 )); then
   # Cursor is near the end of the word, we'll try to keep it there.
   endoffset=1
@@ -42,17 +39,11 @@
 
 # Length of all characters before current.
 # Force use of character (not index) counting and join without IFS.
-integer wordoff="${(cj..)#reply[1,posword-1]}"
+integer wordoff="${(cj..)#reply[1,REPLY-1]}"
 
-# Replacement for current word.  This could do anything to ${reply[posword]}.
-local ARG="${reply[posword]}" repl
-if [[ $1 != *ARG* ]]; then
-    REPLY=
-    $1 $ARG || return 1
-    repl=$REPLY
-else
-    eval repl=\"$1\"
-fi
+# Replacement for current word.  This could do anything to ${reply[REPLY]}.
+local ARG="${reply[REPLY]}" repl
+eval repl=\"$1\"
 
 if (( !endoffset )) && [[ ${repl[fromend,-1]} = ${ARG[fromend,-1]} ]]; then
   # If the part of the string from here to the end hasn't changed,
@@ -63,8 +54,8 @@
 # New line:  all words before and after current word, with
 # no additional spaces since we've already got the whitespace
 # and the replacement word in the middle.
-local left="${(j..)reply[1,posword-1]}${repl}"
-local right="${(j..)reply[posword+1,-1]}"
+local left="${(j..)reply[1,REPLY-1]}${repl}"
+local right="${(j..)reply[REPLY+1,-1]}"
 
 if [[ endoffset -ne 0 && ${#repl} -ne 0 ]]; then
   # Place cursor relative to end.
@@ -80,5 +71,5 @@
   integer repmax=$(( ${#repl} + 1 ))
   # Remember CURSOR starts from offset 0 for some reason, so
   # subtract 1 from positions.
-  (( CURSOR = wordoff + (poschar > repmax ? repmax : poschar) - 1 ))
+  (( CURSOR = wordoff + (REPLY2 > repmax ? repmax : REPLY2) - 1 ))
 fi
diff -ruN zsh-5.0.4/Functions/Zle/up-line-or-beginning-search zsh-5.0.2/Functions/Zle/up-line-or-beginning-search
--- zsh-5.0.4/Functions/Zle/up-line-or-beginning-search	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Functions/Zle/up-line-or-beginning-search	2007-08-22 13:24:47.000000000 -0700
@@ -3,8 +3,6 @@
 
 emulate -L zsh
 
-typeset -g __searching __savecursor
-
 if [[ $LBUFFER == *$'\n'* ]]; then
   zle .up-line-or-history
   __searching=''
diff -ruN zsh-5.0.4/INSTALL zsh-5.0.2/INSTALL
--- zsh-5.0.4/INSTALL	2013-12-17 12:17:12.000000000 -0800
+++ zsh-5.0.2/INSTALL	2011-04-30 09:54:26.000000000 -0700
@@ -13,26 +13,6 @@
 MAKING AND INSTALLING
 =====================
 
-Dependencies
-------------
-
-The main shell can be compiled with tools available on a typical
-Unix-like system including development packages.  However, the
-documentation requires various additional tools that are not so standard:
-
-- YODL, for turning the documentation source files (.yo) into manual
-pages and TeXinfo source for producing PDF and .info formats;
-
-- Perl and interactive manual tools, for turning the zshbuiltins(1)
-manual into help files that can be displayed by the run-help function.
-For example, the colcrt or col tool, not typically required for
-installing software, must be available.
-
-To avoid needing these, the source distribution is supplemented by a
-documentation distribution that may be downloaded from the same place as
-the source.  This provides fully generated documentation with references
-to files in the default locations.
-
 Check MACHINES File
 -------------------
 
@@ -297,7 +277,7 @@
 If you are making local modifications to zsh, you are strongly
 advised to configure with the option
 
-  --enable-custom-patchlevel="<my-mod-string>"
+  --enable-local-patchlevel="<my-mod-string>"
 
 so that the variable $ZSH_PATCHLEVEL indicates this is not a standard
 version of the shell.  The argument is arbitrary, but should indicate
diff -ruN zsh-5.0.4/LICENCE zsh-5.0.2/LICENCE
--- zsh-5.0.4/LICENCE	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/LICENCE	2009-03-14 11:23:31.000000000 -0700
@@ -1,17 +1,5 @@
-Unless otherwise noted in the header of specific files, files in this
-distribution have the licence shown below.
-
-However, note that certain shell functions are licensed under versions
-of the GNU Public Licence.  Anyone distributing the shell as a binary
-including those files needs to take account of this.  Search shell
-functions for "Copyright" for specific copyright information.
-None of the core functions are affected by this, so those files
-may simply be omitted.
-
---
-
 The Z Shell is copyright (c) 1992-2009 Paul Falstad, Richard Coleman,
-Zolt√°n Hidv√©gi, Andrew Main, Peter Stephenson, Sven Wischnowsky, and
+Zolt·n HidvÈgi, Andrew Main, Peter Stephenson, Sven Wischnowsky, and
 others.  All rights reserved.  Individual authors, whether or not
 specifically named, retain copyright in all changes; in what follows, they
 are referred to as `the Zsh Development Group'.  This is for convenience
diff -ruN zsh-5.0.4/Makefile.in zsh-5.0.2/Makefile.in
--- zsh-5.0.4/Makefile.in	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Makefile.in	2009-03-08 14:45:29.000000000 -0700
@@ -63,8 +63,8 @@
 	$(MAKE) install STRIPFLAGS="-s"
 
 # install/uninstall most things
-install: install.bin install.modules install.fns install.man install.runhelp
-uninstall: uninstall.bin uninstall.modules uninstall.fns uninstall.man uninstall.runhelp
+install: install.bin install.modules install.fns install.man
+uninstall: uninstall.bin uninstall.modules uninstall.fns uninstall.man
 
 # install/uninstall just the binary
 install.bin uninstall.bin:
@@ -78,17 +78,13 @@
 install.man uninstall.man:
 	@cd Doc && $(MAKE) $(MAKEDEFS) $@
 
-# install/uninstall just the runhelp files
-install.runhelp uninstall.runhelp:
-	@cd Doc && $(MAKE) $(MAKEDEFS) $@
-
 # install/uninstall just the shell functions
 install.fns:
 	if test x$(fndir) != x && test x$(fndir) != xno; then \
 	  test x$(sitefndir) != xno && \
 	    $(SHELL) $(sdir_top)/mkinstalldirs $(DESTDIR)$(sitefndir); \
 	  sdir_top="$(sdir_top)" fndir="$(fndir)" dir_top="$(dir_top)" \
-	  scriptdir="$(scriptdir)" runhelpdir="$(runhelpdir)" \
+	  scriptdir="$(scriptdir)" \
 	  FUNCTIONS_SUBDIRS="$(FUNCTIONS_SUBDIRS)" \
 	  INSTALL_DATA="$(INSTALL_DATA)" \
 	  INSTALL_PROGRAM="$(INSTALL_PROGRAM)" \
@@ -164,7 +160,6 @@
 $(DISTNAME).tar.gz: FORCE
 	@$(sdir_top)/Util/mkdisttree.sh $(DISTNAME) $(sdir_top) $(dir_top) SRC \
 	    $(MAKE) $(MAKEDEFS)
-	echo '#define ZSH_PATCHLEVEL "'`cd $(sdir_top) && git describe --tags --long`'"' >$(DISTNAME)/Src/patchlevel.h.release
 	tar cf - $(DISTNAME) | gzip -9 > $@
 	rm -rf $(DISTNAME)
 
diff -ruN zsh-5.0.4/NEWS zsh-5.0.2/NEWS
--- zsh-5.0.4/NEWS	2013-12-16 14:17:12.000000000 -0800
+++ zsh-5.0.2/NEWS	2012-09-15 11:22:31.000000000 -0700
@@ -17,26 +17,6 @@
 functions called from the specified one(s) that don't also have the -t
 or -T flag.
 
-The option FORCE_FLOAT has been added to force all arithmetic constants
-to be treated as floating point.  This is most useful locally within
-functions or scripts performing floating point calculations.
-
-Individual pattern characters can be disabled.  For example, to allow '^'
-to be an ordinary character even if the option EXTENDED_GLOB is set, use
-"disable -p '^'".
-
-The variable editing builtin vared can be given custom editing widgets
-for initialisation and finishing.
-
-The line editor's capability for listening on file descriptors
-additional to the terminal has been enhanced so that the handler for
-such file descriptors can be a line editor widget.  Previously the
-handler always behaved as a standard shell function.
-
-Hooks for adding history (the function zshaddhistory and the
-array zshaddhistory_functions) can return status 2 to indicate that
-history is to be saved internally within the shell but not written.
-
 In file completion, the recursive-files style can be set to an array of
 patterns to match against "$PWD/".  In any matched location, it is
 possibly to complete files in arbitrarily deep subdirectories without
@@ -47,17 +27,6 @@
 user-expand files to return a string in REPLY that will be used to name
 the set of expansions returned.
 
-The parameter HISTORY_IGNORE may be set to a pattern which matches
-lines in the internal history that are to be omitted from the history
-file at file write time.  This differs from history changes made in
-the zshaddhistory hook or by the HIST_IGNORE_* options, all of which
-take effect immediately on the internal history list itself.
-
-The parameter ZLE_RPROMPT_INDENT can be set to 0 to remove the space
-between the right hand side of the screen (this causes problems with
-some terminals).  It is not special and is not set by default; the
-effect in that case is as if it was 1, as in previous versions.
-
 
 Changes between 4.2 and 5.0.0
 -----------------------------
diff -ruN zsh-5.0.4/README zsh-5.0.2/README
--- zsh-5.0.4/README	2013-12-20 10:28:48.000000000 -0800
+++ zsh-5.0.2/README	2012-12-21 11:32:11.000000000 -0800
@@ -5,9 +5,9 @@
 Version
 -------
 
-This is version 5.0.4 of the shell.  This is a stable release.
-There are minor new features as well as bug fixes since 5.0.2.
-5.0.3 was a short-lived release with most of the features of 5.0.4.
+This is version 5.0.2 of the shell.  This is a stable release.
+There are minor new features as well as bug fixes since 5.0.0 and
+one bug fix since the short-lived 5.0.1.
 
 Installing Zsh
 --------------
@@ -28,17 +28,6 @@
 file FEATURES, and for the latest changes see NEWS.  For more
 details, see the documentation.
 
-Incompatibilities between 5.0.2 and 5.0.4
------------------------------------------
-
-The "zshaddhistory" hook mechanism documented in the zshmisc manual page
-has been upgraded so that a hook returning status 2 causes a history
-line to be saved on the internal history list but not written to the
-history file.  Previously any non-zero status return would cause
-the line not to be saved on the history at all.  It is recommended
-to use status 1 for this (indeed most shell users would naturally do
-so).
-
 Incompatibilities between 5.0.0 and 5.0.2
 -----------------------------------------
 
@@ -366,7 +355,7 @@
 If you would like to contribute to the development and maintenance of zsh,
 then you should join the zsh-workers mailing list (check the META-FAQ
 for info on this).  You should also read the "zsh-development-guide"
-located in the subdirectory Etc.
+located in the subdirectory Util.
 
 Contributors
 ------------
diff -ruN zsh-5.0.4/Src/Builtins/rlimits.awk zsh-5.0.2/Src/Builtins/rlimits.awk
--- zsh-5.0.4/Src/Builtins/rlimits.awk	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Builtins/rlimits.awk	2012-08-21 10:59:33.000000000 -0700
@@ -42,7 +42,7 @@
 	    if (limnam == "MEMLOCK") { msg[limnum] = "Mmemorylocked" }
 	    if (limnam == "NOFILE")  { msg[limnum] = "Ndescriptors" }
 	    if (limnam == "NPROC")   { msg[limnum] = "Nmaxproc" }
-	    if (limnam == "NTHR")    { msg[limnum] = "Nmaxpthreads" }
+	    if (limnam == "NTHR")    { msg[limnum] = "Nmaxthr" }
 	    if (limnam == "OFILE")   { msg[limnum] = "Ndescriptors" }
 	    if (limnam == "PTHREAD") { msg[limnum] = "Nmaxpthreads" }
 	    if (limnam == "RSS")     { msg[limnum] = "Mresident" }
@@ -55,10 +55,6 @@
 	    if (limnam == "NICE") { msg[limnum] = "Nnice" }
 	    if (limnam == "RTPRIO") { msg[limnum] = "Nrt_priority" }
 	    if (limnam == "RTTIME") { msg[limnum] = "Urt_time" }
-	    if (limnam == "POSIXLOCKS") { msg[limnum] = "Nposixlocks" }
-	    if (limnam == "NPTS")    { msg[limnum] = "Npseudoterminals" }
-	    if (limnam == "SWAP")    { msg[limnum] = "Mswapsize" }
-	    if (limnam == "KQUEUES") { msg[limnum] = "Nkqueues" }
         }
     }
 }
diff -ruN zsh-5.0.4/Src/Builtins/rlimits.c zsh-5.0.2/Src/Builtins/rlimits.c
--- zsh-5.0.4/Src/Builtins/rlimits.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Builtins/rlimits.c	2012-08-21 10:59:33.000000000 -0700
@@ -32,14 +32,6 @@
 
 #if defined(HAVE_GETRLIMIT) && defined(RLIM_INFINITY)
 
-#ifdef RLIMIT_POSIXLOCKS
-#  define RLIMIT_LOCKS		RLIMIT_POSIXLOCKS
-#endif
-
-#ifdef RLIMIT_NTHR
-#  define RLIMIT_PTHREAD	RLIMIT_NTHR
-#endif
-
 enum {
     ZLIMTYPE_MEMORY,
     ZLIMTYPE_NUMBER,
@@ -322,6 +314,12 @@
 	    printf("-u: processes                       ");
 	break;
 # endif /* HAVE_RLIMIT_NPROC */
+# ifdef HAVE_RLIMIT_NTHR
+    case RLIMIT_NTHR:
+	if (head)
+	    printf("-r: threads                         ");
+	break;
+#endif /* HAVE_RLIMIT_NTHR */
 # if defined(HAVE_RLIMIT_VMEM) && (!defined(HAVE_RLIMIT_RSS) || !defined(RLIMIT_VMEM_IS_RSS))
     case RLIMIT_VMEM:
 	if (head)
@@ -373,7 +371,7 @@
 # ifdef HAVE_RLIMIT_PTHREAD
     case RLIMIT_PTHREAD:
 	if (head)
-	    printf("-T: threads per process             ");
+	    printf("-N %2d: threads per process          ", RLIMIT_PTHREAD);
 	break;
 # endif /* HAVE_RLIMIT_PTHREAD */
 # ifdef HAVE_RLIMIT_NICE
@@ -388,26 +386,6 @@
 	    printf("-r: max rt priority                 ");
 	break;
 # endif /* HAVE_RLIMIT_RTPRIO */
-# ifdef HAVE_RLIMIT_NPTS
-    case RLIMIT_NPTS:
-	if (head)
-	    printf("-p: pseudo-terminals                ");
-	break;
-# endif /* HAVE_RLIMIT_NPTS */
-# ifdef HAVE_RLIMIT_SWAP
-    case RLIMIT_SWAP:
-	if (head)
-	    printf("-w: swap size (kbytes)              ");
-	if (limit != RLIM_INFINITY)
-	    limit /= 1024;
-	break;
-# endif /* HAVE_RLIMIT_SWAP */
-# ifdef HAVE_RLIMIT_KQUEUES
-    case RLIMIT_KQUEUES:
-	if (head)
-	    printf("-k: kqueues                         ");
-	break;
-# endif /* HAVE_RLIMIT_KQUEUES */
     default:
 	if (head)
 	    printf("-N %2d:                              ", lim);
@@ -822,6 +800,11 @@
 		    res = RLIMIT_NOFILE;
 		    break;
 # endif /* HAVE_RLIMIT_NOFILE */
+# ifdef HAVE_RLIMIT_NTHR
+		case 'r':
+		    res = RLIMIT_NTHR;
+		    break;
+# endif /* HAVE_RLIMIT_NTHR */
 # ifdef HAVE_RLIMIT_NPROC
 		case 'u':
 		    res = RLIMIT_NPROC;
@@ -861,21 +844,6 @@
 		    res = RLIMIT_RTPRIO;
 		    break;
 # endif
-# ifdef HAVE_RLIMIT_NPTS
-		case 'p':
-		    res = RLIMIT_NPTS;
-		    break;
-# endif
-# ifdef HAVE_RLIMIT_SWAP
-		case 'w':
-		    res = RLIMIT_SWAP;
-		    break;
-# endif
-# ifdef HAVE_RLIMIT_KQUEUES
-		case 'k':
-		    res = RLIMIT_KQUEUES;
-		    break;
-# endif
 		default:
 		    /* unrecognised limit */
 		    zwarnnam(name, "bad option: -%c", *options);
diff -ruN zsh-5.0.4/Src/Modules/clone.c zsh-5.0.2/Src/Modules/clone.c
--- zsh-5.0.4/Src/Modules/clone.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Modules/clone.c	2007-06-28 12:29:40.000000000 -0700
@@ -3,7 +3,7 @@
  *
  * This file is part of zsh, the Z shell.
  *
- * Copyright (c) 1997 Zolt√°n Hidv√©gi
+ * Copyright (c) 1997 Zolt·n HidvÈgi
  * All rights reserved.
  *
  * Permission is hereby granted, without written agreement and without
@@ -12,16 +12,16 @@
  * purpose, provided that the above copyright notice and the following
  * two paragraphs appear in all copies of this software.
  *
- * In no event shall Zolt√°n Hidv√©gi or the Zsh Development Group be liable
+ * In no event shall Zolt·n HidvÈgi or the Zsh Development Group be liable
  * to any party for direct, indirect, special, incidental, or consequential
  * damages arising out of the use of this software and its documentation,
- * even if Zolt√°n Hidv√©gi and the Zsh Development Group have been advised of
+ * even if Zolt·n HidvÈgi and the Zsh Development Group have been advised of
  * the possibility of such damage.
  *
- * Zolt√°n Hidv√©gi and the Zsh Development Group specifically disclaim any
+ * Zolt·n HidvÈgi and the Zsh Development Group specifically disclaim any
  * warranties, including, but not limited to, the implied warranties of
  * merchantability and fitness for a particular purpose.  The software
- * provided hereunder is on an "as is" basis, and Zolt√°n Hidv√©gi and the
+ * provided hereunder is on an "as is" basis, and Zolt·n HidvÈgi and the
  * Zsh Development Group have no obligation to provide maintenance,
  * support, updates, enhancements, or modifications.
  *
diff -ruN zsh-5.0.4/Src/Modules/example.c zsh-5.0.2/Src/Modules/example.c
--- zsh-5.0.4/Src/Modules/example.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Modules/example.c	2007-06-29 15:47:13.000000000 -0700
@@ -3,7 +3,7 @@
  *
  * This file is part of zsh, the Z shell.
  *
- * Copyright (c) 1996-1997 Zolt√°n Hidv√©gi
+ * Copyright (c) 1996-1997 Zolt·n HidvÈgi
  * All rights reserved.
  *
  * Permission is hereby granted, without written agreement and without
@@ -12,16 +12,16 @@
  * purpose, provided that the above copyright notice and the following
  * two paragraphs appear in all copies of this software.
  *
- * In no event shall Zolt√°n Hidv√©gi or the Zsh Development Group be liable
+ * In no event shall Zolt·n HidvÈgi or the Zsh Development Group be liable
  * to any party for direct, indirect, special, incidental, or consequential
  * damages arising out of the use of this software and its documentation,
- * even if Zolt√°n Hidv√©gi and the Zsh Development Group have been advised of
+ * even if Zolt·n HidvÈgi and the Zsh Development Group have been advised of
  * the possibility of such damage.
  *
- * Zolt√°n Hidv√©gi and the Zsh Development Group specifically disclaim any
+ * Zolt·n HidvÈgi and the Zsh Development Group specifically disclaim any
  * warranties, including, but not limited to, the implied warranties of
  * merchantability and fitness for a particular purpose.  The software
- * provided hereunder is on an "as is" basis, and Zolt√°n Hidv√©gi and the
+ * provided hereunder is on an "as is" basis, and Zolt·n HidvÈgi and the
  * Zsh Development Group have no obligation to provide maintenance,
  * support, updates, enhancements, or modifications.
  *
diff -ruN zsh-5.0.4/Src/Modules/mathfunc.c zsh-5.0.2/Src/Modules/mathfunc.c
--- zsh-5.0.4/Src/Modules/mathfunc.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Modules/mathfunc.c	2007-06-29 15:48:16.000000000 -0700
@@ -340,16 +340,7 @@
       break;
 
   case MF_GAMMA:
-#ifdef HAVE_TGAMMA
-      retd = tgamma(argd);
-#else
-#ifdef HAVE_SIGNGAM
-      retd = lgamma(argd);
-      retd = signgam*exp(retd);
-#else /*XXX assume gamma(x) returns Gamma(x), not log(|Gamma(x)|) */
       retd = gamma(argd);
-#endif
-#endif
       break;
 
   case MF_HYPOT:
diff -ruN zsh-5.0.4/Src/Modules/parameter.c zsh-5.0.2/Src/Modules/parameter.c
--- zsh-5.0.4/Src/Modules/parameter.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Modules/parameter.c	2012-10-10 13:43:33.000000000 -0700
@@ -759,38 +759,6 @@
     return getreswords(DISABLED);
 }
 
-/* Functions for the patchars special parameter. */
-
-/**/
-static char **
-getpatchars(int dis)
-{
-    int i;
-    char **ret, **p;
-
-    p = ret = (char **) zhalloc(ZPC_COUNT * sizeof(char *));
-
-    for (i = 0; i < ZPC_COUNT; i++)
-	if (zpc_strings[i] && !dis == !zpc_disables[i])
-	    *p++ = dupstring(zpc_strings[i]);
-
-    *p = NULL;
-
-    return ret;
-}
-
-static char **
-patcharsgetfn(UNUSED(Param pm))
-{
-    return getpatchars(0);
-}
-
-static char **
-dispatcharsgetfn(UNUSED(Param pm))
-{
-    return getpatchars(1);
-}
-
 /* Functions for the options special parameter. */
 
 /**/
@@ -2050,10 +2018,6 @@
 { reswordsgetfn, arrsetfn, stdunsetfn };
 static const struct gsu_array disreswords_gsu =
 { disreswordsgetfn, arrsetfn, stdunsetfn };
-static const struct gsu_array patchars_gsu =
-{ patcharsgetfn, arrsetfn, stdunsetfn };
-static const struct gsu_array dispatchars_gsu =
-{ dispatcharsgetfn, arrsetfn, stdunsetfn };
 static const struct gsu_array dirs_gsu =
 { dirsgetfn, dirssetfn, stdunsetfn };
 static const struct gsu_array historywords_gsu =
@@ -2074,8 +2038,6 @@
 	    &pmdisfunctions_gsu, getpmdisfunction, scanpmdisfunctions),
     SPECIALPMDEF("dis_galiases", 0,
 	    &pmdisgaliases_gsu, getpmdisgalias, scanpmdisgaliases),
-    SPECIALPMDEF("dis_patchars", PM_ARRAY|PM_READONLY,
-	    &dispatchars_gsu, NULL, NULL),
     SPECIALPMDEF("dis_reswords", PM_ARRAY|PM_READONLY,
 	    &disreswords_gsu, NULL, NULL),
     SPECIALPMDEF("dis_saliases", 0,
@@ -2110,8 +2072,6 @@
 	    &pmoptions_gsu, getpmoption, scanpmoptions),
     SPECIALPMDEF("parameters", PM_READONLY,
 	    NULL, getpmparameter, scanpmparameters),
-    SPECIALPMDEF("patchars", PM_ARRAY|PM_READONLY,
-	    &patchars_gsu, NULL, NULL),
     SPECIALPMDEF("reswords", PM_ARRAY|PM_READONLY,
 	    &reswords_gsu, NULL, NULL),
     SPECIALPMDEF("saliases", 0,
diff -ruN zsh-5.0.4/Src/Modules/parameter.mdd zsh-5.0.2/Src/Modules/parameter.mdd
--- zsh-5.0.4/Src/Modules/parameter.mdd	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Modules/parameter.mdd	2008-08-13 13:22:28.000000000 -0700
@@ -2,6 +2,6 @@
 link=either
 load=yes
 
-autofeatures="p:parameters p:commands p:functions p:dis_functions p:funcfiletrace p:funcsourcetrace p:funcstack p:functrace p:builtins p:dis_builtins p:reswords p:dis_reswords p:patchars p:dis_patchars p:options p:modules p:dirstack p:history p:historywords p:jobtexts p:jobdirs p:jobstates p:nameddirs p:userdirs p:aliases p:dis_aliases p:galiases p:dis_galiases p:saliases p:dis_saliases"
+autofeatures="p:parameters p:commands p:functions p:dis_functions p:funcfiletrace p:funcsourcetrace p:funcstack p:functrace p:builtins p:dis_builtins p:reswords p:dis_reswords p:options p:modules p:dirstack p:history p:historywords p:jobtexts p:jobdirs p:jobstates p:nameddirs p:userdirs p:aliases p:dis_aliases p:galiases p:dis_galiases p:saliases p:dis_saliases"
 
 objects="parameter.o"
diff -ruN zsh-5.0.4/Src/Modules/stat.c zsh-5.0.2/Src/Modules/stat.c
--- zsh-5.0.4/Src/Modules/stat.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Modules/stat.c	2007-06-28 12:29:40.000000000 -0700
@@ -339,7 +339,7 @@
  *  -H hash:  as for -A array, but returns a hash with the keys being those
  *        from stat -l
  *  -F fmt: specify a $TIME-like format for printing times; the default
- *        is the (CTIME-like) "%a %b %e %k:%M:%S %Z %Y".  This option implies
+ *        is the (CTIME-like) "%a %b %e %k:%M:%S".  This option implies
  *        -s as it is not useful for numerical times.
  *
  *  +type selects just element type of stat buffer (-l gives list):
@@ -361,7 +361,7 @@
     struct stat statbuf;
     int found = 0, nargs;
 
-    timefmt = "%a %b %e %k:%M:%S %Z %Y";
+    timefmt = "%a %b %e %k:%M:%S";
 
     for (; *args && (**args == '+' || **args == '-'); args++) {
 	char *arg = *args+1;
diff -ruN zsh-5.0.4/Src/Modules/zpty.c zsh-5.0.2/Src/Modules/zpty.c
--- zsh-5.0.4/Src/Modules/zpty.c	2013-12-17 12:17:12.000000000 -0800
+++ zsh-5.0.2/Src/Modules/zpty.c	2011-12-10 14:40:56.000000000 -0800
@@ -293,8 +293,8 @@
 newptycmd(char *nam, char *pname, char **args, int echo, int nblock)
 {
     Ptycmd p;
-    int master, slave, pid, oineval = ineval, ret;
-    char *oscriptname = scriptname, syncch;
+    int master, slave, pid, oineval = ineval;
+    char *oscriptname = scriptname;
     Eprog prog;
 
     /* code borrowed from bin_eval() */
@@ -344,8 +344,6 @@
 
 	if (get_pty(0, &slave))
 	    exit(1);
-	SHTTY = slave;
-	attachtty(mypid);
 #ifdef TIOCGWINSZ
 	/* Set the window size before associating with the terminal *
 	 * so that we don't get hit with a SIGWINCH.  I'm paranoid. */
@@ -398,23 +396,8 @@
 	setsparam("TTY", ztrdup(ttystrname));
 
 	opts[INTERACTIVE] = 0;
-
-	syncch = 0;
-	do {
-	    ret = write(1, &syncch, 1);
-	} while (ret != 1 && (
-#ifdef EWOULDBLOCK
-	    errno == EWOULDBLOCK ||
-#else
-#ifdef EAGAIN
-	    errno == EAGAIN ||
-#endif
-#endif
-	    errno == EINTR));
-
 	execode(prog, 1, 0, "zpty");
 	stopmsg = 2;
-	mypid = 0; /* trick to ensure we _exit() */
 	zexit(lastval, 0);
     }
     master = movefd(master);
@@ -447,18 +430,6 @@
     scriptname = oscriptname;
     ineval = oineval;
 
-    do {
-	ret = read(master, &syncch, 1);
-    } while (ret != 1 && (
-#ifdef EWOULDBLOCK
-	    errno == EWOULDBLOCK ||
-#else
-#ifdef EAGAIN
-	    errno == EAGAIN ||
-#endif
-#endif
-	    errno == EINTR));
-
     return 0;
 }
 
@@ -510,14 +481,14 @@
 
     if (cmd->read != -1 || cmd->fin)
 	return;
-    if ((r = read(cmd->fd, &c, 1)) <= 0) {
+    if ((r = read(cmd->fd, &c, 1)) < 0) {
 	if (kill(cmd->pid, 0) < 0) {
 	    cmd->fin = 1;
 	    zclose(cmd->fd);
 	}
 	return;
     }
-    cmd->read = (int) c;
+    if (r) cmd->read = (int) c;
 }
 
 static int
diff -ruN zsh-5.0.4/Src/Zle/compcore.c zsh-5.0.2/Src/Zle/compcore.c
--- zsh-5.0.4/Src/Zle/compcore.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/compcore.c	2012-02-09 13:55:20.000000000 -0800
@@ -826,6 +826,7 @@
 	sfcontext = SFC_CWIDGET;
 	NEWHEAPS(compheap) {
 	    LinkList largs = NULL;
+	    int olv = lastval;
 
 	    if (*cfargs) {
 		char **p = cfargs;
@@ -835,7 +836,9 @@
 		while (*p)
 		    addlinknode(largs, dupstring(*p++));
 	    }
-	    cfret = doshfunc(shfunc, largs, 1);
+	    doshfunc(shfunc, largs, 0);
+	    cfret = lastval;
+	    lastval = olv;
 	} OLDHEAPS;
 	sfcontext = osc;
 	endparamscope();
diff -ruN zsh-5.0.4/Src/Zle/compctl.c zsh-5.0.2/Src/Zle/compctl.c
--- zsh-5.0.4/Src/Zle/compctl.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/compctl.c	2011-05-20 12:13:18.000000000 -0700
@@ -398,6 +398,7 @@
 	if (cl)
 	    return 1;
 	else {
+	    freecompctl(cc);
 	    cclist = COMP_REMOVE;
 	    return 0;
 	}
diff -ruN zsh-5.0.4/Src/Zle/computil.c zsh-5.0.2/Src/Zle/computil.c
--- zsh-5.0.4/Src/Zle/computil.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/computil.c	2011-05-13 11:09:47.000000000 -0700
@@ -465,7 +465,6 @@
     cd_state.showd = disp;
     cd_state.maxg = cd_state.groups = cd_state.descs = 0;
     cd_state.maxmlen = atoi(mlen);
-    cd_state.premaxw = 0;
     itmp = zterm_columns - cd_state.swidth - 4;
     if (cd_state.maxmlen > itmp)
         cd_state.maxmlen = itmp;
@@ -644,43 +643,35 @@
 		    p += str->len;
                     memset(p, ' ', (l = (cd_state.premaxw - str->width + CM_SPACE)));
 		    p += l;
+		    strcpy(p, cd_state.sep);
+		    p += cd_state.slen;
 
+		    /*
+		     * copy a character at once until no more screen width
+		     * is available. Leave 1 character at the end of screen
+		     * as safety margin
+		     */
 		    remw = zterm_columns - cd_state.premaxw -
 			cd_state.swidth - 3;
-		    while (remw < 0 && zterm_columns) {
-			/* line wrapped, use remainder of the extra line */
-			remw += zterm_columns;
-		    }
-		    if (cd_state.slen < remw) {
-			strcpy(p, cd_state.sep);
-			p += cd_state.slen;
-			remw -= cd_state.slen;
-
-			/*
-			 * copy a character at once until no more screen
-			 * width is available. Leave 1 character at the
-			 * end of screen as safety margin
-			 */
-			d = str->desc;
-			w = MB_METASTRWIDTH(d);
-			if (w <= remw)
-			    strcpy(p, d);
-			else {
-			    pp = p;
-			    while (remw > 0 && *d) {
-				l = MB_METACHARLEN(d);
-				memcpy(pp, d, l);
-				pp[l] = '\0';
-				w = MB_METASTRWIDTH(pp);
-				if (w > remw) {
-				    *pp = '\0';
-				    break;
-				}
-
-				pp += l;
-				d += l;
-				remw -= w;
+		    d = str->desc;
+		    w = MB_METASTRWIDTH(d);
+		    if (w <= remw)
+			strcpy(p, d);
+		    else {
+			pp = p;
+			while (remw > 0 && *d) {
+			    l = MB_METACHARLEN(d);
+			    memcpy(pp, d, l);
+			    pp[l] = '\0';
+			    w = MB_METASTRWIDTH(pp);
+			    if (w > remw) {
+				*pp = '\0';
+				break;
 			    }
+
+			    pp += l;
+			    d += l;
+			    remw -= w;
 			}
 		    }
 
@@ -1617,7 +1608,7 @@
 	    return *p;
 	} else if (!min || !*p || (*p)->lastt < (*min)->lastt)
 	    min = p;
-    if (i > 0)
+    if (i)
 	min = p;
     if ((new = parse_cadef(nam, args))) {
 	freecadef(*min);
@@ -3001,7 +2992,7 @@
 	    return *p;
 	} else if (!min || !*p || (*p)->lastt < (*min)->lastt)
 	    min = p;
-    if (i > 0)
+    if (i)
 	min = p;
     if ((new = parse_cvdef(nam, args))) {
 	freecvdef(*min);
diff -ruN zsh-5.0.4/Src/Zle/zle.h zsh-5.0.2/Src/Zle/zle.h
--- zsh-5.0.4/Src/Zle/zle.h	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/zle.h	2012-03-29 13:01:04.000000000 -0700
@@ -497,15 +497,3 @@
 #define METACHECK()
 #define UNMETACHECK()
 #endif
-
-
-typedef struct watch_fd *Watch_fd;
-
-struct watch_fd {
-    /* Function to call */
-    char *func;
-    /* Watched fd */
-    int fd;
-    /* 1 if func is called as a widget */
-    int widget;
-};
diff -ruN zsh-5.0.4/Src/Zle/zle_main.c zsh-5.0.2/Src/Zle/zle_main.c
--- zsh-5.0.4/Src/Zle/zle_main.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/zle_main.c	2012-02-05 11:24:35.000000000 -0800
@@ -197,11 +197,10 @@
  */
 /**/
 int nwatch;		/* Number of fd's we are watching */
-/*
- * Array of nwatch structures.
- */
 /**/
-Watch_fd watch_fds;
+int *watch_fds;		/* The list of fds, not terminated! */
+/**/
+char **watch_funcs;	/* The corresponding functions to call, normal array */
 
 /* set up terminal */
 
@@ -568,9 +567,7 @@
 	gettyinfo(&ti);
 	ti.tio.c_cc[VMIN] = 0;
 	settyinfo(&ti);
-	winch_unblock();
 	ret = read(SHTTY, cptr, 1);
-	winch_block();
 	ti.tio.c_cc[VMIN] = 1;
 	settyinfo(&ti);
 	if (ret > 0)
@@ -587,7 +584,7 @@
 	 */
 	fds[0].events = POLLIN;
 	for (i = 0; i < nwatch; i++) {
-	    fds[i+1].fd = watch_fds[i].fd;
+	    fds[i+1].fd = watch_fds[i];
 	    fds[i+1].events = POLLIN;
 	}
 # endif
@@ -600,9 +597,7 @@
 	    else
 		poll_timeout = -1;
 
-	    winch_unblock();
 	    selret = poll(fds, errtry ? 1 : nfds, poll_timeout);
-	    winch_block();
 # else
 	    int fdmax = SHTTY;
 	    struct timeval *tvptr;
@@ -612,7 +607,7 @@
 	    FD_SET(SHTTY, &foofd);
 	    if (!errtry) {
 		for (i = 0; i < nwatch; i++) {
-		    int fd = watch_fds[i].fd;
+		    int fd = watch_fds[i];
 		    FD_SET(fd, &foofd);
 		    if (fd > fdmax)
 			fdmax = fd;
@@ -627,10 +622,8 @@
 	    else
 		tvptr = NULL;
 
-	    winch_unblock();
 	    selret = select(fdmax+1, (SELECT_ARG_2_T) & foofd,
 			    NULL, NULL, tvptr);
-	    winch_block();
 # endif
 	    /*
 	     * Make sure a user interrupt gets passed on straight away.
@@ -724,51 +717,42 @@
 		 * handler function.
 		 */
 		int lnwatch = nwatch;
-		Watch_fd lwatch_fds = zalloc(lnwatch*sizeof(struct watch_fd));
-		memcpy(lwatch_fds, watch_fds, lnwatch*sizeof(struct watch_fd));
-		for (i = 0; i < lnwatch; i++)
-		    lwatch_fds[i].func = ztrdup(lwatch_fds[i].func);
+		int *lwatch_fds = zalloc(lnwatch*sizeof(int));
+		char **lwatch_funcs = zarrdup(watch_funcs);
+		memcpy(lwatch_fds, watch_fds, lnwatch*sizeof(int));
 		for (i = 0; i < lnwatch; i++) {
-		    Watch_fd lwatch_fd = lwatch_fds + i;
 		    if (
 # ifdef HAVE_POLL
 			(fds[i+1].revents & POLLIN)
 # else
-			FD_ISSET(lwatch_fd->fd, &foofd)
+			FD_ISSET(lwatch_fds[i], &foofd)
 # endif
 			) {
 			/* Handle the fd. */
-			char *fdbuf;
+			LinkList funcargs = znewlinklist();
+			zaddlinknode(funcargs, ztrdup(lwatch_funcs[i]));
 			{
 			    char buf[BDIGBUFSIZE];
-			    convbase(buf, lwatch_fd->fd, 10);
-			    fdbuf = ztrdup(buf);
+			    convbase(buf, lwatch_fds[i], 10);
+			    zaddlinknode(funcargs, ztrdup(buf));
 			}
-
-			if (lwatch_fd->widget) {
-			    zlecallhook(lwatch_fd->func, fdbuf);
-			    zsfree(fdbuf);
-			} else {
-			    LinkList funcargs = znewlinklist();
-			    zaddlinknode(funcargs, ztrdup(lwatch_fd->func));
-			    zaddlinknode(funcargs, fdbuf);
 # ifdef HAVE_POLL
 #  ifdef POLLERR
-			    if (fds[i+1].revents & POLLERR)
-				zaddlinknode(funcargs, ztrdup("err"));
+			if (fds[i+1].revents & POLLERR)
+			    zaddlinknode(funcargs, ztrdup("err"));
 #  endif
 #  ifdef POLLHUP
-			    if (fds[i+1].revents & POLLHUP)
-				zaddlinknode(funcargs, ztrdup("hup"));
+			if (fds[i+1].revents & POLLHUP)
+			    zaddlinknode(funcargs, ztrdup("hup"));
 #  endif
 #  ifdef POLLNVAL
-			    if (fds[i+1].revents & POLLNVAL)
-				zaddlinknode(funcargs, ztrdup("nval"));
+			if (fds[i+1].revents & POLLNVAL)
+			    zaddlinknode(funcargs, ztrdup("nval"));
 #  endif
 # endif
-			    callhookfunc(lwatch_fd->func, funcargs, 0, NULL);
-			    freelinklist(funcargs, freestr);
-			}
+
+
+			callhookfunc(lwatch_funcs[i], funcargs, 0, NULL);
 			if (errflag) {
 			    /* No sensible way of handling errors here */
 			    errflag = 0;
@@ -778,14 +762,14 @@
 			     */
 			    errtry = 1;
 			}
+			freelinklist(funcargs, freestr);
 		    }
 		}
 		/* Function may have invalidated the display. */
 		if (resetneeded)
 		    zrefresh();
-		for (i = 0; i < lnwatch; i++)
-		    zsfree(lwatch_fds[i].func);
-		zfree(lwatch_fds, lnwatch*sizeof(struct watch_fd));
+		zfree(lwatch_fds, lnwatch*sizeof(int));
+		freearray(lwatch_funcs);
 	    }
 	}
 # ifdef HAVE_POLL
@@ -804,9 +788,7 @@
 #  else
 	ioctl(SHTTY, TCSETA, &ti.tio);
 #  endif
-	winch_unblock();
 	ret = read(SHTTY, cptr, 1);
-	winch_block();
 #  ifdef HAVE_TERMIOS_H
 	tcsetattr(SHTTY, TCSANOW, &shttyinfo.tio);
 #  else
@@ -817,9 +799,7 @@
 #endif
     }
 
-    winch_unblock();
     ret = read(SHTTY, cptr, 1);
-    winch_block();
 
     return ret;
 }
@@ -1125,7 +1105,7 @@
 
 /**/
 char *
-zleread(char **lp, char **rp, int flags, int context, char *init, char *finish)
+zleread(char **lp, char **rp, int flags, int context)
 {
     char *s;
     int old_errno = errno;
@@ -1198,13 +1178,6 @@
     viinsbegin = 0;
     statusline = NULL;
     selectkeymap("main", 1);
-    /*
-     * If main is linked to the viins keymap, we need to register
-     * explicitly that we're now in vi insert mode as there's
-     * no user operation to indicate this.
-     */
-    if (openkeymap("main") == openkeymap("viins"))
-	viinsert(NULL);
     selectlocalmap(NULL);
     fixsuffix();
     if ((s = getlinknode(bufstack))) {
@@ -1250,9 +1223,7 @@
 
     unqueue_signals();	/* Should now be safe to acknowledge SIGWINCH */
 
-    zlecallhook(init, NULL);
-
-    zrefresh();
+    zlecallhook("zle-line-init", NULL);
 
     zlecore();
 
@@ -1260,7 +1231,7 @@
 	setsparam("ZLE_LINE_ABORTED", zlegetline(NULL, NULL));
 
     if (done && !exit_pending && !errflag)
-	zlecallhook(finish, NULL);
+	zlecallhook("zle-line-finish", NULL);
 
     statusline = NULL;
     invalidatelist();
@@ -1500,7 +1471,7 @@
     Param pm = 0;
     int ifl;
     int type = PM_SCALAR, obreaks = breaks, haso = 0, oSHTTY = 0;
-    char *p1, *p2, *main_keymapname, *vicmd_keymapname, *init, *finish;
+    char *p1, *p2, *main_keymapname, *vicmd_keymapname;
     Keymap main_keymapsave = NULL, vicmd_keymapsave = NULL;
     FILE *oshout = NULL;
 
@@ -1528,8 +1499,6 @@
     p2 = OPT_ARG_SAFE(ops,'r');
     main_keymapname = OPT_ARG_SAFE(ops,'M');
     vicmd_keymapname = OPT_ARG_SAFE(ops,'m');
-    init = OPT_ARG_SAFE(ops,'i');
-    finish = OPT_ARG_SAFE(ops,'f');
 
     if (type != PM_SCALAR && !OPT_ISSET(ops,'c')) {
 	zwarnnam(name, "-%s ignored", type == PM_ARRAY ? "a" : "A");
@@ -1631,7 +1600,6 @@
 
 	haso = 1;
     }
-
     /* edit the parameter value */
     zpushnode(bufstack, s);
 
@@ -1647,10 +1615,7 @@
     if (OPT_ISSET(ops,'h'))
 	hbegin(2);
     isfirstln = OPT_ISSET(ops,'e');
-
-    t = zleread(&p1, &p2, OPT_ISSET(ops,'h') ? ZLRF_HISTORY : 0, ZLCON_VARED,
-		init ? init : "zle-line-init",
-		finish ? finish : "zle-line-finish");
+    t = zleread(&p1, &p2, OPT_ISSET(ops,'h') ? ZLRF_HISTORY : 0, ZLCON_VARED);
     if (OPT_ISSET(ops,'h'))
 	hend(NULL);
     isfirstln = ifl;
@@ -1915,8 +1880,7 @@
 	flags = va_arg(ap, int);
 	context = va_arg(ap, int);
 
-	return zleread(lp, rp, flags, context,
-		       "zle-line-init", "zle-line-finish");
+	return zleread(lp, rp, flags, context);
     }
 
     case ZLE_CMD_ADD_TO_LINE:
@@ -1951,13 +1915,6 @@
 	break;
     }
 
-    case ZLE_CMD_SET_HIST_LINE:
-    {
-	histline = va_arg(ap, zlong);
-
-	break;
-    }
-
     default:
 #ifdef DEBUG
 	    dputs("Bad command %d in zle_main_entry", cmd);
@@ -1969,8 +1926,8 @@
 
 static struct builtin bintab[] = {
     BUILTIN("bindkey", 0, bin_bindkey, 0, -1, 0, "evaM:ldDANmrsLRp", NULL),
-    BUILTIN("vared",   0, bin_vared,   1,  1, 0, "aAcef:hi:M:m:p:r:t:", NULL),
-    BUILTIN("zle",     0, bin_zle,     0, -1, 0, "aAcCDFgGIKlLmMNrRTUw", NULL),
+    BUILTIN("vared",   0, bin_vared,   1,  1, 0, "aAcehM:m:p:r:t:", NULL),
+    BUILTIN("zle",     0, bin_zle,     0, -1, 0, "aAcCDFgGIKlLmMNrRTU", NULL),
 };
 
 /* The order of the entries in this table has to match the *HOOK
diff -ruN zsh-5.0.4/Src/Zle/zle_move.c zsh-5.0.2/Src/Zle/zle_move.c
--- zsh-5.0.4/Src/Zle/zle_move.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/zle_move.c	2012-08-13 12:35:53.000000000 -0700
@@ -30,7 +30,7 @@
 #include "zle.mdh"
 #include "zle_move.pro"
 
-static int vimarkcs[27], vimarkline[27];
+static int vimarkcs[26], vimarkline[26];
 
 #ifdef MULTIBYTE_SUPPORT
 /*
@@ -825,17 +825,11 @@
 vigotomark(UNUSED(char **args))
 {
     ZLE_INT_T ch;
-    int oldcs = zlecs;
-    int oldline = histline;
 
     ch = getfullchar(0);
-    if (ch == ZWC('\'') || ch == ZWC('`'))
-	ch = 26;
-    else {
-	if (ch < ZWC('a') || ch > ZWC('z'))
-	    return 1;
-	ch -= ZWC('a');
-    }
+    if (ch < ZWC('a') || ch > ZWC('z'))
+	return 1;
+    ch -= ZWC('a');
     if (!vimarkline[ch])
 	return 1;
     if (curhist != vimarkline[ch] && !zle_goto_hist(vimarkline[ch], 0, 0)) {
@@ -843,8 +837,6 @@
 	return 1;
     }
     zlecs = vimarkcs[ch];
-    vimarkcs[26] = oldcs;
-    vimarkline[26] = oldline;
     if (zlecs > zlell)
 	zlecs = zlell;
     return 0;
diff -ruN zsh-5.0.4/Src/Zle/zle_refresh.c zsh-5.0.2/Src/Zle/zle_refresh.c
--- zsh-5.0.4/Src/Zle/zle_refresh.c	2013-12-19 11:35:10.000000000 -0800
+++ zsh-5.0.2/Src/Zle/zle_refresh.c	2012-02-05 11:24:35.000000000 -0800
@@ -976,8 +976,7 @@
     int tmppos;			/* t - tmpline				     */
     int tmpalloced;		/* flag to free tmpline when finished	     */
     int remetafy;		/* flag that zle line is metafied	     */
-    int txtchange;		/* attributes set after prompts              */
-    int rprompt_off;		/* Offset of rprompt from right of screen    */
+    int txtchange;		/* attributes set after prompts */
     struct rparams rpms;
 #ifdef MULTIBYTE_SUPPORT
     int width;			/* width of wide character		     */
@@ -1574,19 +1573,10 @@
     if (!more_start) {
 	if (trashedzle && opts[TRANSIENTRPROMPT])
 	    put_rpmpt = 0;
-	else {
+	else
 	    put_rpmpt = rprompth == 1 && rpromptbuf[0] &&
-		!strchr(rpromptbuf, '\t');
-	    if (put_rpmpt)
-	    {
-	      rprompt_off = rprompt_indent;
-	      /* sanity to avoid horrible things happening */
-	      if (rprompt_off < 0)
-		rprompt_off = 0;
-	      put_rpmpt =
-		(int)ZR_strlen(nbuf[0]) + rpromptw < winw - rprompt_off;
-	    }
-	}
+		!strchr(rpromptbuf, '\t') &&
+		(int)ZR_strlen(nbuf[0]) + rpromptw < winw - 1;
     } else {
 /* insert >.... on first line if there is more text before start of screen */
 	ZR_memset(nbuf[0], zr_sp, lpromptw);
@@ -1641,9 +1631,9 @@
 	if (put_rpmpt && !iln && !oput_rpmpt) {
 	    int attrchange;
 
-	    moveto(0, winw - rprompt_off - rpromptw);
+	    moveto(0, winw - 1 - rpromptw);
 	    zputs(rpromptbuf, shout);
-	    vcs = winw - rprompt_off;
+	    vcs = winw - 1;
 	/* reset character attributes to that set by the main prompt */
 	    txtchange = pmpt_attr;
 	    /*
@@ -2123,24 +2113,19 @@
     const REFRESH_ELEMENT *rep;
 
     if (vcs == winw) {
-	if (rprompt_indent == 0 && tccan(TCLEFT)) {
-	  tc_leftcurs(1);
-	  vcs--;
+	vln++, vcs = 0;
+	if (!hasam) {
+	    zputc(&zr_cr);
+	    zputc(&zr_nl);
 	} else {
-	    vln++, vcs = 0;
-	    if (!hasam) {
-		zputc(&zr_cr);
-		zputc(&zr_nl);
-	    } else {
-		if ((vln < nlnct) && nbuf[vln] && nbuf[vln]->chr)
-		    rep = nbuf[vln];
-		else
-		    rep = &zr_sp;
-		zputc(rep);
-		zputc(&zr_cr);
-		if ((vln < olnct) && obuf[vln] && obuf[vln]->chr)
-		    *obuf[vln] = *rep;
-	    }
+	    if ((vln < nlnct) && nbuf[vln] && nbuf[vln]->chr)
+		rep = nbuf[vln];
+	    else
+		rep = &zr_sp;
+	    zputc(rep);
+	    zputc(&zr_cr);
+	    if ((vln < olnct) && obuf[vln] && obuf[vln]->chr)
+		*obuf[vln] = *rep;
 	}
     }
 
diff -ruN zsh-5.0.4/Src/Zle/zle_thingy.c zsh-5.0.2/Src/Zle/zle_thingy.c
--- zsh-5.0.4/Src/Zle/zle_thingy.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/zle_thingy.c	2012-02-05 11:24:35.000000000 -0800
@@ -778,12 +778,10 @@
 	    return 1;
 	}
 	for (i = 0; i < nwatch; i++) {
-	    Watch_fd watch_fd = watch_fds + i;
-	    if (*args && watch_fd->fd != fd)
+	    if (*args && watch_fds[i] != fd)
 		continue;
 	    found = 1;
-	    printf("%s -F %s%d %s\n", name, watch_fd->widget ? "-w " : "",
-		   watch_fd->fd, watch_fd->func);
+	    printf("%s -F %d %s\n", name, watch_fds[i], watch_funcs[i]);
 	}
 	/* only return status 1 if fd given and not found */
 	return *args && !found;
@@ -794,11 +792,9 @@
 	char *funcnam = ztrdup(args[1]);
 	if (nwatch) {
 	    for (i = 0; i < nwatch; i++) {
-		Watch_fd watch_fd = watch_fds + i;
-		if (watch_fd->fd == fd) {
-		    zsfree(watch_fd->func);
-		    watch_fd->func = funcnam;
-		    watch_fd->widget = OPT_ISSET(ops,'w') ? 1 : 0;
+		if (watch_fds[i] == fd) {
+		    zsfree(watch_funcs[i]);
+		    watch_funcs[i] = funcnam;
 		    found = 1;
 		    break;
 		}
@@ -807,38 +803,46 @@
 	if (!found) {
 	    /* zrealloc handles NULL pointers, so OK for first time through */
 	    int newnwatch = nwatch+1;
-	    Watch_fd new_fd;
-	    watch_fds = (Watch_fd)zrealloc(watch_fds, 
-					   newnwatch * sizeof(struct watch_fd));
-	    new_fd = watch_fds + nwatch;
-	    new_fd->fd = fd;
-	    new_fd->func = funcnam;
-	    new_fd->widget = OPT_ISSET(ops,'w') ? 1 : 0;
+	    watch_fds = (int *)zrealloc(watch_fds, 
+					newnwatch * sizeof(int));
+	    watch_funcs = (char **)zrealloc(watch_funcs,
+					    (newnwatch+1) * sizeof(char *));
+	    watch_fds[nwatch] = fd;
+	    watch_funcs[nwatch] = funcnam;
+	    watch_funcs[newnwatch] = NULL;
 	    nwatch = newnwatch;
 	}
     } else {
 	/* Deleting a handler */
 	for (i = 0; i < nwatch; i++) {
-	    Watch_fd watch_fd = watch_fds + i;
-	    if (watch_fd->fd == fd) {
+	    if (watch_fds[i] == fd) {
 		int newnwatch = nwatch-1;
-		Watch_fd new_fds;
+		int *new_fds;
+		char **new_funcs;
 
-		zsfree(watch_fd->func);
+		zsfree(watch_funcs[i]);
 		if (newnwatch) {
-		    new_fds = zalloc(newnwatch*sizeof(struct watch_fd));
+		    new_fds = zalloc(newnwatch*sizeof(int));
+		    new_funcs = zalloc((newnwatch+1)*sizeof(char*));
 		    if (i) {
-			memcpy(new_fds, watch_fds, i*sizeof(struct watch_fd));
+			memcpy(new_fds, watch_fds, i*sizeof(int));
+			memcpy(new_funcs, watch_funcs, i*sizeof(char *));
 		    }
 		    if (i < newnwatch) {
 			memcpy(new_fds+i, watch_fds+i+1,
-			       (newnwatch-i)*sizeof(struct watch_fd));
+			       (newnwatch-i)*sizeof(int));
+			memcpy(new_funcs+i, watch_funcs+i+1,
+			       (newnwatch-i)*sizeof(char *));
 		    }
+		    new_funcs[newnwatch] = NULL;
 		} else {
 		    new_fds = NULL;
+		    new_funcs = NULL;
 		}
-		zfree(watch_fds, nwatch*sizeof(struct watch_fd));
+		zfree(watch_fds, nwatch*sizeof(int));
+		zfree(watch_funcs, (nwatch+1)*sizeof(char *));
 		watch_fds = new_fds;
+		watch_funcs = new_funcs;
 		nwatch = newnwatch;
 		found = 1;
 		break;
diff -ruN zsh-5.0.4/Src/Zle/zle_tricky.c zsh-5.0.2/Src/Zle/zle_tricky.c
--- zsh-5.0.4/Src/Zle/zle_tricky.c	2013-12-15 13:15:28.000000000 -0800
+++ zsh-5.0.2/Src/Zle/zle_tricky.c	2012-10-05 13:25:58.000000000 -0700
@@ -1095,7 +1095,6 @@
      * the command word is not at index zero in the array.
      */
     int redirpos;
-    int noword;
     char *s = NULL, *tmp, *p, *tt = NULL, rdop[20];
     char *linptr, *u;
 
@@ -1166,7 +1165,7 @@
     * and whatnot. */
 
     do {
-        qsub = noword = 0;
+        qsub = 0;
 
 	lincmd = ((incmdpos && !ins && !incond) ||
 		  (oins == 2 && wordpos == 2) ||
@@ -1240,19 +1239,6 @@
 	     * leave the loop.                                           */
 	    if (tt)
 		break;
-	    if (ins < 2) {
-		/*
-		 * Don't add this as a word, because we're about to start
-		 * a new command line: pretend there's no string here.
-		 * We don't dare do this if we're using one of the
-		 * *really* gross hacks with ins to get later words
-		 * to look like command words, because we don't
-		 * understand how they work.  Quite possibly we
-		 * should be using a mechanism like the one here rather
-		 * than the ins thing.
-		 */
-		noword = 1;
-	    }
 	    /* Otherwise reset the variables we are collecting data in. */
 	    wordpos = cp = rd = ins = redirpos = 0;
 	    tt0 = NULLTOK;
@@ -1267,14 +1253,6 @@
 	    /* If everything before is a redirection, don't reset the index */
 	    if (wordpos != redirpos)
 		wordpos = redirpos = 0;
-	} else if (tok == SEPER) {
-	    /*
-	     * A following DOLOOP should cause us to reset to the start
-	     * of the command line.  For some reason we only recognise
-	     * DOLOOP for this purpose (above) if ins is set.  Why?
-	     * Don't ask pointless questions.
-	     */
-	    ins = 1;
 	}
 	if (!lexflags && tt0 == NULLTOK) {
 	    /* This is done when the lexer reached the word the cursor is on. */
@@ -1344,7 +1322,7 @@
 	    else if (tok == DAMPER)
 		tokstr = "&&";
 	}
-	if (!tokstr || noword)
+	if (!tokstr)
 	    continue;
 	/* Hack to allow completion after `repeat n do'. */
 	if (oins == 2 && !wordpos && !strcmp(tokstr, "do"))
@@ -1504,17 +1482,7 @@
 	    nnb = s + MB_METACHARLEN(s);
 	else
 	    nnb = s;
-	tt = s;
-	if (lincmd)
-	{
-	    /*
-	     * Ignore '['s at the start of a command as they're not
-	     * matched by closing brackets.
-	     */
-	    while (*tt == Inbrack && tt < s + zlemetacs_qsub - wb)
-		tt++;
-	}
-	while (tt < s + zlemetacs_qsub - wb) {
+	for (tt = s; tt < s + zlemetacs_qsub - wb;) {
 	    if (*tt == Inbrack) {
 		i++;
 		nb = nnb;
@@ -2146,8 +2114,8 @@
 	return 0;
     if (len == -1)
 	len = strlen(str);
+    spaceinline(len);
     if (zlemetaline != NULL) {
-	spaceinline(len);
 	strncpy(zlemetaline + zlemetacs, str, len);
 	if (move)
 	    zlemetacs += len;
@@ -2158,7 +2126,6 @@
 
 	instr = ztrduppfx(str, len);
 	zlestr = stringaszleline(instr, 0, &zlelen, NULL, NULL);
-	spaceinline(zlelen);
 	ZS_strncpy(zleline + zlecs, zlestr, zlelen);
 	free(zlestr);
 	zsfree(instr);
diff -ruN zsh-5.0.4/Src/Zle/zle_utils.c zsh-5.0.2/Src/Zle/zle_utils.c
--- zsh-5.0.4/Src/Zle/zle_utils.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/Zle/zle_utils.c	2012-10-09 12:41:02.000000000 -0700
@@ -145,7 +145,6 @@
 		ptr2--;
 	    }
 	    *ptr = Meta;
-	    ptr[1] ^= 32;
 	    ret++;
 	}
 
@@ -1643,7 +1642,7 @@
 {
     Thingy thingy = rthingy_nocreate(name);
     int saverrflag, savretflag;
-    char *args[2];
+    char *args[3];
 
     if (!thingy)
 	return;
@@ -1651,8 +1650,9 @@
     saverrflag = errflag;
     savretflag = retflag;
 
-    args[0] = arg;
-    args[1] = NULL;
+    args[0] = thingy->nam;
+    args[1] = arg;
+    args[2] = NULL;
     execzlefunc(thingy, args, 1);
     unrefthingy(thingy);
 
diff -ruN zsh-5.0.4/Src/builtin.c zsh-5.0.2/Src/builtin.c
--- zsh-5.0.4/Src/builtin.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/builtin.c	2012-11-09 13:46:04.000000000 -0800
@@ -55,11 +55,11 @@
     BUILTIN("continue", BINF_PSPECIAL, bin_break, 0, 1, BIN_CONTINUE, NULL, NULL),
     BUILTIN("declare", BINF_PLUSOPTS | BINF_MAGICEQUALS | BINF_PSPECIAL, bin_typeset, 0, -1, 0, "AE:%F:%HL:%R:%TUZ:%afghi:%klmprtuxz", NULL),
     BUILTIN("dirs", 0, bin_dirs, 0, -1, 0, "clpv", NULL),
-    BUILTIN("disable", 0, bin_enable, 0, -1, BIN_DISABLE, "afmprs", NULL),
+    BUILTIN("disable", 0, bin_enable, 0, -1, BIN_DISABLE, "afmrs", NULL),
     BUILTIN("disown", 0, bin_fg, 0, -1, BIN_DISOWN, NULL, NULL),
     BUILTIN("echo", BINF_SKIPINVALID, bin_print, 0, -1, BIN_ECHO, "neE", "-"),
     BUILTIN("emulate", 0, bin_emulate, 0, -1, 0, "LR", NULL),
-    BUILTIN("enable", 0, bin_enable, 0, -1, BIN_ENABLE, "afmprs", NULL),
+    BUILTIN("enable", 0, bin_enable, 0, -1, BIN_ENABLE, "afmrs", NULL),
     BUILTIN("eval", BINF_PSPECIAL, bin_eval, 0, -1, BIN_EVAL, NULL, NULL),
     BUILTIN("exit", BINF_PSPECIAL, bin_break, 0, 1, BIN_EXIT, NULL, NULL),
     BUILTIN("export", BINF_PLUSOPTS | BINF_MAGICEQUALS | BINF_PSPECIAL, bin_typeset, 0, -1, BIN_EXPORT, "E:%F:%HL:%R:%TUZ:%afhi:%lprtu", "xg"),
@@ -467,9 +467,7 @@
     int match = 0, returnval = 0;
 
     /* Find out which hash table we are working with. */
-    if (OPT_ISSET(ops,'p')) {
-	return pat_enables(name, argv, func == BIN_ENABLE);
-    } else if (OPT_ISSET(ops,'f'))
+    if (OPT_ISSET(ops,'f'))
 	ht = shfunctab;
     else if (OPT_ISSET(ops,'r'))
 	ht = reswdtab;
@@ -939,16 +937,11 @@
      * DOS style names with drives in them
      */
     static char buf[PATH_MAX];
-#ifdef HAVE_CYGWIN_CONV_PATH
-    cygwin_conv_path(CCP_WIN_A_TO_POSIX | CCP_RELATIVE, dest, buf,
-		     PATH_MAX);
-#else
 #ifndef _SYS_CYGWIN_H
     void cygwin_conv_to_posix_path(const char *, char *);
 #endif
 
     cygwin_conv_to_posix_path(dest, buf);
-#endif
     dest = buf;
 #endif
     nocdpath = dest[0] == '.' &&
@@ -1125,8 +1118,7 @@
      * argument to cd relatively.  This is useful if the cwd
      * or a parent directory is renamed in the interim.
      */
-    if (lchdir(buf, NULL, hard) &&
-	(pfix || *dest == '/' || lchdir(dest, NULL, hard))) {
+    if (lchdir(buf, NULL, hard) && lchdir(dest, NULL, hard)) {
 	free(buf);
 	return NULL;
     }
@@ -2478,7 +2470,7 @@
 			setsparam(asg0.name, ztrdup(asg0.value));
 		    return 0;
 		} else {
-		    zwarnnam(name, "can't tie already tied scalar: %s",
+		    zerrnam(name, "can't tie already tied scalar: %s",
 			    asg0.name);
 		}
 		return 1;
@@ -2688,7 +2680,7 @@
     Patprog pprog;
     Shfunc shf;
     int i, returnval = 0;
-    int on = 0, off = 0, pflags = 0, roff;
+    int on = 0, off = 0, pflags = 0;
 
     /* Do we have any flags defined? */
     if (OPT_PLUS(ops,'u'))
@@ -2707,21 +2699,16 @@
 	on |= PM_TAGGED_LOCAL;
     else if (OPT_PLUS(ops,'T'))
 	off |= PM_TAGGED_LOCAL;
-    roff = off;
     if (OPT_MINUS(ops,'z')) {
 	on |= PM_ZSHSTORED;
 	off |= PM_KSHSTORED;
-    } else if (OPT_PLUS(ops,'z')) {
+    } else if (OPT_PLUS(ops,'z'))
 	off |= PM_ZSHSTORED;
-	roff |= PM_ZSHSTORED;
-    }
     if (OPT_MINUS(ops,'k')) {
 	on |= PM_KSHSTORED;
 	off |= PM_ZSHSTORED;
-    } else if (OPT_PLUS(ops,'k')) {
+    } else if (OPT_PLUS(ops,'k'))
 	off |= PM_KSHSTORED;
-	roff |= PM_KSHSTORED;
-    }
 
     if ((off & PM_UNDEFINED) || (OPT_ISSET(ops,'k') && OPT_ISSET(ops,'z')) ||
 	(OPT_MINUS(ops,'X') && (OPT_ISSET(ops,'m') || *argv || !scriptname))) {
@@ -2729,7 +2716,7 @@
 	return 1;
     }
 
-    if (OPT_PLUS(ops,'f') || roff || OPT_ISSET(ops,'+'))
+    if (OPT_PLUS(ops,'f') || OPT_ISSET(ops,'+'))
 	pflags |= PRINT_NAMEONLY;
 
     if (OPT_MINUS(ops,'M') || OPT_PLUS(ops,'M')) {
@@ -3798,11 +3785,11 @@
 
     /* -u and -p -- output to other than standard output */
     if (OPT_HASARG(ops,'u') || OPT_ISSET(ops,'p')) {
-	int fdarg, fd;
+	int fd;
 
 	if (OPT_ISSET(ops, 'p')) {
-	    fdarg = coprocout;
-	    if (fdarg < 0) {
+	    fd = coprocout;
+	    if (fd < 0) {
 		zwarnnam(name, "-p: no coprocess");
 		return 1;
 	    }
@@ -3810,13 +3797,13 @@
 	    char *argptr = OPT_ARG(ops,'u'), *eptr;
 	    /* Handle undocumented feature that -up worked */
 	    if (!strcmp(argptr, "p")) {
-		fdarg= coprocout;
-		if (fdarg < 0) {
+		fd = coprocout;
+		if (fd < 0) {
 		    zwarnnam(name, "-p: no coprocess");
 		    return 1;
 		}
 	    } else {
-		fdarg = (int)zstrtol(argptr, &eptr, 10);
+		fd = (int)zstrtol(argptr, &eptr, 10);
 		if (*eptr) {
 		    zwarnnam(name, "number expected after -%c: %s", 'u',
 			     argptr);
@@ -3825,8 +3812,8 @@
 	    }
 	}
 
-	if ((fd = dup(fdarg)) < 0) {
-	    zwarnnam(name, "bad file number: %d", fdarg);
+	if ((fd = dup(fd)) < 0) {
+	    zwarnnam(name, "bad file number: %d", fd);
 	    return 1;
 	}
 	if ((fout = fdopen(fd, "w")) == 0) {
@@ -5028,7 +5015,6 @@
     int opt_R = OPT_ISSET(ops, 'R');
     int saveemulation, savehackchar;
     int ret = 1, new_emulation;
-    unsigned int savepatterns;
     char saveopts[OPT_SIZE], new_opts[OPT_SIZE];
     char *cmd = 0;
     const char *shname = *argv;
@@ -5070,8 +5056,7 @@
     if (!argv[1]) {
 	emulate(shname, OPT_ISSET(ops,'R'), &emulation, opts);
 	if (OPT_ISSET(ops,'L'))
-	    opts[LOCALOPTIONS] = opts[LOCALTRAPS] = opts[LOCALPATTERNS] = 1;
-	clearpatterndisables();
+	    opts[LOCALOPTIONS] = opts[LOCALTRAPS] = 1;
 	return 0;
     }
 
@@ -5092,13 +5077,6 @@
 	goto restore;
     }
 
-    savepatterns = savepatterndisables();
-    /*
-     * All emulations start with an empty set of pattern disables,
-     * hence no special "sticky" behaviour is required.
-     */
-    clearpatterndisables();
-
     saveemulation = emulation;
     emulation = new_emulation;
     memcpy(opts, new_opts, sizeof(opts));
@@ -5148,7 +5126,6 @@
     sticky = save_sticky;
     emulation = saveemulation;
     memcpy(opts, saveopts, sizeof(opts));
-    restorepatterndisables(savepatterns);
 restore:
     keyboardhackchar = savehackchar;
     inittyptab();	/* restore banghist */
@@ -5513,8 +5490,6 @@
 		eof = 2;
 	    else
 		eof = (bptr - buf != 1 || (buf[0] != 'y' && buf[0] != 'Y'));
-	    buf[0] = eof ? 'n' : 'y';
-	    bptr = buf + 1;
 	}
 	if (OPT_ISSET(ops,'e') || OPT_ISSET(ops,'E'))
 	    fwrite(buf, bptr - buf, 1, stdout);
@@ -5692,7 +5667,7 @@
 	    zputs(buf, stdout);
 	    putchar('\n');
 	}
-	if (!OPT_ISSET(ops,'e') && (*buf || first || gotnl)) {
+	if (!OPT_ISSET(ops,'e') && (*buf || first)) {
 	    if (OPT_ISSET(ops,'A')) {
 		addlinknode(readll, buf);
 		al++;
@@ -5995,7 +5970,7 @@
     char **s;
     Eprog prog;
     struct estate state;
-    int nargs, sense = 0, ret;
+    int nargs;
 
     /* if "test" was invoked as "[", it needs a matching "]" *
      * which is subsequently ignored                         */
@@ -6014,7 +5989,7 @@
     /*
      * Implement some XSI extensions to POSIX here.
      * See
-     * http://pubs.opengroup.org/onlinepubs/9699919799/utilities/test.html
+     * http://www.opengroup.org/onlinepubs/009695399/utilities/test.html.
      */
     nargs = arrlen(argv);
     if (nargs == 3 || nargs == 4)
@@ -6023,10 +5998,6 @@
 	    argv[nargs-1] = NULL;
 	    argv++;
 	}
-	if (nargs == 4 && !strcmp("!", argv[0])) {
-	    sense = 1;
-	    argv++;
-	}
     }
 
     lexsave();
@@ -6061,11 +6032,8 @@
     state.pc = prog->prog;
     state.strs = prog->strs;
 
-    ret = evalcond(&state, name);
-    if (ret < 2 && sense)
-	ret = ! ret;
 
-    return ret;
+    return evalcond(&state, name);
 }
 
 /* display a time, provided in units of 1/60s, as minutes and seconds */
diff -ruN zsh-5.0.4/Src/exec.c zsh-5.0.2/Src/exec.c
--- zsh-5.0.4/Src/exec.c	2013-12-06 12:37:11.000000000 -0800
+++ zsh-5.0.2/Src/exec.c	2012-12-15 10:25:13.000000000 -0800
@@ -448,13 +448,10 @@
     else
 	sprintf(buf + 2, "%s/%s", pwd, pth);
     zputenv(buf);
-#ifndef FD_CLOEXEC
     closedumps();
-#endif
 
     if (newenvp == NULL)
 	    newenvp = environ;
-    winch_unblock();
     execve(pth, argv, newenvp);
 
     /* If the execve returns (which in general shouldn't happen),   *
@@ -489,7 +486,6 @@
 				(pprog = pathprog(ptr2, NULL))) {
 				argv[-2] = ptr2;
 				argv[-1] = ptr + 1;
-				winch_unblock();
 				execve(pprog, argv - 2, newenvp);
 			    }
 			    zerr("%s: bad interpreter: %s: %e", pth, ptr2,
@@ -498,16 +494,13 @@
 			    *ptr = '\0';
 			    argv[-2] = ptr2;
 			    argv[-1] = ptr + 1;
-			    winch_unblock();
 			    execve(ptr2, argv - 2, newenvp);
 			} else {
 			    argv[-1] = ptr2;
-			    winch_unblock();
 			    execve(ptr2, argv - 1, newenvp);
 			}
 		    } else if (eno == ENOEXEC) {
 			argv[-1] = "sh";
-			winch_unblock();
 			execve("/bin/sh", argv - 1, newenvp);
 		    }
 		} else if (eno == ENOEXEC) {
@@ -516,7 +509,6 @@
 			    break;
 		    if (t0 == ct) {
 			argv[-1] = "sh";
-			winch_unblock();
 			execve("/bin/sh", argv - 1, newenvp);
 		    }
 		}
@@ -1027,11 +1019,6 @@
     Eprog prog;
 
     pushheap();
-    if (isset(VERBOSE)) {
-	zputs(s, stderr);
-	fputc('\n', stderr);
-	fflush(stderr);
-    }
     if ((prog = parse_string(s, 0)))
 	execode(prog, dont_change_job, exiting, context);
     popheap();
@@ -1092,9 +1079,6 @@
     if (errflag)
 	return (lastval = 1);
 
-    if (!isset(EXECOPT))
-	return lastval = 0;
-
     /* In evaluated traps, don't modify the line number. */
     if (!IN_EVAL_TRAP() && !ineval && code)
 	lineno = code - 1;
@@ -1661,6 +1645,8 @@
     return lastval;
 }
 
+static int subsh_close = -1;
+
 /* execute pipeline.  This function assumes the `pline' is not NULL. */
 
 /**/
@@ -1737,7 +1723,7 @@
 	    }
 	} else {
 	    /* otherwise just do the pipeline normally. */
-	    addfilelist(NULL, pipes[0]);
+	    subsh_close = pipes[0];
 	    execcmd(state, input, pipes[1], how, 0);
 	}
 	zclose(pipes[1]);
@@ -1750,6 +1736,8 @@
 	execpline2(state, *state->pc++, how, pipes[0], output, last1);
 	list_pipe = old_list_pipe;
 	cmdpop();
+	zclose(pipes[0]);
+	subsh_close = -1;
     }
 }
 
@@ -1853,22 +1841,9 @@
 	case '*':
 	case '?':
 	case '$':
-	case ' ':
 	    putc('\\', file);
 	    break;
 
-	case '\t':
-	    fputs("$'\\t'", file);
-	    continue;
-
-	case '\n':
-	    fputs("$'\\n'", file);
-	    continue;
-
-	case '\r':
-	    fputs("$'\\r'", file);
-	    continue;
-
 	case '=':
 	    if (s == str)
 		putc('\\', file);
@@ -1910,14 +1885,7 @@
 	return 0;
     }
 
-    /*
-     * We can't clobber the value in the parameter if it's
-     * already an opened file descriptor --- that means it's a decimal
-     * integer corresponding to an opened file descriptor,
-     * not merely an expression that evaluates to a file descriptor.
-     */
-    if (!isset(CLOBBER) && (s = getstrvalue(v)) &&
-	(fd = (int)zstrtol(s, &s, 10)) >= 0 && !*s &&
+    if (!isset(CLOBBER) && (fd = (int)getintvalue(v)) &&
 	fd <= max_zsh_fd && fdtable[fd] == FDT_EXTERNAL) {
 	zwarn("can't clobber parameter %s containing file descriptor %d",
 	     f->varid, fd);
@@ -1967,7 +1935,7 @@
 
 /**/
 static void
-closemn(struct multio **mfds, int fd, int type)
+closemn(struct multio **mfds, int fd)
 {
     if (fd >= 0 && mfds[fd] && mfds[fd]->ct >= 2) {
 	struct multio *mn = mfds[fd];
@@ -2026,7 +1994,7 @@
 		}
 	}
 	_exit(0);
-    } else if (fd >= 0 && type == REDIR_CLOSE)
+    } else if (fd >= 0)
 	mfds[fd] = NULL;
 }
 
@@ -2179,6 +2147,8 @@
 	    mfds[fd1]->fds[mfds[fd1]->ct++] = fdN;
 	}
     }
+    if (subsh_close >= 0 && fdtable[subsh_close] == FDT_UNUSED)
+	subsh_close = -1;
 }
 
 /**/
@@ -2877,6 +2847,9 @@
 	    close(synch[1]);
 	    read_loop(synch[0], &dummy, 1);
 	    close(synch[0]);
+#ifdef PATH_DEV_FD
+	    closem(FDT_PROC_SUBST);
+#endif
 	    if (how & Z_ASYNC) {
 		lastpid = (zlong) pid;
 		/* indicate it's possible to set status for lastpid */
@@ -3093,7 +3066,7 @@
 		    }
 		}
 		if (fn->fd1 < 10)
-		    closemn(mfds, fn->fd1, REDIR_CLOSE);
+		    closemn(mfds, fn->fd1);
 		if (!closed && zclose(fn->fd1) < 0) {
 		    zwarn("failed to close file descriptor %d: %e",
 			  fn->fd1, errno);
@@ -3102,7 +3075,7 @@
 	    case REDIR_MERGEIN:
 	    case REDIR_MERGEOUT:
 		if (fn->fd2 < 10)
-		    closemn(mfds, fn->fd2, fn->type);
+		    closemn(mfds, fn->fd2);
 		if (!checkclobberparam(fn))
 		    fil = -1;
 		else if (fn->fd2 > 9 &&
@@ -3123,7 +3096,7 @@
 		    int fd = fn->fd2;
 		    if(fd == -2)
 			fd = (fn->type == REDIR_MERGEOUT) ? coprocout : coprocin;
-		    fil = movefd(dup(fd));
+		    fil = dup(fd);
 		}
 		if (fil == -1) {
 		    char fdstr[4];
@@ -3151,7 +3124,7 @@
 		else
 		    fil = clobber_open(fn);
 		if(fil != -1 && IS_ERROR_REDIR(fn->type))
-		    dfil = movefd(dup(fil));
+		    dfil = dup(fil);
 		else
 		    dfil = 0;
 		if (fil == -1 || dfil == -1) {
@@ -3181,7 +3154,7 @@
      * spawning tee/cat processes as necessary.         */
     for (i = 0; i < 10; i++)
 	if (mfds[i] && mfds[i]->ct >= 2)
-	    closemn(mfds, i, REDIR_CLOSE);
+	    closemn(mfds, i);
 
     if (nullexec) {
 	if (nullexec == 1) {
@@ -3260,12 +3233,33 @@
 
 	    if (is_shfunc) {
 		/* It's a shell function */
+
+#ifdef PATH_DEV_FD
+		int i;
+
+		for (i = 10; i <= max_zsh_fd; i++)
+		    if (fdtable[i] >= FDT_PROC_SUBST)
+			fdtable[i]++;
+#endif
+		if (subsh_close >= 0)
+		    zclose(subsh_close);
+		subsh_close = -1;
+
 		execshfunc((Shfunc) hn, args);
+#ifdef PATH_DEV_FD
+		for (i = 10; i <= max_zsh_fd; i++)
+		    if (fdtable[i] >= FDT_PROC_SUBST)
+			if (--(fdtable[i]) <= FDT_PROC_SUBST)
+			    zclose(i);
+#endif
 	    } else {
 		/* It's a builtin */
 		if (forked)
 		    closem(FDT_INTERNAL);
 		lastval = execbuiltin(args, (Builtin) hn);
+#ifdef PATH_DEV_FD
+		closem(FDT_PROC_SUBST);
+#endif
 		fflush(stdout);
 		if (save[1] == -2) {
 		    if (ferror(stdout)) {
@@ -3309,10 +3303,7 @@
 	    }
 	    if (type == WC_SIMPLE) {
 		if (varspc) {
-		    int addflags = ADDVAR_EXPORT|ADDVAR_RESTRICT;
-		    if (forked)
-			addflags |= ADDVAR_RESTORE;
-		    addvars(state, varspc, addflags);
+		    addvars(state, varspc, ADDVAR_EXPORT|ADDVAR_RESTRICT);
 		    if (errflag)
 			_exit(1);
 		}
@@ -3338,6 +3329,9 @@
 		DPUTS(varspc,
 		      "BUG: assignment before complex command");
 		list_pipe = 0;
+		if (subsh_close >= 0)
+		    zclose(subsh_close);
+                subsh_close = -1;
 		/* If we're forked (and we should be), no need to return */
 		DPUTS(last1 != 1 && !forked, "BUG: not exiting?");
 		DPUTS(type != WC_SUBSH, "Not sure what we're doing.");
@@ -3880,7 +3874,9 @@
 	    untokenize(s);
     }
 
-    addfilelist(nam, 0);
+    if (!jobtab[thisjob].filelist)
+	jobtab[thisjob].filelist = znewlinklist();
+    zaddlinknode(jobtab[thisjob].filelist, nam);
 
     if (!s)
 	child_block();
@@ -3966,7 +3962,9 @@
 	return NULL;
     if (!(prog = parsecmd(cmd, eptr)))
 	return NULL;
-    addfilelist(pnam, 0);
+    if (!jobtab[thisjob].filelist)
+	jobtab[thisjob].filelist = znewlinklist();
+    zaddlinknode(jobtab[thisjob].filelist, ztrdup(pnam));
 
     if ((pid = zfork(&bgtime))) {
 	if (pid == -1)
@@ -3984,7 +3982,7 @@
     entersubsh(ESUB_ASYNC|ESUB_PGRP);
     redup(fd, out);
 #else /* PATH_DEV_FD */
-    int pipes[2], fd;
+    int pipes[2];
 
     if (thisjob == -1)
 	return NULL;
@@ -4001,9 +3999,7 @@
 	    zclose(pipes[!out]);
 	    return NULL;
 	}
-	fd = pipes[!out];
-	fdtable[fd] = FDT_PROC_SUBST;
-	addfilelist(NULL, fd);
+	fdtable[pipes[!out]] = FDT_PROC_SUBST;
 	if (!out)
 	{
 	    addproc(pid, NULL, 1, &bgtime);
@@ -4618,7 +4614,6 @@
     }
 
     starttrapscope();
-    startpatternscope();
 
     pptab = pparams;
     if (!(flags & PM_UNDEFINED))
@@ -4666,8 +4661,6 @@
 		 offptr++)
 		opts[*offptr] = 0;
 	}
-	/* All emulations start with pattern disables clear */
-	clearpatterndisables();
     } else
 	restore_sticky = 0;
 
@@ -4768,8 +4761,6 @@
     scriptname = oldscriptname;
     oflags = ooflags;
 
-    endpatternscope();		/* before restoring old LOCALPATTERNS */
-
     if (restore_sticky) {
 	/*
 	 * If we switched to an emulation environment just for
@@ -5079,6 +5070,7 @@
     es->trapisfunc = trapisfunc;
     es->traplocallevel = traplocallevel;
     es->noerrs = noerrs;
+    es->subsh_close = subsh_close;
     es->underscore = ztrdup(zunderscore);
     es->next = exstack;
     exstack = es;
@@ -5089,33 +5081,30 @@
 void
 execrestore(void)
 {
-    struct execstack *en = exstack;
+    struct execstack *en;
 
     DPUTS(!exstack, "BUG: execrestore() without execsave()");
-
-    queue_signals();
-    exstack = exstack->next;
-
-    list_pipe_pid = en->list_pipe_pid;
-    nowait = en->nowait;
-    pline_level = en->pline_level;
-    list_pipe_child = en->list_pipe_child;
-    list_pipe_job = en->list_pipe_job;
-    strcpy(list_pipe_text, en->list_pipe_text);
-    lastval = en->lastval;
-    noeval = en->noeval;
-    badcshglob = en->badcshglob;
-    cmdoutpid = en->cmdoutpid;
-    cmdoutval = en->cmdoutval;
-    use_cmdoutval = en->use_cmdoutval;
-    trap_return = en->trap_return;
-    trap_state = en->trap_state;
-    trapisfunc = en->trapisfunc;
-    traplocallevel = en->traplocallevel;
-    noerrs = en->noerrs;
-    setunderscore(en->underscore);
-    zsfree(en->underscore);
-    free(en);
-
-    unqueue_signals();
+    list_pipe_pid = exstack->list_pipe_pid;
+    nowait = exstack->nowait;
+    pline_level = exstack->pline_level;
+    list_pipe_child = exstack->list_pipe_child;
+    list_pipe_job = exstack->list_pipe_job;
+    strcpy(list_pipe_text, exstack->list_pipe_text);
+    lastval = exstack->lastval;
+    noeval = exstack->noeval;
+    badcshglob = exstack->badcshglob;
+    cmdoutpid = exstack->cmdoutpid;
+    cmdoutval = exstack->cmdoutval;
+    use_cmdoutval = exstack->use_cmdoutval;
+    trap_return = exstack->trap_return;
+    trap_state = exstack->trap_state;
+    trapisfunc = exstack->trapisfunc;
+    traplocallevel = exstack->traplocallevel;
+    noerrs = exstack->noerrs;
+    subsh_close = exstack->subsh_close;
+    setunderscore(exstack->underscore);
+    zsfree(exstack->underscore);
+    en = exstack->next;
+    free(exstack);
+    exstack = en;
 }
diff -ruN zsh-5.0.4/Src/glob.c zsh-5.0.2/Src/glob.c
--- zsh-5.0.4/Src/glob.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/glob.c	2012-06-21 11:36:09.000000000 -0700
@@ -445,6 +445,41 @@
     unqueue_signals();
 }
 
+/* Check to see if str is eligible for filename generation. */
+
+/**/
+mod_export int
+haswilds(char *str)
+{
+    /* `[' and `]' are legal even if bad patterns are usually not. */
+    if ((*str == Inbrack || *str == Outbrack) && !str[1])
+	return 0;
+
+    /* If % is immediately followed by ?, then that ? is     *
+     * not treated as a wildcard.  This is so you don't have *
+     * to escape job references such as %?foo.               */
+    if (str[0] == '%' && str[1] == Quest)
+	str[1] = '?';
+
+    for (; *str; str++) {
+	switch (*str) {
+	    case Inpar:
+	    case Bar:
+	    case Star:
+	    case Inbrack:
+	    case Inang:
+	    case Quest:
+		return 1;
+	    case Pound:
+	    case Hat:
+		if (isset(EXTENDEDGLOB))
+		    return 1;
+		break;
+	}
+    }
+    return 0;
+}
+
 /* Do the globbing:  scanner is called recursively *
  * with successive bits of the path until we've    *
  * tried all of it.                                */
@@ -673,9 +708,8 @@
     }
 
     /* Parse repeated directories such as (dir/)# and (dir/)## */
-    if (*(str = instr) == zpc_special[ZPC_INPAR] &&
-	!skipparens(Inpar, Outpar, (char **)&str) &&
-        *str == zpc_special[ZPC_HASH] && str[-2] == '/') {
+    if (*(str = instr) == Inpar && !skipparens(Inpar, Outpar, (char **)&str) &&
+        *str == Pound && isset(EXTENDEDGLOB) && str[-2] == '/') {
 	instr++;
 	if (!(p1 = patcompile(instr, compflags, &instr)))
 	    return NULL;
@@ -727,9 +761,9 @@
      * Check for initial globbing flags, so that they don't form
      * a bogus path component.
      */
-    if ((*str == zpc_special[ZPC_INPAR] && str[1] == zpc_special[ZPC_HASH]) ||
-	(*str == zpc_special[ZPC_KSH_AT] && str[1] == Inpar &&
-	 str[2] == zpc_special[ZPC_HASH])) {
+    if ((*str == Inpar && str[1] == Pound && isset(EXTENDEDGLOB)) ||
+	(isset(KSHGLOB) && *str == '@' && str[1] == Inpar &&
+	 str[2] == Pound)) {
 	str += (*str == Inpar) ? 2 : 3;
 	if (!patgetglobflags(&str, &assert, &ignore))
 	    return NULL;
@@ -1112,8 +1146,7 @@
     gf_pre_words = NULL;
 
     /* Check for qualifiers */
-    while (!nobareglob ||
-	   (isset(EXTENDEDGLOB) && !zpc_disables[ZPC_HASH])) {
+    while (!nobareglob || isset(EXTENDEDGLOB)) {
 	struct qual *newquals;
 	char *s;
 	int sense, paren;
@@ -1159,11 +1192,10 @@
 	    case Outpar:
 		paren++; /*FALLTHROUGH*/
 	    case Bar:
-		if (!zpc_disables[ZPC_BAR])
-		    nobareglob = 1;
+		nobareglob = 1;
 		break;
 	    case Tilde:
-		if (isset(EXTENDEDGLOB) && !zpc_disables[ZPC_TILDE])
+		if (isset(EXTENDEDGLOB))
 		    nobareglob = 1;
 		break;
 	    case Inpar:
@@ -1173,7 +1205,7 @@
 	}
 	if (*s != Inpar)
 	    break;
-	if (isset(EXTENDEDGLOB) && !zpc_disables[ZPC_HASH] && s[1] == Pound) {
+	if (isset(EXTENDEDGLOB) && s[1] == Pound) {
 	    if (s[2] == 'q') {
 		*s = 0;
 		s += 2;
@@ -1612,8 +1644,7 @@
 		    break;
 		}
 		default:
-		    untokenize(--s);
-		    zerr("unknown file attribute: %c", *s);
+		    zerr("unknown file attribute");
 		    restore_globstate(saved);
 		    return;
 		}
diff -ruN zsh-5.0.4/Src/hist.c zsh-5.0.2/Src/hist.c
--- zsh-5.0.4/Src/hist.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/hist.c	2012-11-09 14:23:04.000000000 -0800
@@ -76,9 +76,6 @@
  * and a temporary history entry is inserted while the user is editing.
  * If the resulting line was not added to the list, a flag is set so
  * that curhist will be decremented in hbegin().
- *
- * Note curhist is passed to zle on variable length argument list:
- * type must match that retrieved in zle_main_entry.
  */
  
 /**/
@@ -521,12 +518,6 @@
 		}
 		c = ingetc();
 	    }
-	    if (ptr == buf &&
-		(c == '}' ||  c == ';' || c == '\'' || c == '"' || c == '`')) {
-	      /* Neither event nor word designator, no expansion */
-	      safeinungetc(c);
-	      return bangchar;
-	    }
 	    *ptr = 0;
 	    if (!*buf) {
 		if (c != '%') {
@@ -877,8 +868,6 @@
 mod_export void
 hbegin(int dohist)
 {
-    char *hf;
-
     isfirstln = isfirstch = 1;
     errflag = histdone = 0;
     if (!dohist)
@@ -932,35 +921,13 @@
 	defev = addhistnum(curhist, -1, HIST_FOREIGN);
     } else
 	histactive = HA_ACTIVE | HA_NOINC;
-
-    hf = getsparam("HISTFILE");
-    /*
-     * For INCAPPENDHISTORY, when interactive, save the history here
-     * as it gives a better estimate of the times of commands.
-     *
-     * If SHAREHISTORY is also set continue to do so in the
-     * standard place, because that's safer about reading and
-     * rewriting history atomically.
-     *
-     * The histsave_stack_pos test won't usually fail here.
-     * We need to test the opposite for the hend() case because we
-     * need to save in the history file we've switched to, but then
-     * we pop immediately after that so the variable becomes zero.
-     * We will already have saved the line and restored the history
-     * so that (correctly) nothing happens here.  But it shows
-     * I thought about it.
-     */
-    if (isset(INCAPPENDHISTORY) && !isset(SHAREHISTORY) &&
-	!(histactive & HA_NOINC) && !strin && histsave_stack_pos == 0)
-	savehistfile(hf, 0, HFILE_USE_OPTIONS | HFILE_FAST);
 }
 
 /**/
 void
 histreduceblanks(void)
 {
-    int i, len, pos, needblank, spacecount = 0, trunc_ok;
-    char *lastptr, *ptr;
+    int i, len, pos, needblank, spacecount = 0;
 
     if (isset(HISTIGNORESPACE))
 	while (chline[spacecount] == ' ') spacecount++;
@@ -972,41 +939,17 @@
     if (chline[len] == '\0')
 	return;
 
-    /* Remember where the delimited words end */
-    if (chwordpos)
-	lastptr = chline + chwords[chwordpos-1];
-    else
-	lastptr = chline;
-
     for (i = 0, pos = spacecount; i < chwordpos; i += 2) {
 	len = chwords[i+1] - chwords[i];
 	needblank = (i < chwordpos-2 && chwords[i+2] > chwords[i+1]);
 	if (pos != chwords[i]) {
-	    memmove(chline + pos, chline + chwords[i], len + needblank);
+	    memcpy(chline + pos, chline + chwords[i], len + needblank);
 	    chwords[i] = pos;
 	    chwords[i+1] = chwords[i] + len;
 	}
 	pos += len + needblank;
     }
-
-    /*
-     * A terminating comment isn't recorded as a word.
-     * Only truncate the line if just whitespace remains.
-     */
-    trunc_ok = 1;
-    for (ptr = lastptr; *ptr; ptr++) {
-	if (!inblank(*ptr)) {
-	    trunc_ok = 0;
-	    break;
-	}
-    }
-    if (trunc_ok) {
-	chline[pos] = '\0';
-    } else {
-	ptr = chline + pos;
-	while ((*ptr++ = *lastptr++))
-	    ;
-    }
+    chline[pos] = '\0';
 }
 
 /**/
@@ -1226,15 +1169,7 @@
 hend(Eprog prog)
 {
     LinkList hookargs = newlinklist();
-    int flag, hookret, stack_pos = histsave_stack_pos;
-    /*
-     * save:
-     * 0: don't save
-     * 1: save normally
-     * -1: save temporarily, delete after next line
-     * -2: save internally but mark for not writing
-     */
-    int save = 1;
+    int flag, save = 1, hookret, stack_pos = histsave_stack_pos;
     char *hf;
 
     DPUTS(stophist != 2 && !(inbufflags & INP_ALIAS) && !chline,
@@ -1287,11 +1222,7 @@
 	}
 	if (chwordpos <= 2)
 	    save = 0;
-	else if (should_ignore_line(prog))
-	    save = -1;
-	else if (hookret == 2)
-	    save = -2;
-	else if (hookret)
+	else if (hookret || should_ignore_line(prog))
 	    save = -1;
     }
     if (flag & (HISTFLAG_DONE | HISTFLAG_RECALL)) {
@@ -1337,12 +1268,7 @@
 	    if (isset(HISTREDUCEBLANKS))
 		histreduceblanks();
 	}
-	if (save == -1)
-	    newflags = HIST_TMPSTORE;
-	else if (save == -2)
-	    newflags = HIST_NOWRITE;
-	else
-	    newflags = 0;
+	newflags = save > 0? 0 : HIST_TMPSTORE;
 	if ((isset(HISTIGNOREDUPS) || isset(HISTIGNOREALLDUPS)) && save > 0
 	 && hist_ring && histstrcmp(chline, hist_ring->node.nam) == 0) {
 	    /* This history entry compares the same as the previous.
@@ -1374,11 +1300,7 @@
     chline = hptr = NULL;
     chwords = NULL;
     histactive = 0;
-    /*
-     * For normal INCAPPENDHISTORY case and reasoning, see hbegin().
-     */
-    if (isset(SHAREHISTORY) ? histfileIsLocked() :
-	(isset(INCAPPENDHISTORY) && histsave_stack_pos != 0))
+    if (isset(SHAREHISTORY)? histfileIsLocked() : isset(INCAPPENDHISTORY))
 	savehistfile(hf, 0, HFILE_USE_OPTIONS | HFILE_FAST);
     unlockhistfile(hf); /* It's OK to call this even if we aren't locked */
     /*
@@ -2467,9 +2389,6 @@
 	zerr("can't read history file %s", fn);
 
     unlockhistfile(fn);
-
-    if (zleactive)
-	zleentry(ZLE_CMD_SET_HIST_LINE, curhist);
 }
 
 #ifdef HAVE_FCNTL_H
@@ -2600,29 +2519,14 @@
 	}
     }
     if (out) {
-	char *history_ignore;
-	Patprog histpat = NULL;
-
-	pushheap();
-
-	if ((history_ignore = getsparam("HISTORY_IGNORE")) != NULL) {
-	    tokenize(history_ignore = dupstring(history_ignore));
-	    remnulargs(history_ignore);
-	    histpat = patcompile(history_ignore, 0, NULL);
-	}
-
 	ret = 0;
 	for (; he && he->histnum <= xcurhist; he = down_histent(he)) {
 	    if ((writeflags & HFILE_SKIPDUPS && he->node.flags & HIST_DUP)
 	     || (writeflags & HFILE_SKIPFOREIGN && he->node.flags & HIST_FOREIGN)
 	     || he->node.flags & HIST_TMPSTORE)
 		continue;
-	    if (histpat &&
-		pattry(histpat, metafy(he->node.nam, -1, META_HEAPDUP))) {
-		continue;
-	    }
 	    if (writeflags & HFILE_SKIPOLD) {
-		if (he->node.flags & (HIST_OLD|HIST_NOWRITE))
+		if (he->node.flags & HIST_OLD)
 		    continue;
 		he->node.flags |= HIST_OLD;
 		if (writeflags & HFILE_USE_OPTIONS)
@@ -2700,8 +2604,6 @@
 		histactive = remember_histactive;
 	    }
 	}
-
-	popheap();
     } else
 	ret = -1;
 
@@ -3412,8 +3314,6 @@
     }
     hist_ring = NULL;
     curhist = histlinect = 0;
-    if (zleactive)
-	zleentry(ZLE_CMD_SET_HIST_LINE, curhist);
     histsiz = hs;
     savehistsiz = shs;
     inithist(); /* sets histtab */
@@ -3453,8 +3353,6 @@
     histtab = h->histtab;
     hist_ring = h->hist_ring;
     curhist = h->curhist;
-    if (zleactive)
-	zleentry(ZLE_CMD_SET_HIST_LINE, curhist);
     histlinect = h->histlinect;
     histsiz = h->histsiz;
     savehistsiz = h->savehistsiz;
diff -ruN zsh-5.0.4/Src/init.c zsh-5.0.2/Src/init.c
--- zsh-5.0.4/Src/init.c	2013-12-19 11:35:10.000000000 -0800
+++ zsh-5.0.2/Src/init.c	2012-11-09 13:53:12.000000000 -0800
@@ -77,7 +77,7 @@
 /**/
 int tclines, tccolumns;
 /**/
-mod_export int hasam, hasxn, hasye;
+mod_export int hasam, hasxn;
 
 /* Value of the Co (max_colors) entry: may not be set */
 
@@ -281,10 +281,9 @@
 
 /**/
 static void
-parseopts_insert(LinkList optlist, char *base, int optno)
+parseopts_insert(LinkList optlist, void *ptr)
 {
     LinkNode node;
-    void *ptr = base + (optno < 0 ? -optno : optno);
 
     for (node = firstnode(optlist); node; incnode(node)) {
 	if (ptr < getdata(node)) {
@@ -391,7 +390,7 @@
 		    if (dosetopt(optno, action, !nam, new_opts) && nam) {
 			WARN_OPTION("can't change option: %s", *argv);
 		    } else if (optlist) {
-			parseopts_insert(optlist, new_opts, optno);
+			parseopts_insert(optlist, new_opts+optno);
 		    }
 		}
               break;
@@ -416,7 +415,7 @@
 		    if (dosetopt(optno, action, !nam, new_opts) && nam) {
 			WARN_OPTION("can't change option: -%c", **argv);
 		    } else if (optlist) {
-			parseopts_insert(optlist, new_opts, optno);
+			parseopts_insert(optlist, new_opts+optno);
 		    }
 		}
 	    }
@@ -699,7 +698,6 @@
 	/* check whether terminal has automargin (wraparound) capability */
 	hasam = tgetflag("am");
 	hasxn = tgetflag("xn"); /* also check for newline wraparound glitch */
-	hasye = tgetflag("YE"); /* print in last column does carriage return */
 
 	tclines = tgetnum("li");
 	tccolumns = tgetnum("co");
@@ -749,9 +747,6 @@
 	    tcstr[TCCLEARSCREEN] = ztrdup("\14");
 	    tclen[TCCLEARSCREEN] = 1;
 	}
-#if 0	/* This might work, but there may be more to it */
-	rprompt_indent = (hasye || !tccan(TCLEFT)) ? 1 : 0;
-#endif
     }
     return 1;
 }
@@ -1003,15 +998,6 @@
     setiparam("COLUMNS", zterm_columns);
     setiparam("LINES", zterm_lines);
 #endif
-    {
-	/* Import from environment, overrides init_term() */
-	struct value vbuf;
-	char *name = "ZLE_RPROMPT_INDENT";
-	if (getvalue(&vbuf, &name, 1) && !(vbuf.flags & PM_UNSET))
-	    rprompt_indent = getintvalue(&vbuf);
-	else
-	    rprompt_indent = 1;
-    }
 
 #ifdef HAVE_GETRLIMIT
     for (i = 0; i != RLIM_NLIMITS; i++) {
@@ -1127,7 +1113,6 @@
     install_handler(SIGCHLD);
 #ifdef SIGWINCH
     install_handler(SIGWINCH);
-    winch_block();	/* See utils.c:preprompt() */
 #endif
     if (interact) {
 	install_handler(SIGALRM);
@@ -1597,7 +1582,6 @@
 
     fdtable_size = zopenmax();
     fdtable = zshcalloc(fdtable_size*sizeof(*fdtable));
-    fdtable[0] = fdtable[1] = fdtable[2] = FDT_EXTERNAL;
 
     createoptiontable();
     emulate(zsh_name, 1, &emulation, opts);   /* initialises most options */
diff -ruN zsh-5.0.4/Src/input.c zsh-5.0.2/Src/input.c
--- zsh-5.0.4/Src/input.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/input.c	2010-12-20 11:53:35.000000000 -0800
@@ -142,14 +142,12 @@
     char *p;
 
     p = buf;
-    winch_unblock();
     for (;;) {
 	do {
 	    errno = 0;
 	    c = fgetc(bshin);
 	} while (c < 0 && errno == EINTR);
 	if (c < 0 || c == '\n') {
-	    winch_block();
 	    if (c == '\n')
 		*p++ = '\n';
 	    if (p > buf) {
@@ -165,13 +163,11 @@
 	} else
 	    *p++ = c;
 	if (p >= buf + BUFSIZ - 1) {
-	    winch_block();
 	    line = zrealloc(line, ll + (p - buf) + 1);
 	    memcpy(line + ll, buf, p - buf);
 	    ll += p - buf;
 	    line[ll] = '\0';
 	    p = buf;
-	    winch_unblock();
 	}
     }
 }
diff -ruN zsh-5.0.4/Src/jobs.c zsh-5.0.2/Src/jobs.c
--- zsh-5.0.4/Src/jobs.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/jobs.c	2012-11-18 10:44:18.000000000 -0800
@@ -376,36 +376,6 @@
     }
 }
 
-/**/
-void
-storepipestats(Job jn, int inforeground, int fixlastval)
-{
-    int i, pipefail = 0, jpipestats[MAX_PIPESTATS];
-    Process p;
-
-    for (p = jn->procs, i = 0; p && i < MAX_PIPESTATS; p = p->next, i++) {
-	jpipestats[i] = ((WIFSIGNALED(p->status)) ?
-			 0200 | WTERMSIG(p->status) :
-			 WEXITSTATUS(p->status));
-	if (jpipestats[i])
-	    pipefail = jpipestats[i];
-    }
-    if (inforeground) {
-	memcpy(pipestats, jpipestats, sizeof(int)*i);
-	if ((jn->stat & STAT_CURSH) && i < MAX_PIPESTATS)
-	    pipestats[i++] = lastval;
-	numpipestats = i;
-    }
-
-    if (fixlastval) {
-      if (jn->stat & STAT_CURSH) {
-	if (!lastval && isset(PIPEFAIL))
-	  lastval = pipefail;
-      } else if (isset(PIPEFAIL))
-	lastval = pipefail;
-    }
-}
-
 /* Update status of job, possibly printing it */
 
 /**/
@@ -537,13 +507,17 @@
 	return;
     jn->stat |= (somestopped) ? STAT_CHANGED | STAT_STOPPED :
 	STAT_CHANGED | STAT_DONE;
-    if (jn->stat & STAT_DONE) {
-	/* This may be redundant with printjob() but note that inforeground
-	 * is true here for STAT_CURSH jobs even when job != thisjob, most
-	 * likely because thisjob = -1 from exec.c:execsimple() trickery.
-	 * However, if we reset lastval here we break it for printjob().
-	 */
-	storepipestats(jn, inforeground, 0);
+    if (job == thisjob && (jn->stat & STAT_DONE)) {
+	int i;
+	Process p;
+
+	for (p = jn->procs, i = 0; p && i < MAX_PIPESTATS; p = p->next, i++)
+	    pipestats[i] = ((WIFSIGNALED(p->status)) ?
+			    0200 | WTERMSIG(p->status) :
+			    WEXITSTATUS(p->status));
+	if ((jn->stat & STAT_CURSH) && i < MAX_PIPESTATS)
+	    pipestats[i++] = lastval;
+	numpipestats = i;
     }
     if (!inforeground &&
 	(jn->stat & (STAT_SUBJOB | STAT_DONE)) == (STAT_SUBJOB | STAT_DONE)) {
@@ -941,13 +915,10 @@
     int doneprint = 0, skip_print = 0;
     FILE *fout = (synch == 2 || !shout) ? stdout : shout;
 
-    if (synch > 1 && oldjobtab != NULL)
+    if (oldjobtab != NULL)
 	job = jn - oldjobtab;
     else
 	job = jn - jobtab;
-    DPUTS3(job < 0 || job > (oldjobtab && synch > 1 ? oldmaxjob : maxjob),
-	   "bogus job number, jn = %L, jobtab = %L, oldjobtab = %L",
-	   (long)jn, (long)jobtab, (long)oldjobtab);
 
     if (jn->stat & STAT_NOPRINT) {
 	skip_print = 1;
@@ -997,9 +968,6 @@
 
     if (skip_print) {
 	if (jn->stat & STAT_DONE) {
-	    /* This looks silly, but see update_job() */
-	    if (synch <= 1)
-		storepipestats(jn, job == thisjob, job == thisjob);
 	    if (should_report_time(jn))
 		dumptime(jn);
 	    deletejob(jn, 0);
@@ -1115,9 +1083,9 @@
 	fflush(fout);
     }
 
-    /* print "(pwd now: foo)" messages: with (lng & 4) we are printing
-     * the directory where the job is running, otherwise the current directory
-     */
+/* print "(pwd now: foo)" messages: with (lng & 4) we are printing
+ * the directory where the job is running, otherwise the current directory
+ */
 
     if ((lng & 4) || (interact && job == thisjob &&
 		      jn->pwd && strcmp(jn->pwd, pwd))) {
@@ -1127,13 +1095,9 @@
 	fprintf(fout, ")\n");
 	fflush(fout);
     }
-
-    /* delete job if done */
+/* delete job if done */
 
     if (jn->stat & STAT_DONE) {
-	/* This looks silly, but see update_job() */
-	if (synch <= 1)
-	    storepipestats(jn, job == thisjob, job == thisjob);
 	if (should_report_time(jn))
 	    dumptime(jn);
 	deletejob(jn, 0);
@@ -1149,48 +1113,16 @@
     return doneprint;
 }
 
-/* Add a file to be deleted or fd to be closed to the current job */
-
-/**/
-void
-addfilelist(const char *name, int fd)
-{
-    Jobfile jf = (Jobfile)zalloc(sizeof(struct jobfile));
-    LinkList ll = jobtab[thisjob].filelist;
-
-    if (!ll)
-	ll = jobtab[thisjob].filelist = znewlinklist();
-    if (name)
-    {
-	jf->u.name = ztrdup(name);
-	jf->is_fd = 0;
-    }
-    else
-    {
-	jf->u.fd = fd;
-	jf->is_fd = 1;
-    }
-    zaddlinknode(ll, jf);
-}
-
-/* Finished with list of files for a job */
-
 /**/
 void
 deletefilelist(LinkList file_list, int disowning)
 {
-    Jobfile jf;
+    char *s;
     if (file_list) {
-	while ((jf = (Jobfile)getlinknode(file_list))) {
-	    if (jf->is_fd) {
-		if (!disowning)
-		    zclose(jf->u.fd);
-	    } else {
-		if (!disowning)
-		    unlink(jf->u.name);
-		zsfree(jf->u.name);
-	    }
-	    zfree(jf, sizeof(*jf));
+	while ((s = (char *)getlinknode(file_list))) {
+	    if (!disowning)
+		unlink(s);
+	    zsfree(s);
 	}
 	zfree(file_list, sizeof(struct linklist));
     }
@@ -1404,31 +1336,6 @@
 	jn->stat |= STAT_LOCKED;
 	if (jn->stat & STAT_CHANGED)
 	    printjob(jn, !!isset(LONGLISTJOBS), 1);
-	if (jn->filelist) {
-	    /*
-	     * The main shell is finished with any file descriptors used
-	     * for process substitution associated with this job: close
-	     * them to indicate to listeners there's no more input.
-	     *
-	     * Note we can't safely delete temporary files yet as these
-	     * are directly visible to other processes.  However,
-	     * we can't deadlock on the fact that those still exist, so
-	     * that's not a problem.
-	     */
-	    LinkNode node = firstnode(jn->filelist);
-	    while (node) {
-		Jobfile jf = (Jobfile)getdata(node);
-		if (jf->is_fd) {
-		    LinkNode next = nextnode(node);
-		    (void)remnode(jn->filelist, node);
-		    zclose(jf->u.fd);
-		    zfree(jf, sizeof(*jf));
-		    node = next;
-		} else {
-		    incnode(node);
-		}
-	    }
-	}
 	while (!errflag && jn->stat &&
 	       !(jn->stat & STAT_DONE) &&
 	       !(interact && (jn->stat & STAT_STOPPED))) {
@@ -2615,8 +2522,6 @@
 	while ((ttpgrp = gettygrp()) != -1 && ttpgrp != mypgrp) {
 	    mypgrp = GETPGRP();
 	    if (mypgrp == mypid) {
-		if (!interact)
-		    break; /* attachtty() will be a no-op, give up */
 		signal_setmask(oldset);
 		attachtty(mypgrp); /* Might generate SIGT* */
 		signal_block(blockset);
diff -ruN zsh-5.0.4/Src/lex.c zsh-5.0.2/Src/lex.c
--- zsh-5.0.4/Src/lex.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/lex.c	2012-11-09 13:46:04.000000000 -0800
@@ -778,7 +778,6 @@
 	    bptr = tokstr = (char *)hcalloc(bsiz = 32);
 	    add(c);
 	}
-	hwend();
 	while ((c = ingetc()) != '\n' && !lexstop) {
 	    hwaddc(c);
 	    addtoline(c);
diff -ruN zsh-5.0.4/Src/math.c zsh-5.0.2/Src/math.c
--- zsh-5.0.4/Src/math.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/math.c	2012-12-11 13:22:49.000000000 -0800
@@ -362,9 +362,8 @@
     if (mlevel >= MAX_MLEVEL) {
 	xyyval.type = MN_INTEGER;
 	xyyval.u.l = 0;
-	*ep = s;
 
-	zerr("math recursion limit exceeded: %s", *ep);
+	zerr("math recursion limit exceeded");
 
 	return xyyval;
     }
@@ -448,18 +447,15 @@
     if (*nptr == '-')
 	nptr++;
 
-    if (*nptr == '0') {
+    if (*nptr == '0' &&
+	(memchr(nptr, '.', strlen(nptr)) == NULL))
+    {
 	nptr++;
 	if (*nptr == 'x' || *nptr == 'X') {
 	    /* Let zstrtol parse number with base */
 	    yyval.u.l = zstrtol_underscore(ptr, &ptr, 0, 1);
 	    /* Should we set lastbase here? */
 	    lastbase = 16;
-	    if (isset(FORCEFLOAT))
-	    {
-		yyval.type = MN_FLOAT;
-		yyval.u.d = (double)yyval.u.l;
-	    }
 	    return NUM;
 	}
 	else if (isset(OCTALZEROES))
@@ -479,18 +475,16 @@
 	    {
 		yyval.u.l = zstrtol_underscore(ptr, &ptr, 0, 1);
 		lastbase = 8;
-		if (isset(FORCEFLOAT))
-		{
-		    yyval.type = MN_FLOAT;
-		    yyval.u.d = (double)yyval.u.l;
-		}
 		return NUM;
 	    }
 	    nptr = ptr2;
 	}
     }
-    while (idigit(*nptr) || *nptr == '_')
-	nptr++;
+    else
+    {
+	while (idigit(*nptr) || *nptr == '_')
+	    nptr++;
+    }
 
     if (*nptr == '.' || *nptr == 'e' || *nptr == 'E') {
 	char *ptr2;
@@ -543,11 +537,6 @@
 	    lastbase = yyval.u.l;
 	    yyval.u.l = zstrtol_underscore(ptr, &ptr, lastbase, 1);
 	}
-	if (isset(FORCEFLOAT))
-	{
-	    yyval.type = MN_FLOAT;
-	    yyval.u.d = (double)yyval.u.l;
-	}
     }
     return NUM;
 }
@@ -1369,19 +1358,6 @@
     mnumber x;
     int xmtok = mtok;
 
-    /*
-     * At this entry point we don't allow an empty expression,
-     * whereas we do with matheval().  I'm not sure if this
-     * difference is deliberate, but it does mean that e.g.
-     * $array[$ind] where ind hasn't been set produces an error,
-     * which is probably safe.
-     *
-     * To avoid a more opaque error further in, bail out here.
-     */
-    if (!*s) {
-	zerr("bad math expression: empty string");
-	return (zlong)0;
-    }
     x = mathevall(s, MPREC_ARG, ss);
     if (mtok == COMMA)
 	(*ss)--;
@@ -1409,7 +1385,6 @@
     }
     if (errmsg) {
 	int len, over = 0;
-	char *errtype = errmsg == 2 ? "operator" : "operand";
 	while (inblank(*mptr))
 	    mptr++;
 	len = ztrlen(mptr);
@@ -1417,12 +1392,9 @@
 	    len = 10;
 	    over = 1;
 	}
-	if (!*mptr)
-	    zerr("bad math expression: %s expected at end of string",
-		errtype);
-	else
-	    zerr("bad math expression: %s expected at `%l%s'",
-		 errtype, mptr, len, over ? "..." : "");
+	zerr("bad math expression: %s expected at `%l%s'",
+	     errmsg == 2 ? "operator" : "operand",
+	     mptr, len, over ? "..." : "");
     }
     unary = !(tp & OP_OPF);
 }
@@ -1471,8 +1443,7 @@
 	case QUEST:
 	    if (stack[sp].val.type == MN_UNSET)
 		stack[sp].val = getmathparam(stack + sp);
-	    q = (stack[sp].val.type == MN_FLOAT) ?
-		(stack[sp].val.u.d == 0 ? 0 : 1) :
+	    q = (stack[sp].val.type == MN_FLOAT) ? (zlong)stack[sp].val.u.d :
 		stack[sp].val.u.l;
 
 	    if (!q)
diff -ruN zsh-5.0.4/Src/module.c zsh-5.0.2/Src/module.c
--- zsh-5.0.4/Src/module.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/module.c	2011-10-28 11:27:43.000000000 -0700
@@ -3,7 +3,7 @@
  *
  * This file is part of zsh, the Z shell.
  *
- * Copyright (c) 1996-1997 Zolt√°n Hidv√©gi
+ * Copyright (c) 1996-1997 Zolt·n HidvÈgi
  * All rights reserved.
  *
  * Permission is hereby granted, without written agreement and without
@@ -12,16 +12,16 @@
  * purpose, provided that the above copyright notice and the following
  * two paragraphs appear in all copies of this software.
  *
- * In no event shall Zolt√°n Hidv√©gi or the Zsh Development Group be liable
+ * In no event shall Zolt·n HidvÈgi or the Zsh Development Group be liable
  * to any party for direct, indirect, special, incidental, or consequential
  * damages arising out of the use of this software and its documentation,
- * even if Zolt√°n Hidv√©gi and the Zsh Development Group have been advised of
+ * even if Zolt·n HidvÈgi and the Zsh Development Group have been advised of
  * the possibility of such damage.
  *
- * Zolt√°n Hidv√©gi and the Zsh Development Group specifically disclaim any
+ * Zolt·n HidvÈgi and the Zsh Development Group specifically disclaim any
  * warranties, including, but not limited to, the implied warranties of
  * merchantability and fitness for a particular purpose.  The software
- * provided hereunder is on an "as is" basis, and Zolt√°n Hidv√©gi and the
+ * provided hereunder is on an "as is" basis, and Zolt·n HidvÈgi and the
  * Zsh Development Group have no obligation to provide maintenance,
  * support, updates, enhancements, or modifications.
  */
@@ -3419,15 +3419,12 @@
     int ret = 0, subret;
     Module defm, m;
     char **modfeatures = NULL;
-    int *modenables = NULL;
     if (module) {
 	defm = (Module)find_module(module,
 				   FINDMOD_ALIASP|FINDMOD_CREATE, NULL);
 	if ((defm->node.flags & MOD_LINKED) ? defm->u.linked :
-	    defm->u.handle) {
+	    defm->u.handle)
 	    (void)features_module(defm, &modfeatures);
-	    (void)enables_module(defm, &modenables);
-	}
     } else
 	defm = NULL;
 
@@ -3547,16 +3544,6 @@
 		    ret = 1;
 		    continue;
 		}
-		/*
-		 * If the feature is already provided by the module, there's
-		 * nothing more to do.
-		 */
-		if (modenables[ptr-modfeatures])
-		    continue;
-		/*
-		 * Otherwise, marking it for autoload will do the
-		 * right thing when the feature is eventually used.
-		 */
 	    }
 	    if (!m->autoloads) {
 		m->autoloads = znewlinklist();
diff -ruN zsh-5.0.4/Src/options.c zsh-5.0.2/Src/options.c
--- zsh-5.0.4/Src/options.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/options.c	2012-11-09 13:53:44.000000000 -0800
@@ -131,7 +131,6 @@
 {{NULL, "extendedhistory",    OPT_CSH},			 EXTENDEDHISTORY},
 {{NULL, "evallineno",	      OPT_EMULATE|OPT_ZSH},	 EVALLINENO},
 {{NULL, "flowcontrol",	      OPT_ALL},			 FLOWCONTROL},
-{{NULL, "forcefloat",         0},                        FORCEFLOAT},
 {{NULL, "functionargzero",    OPT_EMULATE|OPT_NONBOURNE},FUNCTIONARGZERO},
 {{NULL, "glob",		      OPT_EMULATE|OPT_ALL},	 GLOBOPT},
 {{NULL, "globalexport",       OPT_EMULATE|OPT_ZSH},	 GLOBALEXPORT},
@@ -179,7 +178,6 @@
 {{NULL, "listrowsfirst",      0},			 LISTROWSFIRST},
 {{NULL, "listtypes",	      OPT_ALL},			 LISTTYPES},
 {{NULL, "localoptions",	      OPT_EMULATE|OPT_KSH},	 LOCALOPTIONS},
-{{NULL, "localpatterns",      OPT_EMULATE},		 LOCALPATTERNS},
 {{NULL, "localtraps",	      OPT_EMULATE|OPT_KSH},	 LOCALTRAPS},
 {{NULL, "login",	      OPT_SPECIAL},		 LOGINSHELL},
 {{NULL, "longlistjobs",	      0},			 LONGLISTJOBS},
@@ -205,7 +203,6 @@
 {{NULL, "overstrike",	      0},			 OVERSTRIKE},
 {{NULL, "pathdirs",	      OPT_EMULATE},		 PATHDIRS},
 {{NULL, "pathscript",	      OPT_EMULATE|OPT_BOURNE},	 PATHSCRIPT},
-{{NULL, "pipefail",           OPT_EMULATE},              PIPEFAIL},
 {{NULL, "posixaliases",       OPT_EMULATE|OPT_BOURNE},	 POSIXALIASES},
 {{NULL, "posixbuiltins",      OPT_EMULATE|OPT_BOURNE},	 POSIXBUILTINS},
 {{NULL, "posixcd",            OPT_EMULATE|OPT_BOURNE},	 POSIXCD},
diff -ruN zsh-5.0.4/Src/params.c zsh-5.0.2/Src/params.c
--- zsh-5.0.4/Src/params.c	2013-12-19 11:35:10.000000000 -0800
+++ zsh-5.0.2/Src/params.c	2012-08-19 12:46:43.000000000 -0700
@@ -97,7 +97,6 @@
      lastpid,		/* $!           */
      zterm_columns,	/* $COLUMNS     */
      zterm_lines,	/* $LINES       */
-     rprompt_indent,	/* $ZLE_RPROMPT_INDENT */
      ppid,		/* $PPID        */
      zsh_subshell;	/* $ZSH_SUBSHELL */
 /**/
@@ -317,10 +316,8 @@
 IPDEF4("ZSH_SUBSHELL", &zsh_subshell),
 
 #define IPDEF5(A,B,F) {{NULL,A,PM_INTEGER|PM_SPECIAL},BR((void *)B),GSU(F),10,0,NULL,NULL,NULL,0}
-#define IPDEF5U(A,B,F) {{NULL,A,PM_INTEGER|PM_SPECIAL|PM_UNSET},BR((void *)B),GSU(F),10,0,NULL,NULL,NULL,0}
 IPDEF5("COLUMNS", &zterm_columns, zlevar_gsu),
 IPDEF5("LINES", &zterm_lines, zlevar_gsu),
-IPDEF5U("ZLE_RPROMPT_INDENT", &rprompt_indent, zlevar_gsu),
 IPDEF5("OPTIND", &zoptind, varinteger_gsu),
 IPDEF5("SHLVL", &shlvl, varinteger_gsu),
 IPDEF5("TRY_BLOCK_ERROR", &try_errflag, varinteger_gsu),
@@ -4670,12 +4667,10 @@
 mod_export void
 endparamscope(void)
 {
-    queue_signals();
     locallevel--;
     /* This pops anything from a higher locallevel */
     saveandpophiststack(0, HFILE_USE_OPTIONS);
     scanhashtable(paramtab, 0, 0, 0, scanendscope, 0);
-    unqueue_signals();
 }
 
 /**/
diff -ruN zsh-5.0.4/Src/parse.c zsh-5.0.2/Src/parse.c
--- zsh-5.0.4/Src/parse.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/parse.c	2012-12-21 11:29:37.000000000 -0800
@@ -2088,17 +2088,9 @@
 	}
     }
     if (tok == BANG) {
-	/*
-	 * In "test" compatibility mode, "! -a ..." and "! -o ..."
-	 * are treated as "[string] [and] ..." and "[string] [or] ...".
-	 */
-	if (!(condlex == testlex && *testargs && 
-	      (!strcmp(*testargs, "-a") || !strcmp(*testargs, "-o"))))
-	{
-	    condlex();
-	    ecadd(WCB_COND(COND_NOT, 0));
-	    return par_cond_2();
-	}
+	condlex();
+	ecadd(WCB_COND(COND_NOT, 0));
+	return par_cond_2();
     }
     if (tok == INPAR) {
 	int r;
@@ -3179,9 +3171,6 @@
     d->dev = sbuf->st_dev;
     d->ino = sbuf->st_ino;
     d->fd = fd;
-#ifdef FD_CLOEXEC
-    fcntl(fd, F_SETFD, FD_CLOEXEC);
-#endif
     d->map = addr + (other ? (len - off) / sizeof(wordcode) : 0);
     d->addr = addr;
     d->len = len;
@@ -3426,16 +3415,6 @@
     f->count++;
 }
 
-/**/
-static void
-freedump(FuncDump f)
-{
-    munmap((void *) f->addr, f->len);
-    zclose(f->fd);
-    zsfree(f->filename);
-    zfree(f, sizeof(*f));
-}
-
 /* Decrement the reference counter for a dump file. If zero, unmap the file. */
 
 /**/
@@ -3452,23 +3431,23 @@
 		q->next = p->next;
 	    else
 		dumps = p->next;
-	    freedump(f);
+	    munmap((void *) f->addr, f->len);
+	    zclose(f->fd);
+	    zsfree(f->filename);
+	    zfree(f, sizeof(*f));
 	}
     }
 }
 
-#ifndef FD_CLOEXEC
 /**/
 mod_export void
 closedumps(void)
 {
-    while (dumps) {
-	FuncDump p = dumps->next;
-	freedump(dumps);
-	dumps = p;
-    }
+    FuncDump p;
+
+    for (p = dumps; p; p = p->next)
+	zclose(p->fd);
 }
-#endif
 
 #else
 
@@ -3482,13 +3461,11 @@
 {
 }
 
-#ifndef FD_CLOEXEC
 /**/
 mod_export void
 closedumps(void)
 {
 }
-#endif
 
 #endif
 
diff -ruN zsh-5.0.4/Src/patchlevel.h.release zsh-5.0.2/Src/patchlevel.h.release
--- zsh-5.0.4/Src/patchlevel.h.release	2013-12-20 10:30:02.000000000 -0800
+++ zsh-5.0.2/Src/patchlevel.h.release	1969-12-31 16:00:00.000000000 -0800
@@ -1 +0,0 @@
-#define ZSH_PATCHLEVEL "zsh-5.0.4-0-g58614f1"
diff -ruN zsh-5.0.4/Src/pattern.c zsh-5.0.2/Src/pattern.c
--- zsh-5.0.4/Src/pattern.c	2013-12-16 14:02:19.000000000 -0800
+++ zsh-5.0.2/Src/pattern.c	2010-01-21 12:35:42.000000000 -0800
@@ -225,50 +225,34 @@
 #endif
 
 /*
- * Array of characters corresponding to zpc_chars enum, which it must match.
+ * Characters which terminate a pattern segment.  We actually use
+ * a pointer patendseg which skips the first character if we are not
+ * parsing a file pattern.
+ * Note that the size of this and the next array are hard-wired
+ * via the definitions.
  */
-static const char zpc_chars[ZPC_COUNT] = {
-    '/', '\0', Bar, Outpar, Tilde, Inpar, Quest, Star, Inbrack, Inang,
-    Hat, Pound, Bnullkeep, Quest, Star, '+', '!', '@'
-};
 
-/*
- * Corresponding strings used in enable/disable -p.
- * NULL means no way of turning this on or off.
- */
-/**/
-mod_export const char *zpc_strings[ZPC_COUNT] = {
-   NULL, NULL, "|", NULL, "~", "(", "?", "*", "[", "<",
-   "^", "#", NULL, "?(", "*(", "+(", "!(", "@("
+static char endseg[] = {
+    '/',			/* file only */
+    '\0', Bar, Outpar,		/* all patterns */
+    Tilde			/* extended glob only */
 };
 
-/*
- * Corresponding array of pattern disables as set by the user
- * using "disable -p".
- */
-/**/
-mod_export char zpc_disables[ZPC_COUNT];
+#define PATENDSEGLEN_NORM 4
+#define PATENDSEGLEN_EXT  5
 
-/*
- * Stack of saved (compressed) zpc_disables for function scope.
- */
+/* Characters which terminate a simple string */
 
-static struct zpc_disables_save *zpc_disables_stack;
+static char endstr[] = {
+    '/',			/* file only */
+    '\0', Bar, Outpar, Quest, Star, Inbrack, Inpar, Inang, Bnullkeep,
+				/* all patterns */
+    Tilde, Hat, Pound		/* extended glob only */
+};
 
-/*
- * Characters which terminate a simple string (ZPC_COUNT) or
- * an entire pattern segment (the first ZPC_SEG_COUNT).
- * Each entry is either the corresponding character in zpc_chars
- * or Marker which is guaranteed not to match a character in a
- * pattern we are compiling.
- *
- * The complete list indicates characters that are special, so e.g.
- * (testchar == special[ZPC_TILDE]) succeeds only if testchar is a Tilde
- * *and* Tilde is currently special.
- */
+#define PATENDSTRLEN_NORM 10
+#define PATENDSTRLEN_EXT  13
 
-/**/
-char zpc_special[ZPC_COUNT];
 
 /* Default size for pattern buffer */
 #define P_DEF_ALLOC 256
@@ -280,6 +264,10 @@
 static long patsize;		/* size of code */
 static char *patout;		/* start of code emission string */
 static long patalloc;		/* size allocated for same */
+static char *patendseg;		/* characters ending segment */
+static int patendseglen;	/* length of same */
+static char *patendstr;		/* characters ending plain string */
+static int patendstrlen;	/* length of sameo */
 
 /* Flags used in both compilation and execution */
 static int patflags;		    /* flags passed down to patcompile */
@@ -429,68 +417,12 @@
 		    (P_OP(p) == P_BACK) ? \
 		    ((p)-rn_offs) : ((p)+rn_offs) : NULL)
 
-/*
- * Set up zpc_special with characters that end a string segment.
- * "Marker" cannot occur in the pattern we are compiling so
- * is used to mark "invalid".
- */
-static void
-patcompcharsset(void)
-{
-    char *spp, *disp;
-    int i;
-
-    /* Initialise enabled special characters */
-    memcpy(zpc_special, zpc_chars, ZPC_COUNT);
-    /* Apply user disables from disable -p */
-    for (i = 0, spp = zpc_special, disp = zpc_disables;
-	 i < ZPC_COUNT;
-	 i++, spp++, disp++) {
-	if (*disp)
-	    *spp = Marker;
-    }
-
-    if (!isset(EXTENDEDGLOB)) {
-	/* Extended glob characters are not active */
-	zpc_special[ZPC_TILDE] = zpc_special[ZPC_HAT] =
-	    zpc_special[ZPC_HASH] = Marker;
-    }
-    if (!isset(KSHGLOB)) {
-	/*
-	 * Ksh glob characters are not active.
-	 * * and ? are shared with normal globbing, but for their
-	 * use here we are looking for a following Inpar.
-	 */
-	zpc_special[ZPC_KSH_QUEST] = zpc_special[ZPC_KSH_STAR] =
-	    zpc_special[ZPC_KSH_PLUS] = zpc_special[ZPC_KSH_BANG] =
-	    zpc_special[ZPC_KSH_AT] = Marker;
-    }
-    /*
-     * Note that if we are using KSHGLOB, then we test for a following
-     * Inpar, not zpc_special[ZPC_INPAR]:  the latter makes an Inpar on
-     * its own active.  The zpc_special[ZPC_KSH_*] followed by any old Inpar
-     * discriminate ksh globbing.
-     */
-    if (isset(SHGLOB)) {
-	/*
-	 * Grouping and numeric ranges are not valid.
-	 * We do allow alternation, however; it's needed for
-	 * "case".  This may not be entirely consistent.
-	 *
-	 * Don't disable Outpar: we may need to match the end of KSHGLOB
-	 * parentheses and it would be difficult to tell them apart.
-	 */
-	zpc_special[ZPC_INPAR] = zpc_special[ZPC_INANG] = Marker;
-    }
-}
-
 /* Called before parsing a set of file matchs to initialize flags */
 
 /**/
 void
 patcompstart(void)
 {
-    patcompcharsset();
     if (isset(CASEGLOB))
 	patglobflags = 0;
     else
@@ -537,9 +469,16 @@
     patnpar = 1;
     patflags = inflags & ~(PAT_PURES|PAT_HAS_EXCLUDP);
 
+    patendseg = endseg;
+    patendseglen = isset(EXTENDEDGLOB) ? PATENDSEGLEN_EXT : PATENDSEGLEN_NORM;
+    patendstr = endstr;
+    patendstrlen = isset(EXTENDEDGLOB) ? PATENDSTRLEN_EXT : PATENDSTRLEN_NORM;
+
     if (!(patflags & PAT_FILE)) {
-	patcompcharsset();
-	zpc_special[ZPC_SLASH] = Marker;
+	patendseg++;
+	patendstr++;
+	patendseglen--;
+	patendstrlen--;
 	remnulargs(patparse);
 	if (isset(MULTIBYTE))
 	    patglobflags = GF_MULTIBYTE;
@@ -748,7 +687,7 @@
 	starter = 0;
 
     br = patnode(P_BRANCH);
-    if (!patcompbranch(&flags, paren))
+    if (!patcompbranch(&flags))
 	return 0;
     if (patglobflags != (int)savglobflags)
 	gfchanged++;
@@ -759,11 +698,11 @@
 
     *flagp |= flags & (P_HSTART|P_PURESTR);
 
-    while (*patparse == zpc_chars[ZPC_BAR] ||
-	   (*patparse == zpc_special[ZPC_TILDE] &&
+    while (*patparse == Bar ||
+	   (isset(EXTENDEDGLOB) && *patparse == Tilde &&
 	    (patparse[1] == '/' ||
-	     !memchr(zpc_special, patparse[1], ZPC_SEG_COUNT)))) {
-	int tilde = *patparse++ == zpc_special[ZPC_TILDE];
+	     !memchr(patendseg, patparse[1], patendseglen)))) {
+	int tilde = *patparse++ == Tilde;
 	long gfnode = 0, newbr;
 
 	*flagp &= ~P_PURESTR;
@@ -800,9 +739,12 @@
 	    up.p = NULL;
 	    patadd((char *)&up, 0, sizeof(up), 0);
 	    /* / is not treated as special if we are at top level */
-	    if (!paren && zpc_special[ZPC_SLASH] == '/') {
+	    if (!paren && *patendseg == '/') {
 		tilde++;
-		zpc_special[ZPC_SLASH] = Marker;
+		patendseg++;
+		patendseglen--;
+		patendstr++;
+		patendstrlen--;
 	    }
 	} else {
 	    excsync = 0;
@@ -839,10 +781,13 @@
 		patglobflags = (int)savglobflags;
 	    }
 	}
-	newbr = patcompbranch(&flags, paren);
+	newbr = patcompbranch(&flags);
 	if (tilde == 2) {
 	    /* restore special treatment of / */
-	    zpc_special[ZPC_SLASH] = '/';
+	    patendseg--;
+	    patendseglen++;
+	    patendstr--;
+	    patendstrlen++;
 	}
 	if (!newbr)
 	    return 0;
@@ -902,7 +847,7 @@
 
 /**/
 static long
-patcompbranch(int *flagp, int paren)
+patcompbranch(int *flagp)
 {
     long chain, latest = 0, starter;
     int flags = 0;
@@ -910,13 +855,14 @@
     *flagp = P_PURESTR;
 
     starter = chain = 0;
-    while (!memchr(zpc_special, *patparse, ZPC_SEG_COUNT) ||
-	   (*patparse == zpc_special[ZPC_TILDE] && patparse[1] != '/' &&
-	    memchr(zpc_special, patparse[1], ZPC_SEG_COUNT))) {
-	if ((*patparse == zpc_special[ZPC_INPAR] &&
-	     patparse[1] == zpc_special[ZPC_HASH]) ||
-	    (*patparse == zpc_special[ZPC_KSH_AT] && patparse[1] == Inpar &&
-	     patparse[2] == zpc_special[ZPC_HASH])) {
+    while (!memchr(patendseg, *patparse, patendseglen) ||
+	   (*patparse == Tilde && patparse[1] != '/' &&
+	    memchr(patendseg, patparse[1], patendseglen))) {
+	if (isset(EXTENDEDGLOB) &&
+	    ((!isset(SHGLOB) &&
+	      (*patparse == Inpar && patparse[1] == Pound)) ||
+	     (isset(KSHGLOB) && *patparse == '@' && patparse[1] == Inpar &&
+	      patparse[2] == Pound))) {
 	    /* Globbing flags. */
 	    char *pp1 = patparse;
 	    int oldglobflags = patglobflags, ignore;
@@ -964,7 +910,7 @@
 		break;
 	    else
 		continue;
-	} else if (*patparse == zpc_special[ZPC_HAT]) {
+	} else if (isset(EXTENDEDGLOB) && *patparse == Hat) {
 	    /*
 	     * ^pat:  anything but pat.  For proper backtracking,
 	     * etc., we turn this into (*~pat), except without the
@@ -973,7 +919,7 @@
 	    patparse++;
 	    latest = patcompnot(0, &flags);
 	} else
-	    latest = patcomppiece(&flags, paren);
+	    latest = patcomppiece(&flags);
 	if (!latest)
 	    return 0;
 	if (!starter)
@@ -1221,11 +1167,11 @@
 
 /**/
 static long
-patcomppiece(int *flagp, int paren)
+patcomppiece(int *flagp)
 {
     long starter = 0, next, op, opnd;
     int flags, flags2, kshchar, len, ch, patch, nmeta;
-    int hash, count;
+    int pound, count;
     union upat up;
     char *nptr, *str0, *ptr, *patprev;
     zrange_t from, to;
@@ -1239,45 +1185,25 @@
 	 * the string doesn't introduce a ksh-like parenthesized expression.
 	 */
 	kshchar = '\0';
-	if (*patparse && patparse[1] == Inpar) {
-	    if (*patparse == zpc_special[ZPC_KSH_PLUS])
-		kshchar = STOUC('+');
-	    else if (*patparse == zpc_special[ZPC_KSH_BANG])
-		kshchar = STOUC('!');
-	    else if (*patparse == zpc_special[ZPC_KSH_AT])
-		kshchar = STOUC('@');
-	    else if (*patparse == zpc_special[ZPC_KSH_STAR])
-		kshchar = STOUC('*');
-	    else if (*patparse == zpc_special[ZPC_KSH_QUEST])
-		kshchar = STOUC('?');
+	if (isset(KSHGLOB) && *patparse && patparse[1] == Inpar) {
+	    if (strchr("?*+!@", *patparse))
+		kshchar = STOUC(*patparse);
+	    else if (*patparse == Star || *patparse == Quest)
+		kshchar = STOUC(ztokens[*patparse - Pound]);
 	}
 
 	/*
-	 * If '(' is disabled as a pattern char, allow ')' as
-	 * an ordinary string character if there are no parentheses to
-	 * close.  Don't allow it otherwise, it changes the syntax.
+	 * End of string (or no string at all) if ksh-type parentheses,
+	 * or special character, unless that character is a tilde and
+	 * the character following is an end-of-segment character.  Thus
+	 * tildes are not special if there is nothing following to
+	 * be excluded.
 	 */
-	if (zpc_special[ZPC_INPAR] != Marker || *patparse != Outpar ||
-	    paren) {
-	    /*
-	     * End of string (or no string at all) if ksh-type parentheses,
-	     * or special character, unless that character is a tilde and
-	     * the character following is an end-of-segment character.  Thus
-	     * tildes are not special if there is nothing following to
-	     * be excluded.
-	     *
-	     * Don't look for X()-style kshglobs at this point; we've
-	     * checked above for the case with parentheses and we don't
-	     * want to match without parentheses.
-	     */
-	    if (kshchar ||
-		(memchr(zpc_special, *patparse, ZPC_NO_KSH_GLOB) &&
-		 (*patparse != zpc_special[ZPC_TILDE] ||
-		  patparse[1] == '/' ||
-		  !memchr(zpc_special, patparse[1], ZPC_SEG_COUNT)))) {
-		break;
-	    }
-    	}
+	if (kshchar || (memchr(patendstr, *patparse, patendstrlen) &&
+			(*patparse != Tilde ||
+			 patparse[1] == '/' ||
+			 !memchr(patendseg, patparse[1], patendseglen))))
+	    break;
 
 	/* Remember the previous character for backtracking */
 	patprev = patparse;
@@ -1301,14 +1227,10 @@
 	 * If we have more than one character, a following hash
 	 * or (#c...) only applies to the last, so backtrack one character.
 	 */
-	if ((*patparse == zpc_special[ZPC_HASH] ||
-	     (*patparse == zpc_special[ZPC_INPAR] &&
-	      patparse[1] == zpc_special[ZPC_HASH] &&
-	      patparse[2] == 'c') ||
-	     (*patparse == zpc_special[ZPC_KSH_AT] &&
-	      patparse[1] == Inpar &&
-	      patparse[2] == zpc_special[ZPC_HASH] &&
-	      patparse[3] == 'c')) && morelen)
+	if (isset(EXTENDEDGLOB) &&
+	    (*patparse == Pound ||
+	     (*patparse == Inpar && patparse[1] == Pound &&
+	      patparse[2] == 'c')) && morelen)
 	    patparse = patprev;
 	/*
 	 * If len is 1, we can't have an active # following, so doesn't
@@ -1384,21 +1306,15 @@
 	METACHARINC(patparse);
 	switch(patch) {
 	case Quest:
-	    DPUTS(zpc_special[ZPC_QUEST] == Marker,
-		  "Treating '?' as pattern character although disabled");
 	    flags |= P_SIMPLE;
 	    starter = patnode(P_ANY);
 	    break;
 	case Star:
-	    DPUTS(zpc_special[ZPC_STAR] == Marker,
-		  "Treating '*' as pattern character although disabled");
 	    /* kshchar is used as a sign that we can't have #'s. */
 	    kshchar = -1;
 	    starter = patnode(P_STAR);
 	    break;
 	case Inbrack:
-	    DPUTS(zpc_special[ZPC_INBRACK] == Marker,
-		  "Treating '[' as pattern character although disabled");
 	    flags |= P_SIMPLE;
 	    if (*patparse == Hat || *patparse == '^' || *patparse == '!') {
 		patparse++;
@@ -1452,10 +1368,9 @@
 	    patadd(NULL, 0, 1, 0);
 	    break;
 	case Inpar:
-	    DPUTS(!kshchar && zpc_special[ZPC_INPAR] == Marker,
-		  "Treating '(' as pattern character although disabled");
-	    DPUTS(isset(SHGLOB) && !kshchar,
-		  "Treating bare '(' as pattern character with SHGLOB");
+	    /* is this how to treat parentheses in SHGLOB? */
+	    if (isset(SHGLOB) && !kshchar)
+		return 0;
 	    if (kshchar == '!') {
 		/* This is nasty, we should really either handle all
 		 * kshglobbing below or here.  But most of the
@@ -1478,9 +1393,6 @@
 	    break;
 	case Inang:
 	    /* Numeric glob */
-	    DPUTS(zpc_special[ZPC_INANG] == Marker,
-		  "Treating '<' as pattern character although disabled");
-	    DPUTS(isset(SHGLOB), "Treating <..> as numeric range with SHGLOB");
 	    len = 0;		/* beginning present 1, end present 2 */
 	    if (idigit(*patparse)) {
 		from = (zrange_t) zstrtol((char *)patparse,
@@ -1523,8 +1435,6 @@
 	     */
 	    break;
 	case Pound:
-	    DPUTS(zpc_special[ZPC_HASH] == Marker,
-		  "Treating '#' as pattern character although disabled");
 	    DPUTS(!isset(EXTENDEDGLOB), "BUG: # not treated as string");
 	    /*
 	     * A hash here is an error; it should follow something
@@ -1537,7 +1447,7 @@
 	     * Marker for restoring a backslash in output:
 	     * does not match a character.
 	     */
-	    next = patcomppiece(flagp, paren);
+	    next = patcomppiece(flagp);
 	    /*
 	     * Can't match a pure string since we need to do this
 	     * as multiple chunks.
@@ -1555,21 +1465,16 @@
     }
 
     count = 0;
-    if (!(hash = (*patparse == zpc_special[ZPC_HASH])) &&
-	!(count = ((*patparse == zpc_special[ZPC_INPAR] &&
-		    patparse[1] == zpc_special[ZPC_HASH] &&
-		    patparse[2] == 'c') ||
-		   (*patparse == zpc_special[ZPC_KSH_AT] &&
-		    patparse[1] == Inpar &&
-		    patparse[2] == zpc_special[ZPC_HASH] &&
-		    patparse[3] == 'c'))) &&
+    if (!(pound = (*patparse == Pound && isset(EXTENDEDGLOB))) &&
+	!(count = (isset(EXTENDEDGLOB) && *patparse == Inpar &&
+		   patparse[1] == Pound && patparse[2] == 'c')) &&
 	(kshchar <= 0 || kshchar == '@' || kshchar == '!')) {
 	*flagp = flags;
 	return starter;
     }
 
     /* too much at once doesn't currently work */
-    if (kshchar && (hash || count))
+    if (kshchar && pound)
 	return 0;
 
     if (kshchar == '*') {
@@ -1585,7 +1490,7 @@
 	op = P_COUNT;
 	patparse += 3;
 	*flagp = P_HSTART;
-    } else if (*++patparse == zpc_special[ZPC_HASH]) {
+    } else if (*++patparse == Pound) {
 	op = P_TWOHASH;
 	patparse++;
 	*flagp = P_HSTART;
@@ -1695,7 +1600,7 @@
 	pattail(starter, next);
 	patoptail(starter, next);
     }
-    if (*patparse == zpc_special[ZPC_HASH])
+    if (*patparse == Pound)
 	return 0;
 
     return starter;
@@ -1724,7 +1629,7 @@
     pattail(starter, excl = patnode(P_EXCLUDE));
     up.p = NULL;
     patadd((char *)&up, 0, sizeof(up), 0);
-    if (!(br = (paren ? patcompswitch(1, &dummy) : patcompbranch(&dummy, 0))))
+    if (!(br = (paren ? patcompswitch(1, &dummy) : patcompbranch(&dummy))))
 	return 0;
     pattail(br, patnode(P_EXCEND));
     n = patnode(P_NOTHING); /* just so much easier */
@@ -3848,212 +3753,3 @@
     if (prog && prog != dummy_patprog1 && prog != dummy_patprog2)
 	zfree(prog, prog->size);
 }
-
-/* Disable or reenable a pattern character */
-
-/**/
-int
-pat_enables(const char *cmd, char **patp, int enable)
-{
-    int ret = 0;
-    const char **stringp;
-    char *disp;
-
-    if (!*patp) {
-	int done = 0;
-	for (stringp = zpc_strings, disp = zpc_disables;
-	     stringp < zpc_strings + ZPC_COUNT;
-	     stringp++, disp++) {
-	    if (!*stringp)
-		continue;
-	    if (enable ? *disp : !*disp)
-		continue;
-	    if (done)
-		putc(' ', stdout);
-	    printf("'%s'", *stringp);
-	    done = 1;
-	}
-	if (done)
-	    putc('\n', stdout);
-	return 0;
-    }
-
-    for (; *patp; patp++) {
-	for (stringp = zpc_strings, disp = zpc_disables;
-	     stringp < zpc_strings + ZPC_COUNT;
-	     stringp++, disp++) {
-	    if (*stringp && !strcmp(*stringp, *patp)) {
-		*disp = (char)!enable;
-		break;
-	    }
-	}
-	if (stringp == zpc_strings + ZPC_COUNT) {
-	    zerrnam(cmd, "invalid pattern: %s", *patp);
-	    ret = 1;
-	}
-    }
-
-    return ret;
-}
-
-/*
- * Save the current state of pattern disables, returning the saved value.
- */
-
-/**/
-unsigned int
-savepatterndisables(void)
-{
-    unsigned int disables, bit;
-    char *disp;
-
-    disables = 0;
-    for (bit = 1, disp = zpc_disables;
-	 disp < zpc_disables + ZPC_COUNT;
-	 bit <<= 1, disp++) {
-	if (*disp)
-	    disables |= bit;
-    }
-    return disables;
-}
-
-/*
- * Function scope saving pattern enables.
- */
-
-/**/
-void
-startpatternscope(void)
-{
-    Zpc_disables_save newdis;
-
-    newdis = (Zpc_disables_save)zalloc(sizeof(*newdis));
-    newdis->next = zpc_disables_stack;
-    newdis->disables = savepatterndisables();
-
-    zpc_disables_stack = newdis;
-}
-
-/*
- * Restore completely the state of pattern disables.
- */
-
-/**/
-void
-restorepatterndisables(unsigned int disables)
-{
-    char *disp;
-    unsigned int bit;
-
-    for (bit = 1, disp = zpc_disables;
-	 disp < zpc_disables + ZPC_COUNT;
-	 bit <<= 1, disp++) {
-	if (disables & bit)
-	    *disp = 1;
-	else
-	    *disp = 0;
-    }
-}
-
-/*
- * Function scope to restore pattern enables if localpatterns is turned on.
- */
-
-/**/
-void
-endpatternscope(void)
-{
-    Zpc_disables_save olddis;
-
-    olddis = zpc_disables_stack;
-    zpc_disables_stack = olddis->next;
-
-    if (isset(LOCALPATTERNS))
-	restorepatterndisables(olddis->disables);
-
-    zfree(olddis, sizeof(*olddis));
-}
-
-/* Reinitialise pattern disables */
-
-/**/
-void
-clearpatterndisables(void)
-{
-    memset(zpc_disables, 0, ZPC_COUNT);
-}
-
-
-/* Check to see if str is eligible for filename generation. */
-
-/**/
-mod_export int
-haswilds(char *str)
-{
-    char *start;
-
-    /* `[' and `]' are legal even if bad patterns are usually not. */
-    if ((*str == Inbrack || *str == Outbrack) && !str[1])
-	return 0;
-
-    /* If % is immediately followed by ?, then that ? is     *
-     * not treated as a wildcard.  This is so you don't have *
-     * to escape job references such as %?foo.               */
-    if (str[0] == '%' && str[1] == Quest)
-	str[1] = '?';
-
-    /*
-     * Note that at this point zpc_special has not been set up.
-     */
-    start = str;
-    for (; *str; str++) {
-	switch (*str) {
-	    case Inpar:
-		if ((!isset(SHGLOB) && !zpc_disables[ZPC_INPAR]) ||
-		    (str > start && isset(KSHGLOB) &&
-		     ((str[-1] == Quest && !zpc_disables[ZPC_KSH_QUEST]) ||
-		      (str[-1] == Star && !zpc_disables[ZPC_KSH_STAR]) ||
-		      (str[-1] == '+' && !zpc_disables[ZPC_KSH_PLUS]) ||
-		      (str[-1] == '!' && !zpc_disables[ZPC_KSH_BANG]) ||
-		      (str[-1] == '@' && !zpc_disables[ZPC_KSH_AT]))))
-		    return 1;
-		break;
-
-	    case Bar:
-		if (!zpc_disables[ZPC_BAR])
-		    return 1;
-		break;
-
-	    case Star:
-		if (!zpc_disables[ZPC_STAR])
-		    return 1;
-		break;
-
-	    case Inbrack:
-		if (!zpc_disables[ZPC_INBRACK])
-		    return 1;
-		break;
-
-	    case Inang:
-		if (!zpc_disables[ZPC_INANG])
-		    return 1;
-		break;
-
-	    case Quest:
-		if (!zpc_disables[ZPC_QUEST])
-		    return 1;
-		break;
-
-	    case Pound:
-		if (isset(EXTENDEDGLOB) && !zpc_disables[ZPC_HASH])
-		    return 1;
-		break;
-
-	    case Hat:
-		if (isset(EXTENDEDGLOB) && !zpc_disables[ZPC_HAT])
-		    return 1;
-		break;
-	}
-    }
-    return 0;
-}
diff -ruN zsh-5.0.4/Src/prompt.c zsh-5.0.2/Src/prompt.c
--- zsh-5.0.4/Src/prompt.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/prompt.c	2012-03-06 12:04:45.000000000 -0800
@@ -232,33 +232,6 @@
     return new_vars.buf;
 }
 
-/* Parse the argument for %F and %K */
-static int
-parsecolorchar(int arg, int is_fg)
-{
-    if (bv->fm[1] == '{') {
-	char *ep;
-	bv->fm += 2; /* skip over F{ */
-	if ((ep = strchr(bv->fm, '}'))) {
-	    char oc = *ep, *col, *coll;
-	    *ep = '\0';
-	    /* expand the contents of the argument so you can use
-	     * %v for example */
-	    coll = col = promptexpand(bv->fm, 0, NULL, NULL, NULL);
-	    *ep = oc;
-	    arg = match_colour((const char **)&coll, is_fg, 0);
-	    free(col);
-	    bv->fm = ep;
-	} else {
-	    arg = match_colour((const char **)&bv->fm, is_fg, 0);
-	    if (*bv->fm != '}')
-		bv->fm--;
-	}
-    } else
-	arg = match_colour(NULL, 1, arg);
-    return arg;
-}
-
 /* Perform %- and !-expansion as required on a section of the prompt.  The *
  * section is ended by an instance of endchar.  If doprint is 0, the valid *
  * % sequences are merely skipped over, and nothing is stored.             */
@@ -521,7 +494,13 @@
 		tsetcap(TCUNDERLINEEND, TSC_PROMPT|TSC_DIRTY);
 		break;
 	    case 'F':
-		arg = parsecolorchar(arg, 1);
+		if (bv->fm[1] == '{') {
+		    bv->fm += 2;
+		    arg = match_colour((const char **)&bv->fm, 1, 0);
+		    if (*bv->fm != '}')
+			bv->fm--;
+		} else
+		    arg = match_colour(NULL, 1, arg);
 		if (arg >= 0 && !(arg & TXTNOFGCOLOUR)) {
 		    txtchangeset(txtchangep, arg & TXT_ATTR_FG_ON_MASK,
 				 TXTNOFGCOLOUR);
@@ -536,7 +515,13 @@
 		set_colour_attribute(TXTNOFGCOLOUR, COL_SEQ_FG, TSC_PROMPT);
 		break;
 	    case 'K':
-		arg = parsecolorchar(arg, 0);
+		if (bv->fm[1] == '{') {
+		    bv->fm += 2;
+		    arg = match_colour((const char **)&bv->fm, 0, 0);
+		    if (*bv->fm != '}')
+			bv->fm--;
+		} else
+		    arg = match_colour(NULL, 0, arg);
 		if (arg >= 0 && !(arg & TXTNOBGCOLOUR)) {
 		    txtchangeset(txtchangep, arg & TXT_ATTR_BG_ON_MASK,
 				 TXTNOBGCOLOUR);
diff -ruN zsh-5.0.4/Src/signals.c zsh-5.0.2/Src/signals.c
--- zsh-5.0.4/Src/signals.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/signals.c	2012-10-25 02:56:36.000000000 -0700
@@ -185,7 +185,7 @@
  * only the given signal           */
  
 /**/
-mod_export sigset_t
+sigset_t
 signal_mask(int sig)
 {
     sigset_t set;
@@ -202,8 +202,7 @@
 /**/
 #ifndef BSD_SIGNALS
 
-/**/
-mod_export sigset_t
+sigset_t
 signal_block(sigset_t set)
 {
     sigset_t oset;
@@ -246,8 +245,7 @@
 /* Unblock the signals in the given signal *
  * set. Return the old signal set.         */
 
-/**/
-mod_export sigset_t
+sigset_t
 signal_unblock(sigset_t set)
 {
     sigset_t oset;
diff -ruN zsh-5.0.4/Src/signals.h zsh-5.0.2/Src/signals.h
--- zsh-5.0.4/Src/signals.h	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/signals.h	2007-05-01 13:25:00.000000000 -0700
@@ -59,14 +59,6 @@
 #define child_block()      signal_block(sigchld_mask)
 #define child_unblock()    signal_unblock(sigchld_mask)
 
-#ifdef SIGWINCH
-# define winch_block()      signal_block(signal_mask(SIGWINCH))
-# define winch_unblock()    signal_unblock(signal_mask(SIGWINCH))
-#else
-# define winch_block()      0
-# define winch_unblock()    0
-#endif
-
 /* ignore a signal */
 #define signal_ignore(S)   signal(S, SIG_IGN)
 
diff -ruN zsh-5.0.4/Src/subst.c zsh-5.0.2/Src/subst.c
--- zsh-5.0.4/Src/subst.c	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/subst.c	2012-10-05 13:23:42.000000000 -0700
@@ -2941,14 +2941,6 @@
 		}
 	    }
 	}
-	if (vunset) {
-	    if (unset(UNSET)) {
-		*idend = '\0';
-		zerr("%s: parameter not set", idbeg);
-		return NULL;
-	    }
-	    val = dupstring("");
-	}
     } else {			/* no ${...=...} or anything, but possible modifiers. */
 	/*
 	 * Handler ${+...}.  TODO: strange, why do we handle this only
@@ -3715,11 +3707,6 @@
 	char *y;
 
 	x = val;
-	if (!x) {
-	    /* Shouldn't have got here with a NULL string. */
-	    DPUTS(1, "value is NULL in paramsubst");
-	    return NULL;
-	}
 	if (prenum || postnum)
 	    x = dopadding(x, prenum, postnum, preone, postone,
 			  premul, postmul
@@ -4034,10 +4021,7 @@
 		    all = tmp;
 		    t = e;
 		}
-		if (!all)
-		    *str = dupstring("");
-		else
-		    *str = all;
+		*str = all;
 
 	    } else {
 		switch (c) {
diff -ruN zsh-5.0.4/Src/utils.c zsh-5.0.2/Src/utils.c
--- zsh-5.0.4/Src/utils.c	2013-11-29 15:28:25.000000000 -0800
+++ zsh-5.0.2/Src/utils.c	2012-12-16 10:42:36.000000000 -0800
@@ -1287,17 +1287,9 @@
 preprompt(void)
 {
     static time_t lastperiodic;
-    time_t currentmailcheck;
     LinkNode ln;
-    zlong period = getiparam("PERIOD");
-    zlong mailcheck = getiparam("MAILCHECK");
-
-    /*
-     * Handle any pending window size changes before we compute prompts,
-     * then block them again to avoid interrupts during prompt display.
-     */
-    winch_unblock();
-    winch_block();
+    int period = getiparam("PERIOD");
+    int mailcheck = getiparam("MAILCHECK");
 
     if (isset(PROMPTSP) && isset(PROMPTCR) && !use_exit_printed && shout) {
 	/* The PROMPT_SP heuristic will move the prompt down to a new line
@@ -1338,7 +1330,7 @@
     /* If 1) the parameter PERIOD exists, 2) a hook function for    *
      * "periodic" exists, 3) it's been greater than PERIOD since we *
      * executed any such hook, then execute it now.                 */
-    if (period && ((zlong)time(NULL) > (zlong)lastperiodic + period) &&
+    if (period && (time(NULL) > lastperiodic + period) &&
 	!callhookfunc("periodic", NULL, 1, NULL))
 	lastperiodic = time(NULL);
     if (errflag)
@@ -1356,9 +1348,7 @@
 	return;
 
     /* Check mail */
-    currentmailcheck = time(NULL);
-    if (mailcheck &&
-	(zlong) difftime(currentmailcheck, lastmailcheck) > mailcheck) {
+    if (mailcheck && (int) difftime(time(NULL), lastmailcheck) > mailcheck) {
 	char *mailfile;
 
 	if (mailpath && *mailpath && **mailpath)
@@ -1374,7 +1364,7 @@
 	    }
 	    unqueue_signals();
 	}
-	lastmailcheck = currentmailcheck;
+	lastmailcheck = time(NULL);
     }
 
     if (prepromptfns) {
@@ -1434,7 +1424,7 @@
 	    }
 	} else if (shout) {
 	    if (st.st_size && st.st_atime <= st.st_mtime &&
-		st.st_mtime >= lastmailcheck) {
+		st.st_mtime > lastmailcheck) {
 		if (!u) {
 		    fprintf(shout, "You have new mail.\n");
 		    fflush(shout);
@@ -2299,8 +2289,6 @@
 	sleep(10);
 	fputc('\n', shout);
     }
-    if (errflag)
-      return 0;
     fputs(" [yn]? ", shout);
     fflush(shout);
     zbeep();
@@ -3985,7 +3973,7 @@
 	    if (imeta(*e++))
 		meta++;
 
-    if (meta || heap == META_DUP || heap == META_HEAPDUP) {
+    if (meta || heap == META_DUP || heap == META_HEAPDUP || *e != '\0') {
 	switch (heap) {
 	case META_REALLOC:
 	    buf = zrealloc(buf, len + meta + 1);
@@ -4028,8 +4016,8 @@
 		meta--;
 	    }
 	}
+	*e = '\0';
     }
-    *e = '\0';
     return buf;
 }
 
diff -ruN zsh-5.0.4/Src/zsh.h zsh-5.0.2/Src/zsh.h
--- zsh-5.0.4/Src/zsh.h	2013-12-16 14:00:12.000000000 -0800
+++ zsh-5.0.2/Src/zsh.h	2012-11-09 13:52:13.000000000 -0800
@@ -179,11 +179,7 @@
  * Take care to update the use of IMETA appropriately when adding
  * tokens here.
  */
-/*
- * Marker used in paramsubst for rc_expand_param.
- * Also used in pattern character arrays as guaranteed not to
- * mark a character in a string.
- */
+/* Marker used in paramsubst for rc_expand_param */
 #define Marker		((char) 0xa0)
 
 /* chars that need to be quoted if meant literally */
@@ -374,8 +370,9 @@
 #ifdef PATH_DEV_FD
 /*
  * Entry used by a process substition.
- * This marker is not tested internally as we associated the file
- * descriptor with a job for closing.
+ * The value will be incremented on entering a function and
+ * decremented on exit; we don't close entries greater than
+ * FDT_PROC_SUBST except when closing everything.
  */
 #define FDT_PROC_SUBST		6
 #endif
@@ -421,7 +418,6 @@
 typedef struct heapstack *Heapstack;
 typedef struct histent   *Histent;
 typedef struct hookdef   *Hookdef;
-typedef struct jobfile   *Jobfile;
 typedef struct job       *Job;
 typedef struct linkedmod *Linkedmod;
 typedef struct linknode  *LinkNode;
@@ -878,18 +874,6 @@
 /* Definitions for job table and job control */
 /********************************************/
 
-/* Entry in filelist linked list in job table */
-
-struct jobfile {
-    /* Record to be deleted or closed */
-    union {
-	char *name; /* Name of file to delete */
-	int fd;	    /* File descriptor to close */
-    } u;
-    /* Discriminant */
-    int is_fd;
-};
-
 /* entry in the job table */
 
 struct job {
@@ -901,7 +885,6 @@
     struct process *procs;	/* list of processes                 */
     struct process *auxprocs;	/* auxiliary processes e.g multios   */
     LinkList filelist;		/* list of files to delete when done */
-				/* elements are struct jobfile */
     int stty_in_env;		/* if STTY=... is present            */
     struct ttyinfo *ty;		/* the modes specified by STTY       */
 };
@@ -977,6 +960,7 @@
     int trapisfunc;
     int traplocallevel;
     int noerrs;
+    int subsh_close;
     char *underscore;
 };
 
@@ -1391,59 +1375,6 @@
 #define PAT_HAS_EXCLUDP	0x0800	/* (internal): top-level path1~path2. */
 #define PAT_LCMATCHUC   0x1000  /* equivalent to setting (#l) */
 
-/**
- * Indexes into the array of active pattern characters.
- * This must match the array zpc_chars in pattern.c.
- */
-enum zpc_chars {
-    /*
-     * These characters both terminate a pattern segment and
-     * a pure string segment.
-     */
-    ZPC_SLASH,			/* / active as file separator */
-    ZPC_NULL,			/* \0 as string terminator */
-    ZPC_BAR,			/* | for "or" */
-    ZPC_OUTPAR,			/* ) for grouping */
-    ZPC_TILDE,			/* ~ for exclusion (extended glob) */
-    ZPC_SEG_COUNT,              /* No. of the above characters */
-    /*
-     * These characters terminate a pure string segment.
-     */
-    ZPC_INPAR = ZPC_SEG_COUNT,  /* ( for grouping */
-    ZPC_QUEST,			/* ? as wildcard */
-    ZPC_STAR,			/* * as wildcard */
-    ZPC_INBRACK,		/* [ for character class */
-    ZPC_INANG,			/* < for numeric glob */
-    ZPC_HAT,			/* ^ for exclusion (extended glob) */
-    ZPC_HASH,			/* # for repetition (extended glob) */
-    ZPC_BNULLKEEP,		/* Special backslashed null not removed */
-    /*
-     * These characters are only valid before a parenthesis
-     */
-    ZPC_NO_KSH_GLOB,
-    ZPC_KSH_QUEST = ZPC_NO_KSH_GLOB, /* ? for ?(...) in KSH_GLOB */
-    ZPC_KSH_STAR,               /* * for *(...) in KSH_GLOB */
-    ZPC_KSH_PLUS,               /* + for +(...) in KSH_GLOB */
-    ZPC_KSH_BANG,               /* ! for !(...) in KSH_GLOB */
-    ZPC_KSH_AT,                 /* @ for @(...) in KSH_GLOB */
-    ZPC_COUNT			/* Number of special chararacters */
-};
-
-/*
- * Structure to save disables special characters for function scope.
- */
-struct zpc_disables_save {
-    struct zpc_disables_save *next;
-    /*
-     * Bit vector of ZPC_COUNT disabled characters.
-     * We'll live dangerously and assumed ZPC_COUNT is no greater
-     * than the number of bits an an unsigned int.
-     */
-    unsigned int disables;
-};
-
-typedef struct zpc_disables_save *Zpc_disables_save;
-
 /*
  * Special match types used in character classes.  These
  * are represented as tokens, with Meta added.  The character
@@ -1898,7 +1829,6 @@
 #define HIST_DUP	0x00000008	/* Command duplicates a later line */
 #define HIST_FOREIGN	0x00000010	/* Command came from another shell */
 #define HIST_TMPSTORE	0x00000020	/* Kill when user enters another cmd */
-#define HIST_NOWRITE	0x00000040	/* Keep internally but don't write */
 
 #define GETHIST_UPWARD  (-1)
 #define GETHIST_DOWNWARD  1
@@ -2058,7 +1988,6 @@
     EXTENDEDHISTORY,
     EVALLINENO,
     FLOWCONTROL,
-    FORCEFLOAT,
     FUNCTIONARGZERO,
     GLOBOPT,
     GLOBALEXPORT,
@@ -2106,7 +2035,6 @@
     LISTROWSFIRST,
     LISTTYPES,
     LOCALOPTIONS,
-    LOCALPATTERNS,
     LOCALTRAPS,
     LOGINSHELL,
     LONGLISTJOBS,
@@ -2126,7 +2054,6 @@
     OVERSTRIKE,
     PATHDIRS,
     PATHSCRIPT,
-    PIPEFAIL,
     POSIXALIASES,
     POSIXBUILTINS,
     POSIXCD,
@@ -2762,8 +2689,7 @@
     ZLE_CMD_RESET_PROMPT,
     ZLE_CMD_REFRESH,
     ZLE_CMD_SET_KEYMAP,
-    ZLE_CMD_GET_KEY,
-    ZLE_CMD_SET_HIST_LINE
+    ZLE_CMD_GET_KEY
 };
 
 /***************************************/
diff -ruN zsh-5.0.4/Src/zsh.mdd zsh-5.0.2/Src/zsh.mdd
--- zsh-5.0.4/Src/zsh.mdd	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/zsh.mdd	2011-05-13 11:07:35.000000000 -0700
@@ -39,14 +39,10 @@
 version.h: $(sdir_top)/Config/version.mk zshcurses.h zshterm.h
 	echo '#define ZSH_VERSION "'$(VERSION)'"' > $@
 
-patchlevel.h: FORCE
-	@if [ -f $(sdir)/$@.release ]; then \
-	  cp -f $(sdir)/$@.release $@; \
-	else \
-	  echo '#define ZSH_PATCHLEVEL "'`cd $(sdir) && git describe --tags --long`'"' > $@.tmp; \
-	  cmp $@ $@.tmp 2>/dev/null && rm -f $@.tmp || mv $@.tmp $@; \
-	fi
-FORCE:
+patchlevel.h: $(sdir_top)/ChangeLog
+	sed -ne \
+	's/^\* *\$$''Revision: \(.*\) ''\$$/#define ZSH_PATCHLEVEL "\1"/p' \
+	$(sdir_top)/ChangeLog >patchlevel.h
 
 zshcurses.h: ../config.h
 	@if test x$(ZSH_CURSES_H) != x; then \
diff -ruN zsh-5.0.4/Src/zsh_system.h zsh-5.0.2/Src/zsh_system.h
--- zsh-5.0.4/Src/zsh_system.h	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Src/zsh_system.h	2012-08-16 12:10:31.000000000 -0700
@@ -773,7 +773,7 @@
 # define IS_DIRSEP(c) ((c) == '/')
 #endif
 
-#if defined(__GNUC__) && (!defined(__APPLE__) || defined(__clang__))
+#if defined(__GNUC__) && !defined(__APPLE__)
 /* Does the OS X port of gcc still gag on __attribute__? */
 #define UNUSED(x) x __attribute__((__unused__))
 #else
diff -ruN zsh-5.0.4/StartupFiles/zshrc zsh-5.0.2/StartupFiles/zshrc
--- zsh-5.0.4/StartupFiles/zshrc	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/StartupFiles/zshrc	2008-07-11 12:15:41.000000000 -0700
@@ -75,7 +75,7 @@
 # Some environment variables
 export MAIL=/var/spool/mail/$USERNAME
 export LESS=-cex3M
-export HELPDIR=/usr/share/zsh/$ZSH_VERSION/help  # directory for run-help function to find docs
+export HELPDIR=/usr/local/lib/zsh/help  # directory for run-help function to find docs
 
 MAILCHECK=300
 HISTSIZE=200
diff -ruN zsh-5.0.4/Test/.distfiles zsh-5.0.2/Test/.distfiles
--- zsh-5.0.4/Test/.distfiles	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/.distfiles	2012-02-19 11:30:13.000000000 -0800
@@ -40,8 +40,6 @@
 V05styles.ztst
 V06parameter.ztst
 V07pcre.ztst
-V08zpty.ztst
-X02zlevi.ztst
 Y01completion.ztst
 Y02compmatch.ztst
 Y03arguments.ztst
diff -ruN zsh-5.0.4/Test/A04redirect.ztst zsh-5.0.2/Test/A04redirect.ztst
--- zsh-5.0.4/Test/A04redirect.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/A04redirect.ztst	2012-11-09 14:01:00.000000000 -0800
@@ -328,17 +328,6 @@
 1q:NO_CLOBBER prevents overwriting parameter with allocated fd
 ?(eval):4: can't clobber parameter myfd containing file descriptor $myfd
 
-  (setopt noclobber
-   exec {myfd}>logfile2b
-   print First open >&$myfd
-   rm -f logfile2b # prevent normal file no_clobberation
-   myotherfd="${myfd}+0"
-   exec {myotherfd}>logfile2b
-   print Overwritten >&$myotherfd)
-   cat logfile2b
-0:NO_CLOBBER doesn't complain about any other expression
->Overwritten
-
   (exec {myfd}>logfile4
   echo $myfd
   exec {myfd}>&-
diff -ruN zsh-5.0.4/Test/A05execution.ztst zsh-5.0.2/Test/A05execution.ztst
--- zsh-5.0.4/Test/A05execution.ztst	2013-12-03 11:59:59.000000000 -0800
+++ zsh-5.0.2/Test/A05execution.ztst	2010-12-05 08:45:21.000000000 -0800
@@ -178,27 +178,3 @@
   kill $!
 0:Status reset by starting a backgrounded command
 >0
-
-  { setopt MONITOR } 2>/dev/null
-  [[ -o MONITOR ]] || print -u $ZTST_fd 'Unable to change MONITOR option'
-  repeat 2048; do (return 2 |
-                   return 1 |
-                   while true; do
-                             false
-                             break
-                           done;
-                   print "${pipestatus[@]}")
-	ZTST_hashmark
-  done | sort | uniq -c | sed 's/^ *//'
-0:Check whether `$pipestatus[]' behaves.
->2048 2 1 0
-F:This test checks for a bug in `$pipestatus[]' handling.  If it breaks then
-F:the bug is still there or it reappeared. See workers-29973 for details.
-
-  { setopt MONITOR } 2>/dev/null
-  externFunc() { awk >/dev/null 2>&1; true; }
-  false | true | false | true | externFunc
-  echo $pipestatus
-0:Check $pipestatus with a known difficult case
->1 0 1 0 0
-F:This similar test was triggering a reproducible failure with pipestatus.
diff -ruN zsh-5.0.4/Test/C01arith.ztst zsh-5.0.2/Test/C01arith.ztst
--- zsh-5.0.4/Test/C01arith.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/C01arith.ztst	2012-12-11 13:22:49.000000000 -0800
@@ -134,11 +134,11 @@
 
   print $(( a = ))
 1:empty assignment
-?(eval):1: bad math expression: operand expected at end of string
+?(eval):1: bad math expression: operand expected at `'
 
   print $(( 3, ))
 1:empty right hand of comma
-?(eval):1: bad math expression: operand expected at end of string
+?(eval):1: bad math expression: operand expected at `'
 
   print $(( 3,,4 ))
 1:empty middle of comma
@@ -243,26 +243,3 @@
 >6000000
 >5000
 >255
-
-  # Force floating point.
-  for expr in "3/4" "0x100/0x200" "0x30/0x10"; do
-    print $(( $expr ))
-    setopt force_float
-    print $(( $expr ))
-    unsetopt force_float
-  done
-0:Forcing floating point constant evaluation, or not.
->0
->0.75
->0
->0.5
->3
->3.
-
-  print $(( 0x30 + 0.5 ))
-  print $(( 077 + 0.5 ))
-  (setopt octalzeroes; print $(( 077 + 0.5 )) )
-0:Mixed float and non-decimal integer constants
->48.5
->77.5
->63.5
diff -ruN zsh-5.0.4/Test/C02cond.ztst zsh-5.0.2/Test/C02cond.ztst
--- zsh-5.0.4/Test/C02cond.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/C02cond.ztst	2012-02-26 10:52:56.000000000 -0800
@@ -324,31 +324,6 @@
 >	fi
 >}
 
-  weirdies=(
-    '! -a !'
-    '! -o !'
-    '! -a'
-    '! -o'
-    '! -a ! -a !'
-    '! = !'
-    '! !'
-    '= -a o'
-    '! = -a o')
-  for w in $weirdies; do
-     eval test $w
-     print $?
-  done
-0:test compatability weirdness: treat ! as a string sometimes
->0
->0
->1
->0
->0
->0
->1
->0
->1
-
 %clean
   # This works around a bug in rm -f in some versions of Cygwin
   chmod 644 unmodish
diff -ruN zsh-5.0.4/Test/D02glob.ztst zsh-5.0.2/Test/D02glob.ztst
--- zsh-5.0.4/Test/D02glob.ztst	2013-12-16 14:06:13.000000000 -0800
+++ zsh-5.0.2/Test/D02glob.ztst	2010-02-20 14:18:57.000000000 -0800
@@ -433,96 +433,3 @@
  print glob.tmp/dir5/N<->(N)
 0:Numeric glob is not usurped by process substitution.
 >glob.tmp/dir5/N123
-
- tpd() {
-   [[ $1 = $~2 ]]
-  print -r "$1, $2: $?"
- }
- test_pattern_disables() {
-   emulate -L zsh
-   tpd 'forthcoming' 'f*g'
-   disable -p '*'
-   tpd 'forthcoming' 'f*g'
-   tpd 'f*g' 'f*g'
-   tpd '[frog]' '[frog]'
-   tpd '[frog]' '\[[f]rog\]'
-   disable -p '['
-   tpd '[frog]' '[frog]'
-   tpd '[frog]' '\[[f]rog\]'
-   setopt extendedglob
-   tpd 'foo' '^bar'
-   disable -p '^'
-   tpd 'foo' '^bar'
-   tpd '^bar' '^bar'
-   tpd 'rumble' '(rumble|bluster)'
-   tpd '(thunder)' '(thunder)'
-   disable -p '('
-   tpd 'rumble' '(rumble|bluster)'
-   tpd '(thunder)' '(thunder)'
-   setopt kshglob
-   tpd 'scramble' '@(panic|frenzy|scramble)'
-   tpd '@(scrimf)' '@(scrimf)'
-   disable -p '@('
-   tpd 'scramble' '@(panic|frenzy|scramble)'
-   tpd '@(scrimf)' '@(scrimf)'
-   disable -p
- }
- test_pattern_disables
- print Nothing should be disabled.
- disable -p
-0:disable -p
->forthcoming, f*g: 0
->forthcoming, f*g: 1
->f*g, f*g: 0
->[frog], [frog]: 1
->[frog], \[[f]rog\]: 0
->[frog], [frog]: 0
->[frog], \[[f]rog\]: 1
->foo, ^bar: 0
->foo, ^bar: 1
->^bar, ^bar: 0
->rumble, (rumble|bluster): 0
->(thunder), (thunder): 1
->rumble, (rumble|bluster): 1
->(thunder), (thunder): 0
->scramble, @(panic|frenzy|scramble): 0
->@(scrimf), @(scrimf): 1
->scramble, @(panic|frenzy|scramble): 1
->@(scrimf), @(scrimf): 0
->'(' '*' '[' '^' '@('
->Nothing should be disabled.
-
-  (
-   setopt nomatch
-   x=( '' )
-   print $^x(N)
-  )
-0:No error with empty null glob with (N).
->
-
-  (setopt kshglob
-   test_array=(
-     '+fours'    '+*'
-     '@titude'   '@*'
-     '!bang'     '!*'
-     # and check they work in the real kshglob cases too...
-     '+bus+bus'  '+(+bus|-car)'
-     '@sinhats'  '@(@sinhats|wrensinfens)'
-     '!kerror'   '!(!somethingelse)'
-     # and these don't match, to be sure
-     '+more'      '+(+less)'
-     '@all@all'   '@(@all)'
-     '!goesitall' '!(!goesitall)'
-   )
-   for str pat in $test_array; do
-     eval "[[ $str = $pat ]]" && print "$str matches $pat"
-   done
-   true
-  )
-0:kshglob option does not break +, @, ! without following open parenthesis
->+fours matches +*
->@titude matches @*
->!bang matches !*
->+bus+bus matches +(+bus|-car)
->@sinhats matches @(@sinhats|wrensinfens)
->!kerror matches !(!somethingelse)
diff -ruN zsh-5.0.4/Test/D03procsubst.ztst zsh-5.0.2/Test/D03procsubst.ztst
--- zsh-5.0.4/Test/D03procsubst.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/D03procsubst.ztst	2012-12-21 11:29:37.000000000 -0800
@@ -107,11 +107,3 @@
 >third: This becomes argument three
 >fourth: and this argument four
 
-  () {
-     # Make sure we don't close the file descriptor too early
-     eval 'print "Execute a complicated command first" | sed s/command/order/'
-     cat $1
-  } <(echo This line was brought to you by the letters F and D)
-0:Process substitution as anonymous function argument
->Execute a complicated order first
->This line was brought to you by the letters F and D
diff -ruN zsh-5.0.4/Test/D04parameter.ztst zsh-5.0.2/Test/D04parameter.ztst
--- zsh-5.0.4/Test/D04parameter.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/D04parameter.ztst	2012-04-29 11:39:21.000000000 -0700
@@ -1544,19 +1544,3 @@
 0:Regression test for shwordsplit with null or unset IFS and quoted array
 >abc
 >a b c
-
-   foo=
-   print ${foo:wq}
-   print ${:wq}
-0:Empty parameter shouldn't cause modifiers to crash the shell
->
->
-
-# This used to cause uncontrolled behaviour, but at best
-# you got the wrong output so the check is worth it.
-   args() { print $#; }
-   args ${:*}
-   args ${:|}
-0:Intersection and disjunction with empty parameters
->0
->0
diff -ruN zsh-5.0.4/Test/E01options.ztst zsh-5.0.2/Test/E01options.ztst
--- zsh-5.0.4/Test/E01options.ztst	2013-12-06 12:37:11.000000000 -0800
+++ zsh-5.0.2/Test/E01options.ztst	2011-12-07 12:17:41.000000000 -0800
@@ -83,13 +83,12 @@
 %prep
   mkdir options.tmp && cd options.tmp
 
-  mkdir tmpcd homedir
+  mkdir tmpcd
 
   touch tmpfile1 tmpfile2
 
   mydir=$PWD
   mydirt=`print -P %~`
-  mydirhome=`export HOME=$mydir/homedir; print -P %~`
   catpath=$(which cat)
   lspath==ls
 
@@ -514,10 +513,10 @@
   print *(#q:s/#(#b)tmp(*e)/'scrunchy${match[1]}'/)
   unsetopt histsubstpattern
 0:HIST_SUBST_PATTERN option
->TINGcd TINGfile1 TINGfile2 homedir
+>TINGcd TINGfile1 TINGfile2
 >THUMPcd THUMPfile1 THUMPfile2
 >one.c Two.X Three.X
->homedir scrunchyfile1 scrunchyfile2 tmpcd
+>scrunchyfile1 scrunchyfile2 tmpcd
 
   setopt ignorebraces
   echo X{a,b}Y
@@ -854,7 +853,6 @@
 
 # Do you have any idea how dull this is?
 
-  (export HOME=$mydir/homedir
   pushd $mydir/tmpcd
   pushd
   dirs
@@ -865,11 +863,11 @@
   popd
   pushd
   popd
-  dirs)
+  dirs
 0q:PUSHD_TO_HOME option
->$mydirhome $mydirhome/tmpcd
->~ $mydirhome $mydirhome/tmpcd
->$mydirhome
+>$mydirt $mydirt/tmpcd
+>~ $mydirt $mydirt/tmpcd
+>$mydirt
 
   array=(one two three four)
   setopt rcexpandparam
@@ -1069,7 +1067,6 @@
     fn2() {
       foo3=bar6
     }
-    foo4=bar7 =true
   }
   fn
 0:WARN_CREATE_GLOBAL option
@@ -1099,18 +1096,3 @@
 0:IGNORE_CLOSE_BRACES option
 >this is OK
 >6
-
-  (setopt pipefail
-  true | true | true
-  print $?
-  true | false | true
-  print $?
-  exit 2 | false | true
-  print $?
-  false | exit 2 | true
-  print $?)
-0:PIPE_FAIL option
->0
->1
->1
->2
diff -ruN zsh-5.0.4/Test/E02xtrace.ztst zsh-5.0.2/Test/E02xtrace.ztst
--- zsh-5.0.4/Test/E02xtrace.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/E02xtrace.ztst	2011-05-24 13:39:34.000000000 -0700
@@ -118,12 +118,3 @@
 ?+./fnfile:5> :
 ?+./fnfile:6> fn
 ?+./fnfile:3> print This is fn.
-
- set -x
- [[ 'f o' = 'f x'* || 'b r' != 'z o' && 'squashy sound' < 'squishy sound' ]]
- [[ -e nonexistentfile || ( -z '' && -t 3 ) ]]
- set +x
-0:Trace for conditions
-?+(eval):2> [[ 'f o' == f\ x* || 'b r' != z\ o && 'squashy sound' < 'squishy sound' ]]
-?+(eval):3> [[ -e nonexistentfile || -z '' && -t 3 ]]
-?+(eval):4> set +x
diff -ruN zsh-5.0.4/Test/V01zmodload.ztst zsh-5.0.2/Test/V01zmodload.ztst
--- zsh-5.0.4/Test/V01zmodload.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/V01zmodload.ztst	2011-05-31 11:45:39.000000000 -0700
@@ -183,7 +183,6 @@
 >p:dis_builtins
 >p:dis_functions
 >p:dis_galiases
->p:dis_patchars
 >p:dis_reswords
 >p:dis_saliases
 >p:funcfiletrace
@@ -201,7 +200,6 @@
 >p:nameddirs
 >p:options
 >p:parameters
->p:patchars
 >p:reswords
 >p:saliases
 >p:userdirs
diff -ruN zsh-5.0.4/Test/V03mathfunc.ztst zsh-5.0.2/Test/V03mathfunc.ztst
--- zsh-5.0.4/Test/V03mathfunc.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/V03mathfunc.ztst	2004-12-07 04:08:01.000000000 -0800
@@ -136,9 +136,3 @@
   done
   (( ok ))
 0:Test random number generator distributions are not grossly broken
-
-  float -F 5 g l
-  (( g = gamma(2), l = lgamma(2) ))
-  print $g, $l
-0:Test Gamma function gamma and lgamma
->1.00000, 0.00000
diff -ruN zsh-5.0.4/Test/V08zpty.ztst zsh-5.0.2/Test/V08zpty.ztst
--- zsh-5.0.4/Test/V08zpty.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/V08zpty.ztst	1969-12-31 16:00:00.000000000 -0800
@@ -1,28 +0,0 @@
-# zpty is required by tests of interactive modes of the shell itself.
-# This tests some extra things.
-
-%prep
-
-  if ! zmodload zsh/zpty 2>/dev/null
-  then
-    ZTST_unimplemented="the zsh/zpty module is not available"
-    return 0
-  fi
-
-%test
-
-  zpty cat cat
-  zpty -w cat a line of text
-  var=
-  zpty -r cat var && print -r -- ${var%%$'\r\n'}
-  zpty -d cat
-0:zpty with a process that does not set up the terminal: internal write
->a line of text
-
-  zpty cat cat
-  print a line of text | zpty -w cat
-  var=
-  zpty -r cat var && print -r -- ${var%%$'\r\n'}
-  zpty -d cat
-0:zpty with a process that does not set up the terminal: write via stdin
->a line of text
diff -ruN zsh-5.0.4/Test/X02zlevi.ztst zsh-5.0.2/Test/X02zlevi.ztst
--- zsh-5.0.4/Test/X02zlevi.ztst	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/Test/X02zlevi.ztst	1969-12-31 16:00:00.000000000 -0800
@@ -1,20 +0,0 @@
-# Tests of the vi mode of ZLE
-
-%prep
-  if ( zmodload -i zsh/zpty ) >/dev/null 2>&1; then
-    . $ZTST_srcdir/comptest
-    comptestinit -v -z $ZTST_testdir/../Src/zsh
-  else
-    ZTST_unimplemented="the zsh/zpty module is not available"
-  fi
-
-%test
-
-  zletest $'one two\ebmt3|`tx``'
-0:setting mark and returning to original position
->BUFFER: one wo
->CURSOR: 2
-
-%clean
-
-  zmodload -ui zsh/zpty
diff -ruN zsh-5.0.4/Test/comptest zsh-5.0.2/Test/comptest
--- zsh-5.0.4/Test/comptest	2013-12-17 12:17:12.000000000 -0800
+++ zsh-5.0.2/Test/comptest	2009-01-13 11:10:49.000000000 -0800
@@ -8,12 +8,10 @@
   zmodload -i zsh/zpty || return $?
 
   comptest_zsh=${ZSH:-zsh}
-  comptest_keymap=e
 
-  while getopts vz: opt; do
+  while getopts z: opt; do
     case $opt in
       z) comptest_zsh="$OPTARG";;
-      v) comptest_keymap="v";;
     esac
   done
   (( OPTIND > 1 )) && shift $(( OPTIND - 1 ))
@@ -32,11 +30,11 @@
 "export ZDOTDIR=$ZTST_testdir" \
 "module_path=( $module_path )" \
 "fpath=( $fpath )" \
-"bindkey -$comptest_keymap" \
 'LISTMAX=10000000
-stty 38400 columns 80 rows 24
 TERM=vt100
+stty columns 80 rows 24
 setopt zle
+bindkey -e
 autoload -U compinit
 compinit -u
 zstyle ":completion:*:default" list-colors "no=<NO>" "fi=<FI>" "di=<DI>" "ln=<LN>" "pi=<PI>" "so=<SO>" "bd=<BD>" "cd=<CD>" "ex=<EX>" "mi=<MI>" "tc=<TC>" "sp=<SP>" "lc=<LC>" "ec=<EC>\n" "rc=<RC>"
@@ -62,29 +60,18 @@
   zle clear-screen
   zle -R
 }
-comp-finish () {
+finish () {
   print "<WIDGET><finish>"
   zle kill-whole-line
   zle clear-screen
   zle -R
 }
-zle-finish () {
-  print -lr "<WIDGET><finish>" "BUFFER: $BUFFER" "CURSOR: $CURSOR"
-  (( region_active )) && print -lr "MARK: $MARK"
-  zle -K main
-  zle kill-whole-line
-  zle clear-screen
-  zle -R
-}
 zle -N expand-or-complete-with-report
 zle -N list-choices-with-report
-zle -N comp-finish
-zle -N zle-finish
+zle -N finish
 bindkey "^I" expand-or-complete-with-report
 bindkey "^D" list-choices-with-report
-bindkey "^Z" comp-finish
-bindkey "^M" zle-finish
-bindkey -a "^M" zle-finish
+bindkey "^Z" finish
 '
 }
 
@@ -133,13 +120,3 @@
     done
   done
 }
-
-zletest () {
-  input="$*"
-  zpty -n -w zsh "$input"$'\C-M'
-  zpty -r -m zsh log "*<WIDGET><finish>*<PROMPT>*" || {
-    print "failed to invoke finish widget."
-    return 1
-  }
-  print -lr "${(@)${(ps:\r\n:)log##*<WIDGET><finish>}[1,-2]}"
-}
diff -ruN zsh-5.0.4/Util/helpfiles zsh-5.0.2/Util/helpfiles
--- zsh-5.0.4/Util/helpfiles	2013-12-14 11:46:11.000000000 -0800
+++ zsh-5.0.2/Util/helpfiles	2006-03-13 11:03:55.000000000 -0800
@@ -2,10 +2,8 @@
 
 # helpfiles:  make help files for Z-shell builtins from the manual entries.
 
-# Create help files for zsh commands for the manpage file of zshbuildins.1
-# passed as the first arg.
-# The second arg is the directory in which the help files will be created.
-# Assumes no other files are present.
+# Create help files for zsh commands in the current directory;
+# assumes no other files are present.
 # No overwriting check;  `.' becomes `dot', `:' becomes `colon'.
 
 # Any command claiming to be `same as <foo>' or `equivalent to <foo>'
@@ -13,8 +11,14 @@
 # link to <foo>.  (Arguably the help file should be put at the start
 # instead.)
 
-# If a third arg is given, the symlink is not created, but a
-# list of symlinks is put into the file specified by that arg.
+# Takes one filename argument, or stdin: the zsh manual page as a plain
+# ascii file: `man zshbuiltins | colcrt -' (remember the -) should do
+# the trick.
+
+# If you don't have colcrt, try 'col -bx'.  The x is necessary so that
+# spaces don't turn into tabs, which messes up the calculations of
+# indentation on machines which randomly wrap lines round to the
+# previous line (so you see what we're up against).
 
 # Example usage:
 #    cd ~/zsh-4.0.1				# or wherever
@@ -35,79 +39,7 @@
 #    }
 # now <Esc>-h works for shell builtins.
 
-sub Usage {
-    print(STDERR "Usage: helpfiles zshbuiltins.1 dest-dir [link-file]\n");
-    exit(1);
-}
-
-sub Info {
-    print('helpfiles: ', @_, "\n");
-}
-
-sub Die {
-    print(STDERR 'helpfiles: ', @_, "\n");
-    exit(1);
-}
-
-&Usage() unless(@ARGV);
-$manfile = shift(@ARGV);
-&Usage() unless(@ARGV);
-$destdir = shift(@ARGV);
-$linkfile = ((@ARGV) ? shift(@ARGV) : '');
-unless(-d $destdir) {
-    mkdir($destdir) || &Die("$destdir is not a directory and cannot be created");
-}
-
-foreach (keys %ENV) {
-	delete($ENV{$_}) if(/^((LC_)|(LESS)|(MAN))/);
-}
-$ENV{'LANG'} = 'C';
-$ENV{'MANWIDTH'} = '80';
-$ENV{'GROFF_NO_SGR'} = ''; # We need "classical" formatting of man pages.
-
-$mantmp = $destdir . '/man.tmp';
-$coltmpbase = 'col.tmp';
-$coltmp = $destdir . '/' . $coltmpbase;
-$args = "$manfile >$mantmp";
-unlink($mantmp);
-&Info('attempting man ', $args);
-if(system('man ' . $args) || !(-s $mantmp)) {
-    unlink($mantmp);
-    &Info('attempting nroff -man ', $args);
-    if(system('nroff -man ' . $args) || !(-s $mantmp)) {
-        unlink($mantmp);
-        &Die('man and nroff -man both failed for ', $manfile);
-    }
-}
-$args = "$mantmp >$coltmp";
-unlink($coltmp);
-&Info('attempting colcrt ', $args);
-if(system('colcrt ' . $args) || !(-s $coltmp)) {
-    unlink($coltmp);
-    &Info('attempting col -bx <', $args);
-# The x is necessary so that spaces don't turn into tabs, which messes
-# up the calculations of indentation on machines which randomly wrap lines
-# round to the previous line (so you see what we're up against).
-    if(system('col -bx <' . $args) || !(-s $coltmp)) {
-        unlink($mantmp);
-        unlink($coltmp);
-        &Die('colcrt and col -bx both failed');
-    }
-}
-unlink($mantmp) || &Die('cannot remove tempfile ', $mantmp);
-
-unless(open(MANPAGE, '<', $coltmp)) {
-    unlink($coltmp);
-    &Die('generated tmpfile cannot be read');
-}
-
-unless($linkfile eq '') {
-    open(LINKFILE, '>', $linkfile) || &Die("cannot open $linkfile for writing")
-}
-
-chdir($destdir) || &Die("cannot cd to $destdir");
-
-while (<MANPAGE>) {
+while (<>) {
     last if /^\s*SHELL BUILTIN COMMANDS/;
     /zshbuiltins/ && $zb++;
     last if ($zb && /^\s*DESCRIPTIONS/);
@@ -117,7 +49,7 @@
 
 sub namesub {
     local($cmd) = shift;
-    if ($cmd =~ /^\w*$/ && lc($cmd) eq $cmd) {
+    if ($cmd =~ /^\w+$/) {
 	$cmd;
     } elsif ($cmd eq '.') {
 	'dot';
@@ -161,7 +93,7 @@
     print;
 }
 
-while (<MANPAGE>) { last unless /^\s*$/; }
+while (<>) { last unless /^\s*$/; }
 
 /^(\s+)(\S+)/;
 $indentstr = $1;
@@ -169,13 +101,13 @@
 &newcmd($2);
 print if $print;
 
-BUILTINS: while (<MANPAGE>) {
+BUILTINS: while (<>) {
     next if /^\w/;
 
     undef($undented);
     if (/^\s*$/ || ($undented = (/^(\s*)/  && length($1) < $indent))) {
 	$undented && &doprint($_);
-	while (defined($_ = <MANPAGE>) && /(^\w)|(^\s*$)/) {
+	while (defined($_ = <>) && /(^\w)|(^\s*$)/) {
 	    # NAME is the start of the next section when in zshall.
 	    # (Historical note: we used to exit on the page header,
 	    # but text from the old section can continue to the
@@ -186,11 +118,11 @@
 	}
         if (/^\s*Page/ || /^zsh.*\s\d$/) {
 	    do {
-		$_ = <MANPAGE>;
+		$_ = <>;
 	    } while (defined($_) && /^\s*$/);
 	    if (/^\s*ZSHBUILTINS/) {
 		do {
-		    $_ = <MANPAGE>;
+		    $_ = <>;
 		} while (defined($_) && /^\s*$/);
 	    }
 	}
@@ -200,7 +132,7 @@
 	    s/^\s*/ /;
 	    $defer = $_;
 	    do {
-		$_ = <MANPAGE>;
+		$_ = <>;
 	    } while (defined($_) && /^\s*$/);
 	    last unless defined($_);
 	}
@@ -225,8 +157,6 @@
 
 select STDOUT;
 close OUT;
-close(MANPAGE);
-unlink($coltmpbase) || &Die('cannot remove tempfile ', $coltmpbase);
 
 foreach $file (<*>) {
     open (IN, $file);
@@ -246,16 +176,8 @@
 
 	# Make this a link to that.
 	unlink $file;
-	if($linkfile eq '') {
-	    symlink ($sameas, $file);
-	} else {
-	    print(LINKFILE "$sameas $file\n");
-	}
+	symlink ($sameas, $file);
     }
 }
-close(LINKFILE) unless($linkfile eq '');
-
-# Make one sanity check
-&Die('not all files were properly generated') unless(-r 'ztcp');
 
 __END__
diff -ruN zsh-5.0.4/config.h.in zsh-5.0.2/config.h.in
--- zsh-5.0.4/config.h.in	2013-11-29 15:28:56.000000000 -0800
+++ zsh-5.0.2/config.h.in	2012-08-21 11:20:59.000000000 -0700
@@ -159,9 +159,6 @@
 /* Define to 1 if you have the <curses.h> header file. */
 #undef HAVE_CURSES_H
 
-/* Define to 1 if you have the `cygwin_conv_path' function. */
-#undef HAVE_CYGWIN_CONV_PATH
-
 /* Define to 1 if you have the `difftime' function. */
 #undef HAVE_DIFFTIME
 
@@ -505,9 +502,6 @@
 /* Define to 1 if RLIMIT_AS is present (whether or not as a macro). */
 #undef HAVE_RLIMIT_AS
 
-/* Define to 1 if RLIMIT_KQUEUES is present (whether or not as a macro). */
-#undef HAVE_RLIMIT_KQUEUES
-
 /* Define to 1 if RLIMIT_LOCKS is present (whether or not as a macro). */
 #undef HAVE_RLIMIT_LOCKS
 
@@ -526,15 +520,9 @@
 /* Define to 1 if RLIMIT_NPROC is present (whether or not as a macro). */
 #undef HAVE_RLIMIT_NPROC
 
-/* Define to 1 if RLIMIT_NPTS is present (whether or not as a macro). */
-#undef HAVE_RLIMIT_NPTS
-
 /* Define to 1 if RLIMIT_NTHR is present (whether or not as a macro). */
 #undef HAVE_RLIMIT_NTHR
 
-/* Define to 1 if RLIMIT_POSIXLOCKS is present (whether or not as a macro). */
-#undef HAVE_RLIMIT_POSIXLOCKS
-
 /* Define to 1 if RLIMIT_PTHREAD is present (whether or not as a macro). */
 #undef HAVE_RLIMIT_PTHREAD
 
@@ -550,9 +538,6 @@
 /* Define to 1 if RLIMIT_SIGPENDING is present (whether or not as a macro). */
 #undef HAVE_RLIMIT_SIGPENDING
 
-/* Define to 1 if RLIMIT_SWAP is present (whether or not as a macro). */
-#undef HAVE_RLIMIT_SWAP
-
 /* Define to 1 if RLIMIT_TCACHE is present (whether or not as a macro). */
 #undef HAVE_RLIMIT_TCACHE
 
@@ -863,9 +848,6 @@
 /* Define to 1 if you have the <term.h> header file. */
 #undef HAVE_TERM_H
 
-/* Define to 1 if you have the `tgamma' function. */
-#undef HAVE_TGAMMA
-
 /* Define to 1 if you have the `tgetent' function. */
 #undef HAVE_TGETENT
 
diff -ruN zsh-5.0.4/configure zsh-5.0.2/configure
--- zsh-5.0.4/configure	2013-11-29 15:28:55.000000000 -0800
+++ zsh-5.0.2/configure	2012-09-15 13:13:14.000000000 -0700
@@ -633,7 +633,6 @@
 PDFETEX
 YODL_OPTIONS
 YODL
-LN_S
 LN
 AWK
 INSTALL_DATA
@@ -660,8 +659,6 @@
 sitefndir
 fndir
 additionalfpath
-runhelp
-runhelpdir
 zlogout
 zlogin
 zprofile
@@ -741,7 +738,6 @@
 enable_restricted_r
 enable_locale
 enable_ansi2knr
-enable_runhelpdir
 enable_fndir
 enable_site_fndir
 enable_function_subdirs
@@ -1412,7 +1408,6 @@
   --disable-restricted-r  turn off r* invocation for restricted shell
   --disable-locale        turn off locale features
   --enable-ansi2knr       translate source to K&R C before compiling
-  --enable-runhelpdir=DIR the directory in which to install run-help files
   --enable-fndir=DIR      the directory in which to install functions
   --enable-site-fndir=DIR same for site functions (not version specific)
   --enable-function-subdirs
@@ -2796,26 +2791,6 @@
 fi
 
 
-# Check whether --enable-runhelpdir was given.
-if test "${enable_runhelpdir+set}" = set; then :
-  enableval=$enable_runhelpdir; if test x"$enableval" = xno; then
-  runhelpdir=
-else
-  runhelpdir="$enableval"
-fi
-else
-  runhelpdir=yes
-fi
-
-if test x"$runhelpdir" = xyes; then
-  runhelpdir=${datadir}/${tzsh_name}/'${VERSION}'/help
-fi
-if test x"$runhelpdir" = x; then
-  runhelp=
-else
-  runhelp=runhelp
-fi
-
 # Check whether --enable-fndir was given.
 if test "${enable_fndir+set}" = set; then :
   enableval=$enable_fndir; if test x$enableval = xyes; then
@@ -5107,17 +5082,7 @@
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
 fi
-                  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether ln -s works" >&5
-$as_echo_n "checking whether ln -s works... " >&6; }
-LN_S=$as_ln_s
-if test "$LN_S" = "ln -s"; then
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
-$as_echo "yes" >&6; }
-else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no, using $LN_S" >&5
-$as_echo "no, using $LN_S" >&6; }
-fi
-                { $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
+                  { $as_echo "$as_me:${as_lineno-$LINENO}: checking for egrep" >&5
 $as_echo_n "checking for egrep... " >&6; }
 if ${ac_cv_path_EGREP+:} false; then :
   $as_echo_n "(cached) " >&6
@@ -8247,7 +8212,7 @@
 	       getrlimit getrusage \
 	       setlocale \
 	       uname \
-	       signgam tgamma \
+	       signgam \
 	       putenv getenv setenv unsetenv xw\
 	       brk sbrk \
 	       pathconf sysconf \
@@ -8262,8 +8227,7 @@
 	       regcomp regexec regerror regfree \
 	       gdbm_open getxattr \
 	       realpath canonicalize_file_name \
-	       symlink getcwd \
-	       cygwin_conv_path
+	       symlink getcwd
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
@@ -10041,150 +10005,6 @@
 
 fi
 
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for limit RLIMIT_POSIXLOCKS" >&5
-$as_echo_n "checking for limit RLIMIT_POSIXLOCKS... " >&6; }
-if ${zsh_cv_have_RLIMIT_POSIXLOCKS+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <sys/types.h>
-#ifdef HAVE_SYS_TIME_H
-#include <sys/time.h>
-#endif
-#include <sys/resource.h>
-int
-main ()
-{
-RLIMIT_POSIXLOCKS
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  zsh_cv_have_RLIMIT_POSIXLOCKS=yes
-else
-  zsh_cv_have_RLIMIT_POSIXLOCKS=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $zsh_cv_have_RLIMIT_POSIXLOCKS" >&5
-$as_echo "$zsh_cv_have_RLIMIT_POSIXLOCKS" >&6; }
-
-if test $zsh_cv_have_RLIMIT_POSIXLOCKS = yes; then
-  $as_echo "#define HAVE_RLIMIT_POSIXLOCKS 1" >>confdefs.h
-
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for limit RLIMIT_NPTS" >&5
-$as_echo_n "checking for limit RLIMIT_NPTS... " >&6; }
-if ${zsh_cv_have_RLIMIT_NPTS+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <sys/types.h>
-#ifdef HAVE_SYS_TIME_H
-#include <sys/time.h>
-#endif
-#include <sys/resource.h>
-int
-main ()
-{
-RLIMIT_NPTS
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  zsh_cv_have_RLIMIT_NPTS=yes
-else
-  zsh_cv_have_RLIMIT_NPTS=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $zsh_cv_have_RLIMIT_NPTS" >&5
-$as_echo "$zsh_cv_have_RLIMIT_NPTS" >&6; }
-
-if test $zsh_cv_have_RLIMIT_NPTS = yes; then
-  $as_echo "#define HAVE_RLIMIT_NPTS 1" >>confdefs.h
-
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for limit RLIMIT_SWAP" >&5
-$as_echo_n "checking for limit RLIMIT_SWAP... " >&6; }
-if ${zsh_cv_have_RLIMIT_SWAP+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <sys/types.h>
-#ifdef HAVE_SYS_TIME_H
-#include <sys/time.h>
-#endif
-#include <sys/resource.h>
-int
-main ()
-{
-RLIMIT_SWAP
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  zsh_cv_have_RLIMIT_SWAP=yes
-else
-  zsh_cv_have_RLIMIT_SWAP=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $zsh_cv_have_RLIMIT_SWAP" >&5
-$as_echo "$zsh_cv_have_RLIMIT_SWAP" >&6; }
-
-if test $zsh_cv_have_RLIMIT_SWAP = yes; then
-  $as_echo "#define HAVE_RLIMIT_SWAP 1" >>confdefs.h
-
-fi
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking for limit RLIMIT_KQUEUES" >&5
-$as_echo_n "checking for limit RLIMIT_KQUEUES... " >&6; }
-if ${zsh_cv_have_RLIMIT_KQUEUES+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
-
-#include <sys/types.h>
-#ifdef HAVE_SYS_TIME_H
-#include <sys/time.h>
-#endif
-#include <sys/resource.h>
-int
-main ()
-{
-RLIMIT_KQUEUES
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  zsh_cv_have_RLIMIT_KQUEUES=yes
-else
-  zsh_cv_have_RLIMIT_KQUEUES=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $zsh_cv_have_RLIMIT_KQUEUES" >&5
-$as_echo "$zsh_cv_have_RLIMIT_KQUEUES" >&6; }
-
-if test $zsh_cv_have_RLIMIT_KQUEUES = yes; then
-  $as_echo "#define HAVE_RLIMIT_KQUEUES 1" >>confdefs.h
-
-fi
-
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking if RLIMIT_VMEM and RLIMIT_RSS are the same" >&5
 $as_echo_n "checking if RLIMIT_VMEM and RLIMIT_RSS are the same... " >&6; }
diff -ruN zsh-5.0.4/configure.ac zsh-5.0.2/configure.ac
--- zsh-5.0.4/configure.ac	2013-11-27 11:00:20.000000000 -0800
+++ zsh-5.0.2/configure.ac	2012-09-09 11:26:47.000000000 -0700
@@ -258,23 +258,6 @@
 AC_HELP_STRING([--enable-ansi2knr], [translate source to K&R C before compiling]),
 [ansi2knr="$enableval"], [ansi2knr=default])
 
-ifdef([runhelpdir],[undefine([runhelpdir])])dnl
-AC_ARG_ENABLE(runhelpdir,
-AC_HELP_STRING([--enable-runhelpdir=DIR], [the directory in which to install run-help files]),
-[if test x"$enableval" = xno; then
-  runhelpdir=
-else
-  runhelpdir="$enableval"
-fi], [runhelpdir=yes])
-if test x"$runhelpdir" = xyes; then
-  runhelpdir=${datadir}/${tzsh_name}/'${VERSION}'/help
-fi
-if test x"$runhelpdir" = x; then
-  runhelp=
-else
-  runhelp=runhelp
-fi
-
 ifdef([fndir],[undefine([fndir])])dnl
 AC_ARG_ENABLE(fndir,
 AC_HELP_STRING([--enable-fndir=DIR], [the directory in which to install functions]),
@@ -314,8 +297,6 @@
   additionalfpath="${enableval}"
 fi], [additionalfpath=""])
 
-AC_SUBST(runhelpdir)dnl
-AC_SUBST(runhelp)dnl
 AC_SUBST(additionalfpath)dnl
 AC_SUBST(fndir)dnl
 AC_SUBST(sitefndir)dnl
@@ -578,7 +559,6 @@
 AC_PROG_INSTALL             dnl Check for BSD compatible `install'
 AC_PROG_AWK                 dnl Check for mawk,gawk,nawk, then awk.
 AC_PROG_LN                  dnl Check for working ln, for "make install"
-AC_PROG_LN_S                dnl Use ln -s/ln/cp for "make install.runhelp"
 AC_PROG_EGREP               dnl sets $EGREP to grep -E or egrep
 AC_CHECK_PROGS([YODL], [yodl], [: yodl])
 
@@ -1242,7 +1222,7 @@
 	       getrlimit getrusage \
 	       setlocale \
 	       uname \
-	       signgam tgamma \
+	       signgam \
 	       putenv getenv setenv unsetenv xw\
 	       brk sbrk \
 	       pathconf sysconf \
@@ -1257,8 +1237,7 @@
 	       regcomp regexec regerror regfree \
 	       gdbm_open getxattr \
 	       realpath canonicalize_file_name \
-	       symlink getcwd \
-	       cygwin_conv_path)
+	       symlink getcwd)
 AC_FUNC_STRCOLL
 
 if test x$enable_cap = xyes; then
@@ -1832,10 +1811,6 @@
 zsh_LIMIT_PRESENT(RLIMIT_MSGQUEUE)
 zsh_LIMIT_PRESENT(RLIMIT_NICE)
 zsh_LIMIT_PRESENT(RLIMIT_RTPRIO)
-zsh_LIMIT_PRESENT(RLIMIT_POSIXLOCKS)
-zsh_LIMIT_PRESENT(RLIMIT_NPTS)
-zsh_LIMIT_PRESENT(RLIMIT_SWAP)
-zsh_LIMIT_PRESENT(RLIMIT_KQUEUES)
 
 AH_TEMPLATE([RLIMIT_VMEM_IS_RSS],
 [Define to 1 if RLIMIT_VMEM and RLIMIT_RSS both exist and are equal.])
