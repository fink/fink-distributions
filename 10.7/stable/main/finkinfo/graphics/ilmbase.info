Package: ilmbase
Version: 1.0.2
Revision: 2
Maintainer: David Fang <fangism@users.sourceforge.net>
Homepage: http://openexr.com/
Description: ILM base math library
License: BSD
Source: http://download.savannah.nongnu.org/releases/openexr/%n-%v.tar.gz
Source-MD5: 26c133ee8ca48e1196fbfb3ffe292ab4
Conflicts: openexr-dev
Replaces: openexr-dev
BuildDependsOnly: true
# BuildDepends: libtool14 (>= 1.5.26-1)
Depends: %N-shlibs
PatchScript: <<
	#!/bin/sh -ev
	# fix libtool?
	# libtoolize --force --copy
	# fix Makefiles for tests
	sed -i.orig -e '/^LDADD =/s|-L||g' \
		-e '/^LDADD =/s|[HI][a-z]*|&/lib&.la|g' \
		-e '/^LDADD =/s| \\\$||' -e '/-lImath/d' ImathTest/Makefile.in
	# optional: remove assert failures to collect errors
	sed -i.orig -e '/assert (false)/d' HalfTest/testBitPatterns.cpp
<<
ConfigureParams: --enable-shared --disable-static
CompileScript: <<
	#!/bin/sh -ev
	./configure %c
	make
<<
InfoTest: TestScript: make -k check || exit 2
InstallScript: <<
	#!/bin/sh -ev
	make DESTDIR=%d install
	pushd %i/lib
	for f in Half Iex Imath IlmThread
	do
		# replace symlink with versioned lib
		rm -f lib$f.6.dylib
		mv lib$f.6.0.0.dylib lib$f.6.dylib
		ln -f -s lib$f.6.dylib lib$f.dylib
		sed -i.orig -e '/^library_names=/s|lib[HI].*\.0\.0\.dylib ||g' lib$f.la
	done
		rm -f *.la.orig
	popd
<<
DocFiles: AUTHORS ChangeLog COPYING LICENSE NEWS README README.OSX
SplitOff: <<
Package: %N-shlibs
Description: Shared libraries for ilmbase
Files: <<
          lib/libHalf.6.dylib
          lib/libIex.6.dylib
          lib/libIlmThread.6.dylib
          lib/libImath.6.dylib
<<
Shlibs: <<
          %p/lib/libHalf.6.dylib 7.0.0 %n (>= 1.0.0-1)
          %p/lib/libIex.6.dylib 7.0.0 %n (>= 1.0.0-1)
          %p/lib/libIlmThread.6.dylib 7.0.0 %n (>= 1.0.0-1)
          %p/lib/libImath.6.dylib 7.0.0 %n (>= 1.0.0-1)
<<
DocFiles: AUTHORS ChangeLog COPYING LICENSE NEWS README README.OSX
<<
DescDetail: <<
Math library used as the foundation for openexr, from ILM.
<<
DescPort: <<
libHalf is known to fail some tests on powerpc-darwin8.
<<
DescPackaging: <<
Makefile.in generated by automake-1.9.6, in case we need to re-automake.
Conflicts/Replaces old openexr-dev, which basically included ilmbase.
License is a modified BSD license: http://openexr.com/license.html
<<
